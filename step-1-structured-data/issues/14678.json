{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14678",
  "author": "237dmitry",
  "body": "## Summary of the new feature/enhancement\r\n\r\nTest-Connection cmdlet in linux works only when pwsh is elevated by sudo \r\nIt would be better to use Test-Connection as ordinary user. Like /usr/bin/ping, for example.\r\n\r\n## Proposed technical implementation details (optional)\r\n",
  "closed_at": "2021-01-29T17:11:09Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I cannot repro this on Ubuntu 18.04 with pwsh 7.1.0, where I'm able to run `Test-Connect` as a regular user (see below).\r\n@237dmitry please provide more information about the Environment you run into this.\r\n\r\n```\r\nPS:44> whoami\r\ndaxian\r\nPS:45> Test-Connection www.bing.com\r\n\r\n   Destination: www.bing.com\r\n\r\nPing Source           Address                   Latency BufferSize Status\r\n                                                   (ms)        (B)\r\n---- ------           -------                   ------- ---------- ------\r\n   1 dongbo-pro7      204.79.197.200                  3         32 Success\r\n   2 dongbo-pro7      204.79.197.200                  3         32 Success\r\n   3 dongbo-pro7      204.79.197.200                  3         32 Success\r\n   4 dongbo-pro7      204.79.197.200                  3         32 Success\r\n```\r\n",
      "created_at": "2021-01-28T18:11:31Z",
      "updated_at": "2021-01-28T18:13:15Z"
    },
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "I have been trying pwsh snap. The same result:\r\n\r\n```\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[123]\u2500[00:00.008]\u2500[114,34]\r\n > uname -r                      \r\n5.10.9-169.current\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[124]\u2500[00:00.008]\u2500[114,34]\r\n > lsb_release -a                \r\nLSB Version:\t1.4\r\nDistributor ID:\tSolus\r\nDescription:\tSolus\r\nRelease:\t4.1\r\nCodename:\tfortitude\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[125]\u2500[00:00.018]\u2500[114,34]\r\n > $Env:USER                     \r\nherz\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[126]\u2500[00:00.003]\u2500[114,34]\r\n > Test-Connection bing.com\r\nTest-Connection: Testing connection to computer 'bing.com' failed: An exception occurred during a Ping request.\r\nTest-Connection: Testing connection to computer 'bing.com' failed: An exception occurred during a Ping request.\r\nTest-Connection: Testing connection to computer 'bing.com' failed: An exception occurred during a Ping request.\r\nTest-Connection: Testing connection to computer 'bing.com' failed: An exception occurred during a Ping request.\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[127]\u2500[00:00.056]\u2500[114,34]\r\n > pwsh-root                     \r\nPassword:     \r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[/home/herz]\u2500[0]\u2500[001]\u2500[00:00.177]\u2500[114,34]\r\n > $Env:USER                     \r\nroot\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[/home/herz]\u2500[0]\u2500[002]\u2500[00:00.006]\u2500[114,34]\r\n > Test-Connection bing.com      \r\n\r\n   Destination: bing.com\r\n\r\nPing Source           Address                   Latency BufferSize Status\r\n                                                   (ms)        (B)\r\n---- ------           -------                   ------- ---------- ------\r\n   1 mymsi            2620:1ec:c11::200              83         32 Success\r\n   2 mymsi            2620:1ec:c11::200              50         32 Success\r\n   3 mymsi            2620:1ec:c11::200              50         32 Success\r\n   4 mymsi            2620:1ec:c11::200              49         32 Success\r\n\r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[/home/herz]\u2500[0]\u2500[003]\u2500[00:03.301]\u2500[114,34]\r\n > exit                    \r\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[~]\u2500[0]\u2500[128]\u2500[00:34.583]\u2500[114,34]\r\n >    \r\n\r\n\r\n```\r\nPS. `pwsh-root` is the script for user's environment after `sudo`",
      "created_at": "2021-01-28T20:46:59Z",
      "updated_at": "2021-01-28T20:46:59Z"
    },
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "Get-Error output:\r\n\r\n```\r\n > Get-Error\r\n\r\nException             : \r\n    Type           : System.Net.NetworkInformation.PingException\r\n    Message        : Testing connection to computer 'bing.com' failed: An exception occurred during a Ping request.\r\n    InnerException : \r\n        Type       : System.Net.NetworkInformation.PingException\r\n        TargetSite : \r\n            Name          : MoveNext\r\n            DeclaringType : System.Net.NetworkInformation.Ping+<SendWithPingUtilityAsync>d__76, System.Net.Ping, Version=5.0.0.0, Cu\r\nlture=neutral, PublicKeyToken=b03f5f7f11d50a3a\r\n            MemberType    : Method\r\n            Module        : System.Net.Ping.dll\r\n        StackTrace : \r\n   at System.Net.NetworkInformation.Ping.SendWithPingUtilityAsync(IPAddress address, Byte[] buffer, Int32 timeout, PingOptions options)\r\n   at System.Net.NetworkInformation.Ping.SendPingAsyncCore(IPAddress address, Byte[] buffer, Int32 timeout, PingOptions options)\r\n   at System.Net.NetworkInformation.Ping.SendPingAsyncInternal(IPAddress address, Int32 timeout, Byte[] buffer, PingOptions options)\r\n        Message    : An exception occurred during a Ping request.\r\n        Source     : System.Net.Ping\r\n        HResult    : -2146233079\r\n    HResult        : -2146233079\r\nTargetObject          : bing.com\r\nCategoryInfo          : ResourceUnavailable: (bing.com:String) [Test-Connection], PingException\r\nFullyQualifiedErrorId : TestConnectionException,Microsoft.PowerShell.Commands.TestConnectionCommand\r\nInvocationInfo        : \r\n    MyCommand        : Test-Connection\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 127\r\n    Line             : Test-Connection bing.com\r\n    PositionMessage  : At line:1 char:1\r\n                       + Test-Connection bing.com\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : Test-Connection\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : \r\n\r\n```",
      "created_at": "2021-01-28T20:56:24Z",
      "updated_at": "2021-01-28T20:56:24Z"
    },
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "I'm solved the problem. By setting suid bit for pwsh.\r\n\r\n```\r\nsudo chmod 4755 /opt/microsoft/powershell/7/pwsh\r\n```",
      "created_at": "2021-01-29T17:11:03Z",
      "updated_at": "2021-01-29T17:11:03Z"
    }
  ],
  "created_at": "2021-01-28T17:28:40Z",
  "number": 14678,
  "state": "closed",
  "title": "Question Request",
  "updated_at": "2021-01-29T17:11:09Z"
}