{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13778",
  "author": "robertwesterlund",
  "body": "As was discussed and changed as of #3424, the `ConvertFrom-Json` cmdlet now enumerates arrays and provides a `-NoEnumerate` switch to use the old behavior.\r\n\r\nHowever, the `Invoke-RestMethod` cmdlet, which behaves in the same non-conventional way as the old version of `ConvertFrom-Json` was not changed at the same time, so this cmdlet is still deviating from the expected PowerShell behavior.\r\n\r\nBased on the fact that [the PowerShell committee decided to support adding a `-NoEnumerate` switch for the same deviation in `ConvertFrom-Json`](https://github.com/PowerShell/PowerShell/issues/3424#issuecomment-550556633) it seems logical to ensure that the other cmdlet which causes the same issues for people should be changed in the same way.\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\n$port = 41732\r\n\r\n$job = Start-Job {\r\n  PARAM(\r\n    $Port\r\n  )\r\n  $listener = [System.Net.HttpListener]::new()\r\n\r\n  $prefix = \"http://localhost:$Port/\"\r\n  $listener.Prefixes.Add($prefix)\r\n  $listener.Start()\r\n\r\n  Write-Output \"Waiting for requests on $prefix\"\t\r\n  $httpContext = $listener.GetContext()\r\n  Write-Output \"Received Request\"\r\n  $responseContent = [Text.Encoding]::Utf8.GetBytes('[1,2,3]')\r\n  $response = $httpContext.Response\r\n  $response.StatusCode = 200\r\n  $response.ContentType = 'application/json'\r\n  $response.ContentLength64 = $responseContent.Length\r\n  $response.OutputStream.Write($responseContent, 0, $responseContent.Length)\r\n  $response.OutputStream.Close()\r\n  $listener.Close()\r\n  $listener.Dispose()\t\r\n  Write-Output \"Response send, server shut down\"\r\n} -ArgumentList $port\r\n\r\n# Wait for the job to output that it is waiting for requests\r\nwhile(-not($job | receive-job))\r\n{\r\n  Start-Sleep -Milliseconds 250\r\n}\r\n\r\ninvoke-restmethod \"http://localhost:$port/\" | measure | select -expand count\r\n```\r\n\r\n## Expected behavior\r\n\r\nThe output presented should be:\r\n\r\n```none\r\n3\r\n```\r\n\r\n## Actual behavior\r\n\r\nThe output written is:\r\n```none\r\n1\r\n```\r\n\r\n## Environment data\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.0.3\r\nPSEdition                      Core\r\nGitCommitId                    7.0.3\r\nOS                             Microsoft Windows 10.0.19041\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": null,
  "comments": [],
  "created_at": "2020-10-13T19:47:46Z",
  "number": 13778,
  "state": "open",
  "title": "`Invoke-RestMethod` pipes the whole array as a single object instead of a single object for each each entry in the array, deviating from PowerShell conventions and `ConvertFrom-Json`",
  "updated_at": "2020-10-14T05:14:16Z"
}