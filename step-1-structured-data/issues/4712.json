{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4712",
  "author": "HumanEquivalentUnit",
  "body": "<!--\r\n\r\nIf it is a bug report:\r\n- make sure you are able to repro it on the latest released version. \r\nYou can install the latest version from https://github.com/PowerShell/PowerShell/releases\r\n- Search the existing issues.\r\n- Refer to the [FAQ](../docs/FAQ.md).\r\n- Refer to the [known issues](../docs/KNOWNISSUES.md).\r\n- Fill out the following repro template\r\n\r\nIf it's not a bug, please remove the template and elaborate the issue in your own words.\r\n-->\r\n\r\nSteps to reproduce\r\n---------------------\r\n\r\n```powershell\r\nPS C:\\> '' -split '', 0, 'singleline,multiline'\r\nThe combination of options with the -split operator is not valid.\r\n    + CategoryInfo          : ParserError: (:) [], ParseException\r\n    + FullyQualifiedErrorId : InvalidSplitOptionCombination\r\n```\r\n\r\nBut it is not an invalid combination, they do different things, and it is common and useful to use them together.\r\n\r\nThe PowerShell spec v 3.0, section 7.8.4.5 \"Binary split operator\" says:\r\n\r\n> [an options string] must not contain both Multiline and Singleline.\r\n> Multiline: This mode recognizes the start and end of lines and strings. The default mode is Singleline.\r\n\r\nSingleline is not the default of Multiline, they are not two sides of the same option. Multiline changes how the regex characters `^` and `$` work with newlines in a string, and Singleline changes how the regex character `.` works with newlines in a string. It is valid to use both options to change both `^$` and `.` at the same time.\r\n\r\ne.g.\r\n\r\n```powershell\r\n$text = @'\r\na12a\r\nb34b\r\nc56c\r\nd78d\r\n'@\r\n\r\n# The following split fails, because '^' only matches the start of the entire string, \r\n# and 'b' is not at the start of the string:\r\n$text -split '^b'\r\n\r\n# Enable 'Multiline' mode and '^' now matches the start of each line in the string\r\n# and this now succeeds:\r\n$text -split '^b', $numSplits, 'multiline'\r\n\r\n# The following split fails, because '.+' only matches to the end of the line, and never gets to 'c'\r\n$text -split 'b.+c'\r\n\r\n# Enable 'Singleline' mode and '.' now matches over newlines\r\n# and this now succeeds:\r\n$text -split 'b.+c', $numSplits, 'singleline'\r\n\r\n# To combine them and match from \"the b at the start of a line,\r\n# over newlines and up to the last c\" needs both singleline and multiline options.\r\n# This fails and throws an exception:\r\n$text -split '^b.+c', $numSplits, 'singleline, multiline'\r\n\r\n# but you can turn both on at the same time using regex syntax:\r\n# so it can and does work, if you work around PowerShell:\r\n$text -split '(?ms)^b.+c'\r\n# splits on the text b34b`nc56c\r\n\r\n# and you can also do it with the options string passed to the [regex] accelerator:\r\n# This works, too:\r\nPS D:\\> [regex]::Split($text, '^b.+c', 'singleline,multiline')\r\na12a\r\n\r\n\r\nd78d\r\n```\r\n\r\nThe documentation in `Get-Help about_split` is also incorrect:\r\n\r\n>          -- Multiline: Multiline mode recognizes the start and end of lines\r\n>             and strings. Valid only with RegexMatch. Singleline is the default.\r\n>\r\n>          -- Singleline: Singleline mode recognizes only the start and end of\r\n>             strings. Valid only with RegexMatch. Singleline is the default.\r\n\r\n\r\n - [Link to source code of parserutils.cs where the error is thrown](https://github.com/PowerShell/PowerShell/blob/7a55bf98b2370ab4817ab2533cb67673053ee446/src/System.Management.Automation/engine/lang/parserutils.cs#L726)\r\n\r\n - [Link to source code of parserutils.cs where the comment in the SplitOptionsEnum has the same inaccurate suggestion that one is the default setting of the other](https://github.com/PowerShell/PowerShell/blob/7a55bf98b2370ab4817ab2533cb67673053ee446/src/System.Management.Automation/engine/lang/parserutils.cs#L295)\r\n\r\nExpected behavior\r\n-----------------\r\n\r\nSpecifying an options string `'singleline,multiline'` is valid, and enables both Singleline and Multiline mode.\r\n\r\nThe documentation is accurate.\r\n\r\nActual behavior\r\n---------------\r\n\r\nIt throws an exception and misleadingly says they are invalid together.\r\n\r\nThe documentation is inaccurate in three senses - implying there is one option being set instead of two, implying Singleline is the opposite of Multiline, and stating Singleline \"is the default\" when Singleline itself is off by default.\r\n\r\nEnvironment data\r\n----------------\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```powershell\r\n> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.0.0-beta\r\nPSEdition                      Core\r\nGitCommitId                    v6.0.0-beta.6\r\nOS                             Linux 2.6.32-042stab120.6 #1 SMP Thu Oct 27 16:59:03 MSK 2016\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```",
  "closed_at": "2017-09-08T16:23:39Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@HumanEquivalentUnit Thanks for your report!\r\n\r\nCould you please open Issue in [PowerShell Docs](https://github.com/PowerShell/PowerShell-Docs) repo to fix documentation?",
      "created_at": "2017-08-31T14:07:03Z",
      "updated_at": "2017-08-31T14:07:03Z"
    },
    {
      "author": "argonym",
      "author_association": "NONE",
      "body": "`about_Split` docs should be adjusted to reflect this change.",
      "created_at": "2020-02-26T16:27:57Z",
      "updated_at": "2020-02-26T16:28:18Z"
    }
  ],
  "created_at": "2017-08-30T23:39:03Z",
  "number": 4712,
  "state": "closed",
  "title": "-split operator doesn't let you use options SingleLine and MultiLine at the same time (and it should)",
  "updated_at": "2020-02-26T16:28:18Z"
}