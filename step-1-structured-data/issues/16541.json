{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16541",
  "author": "some-sh",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nTried installing the module [SNMP](https://www.powershellgallery.com/packages/SNMP/1.0.0.1) from [PowerShellGallery](https://www.powershellgallery.com/). The below error was thrown:\r\n``` PowerShell\r\n\u279c ~  Install-Module -Name SNMP\r\nInstall-Module: The 'Install-Module' command was found in the module 'PowerShellGet', but the module could not be loaded. For more information, run 'Import-Module PowerShellGet'.\r\n```\r\nSo I tried 'Import-Module PowerShellGet`, the below error was thrown:\r\n``` PowerShell\r\n\u279c ~  Import-Module PowerShellGet\r\nImport-Module: Errors occurred while loading the format data file:\r\nC:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml, , C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml: The file was skipped because of the following validation exception: File C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml cannot be loaded because its operation is blocked by software restriction policies, such as those created by using Group Policy..\r\n```\r\nTried several fixes like setting execution policy, changed the 'SecurityProtocol' according to this [announcement](https://devblogs.microsoft.com/powershell/powershell-gallery-tls-support/), nothing worked\r\n\r\nI've been facing this issue for quite some time now. Please let me know if anymore detail is required. \r\n``` PowerShell\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\n\n### Expected behavior\n\n```console\nPS> Install-Module -Name SNMP\r\n... Module installed successfully (Not sure about the actual output)\n```\n\n\n### Actual behavior\n\n```console\nPS> Install-Module -Name SNMP\r\nInstall-Module: The 'Install-Module' command was found in the module 'PowerShellGet', but the module could not be loaded. For more information, run 'Import-Module PowerShellGet'\n```\n\n\n### Error details\n\n```console\nPSMessageDetails      :\r\nException             : System.Management.Automation.CommandNotFoundException: The 'Install-Module' command was found in the module 'PowerShellGet', but\r\n                        the module could not be loaded. For more information, run 'Import-Module PowerShellGet'.\r\n                         ---> System.Management.Automation.CmdletInvocationException: Errors occurred while loading the format data file:\r\n                        C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml, , C:\\program\r\n                        files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml: The file was skipped because of the following\r\n                        validation exception: File C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml cannot be\r\n                        loaded because its operation is blocked by software restriction policies, such as those created by using Group Policy..\r\n\r\n                         ---> System.Management.Automation.RuntimeException: Errors occurred while loading the format data file:\r\n                        C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml, , C:\\program\r\n                        files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml: The file was skipped because of the following\r\n                        validation exception: File C:\\program files\\powershell\\7\\Modules\\PackageManagement\\PackageManagement.format.ps1xml cannot be\r\n                        loaded because its operation is blocked by software restriction policies, such as those created by using Group Policy..\r\n\r\n                           at System.Management.Automation.Runspaces.InitialSessionState.ThrowTypeOrFormatErrors(String resourceString, String errorMsg,\r\n                        String errorId)\r\n                           at System.Management.Automation.Runspaces.InitialSessionState.UpdateFormats(ExecutionContext context, Boolean update)\r\n                           at System.Management.Automation.Runspaces.InitialSessionState.Bind_UpdateFormats(ExecutionContext context, Boolean updateOnly)\r\n                           at System.Management.Automation.Runspaces.InitialSessionState.<>c__DisplayClass130_0.<Bind>b__1()\r\n                           at System.Management.Automation.Runspaces.InitialSessionState.Bind(ExecutionContext context, Boolean updateOnly, PSModuleInfo\r\n                        module, Boolean noClobber, Boolean local, Boolean setLocation)\r\n                           at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadModuleManifest(String moduleManifestPath, ExternalScriptInfo\r\n                        manifestScriptInfo, Hashtable data, Hashtable localizedData, ManifestProcessingFlags manifestProcessingFlags, Version\r\n                        minimumVersion, Version maximumVersion, Version requiredVersion, Nullable`1 requiredModuleGuid, ImportModuleOptions& options,\r\n                        Boolean& containedErrors)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Management.Automation.Runspaces.PipelineBase.Invoke(IEnumerable input)\r\n                           at System.Management.Automation.PowerShell.Worker.ConstructPipelineAndDoWork(Runspace rs, Boolean performSyncInvoke)\r\n                           at System.Management.Automation.PowerShell.CoreInvokeHelper[TInput,TOutput](PSDataCollection`1 input, PSDataCollection`1\r\n                        output, PSInvocationSettings settings)\r\n                           at System.Management.Automation.PowerShell.CoreInvoke[TInput,TOutput](PSDataCollection`1 input, PSDataCollection`1 output,\r\n                        PSInvocationSettings settings)\r\n                           at System.Management.Automation.PowerShell.Invoke[T](IEnumerable input, IList`1 output, PSInvocationSettings settings)\r\n                           at System.Management.Automation.PowerShell.Invoke[T]()\r\n                           at System.Management.Automation.CommandDiscovery.AutoloadSpecifiedModule(String moduleName, ExecutionContext context,\r\n                        SessionStateEntryVisibility visibility, Exception& exception)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Management.Automation.CommandDiscovery.TryModuleAutoDiscovery(String commandName, ExecutionContext context, String\r\n                        originalCommandName, CommandOrigin commandOrigin, SearchResolutionOptions searchResolutionOptions, CommandTypes commandTypes,\r\n                        Exception& lastError)\r\n                           at System.Management.Automation.CommandDiscovery.LookupCommandInfo(String commandName, CommandTypes commandTypes,\r\n                        SearchResolutionOptions searchResolutionOptions, CommandOrigin commandOrigin, ExecutionContext context)\r\n                           at System.Management.Automation.ExecutionContext.CreateCommand(String command, Boolean dotSource)\r\n                           at System.Management.Automation.PipelineOps.AddCommand(PipelineProcessor pipe, CommandParameterInternal[] commandElements,\r\n                        CommandBaseAst commandBaseAst, CommandRedirection[] redirections, ExecutionContext context)\r\n                           at System.Management.Automation.PipelineOps.InvokePipeline(Object input, Boolean ignoreInput, CommandParameterInternal[][]\r\n                        pipeElements, CommandBaseAst[] pipeElementAsts, CommandRedirection[][] commandRedirections, FunctionContext funcContext)\r\n                           at System.Management.Automation.Interpreter.ActionCallInstruction`6.Run(InterpretedFrame frame)\r\n                           at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\nTargetObject          : Install-Module\r\nCategoryInfo          : ObjectNotFound: (Install-Module:String) [], CommandNotFoundException\r\nFullyQualifiedErrorId : CouldNotAutoloadMatchingModule\r\nErrorDetails          :\r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {}\n```\n\n\n### Environment data\n\n```powershell\nPS> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2021-12-15T00:00:41Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Please create new issue in https://github.com/PowerShell/PowerShellGet\n\n<blockquote><img src=\"https://opengraph.githubassets.com/72b54cc0469638eab9813110982d7dc35c7b4b49eeb09fd0ad36d784cb46ac81/PowerShell/PowerShellGet\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/PowerShellGet\">GitHub - PowerShell/PowerShellGet: PowerShellGet is the package manager for PowerShell</a></strong></div><div>PowerShellGet is the package manager for PowerShell - GitHub - PowerShell/PowerShellGet: PowerShellGet is the package manager for PowerShell</div></blockquote>",
      "created_at": "2021-12-02T16:11:18Z",
      "updated_at": "2021-12-02T16:11:20Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "The exception is thrown from the following code that is checking on whether the system is locked down.\r\n@some-sh Does your computer have a system-wide lock-down through WLDP or AppLocker?  /cc @TravisEz13 \r\n\r\nhttps://github.com/PowerShell/PowerShell/blob/64d2fe26f3957eeb400e48234accbc8e643ef929/src/System.Management.Automation/security/SecurityManager.cs#L170-L180",
      "created_at": "2021-12-02T17:34:50Z",
      "updated_at": "2021-12-02T17:59:01Z"
    },
    {
      "author": "some-sh",
      "author_association": "NONE",
      "body": "> Does your computer have a system-wide lock-down through WLDP or AppLocker\r\n\r\n@daxian-dbw  I'm sorry, I don't know how to check this. May I know?",
      "created_at": "2021-12-05T12:32:20Z",
      "updated_at": "2021-12-05T12:32:20Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "This code pass is only when you have AppLocker disallow policies.\r\nYou really need to work with your IT department.  \r\nThese are the documents to get the Group Policy, which is how AppLocker policy is applied.\r\nhttps://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult\r\n`gpresult /h <path to report.html>`\n\n<blockquote><img src=\"https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png\" width=\"48\" align=\"right\"><div><strong><a href=\"https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult\">gpresult</a></strong></div><div>Reference article for the gpresult command, which displays the Resultant Set of Policy (RSoP) information for a remote user and computer.</div></blockquote>",
      "created_at": "2021-12-07T00:31:06Z",
      "updated_at": "2021-12-07T00:31:08Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "Here is the documentation about AppLocker script policy:\r\nhttps://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/script-rules-in-applocker\n\n<blockquote><img src=\"https://docs.microsoft.com/en-us/media/logos/logo-ms-social.png\" width=\"48\" align=\"right\"><div><strong><a href=\"https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/script-rules-in-applocker\">Script rules in AppLocker (Windows) - Windows security</a></strong></div><div>This topic describes the file formats and available default rules for the script rule collection.</div></blockquote>",
      "created_at": "2021-12-07T00:33:03Z",
      "updated_at": "2021-12-07T00:33:05Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "Adding needs triage to make sure the security WG reviews this.\r\n",
      "created_at": "2021-12-07T00:43:52Z",
      "updated_at": "2021-12-07T00:43:52Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "@WG-Security\r\nWe agree the above investigation.  It is not clear what policy is being applied so it is not possible to comment more, except that the policy requires that PowerShell denies loading PowerShellGet.  We recommend that you investigate the AppLocker policy applied to the system.",
      "created_at": "2021-12-13T21:39:22Z",
      "updated_at": "2021-12-13T21:39:22Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as answered and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2021-12-15T00:00:40Z",
      "updated_at": "2021-12-15T00:00:40Z"
    }
  ],
  "created_at": "2021-12-02T16:02:05Z",
  "number": 16541,
  "state": "closed",
  "title": "Unable to install a module from PSGallery",
  "updated_at": "2021-12-15T00:00:41Z"
}