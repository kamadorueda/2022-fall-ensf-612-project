{
  "_url": "https://github.com/PowerShell/PowerShell/issues/9305",
  "author": "bergmeister",
  "body": "# PR Summary\r\n\r\nFixes #8919 \r\n\r\nPreserve user shortcuts pinned to Taskbar during MSI upgrade by not removing shortcuts in this case (assuming the user has not changed the installation directory), see https://stackoverflow.com/a/33402698/1810304\r\nThis also requires the Guid to not always be re-generated, which PR #7701 originally added to ensure shortcuts get removed when RTM and preview are installed, the underlying problem was rather that RTM and preview shared the same GUIDs, therefore the GUIDs are hard-coded again but different for RTM and preview, therefore the shortcuts will still always get removed on uninstall. But this also means those GUIDs should change when the default installation directory changes, i.e. in PowerShell 7. Should we write the code to already take this into account that it does not get forgotten?\r\n\r\nTested by first reproducing the issue by building installers locally (and bumping the patch version. Then the fix was applied to verify the solution, it. For this to take effect the version from which an MSI is being upgraded must have this fix already, i.e. if this fix got shipped in `6.2.1`, then on ugrading to it, the issue would still occur but when upgrading `6.2.1` to `6.2.2` the shortcut would start being preserved. I am wondering if we could maybe improve this to show effect earlier by trying to extract the used (auto-generated) GUIDs in the `6.2.0` and `6.2.0-rc` packages out and use them...\r\nPlease not that we probably need to take this out for `7.0` because the base installation directory will change. This also assumes that the user has not specified a different installation directory on upgrade but this is a bit of an edge case where I think other things might break as well.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [ ] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [x] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n",
  "closed_at": "2019-04-07T19:25:57Z",
  "comments": [
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@bergmeister, your last commit had 1 failures in `PowerShell-CI-windows`\r\nPowerShellGet - Module tests.Should install a module correctly to the required location with default CurrentUser scope\r\n```powershell\r\nExpected a value, but got $null or empty.\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\PowerShellGet\\PowerShellGet.Tests.ps1: line 134\r\n134:         $installedModuleInfo | Should -Not -BeNullOrEmpty\r\n```\r\n",
      "created_at": "2019-04-05T23:05:18Z",
      "updated_at": "2019-04-05T23:05:18Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@PoshChan Please retry PowerShell-CI-windows",
      "created_at": "2019-04-05T23:35:09Z",
      "updated_at": "2019-04-05T23:36:09Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13, I do not understand the build target(s) `PowerShell-CI-windows`; I only allow `static`, `windows`, `macos`, `linux`, `all`",
      "created_at": "2019-04-05T23:35:11Z",
      "updated_at": "2019-04-05T23:36:01Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@PoshChan please retry windws",
      "created_at": "2019-04-05T23:35:28Z",
      "updated_at": "2019-04-05T23:35:56Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@PoshChan please retry windows",
      "created_at": "2019-04-05T23:35:40Z",
      "updated_at": "2019-04-05T23:35:40Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13, I do not understand the build target(s) `windws`; I only allow `static`, `windows`, `macos`, `linux`, `all`",
      "created_at": "2019-04-05T23:35:41Z",
      "updated_at": "2019-04-05T23:35:50Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13, successfully started retry of `PowerShell-CI-Windows`",
      "created_at": "2019-04-05T23:35:54Z",
      "updated_at": "2019-04-05T23:35:54Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@PoshChan Please remind me in 21 hours",
      "created_at": "2019-04-06T01:08:05Z",
      "updated_at": "2019-04-06T01:08:05Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13, will remind you in 21 hours",
      "created_at": "2019-04-06T01:09:02Z",
      "updated_at": "2019-04-06T01:09:02Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13, this is the reminder you requested 21 hours ago",
      "created_at": "2019-04-06T22:08:22Z",
      "updated_at": "2019-04-06T22:08:22Z"
    }
  ],
  "created_at": "2019-04-05T22:01:14Z",
  "number": 9305,
  "state": "closed",
  "title": "Preserve user shortcuts pinned to Taskbar during MSI upgrade",
  "updated_at": "2021-07-06T22:57:35Z"
}