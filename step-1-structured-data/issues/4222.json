{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4222",
  "author": "PaulHigin",
  "body": "Issue #4195 \r\n\r\nPowerShell 5.1 Get-FormatData has a new required parameter (PowerShellVersion) which was not included in restricted sessions.  So Import-PSSession fails when trying to use the parameter.\r\n\r\nFix is to add this parameter to the restricted session Get-FormatData proxy function.\r\n\r\nRepro:\r\n------\r\n```powershell\r\n# Create and register a restricted session endpoint on local machine with PS 5.1\r\nNew-PSSessionConfigurationFile -Path c:\\restricted.pssc -SessionType RestrictedRemoteServer\r\nRegister-PSSessionConfiguration -Path C:\\restricted.pssc -Name restricted -Force\r\n \r\n# Create and import a session instance\r\n$s = New-PSSession -config restricted \r\nImport-PSSession -Session $s -AllowClobber\r\n \r\nResult:\r\nImport-PSSession : Running the Get-Command command in a remote session reported the following error: A parameter\r\ncannot be found that matches parameter name 'PowerShellVersion'..\r\nAt line:1 char:1\r\n+ Import-PSSession -Session $s -AllowClobber\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidResult: (:) [Import-PSSession], RuntimeException\r\n    + FullyQualifiedErrorId : ErrorFromRemoteCommand,Microsoft.PowerShell.Commands.ImportPSSessionCommand\r\n```",
  "closed_at": "2017-07-14T19:28:22Z",
  "comments": [
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "There is no test associated with this fix because we have not ported implicit remoting tests yet.\r\nI have created Issue #4223 to track this.",
      "created_at": "2017-07-11T18:48:01Z",
      "updated_at": "2017-07-11T18:48:01Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@PaulHigin we have implicit remoting tests at https://github.com/PowerShell/PowerShell/blob/master/test/powershell/Modules/Microsoft.PowerShell.Utility/Implicit.Remoting.Tests.ps1\r\nCan you please take a look to see if that's what you looked for?\r\nIf it is, could you please add the corresponding tests for this PR as well?",
      "created_at": "2017-07-13T18:06:10Z",
      "updated_at": "2017-07-13T18:07:11Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw Thanks!, I didn't realize these tests were ported.  I'll create a test for this fix.",
      "created_at": "2017-07-14T15:06:17Z",
      "updated_at": "2017-07-14T15:06:17Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "restarted AppVeyor CI due to MyGet failure",
      "created_at": "2017-07-14T18:09:12Z",
      "updated_at": "2017-07-14T18:09:12Z"
    }
  ],
  "created_at": "2017-07-11T18:44:10Z",
  "number": 4222,
  "state": "closed",
  "title": "Fix for implicit remote regression in restricted session",
  "updated_at": "2017-07-14T19:30:20Z"
}