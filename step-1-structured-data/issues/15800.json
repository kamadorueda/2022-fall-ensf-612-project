{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15800",
  "author": "skycommand",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Steps to reproduce\r\n\r\nI'm experiencing a problem with the `Update-Module` cmdlet. Today, when I ran it with the  `-WhatIf` switch, I saw the following output:\r\n\r\n```output\r\nWhat if: Performing the operation \"Update-Module\" on target \"Version '2.2.5' of module 'PackageManagement', updating to version '1.4.7'\".\r\n```\r\n\r\nIt seems to be trying to update the PackageManagement module from version 2.2.5 to version 1.4.7. To further diagnose the issue, I ran the cmd with `-WhatIf -Verbose` switches. Here is the output.\r\n\r\n```output\r\nVERBOSE: Checking for updates for module 'PowerShellGet'.\r\nVERBOSE: Repository details, Name = 'PSGallery', Location = 'https://www.powershellgallery.com/api/v2'; IsTrusted = 'True'; IsRegistered = 'True'.\r\nVERBOSE: Using the provider 'PowerShellGet' for searching packages.\r\nVERBOSE: Using the specified source names: 'PSGallery'.\r\nVERBOSE: Getting the provider object for the PackageManagement Provider 'NuGet'.\r\nVERBOSE: The specified Location is 'https://www.powershellgallery.com/api/v2' and PackageManagementProvider is 'NuGet'.\r\nVERBOSE: Searching repository 'https://www.powershellgallery.com/api/v2/FindPackagesById()?id='PowerShellGet'' for ''.\r\nVERBOSE: Total package yield:'1' for the specified package 'PowerShellGet'.\r\nVERBOSE: Using the specified source names: 'PSGallery'.\r\nVERBOSE: Getting the provider object for the PackageManagement Provider 'NuGet'.\r\nVERBOSE: The specified Location is 'https://www.powershellgallery.com/api/v2' and PackageManagementProvider is 'NuGet'.\r\nVERBOSE: Searching repository 'https://www.powershellgallery.com/api/v2/FindPackagesById()?id='PackageManagement'' for ''.\r\nVERBOSE: Total package yield:'4' for the specified package 'PackageManagement'.\r\nVERBOSE: Skipping installed module PowerShellGet 2.2.5.\r\nWhat if: Performing the operation \"Update-Module\" on target \"Version '2.2.5' of module 'PackageManagement', updating to version '1.4.7'\".\r\n```\r\n\r\nOn the face of it, PowerShell seems unable to correctly distinguish the \"PackageManagement\" module from the \"PowerShellGet\" module.\r\n\r\nI've reproduced this issue both on PowerShell 7.1.3 and 7.2.0 Preview 7.\r\n\r\n### Expected behavior\r\n\r\nI expect PowerShell not to confuse modules for one another\r\n\r\n### Actual behavior\r\n\r\nOn the face of it, PowerShell seems unable to correctly distinguish the \"PackageManagement\" module from the \"PowerShellGet\" module. The Update-Module cmdlet seems to want to downgrade a module.\r\n\r\n### Error details\r\n\r\n_No response_\r\n\r\n### Environment data\r\n\r\n```output\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.3\r\nPSEdition                      Core\r\nGitCommitId                    7.1.3\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0-preview.7\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0-preview.7\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n[PowerShell 2021-07-20 11_37_46.zip](https://github.com/PowerShell/PowerShell/files/6846244/PowerShell.2021-07-20.11_37_46.zip)\r\n\r\n**Note:** It's a screenshot in lossless WebP format. The PNG equivalent would have been ten times size and exceeded my allotted GitHub upload limit. If you, for some reason, don't have a default image viewer that displays this popular format, drag and drop it into Microsoft Edge.\r\n",
  "closed_at": "2021-07-20T14:43:47Z",
  "comments": [
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "PowerShellGet has a dependency on PackageManagement, so updating one will usually update the other. Not sure why it's trying to downgrade it, though. You might be better off asking on the PowerShellGet repo, as it is generally responsible for dependency resolution.",
      "created_at": "2021-07-20T12:28:03Z",
      "updated_at": "2021-07-20T12:28:09Z"
    },
    {
      "author": "skycommand",
      "author_association": "NONE",
      "body": "I resolved the issue by completely uninstalling PowerShell, deleting its folder in `C:\\Program Files`, and reinstalling it.\r\n\r\nPackageManagement 1.4.7 and PowerShellGet 2.2.5 come with the latest version of PowerShell.",
      "created_at": "2021-07-20T14:43:39Z",
      "updated_at": "2021-07-20T14:43:39Z"
    }
  ],
  "created_at": "2021-07-20T07:20:37Z",
  "number": 15800,
  "state": "closed",
  "title": "The Update-Module cmdlet seems to want to downgrade a module",
  "updated_at": "2021-07-20T14:43:49Z"
}