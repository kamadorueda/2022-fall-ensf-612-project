{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14976",
  "author": "daxian-dbw",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->\r\n\r\n# PR Summary\r\n\r\nThis PR includes changes in `Build.psm1`, `packaging.psm1` and the release build template files.\r\n\r\n- For `Build.psm1`, `-ForMinimalSize` is added to `Start-PSBuild` to build self-contained application for \"linux-x64\", \"win7-x64\", or \"osx-x64\" runtimes. It reduces the size of package by:\r\n\r\n   - Avoid CrossGen PowerShell and all other library assemblies.\r\n   - Not include the Graphical Host and the WPF/WinForm stuff it pulls in.\r\n   - Remove symbol files (.pdb) and XML document files (.xml)\r\n\r\n- For `packaging.psm1`, `min-size` is added as a new value for `-Type` parameter of `Start-PSPackage`.\r\n- For Windows release build, a new build configuration `minSize` is added, to build and packaging the min-size package.\r\nFor Linux release build, `-TarMinSize` is added to `PowerShellPackage.ps1` as well as `build.json` to build and package for the min-size package.\r\n\r\nThe min-size package has the `-gc` suffix to indicate that it's for the Guest Config team. In the Azure Blob, the min-size packages are uploaded to the container with the `-gc` suffix, not in the main package maintainer (e.g. v7-2-0-preview-4), so that they don't get uploaded to the GitHub release page.\r\n\r\nHere is the release build run: https://dev.azure.com/mscodehub/PowerShellCore/_build/results?buildId=175764&view=results\r\n\r\nThe package size is reduced:\r\n- Windows (x64-zip): from 97mb to 45.3mb\r\n- Linux (x64-tar.gz): from 63.4mb to 40.6mb\r\n\r\n## PR Context\r\n\r\n<!-- Provide a little reasoning as to why this Pull Request helps and why you have opened it. -->\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **[Breaking changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)**\r\n    - [x] None\r\n    - **OR**\r\n    - [ ] [Experimental feature(s) needed](https://github.com/MicrosoftDocs/PowerShell-Docs/blob/staging/reference/6/Microsoft.PowerShell.Core/About/about_Experimental_Features.md)\r\n        - [ ] Experimental feature name(s): <!-- Experimental feature name(s) here -->\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [x] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n- **Tooling**\r\n    - [x] I have considered the user experience from a tooling perspective and don't believe tooling will be impacted.\r\n",
  "closed_at": "2021-03-12T21:25:31Z",
  "comments": [
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@daxian-dbw - seems like there are some merge conflicts. please have a look.",
      "created_at": "2021-03-09T00:27:50Z",
      "updated_at": "2021-03-09T00:27:50Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "Would this PR address this issue #5681 ?",
      "created_at": "2021-03-09T03:23:20Z",
      "updated_at": "2021-03-09T03:23:20Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@kilasuit This is considered to be one step toward that goal, but doesn't resolve that issue. This package is produced mainly for using PowerShell in a service, where startup perf is not a concern (thus no R2R/Crossgen) and GUI won't work (thus no WPF/WinForm).",
      "created_at": "2021-03-09T06:04:19Z",
      "updated_at": "2021-03-09T06:04:19Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@adityapatwardhan and @rjmholt Thanks for the review! I have addressed or replied to your comments, please take another look.\r\n\r\nHere is the new release build run: https://dev.azure.com/mscodehub/PowerShellCore/_build/results?buildId=175764&view=results",
      "created_at": "2021-03-09T17:13:58Z",
      "updated_at": "2021-03-09T18:47:43Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> Avoid CrossGen PowerShell and all other library assemblies.\r\n\r\nAfter that why do you build self-contained application? With shared framework you could significantly reduce a size of the packages.",
      "created_at": "2021-03-11T04:00:36Z",
      "updated_at": "2021-03-11T04:00:36Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "> After that why do you build self-contained application? With shared framework you could significantly reduce a size of the packages.\r\n\r\nThis is a requirement from the Azure Guest Configuration service. There is no shared framework available and the service depends on PS package to bring in the .NET runtime.\r\nFor scenarios that have the shared framework available, the existing fx-depended packages can meet the needs.",
      "created_at": "2021-03-11T17:04:04Z",
      "updated_at": "2021-03-11T17:04:04Z"
    },
    {
      "author": "anmenaga",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan please take another look; thank you.",
      "created_at": "2021-03-12T01:30:43Z",
      "updated_at": "2021-03-12T01:30:43Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:`v7.2.0-preview.4` has been released which incorporates this pull request.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.2.0-preview.4)\n",
      "created_at": "2021-03-16T23:39:21Z",
      "updated_at": "2021-03-16T23:39:21Z"
    }
  ],
  "created_at": "2021-03-09T00:17:11Z",
  "number": 14976,
  "state": "closed",
  "title": "Build self-contained minimal size package for Guest Config team",
  "updated_at": "2021-03-16T23:39:21Z"
}