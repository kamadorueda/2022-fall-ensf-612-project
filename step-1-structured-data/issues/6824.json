{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6824",
  "author": "TylerLeonhardt",
  "body": "## PR Summary\r\n\r\n<!-- summarize your PR between here and the checklist -->\r\nI noticed that *-Location doesn't set the environment current directory:\r\nhttps://msdn.microsoft.com/en-us/library/system.environment.currentdirectory(v=vs.110).aspx\r\n\r\nOn *nix, this value is mapped to the `cwd` property on the process. In bash, when you change directories, that property changes. To test on *nix:\r\n`lsof -p YOU_PID | grep cwd`\r\n\r\nI discovered this when I was trying to add PowerShell support to hypercwd (https://github.com/hharnisc/hypercwd/issues/41) which is a plug-in to [hyper](hyper.is) that, when you open a new tab, preserves the location from the previous tab. In the plug-in, they do this for *nix:\r\nhttps://github.com/hharnisc/hypercwd/blob/master/setCwd.js#L8\r\n\r\nI don't think this is a breaking change.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)",
  "closed_at": "2018-05-07T14:45:39Z",
  "comments": [
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "I thought the issue with setting the process's `cwd` is that with PowerShell you can have multiple runspaces, each in a different directory.  So this \"process global\" cwd value could get changed out from underneath you in any particular runspace by another runspace.",
      "created_at": "2018-05-05T04:53:41Z",
      "updated_at": "2018-05-05T04:53:41Z"
    },
    {
      "author": "TylerLeonhardt",
      "author_association": "MEMBER",
      "body": "That makes sense - and this change might not be the way to go about this...\r\n\r\nbut I think  setting `cwd` should really be best effort rather than no effort. I'm inclined to say that your scenario doesn't happen super often, and `cwd` is easily \"resettable\" by resetting your location.\r\n\r\nThat said, you're scenario is totally valid. Don't think there's much to prevent that.",
      "created_at": "2018-05-05T05:11:03Z",
      "updated_at": "2018-05-05T05:11:03Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "It is a breaking change because scripts can expect that `Environment.CurrentDirectory` is not changed.\r\n\r\nIt is bad practice to change a common value in _any_ multi-thread application randomly.",
      "created_at": "2018-05-05T18:44:50Z",
      "updated_at": "2018-05-05T18:44:50Z"
    },
    {
      "author": "BrucePay",
      "author_association": "COLLABORATOR",
      "body": "@tylerl0706  PowerShell uses a virtualized notion of the cwd  specifically to support concurrent scenarios. These scenarios are fairly common and something that we will be actively facilitating in the future. Given that, even if we made this change no one could use it because they would have no idea when the cwd might change.  Also, it is entirely possible that existing users are depending on the fact that with initial cwd doesn't change after PowerShell has started. So, yes - this is a breaking change (though perhaps small and obscure). ",
      "created_at": "2018-05-07T06:40:07Z",
      "updated_at": "2018-05-07T06:50:48Z"
    },
    {
      "author": "TylerLeonhardt",
      "author_association": "MEMBER",
      "body": "Sounds good. Thanks all for the feedback ",
      "created_at": "2018-05-07T14:45:39Z",
      "updated_at": "2018-05-07T14:45:53Z"
    }
  ],
  "created_at": "2018-05-05T04:50:14Z",
  "number": 6824,
  "state": "closed",
  "title": "Have *-Location modify the Environment.CurrentDirectory which changes the cwd on *nix",
  "updated_at": "2018-05-08T03:46:08Z"
}