{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8513",
  "author": "SteveL-MSFT",
  "body": "## PR Summary\r\n\r\nWhen installing (or upgrading) Preview builds the component ids for the files are the same as the installed files from the stable MSI.  MSI sees this and assumes the file is already installed so skips installing files that haven't changed (been updated) which results in missing files in the preview install folder and pwsh fails to start.  Fix is to dynamically generate new component ids (and compoentrefs) in `files.wxs` using `_Preview` suffix and use that when building a preview package.\r\n\r\nTested manually.\r\n\r\ncc @bergmeister if you can help validate different scenarios.\r\n\r\nFix https://github.com/PowerShell/PowerShell/issues/8289\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2019-01-02T20:00:44Z",
  "comments": [
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@bergmeister If I'm understanding the docs correctly:\r\n\r\n> Component identifier; this is the primary key for identifying components. If omitted, the compiler defaults the identifier to the identifier of the resource that is the explicit keypath of the component (for example, a child File element with KeyPath attribute with value 'yes'.\r\n\r\nThe generated id is the keypath of the file, example\r\n\r\n```xml\r\n      <Component Id=\"cmpE67BDD4BD52046578E30F0B2181877BA\" Guid=\"{E67BDD4B-D520-4657-8E30-F0B2181877BA}\">\r\n        <File Id=\"filE67BDD4BD52046578E30F0B2181877BA\" KeyPath=\"yes\" Source=\"$(env.ProductSourcePath)\\System.DirectoryServices.dll\" />\r\n      </Component>\r\n```\r\n\r\n`$env:ProductSourcePath` is the source of the built binaries, not the destination.  So it'd be exactly the same for stable and preview builds.  `product.wxs` just consumes `files.wxs` during the packaging process.",
      "created_at": "2018-12-22T00:53:32Z",
      "updated_at": "2018-12-22T00:55:35Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks Steve for clarification and cleaning up the temporary file. I noticed that the deletion of temporary files does not happen using a try-finally pattern in this function but I think for the purpose of this function that does not get called too often, it's probably good enough for that.\r\nLooks good to me otherwise.",
      "created_at": "2018-12-31T16:54:20Z",
      "updated_at": "2019-01-02T20:31:13Z"
    }
  ],
  "created_at": "2018-12-21T19:14:04Z",
  "number": 8513,
  "state": "closed",
  "title": "Enable install of Preview MSI release side-by-side with Stable release",
  "updated_at": "2019-01-04T09:13:41Z"
}