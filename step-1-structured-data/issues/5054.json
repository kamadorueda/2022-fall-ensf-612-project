{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5054",
  "author": "daviwil",
  "body": "_From @pldmgg on October 7, 2017 14:5_\n\n### System Details\r\n\r\nI've tested / reproduced this issue on all of the the following systems:\r\n\r\n - Operating System: Ubuntu 16.04.2 LTS\r\nKernel: Linux 4.10.0-35-generic\r\n\r\n- Operating System: Debian GNU/Linux 8 (jessie)\r\nKernel: Linux 3.16.0-4-amd64\r\n\r\n- Operating System: Debian GNU/Linux 9 (stretch)\r\nKernel: Linux 4.9.0-3-amd64\r\n\r\n- Operating System: CentOS Linux 7 (Core)\r\nKernel: Linux 3.10.0-514.16.1.el7.x86_64\r\n\r\nPowerShell Core Version tested:\r\n\r\n- PowerShell-6.0.0-beta.8\r\n\r\n- PowerShell-6.0.0-beta.7\r\n\r\n### Sample Output from Ubuntu 16.04\r\nNOTE: Output is very similar on all other Distros mentioned above, with notable exception CentOS, which forcibly kicks me out of PowerShell if I use Invoke-WebRequest.\r\n\r\n```\r\npdadmin@Ubuntu16VM:~/Downloads$ chmod a+x PowerShell-6.0.0-beta.8-x86_64.AppImage\r\n\r\npdadmin@Ubuntu16VM:~/Downloads$ sudo ./PowerShell-6.0.0-beta.8-x86_64.AppImage\r\n[sudo] password for pdadmin:\r\n$XDG_DATA_DIRS is missing. Please run /tmp/.mount_3ViStr/usr/bin/powershell.wrapper from within an AppImage.\r\nPowerShell v6.0.0-beta.8\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nPS /home/pdadmin/Downloads> iwr google.com\r\niwr : Couldn't resolve host name\r\nAt line:1 char:1\r\n+ iwr google.com\r\n+ ~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidOperation: (Method: GET, Re...rShell/6.0.0\r\n}:HttpRequestMessage) [Invoke-WebRequest], HttpRequestException\r\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.Invo\r\n   keWebRequestCommand\r\n\r\nPS /home/pdadmin/Downloads> ping google.com\r\nping: unknown host google.com\r\n\r\nPS /home/pdadmin/Downloads> exit\r\n\r\npdadmin@Ubuntu16VM:~/Downloads$ ping google.com\r\nPING google.com (172.217.8.14) 56(84) bytes of data.\r\n64 bytes from iad23s59-in-f14.1e100.net (172.217.8.14): icmp_seq=1 ttl=56 time=12.2 ms\r\n64 bytes from iad23s59-in-f14.1e100.net (172.217.8.14): icmp_seq=2 ttl=56 time=15.6 ms\r\n^C\r\n--- google.com ping statistics ---\r\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\r\nrtt min/avg/max/mdev = 12.255/13.971/15.687/1.716 ms\r\n\r\npdadmin@Ubuntu16VM:~/Downloads$ ./PowerShell-6.0.0-beta.8-x86_64.AppImage\r\nPowerShell v6.0.0-beta.8\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nPS /home/pdadmin/Downloads> iwr google.com\r\niwr : Couldn't resolve host name\r\nAt line:1 char:1\r\n+ iwr google.com\r\n+ ~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidOperation: (Method: GET, Re...rShell/6.0.0\r\n}:HttpRequestMessage) [Invoke-WebRequest], HttpRequestException\r\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.Invo\r\n   keWebRequestCommand\r\n\r\nPS /home/pdadmin/Downloads> ping google.com\r\nPING google.com (172.217.8.14) 56(84) bytes of data.\r\n64 bytes from iad23s59-in-f14.1e100.net (172.217.8.14): icmp_seq=1 ttl=56 time=7.15 ms\r\n64 bytes from iad23s59-in-f14.1e100.net (172.217.8.14): icmp_seq=2 ttl=56 time=10.4 ms\r\n^C\r\n--- google.com ping statistics ---\r\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\r\nrtt min/avg/max/mdev = 7.151/8.798/10.446/1.650 ms\r\n\r\nPS /home/pdadmin/Downloads> exit\r\n```\r\n\r\n### Issue Description\r\n\r\nNetworking breaks when using PowerShell Core AppImage. Not sure how it's broken exactly, but I can't resolve anything with PowerShell cmdlets or with Linux utilities like ping or curl.\r\n\r\n### Attached Logs\r\n\r\nReproduced by and additional testing done by @markekraus \r\n(see: https://www.reddit.com/r/PowerShell/comments/74u837/sanity_check_powershell_core_appimage_breaks/)\r\n\r\n(FYI, I'm /u/fourierswager on reddit)\r\n\n\n_Copied from original issue: PowerShell/vscode-powershell#1047_",
  "closed_at": "2017-10-07T16:13:48Z",
  "comments": [
    {
      "author": "daviwil",
      "author_association": "CONTRIBUTOR",
      "body": "_From @markekraus on October 7, 2017 14:9_\n\nI was able to repro this in both `PowerShell-6.0.0-beta.7-x86_64.AppImage` and `PowerShell-6.0.0-beta.8-x86_64.AppImage`\r\n\r\nThere appears to be an issue with DNS resolution in some instances. assuming the appimage is run as a normal user, ping works, but curl and nslookup do not. ping is unable to resolve if you run appimage as sudo. \r\n\r\nThe impact is that the web cmdlets are also unable to resolve hostnames (as it relies on curl) and thus error on any call. I can also repro this with the underlying .NET calls\r\n\r\nSteps to reproduce\r\n------------------\r\n\r\n```bash\r\n./PowerShell-6.0.0-beta.8-x86_64.AppImage\r\n```\r\n```powershell\r\nnslookup google.com\r\n\r\n(Invoke-WebRequest http://google.com).StatusCode\r\n\r\ncurl google.com\r\n\r\n$handler = [System.Net.Http.HttpClientHandler]::new()\r\n$HttpClient = [System.Net.Http.HttpClient]::New($handler)\r\n$HttpClient.GetAsync(\"http://www.contoso.com/\").GetAwaiter().GetResult().StatusCode\r\n```\r\n\r\nExpected behavior\r\n-----------------\r\n\r\n```none\r\nServer:         209.18.47.61\r\nAddress:        209.18.47.61#53\r\n\r\nNon-authoritative answer:\r\nName:   google.com\r\nAddress: 172.217.9.142\r\n\r\n\r\n200\r\n\r\n<HTML><HEAD><meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\">\r\n<TITLE>301 Moved</TITLE></HEAD><BODY>\r\n<H1>301 Moved</H1>\r\nThe document has moved\r\n<A HREF=\"http://www.google.com/\">here</A>.\r\n</BODY></HTML>\r\n\r\nOK\r\n```\r\n\r\nActual behavior\r\n---------------\r\n\r\n```none\r\n/usr/bin/nslookup: /tmp/.mount_81bJrR/usr/lib/libstdc++.so.6: version `CXXABI_1.3.8' not found (required by /usr/lib/x86_64-linux-gnu/libicuuc.so.55)\r\n\r\nInvoke-WebRequest : Couldn't resolve host name\r\nAt line:1 char:2\r\n+ (Invoke-WebRequest http://google.com).StatusCode\r\n+  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidOperation: (Method: GET, Re...rShell/6.0.0\r\n}:HttpRequestMessage) [Invoke-WebRequest], HttpRequestException\r\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand\r\n\r\ncurl: (6) Could not resolve host: google.com\r\n\r\nException calling \"GetResult\" with \"0\" argument(s): \"An error occurred while sending the request.\"\r\nAt line:1 char:1\r\n+ $HttpClient.GetAsync(\"http://www.contoso.com/\").GetAwaiter().GetResul ...\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException\r\n    + FullyQualifiedErrorId : HttpRequestException\r\n```\r\n\r\nmore details on the last error:\r\n\r\n```none\r\nPSMessageDetails      :\r\nException             : System.Management.Automation.MethodInvocationException: Exception calling \"GetResult\" with \"0\" argument(s): \"An error occurred\r\n                        while sending the request.\" ---> System.Net.Http.HttpRequestException: An error occurred while sending the request. --->\r\n                        System.Net.Http.CurlException: Couldn't resolve host name\r\n                           at System.Net.Http.CurlHandler.ThrowIfCURLEError(CURLcode error)\r\n                           at System.Net.Http.CurlHandler.MultiAgent.FinishRequest(StrongToWeakReference`1 easyWrapper, CURLcode messageResult)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n                           at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n                           at System.Runtime.CompilerServices.ConfiguredTaskAwaitable`1.ConfiguredTaskAwaiter.GetResult()\r\n                           at System.Net.Http.HttpClient.<FinishSendAsyncBuffered>d__58.MoveNext()\r\n                        --- End of stack trace from previous location where exception was thrown ---\r\n                           at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n                           at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n                           at CallSite.Target(Closure , CallSite , Object )\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Management.Automation.ExceptionHandlingOps.ConvertToMethodInvocationException(Exception exception, Type typeToThrow,\r\n                        String methodName, Int32 numArgs, MemberInfo memberInfo)\r\n                           at CallSite.Target(Closure , CallSite , Object )\r\n                           at System.Dynamic.UpdateDelegates.UpdateAndExecute1[T0,TRet](CallSite site, T0 arg0)\r\n                           at System.Management.Automation.Interpreter.DynamicInstruction`2.Run(InterpretedFrame frame)\r\n                           at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\nTargetObject          :\r\nCategoryInfo          : NotSpecified: (:) [], MethodInvocationException\r\nFullyQualifiedErrorId : HttpRequestException\r\nErrorDetails          :\r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {}\r\n```\r\n\r\nEnvironment data\r\n----------------\r\n\r\n```none\r\n> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.0.0-beta.8\r\nPSEdition                      Core\r\nGitCommitId                    v6.0.0-beta.8\r\nOS                             Linux 4.4.0-96-generic #119-Ubuntu SMP Tue Sep 12 14:59:54 UTC 2017\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
      "created_at": "2017-10-07T14:17:25Z",
      "updated_at": "2017-10-07T14:17:25Z"
    },
    {
      "author": "daviwil",
      "author_association": "CONTRIBUTOR",
      "body": "Seems like this issue should be filed at the PowerShell/PowerShell repo? I can move it there for you if you think it's not related to the PowerShell extension for VS Code. ",
      "created_at": "2017-10-07T14:17:27Z",
      "updated_at": "2017-10-07T14:17:27Z"
    },
    {
      "author": "daviwil",
      "author_association": "CONTRIBUTOR",
      "body": "_From @markekraus on October 7, 2017 14:16_\n\nye.. woops.. wrong repo... https://github.com/PowerShell/PowerShell/issues ",
      "created_at": "2017-10-07T14:17:28Z",
      "updated_at": "2017-10-07T14:17:28Z"
    },
    {
      "author": "daviwil",
      "author_association": "CONTRIBUTOR",
      "body": "Not a problem :) ",
      "created_at": "2017-10-07T14:17:28Z",
      "updated_at": "2017-10-07T14:17:28Z"
    },
    {
      "author": "pldmgg",
      "author_association": "NONE",
      "body": "Guys sorry, I didn't realize you moved this one already, I opened up #5053 right before #5054 was created.  So they're the same thing.\r\n\r\nI'm just gonna put the keyboard down for a while :(\r\n\r\nLet me know if I can help",
      "created_at": "2017-10-07T14:22:58Z",
      "updated_at": "2017-10-07T14:22:58Z"
    }
  ],
  "created_at": "2017-10-07T14:17:24Z",
  "number": 5054,
  "state": "closed",
  "title": "PowerShell Core AppImage breaks networking on Ubuntu, Debian, CentOS, and RedHat",
  "updated_at": "2017-10-07T16:13:48Z"
}