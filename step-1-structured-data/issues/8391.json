{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8391",
  "author": "mklement0",
  "body": "For a module to be picked up merely by the name of its containing _directory_, its manifest must have the same name as that directory; e.g., a module directory `foo` must contain a manifest named `foo.psd1`.\r\n\r\nAuto-loading and discovery of not-yet-loaded modules relies on this convention.\r\n\r\nThere are two pitfalls, both of which `Test-ModuleManifest` should detect, but currently doesn't:\r\n\r\n* (a) Your `*.psd1` file's base name may differ from the enclosing directory name (assuming that your root `*.psm1` file doesn't match the name either), so loading the module by its directory name / path will fail.\r\n\r\n* (b) A `*.psm1` file that matches the enclosing directory name may be present, but the `*.psd1` file may have a different name, in which case loading the module by directory name will use the  `*.psm1`  _directly_, bypassing the manifest altogether.\r\n\r\n\r\n# Steps to reproduce\r\n\r\nScenario (a)\r\n\r\n```powershell\r\n# Create a manifest in subdir. \"tmpMod1\", but with the wrong name.\r\nNew-ModuleManifest (Join-Path (New-Item -Force -Type Directory tmpMod1) wrongName.psd1) -RootModule wrongName.psm1 -function foo\r\n# Create the associated *.psm1 file with the same wrong name.\r\n'function foo { \"foo\" }' > tmpMod1/wrongName.psm1\r\n\r\nTest-ModuleManifest tmpMod1/wrongName.psd1\r\n```\r\n\r\nScenario (b)\r\n\r\n```powershell\r\n# Create a manifest in subdir. \"tmpMod2\", but with the wrong name, but pointing\r\n# to a *.psm1 file with the RIGHT name.\r\nNew-ModuleManifest (Join-Path (New-Item -Force -Type Directory tmpMod2) wrongName.psd1) -RootModule tmpMod2.psm1 -function foo\r\n# Create the associated *.psm1 file with the RIGHT Name\r\n'function foo { \"foo2\" }' > tmpMod2/tmpMod2.psm1\r\n\r\nTest-ModuleManifest tmpMod2/wrongName.psd1 -vb\r\n```\r\n\r\n\r\n# Expected behavior\r\n\r\nScenario (a)\r\n\r\n`Test-ModuleManifest` should report an error that the `*.psd1` file's base name doesn't match the name of the enclosing directory.\r\n\r\nScenario (b)\r\n\r\n`Test-ModuleManifest` should report an error or at least warn that no `*.psd1` file (manifest) with the expected name was found, only a `*.psm1` file.\r\n\r\n# Actual behavior\r\n\r\nScenario (a)\r\n\r\n`Test-ModuleManifest` succeeds.\r\n\r\nScenario (b)\r\n\r\n`Test-ModuleManifest` succeeds, and the verbose output indicates that it was the `*.psm1` file rather than the manifest (`*.psd1`) that was imported (and would be with `Import-Module`).\r\n\r\n# Environment data\r\n\r\n```none\r\nPowerShell Core v6.2.0-preview.2 (6.2.0-preview.2) on Ubuntu 18.04.1 LTS\r\n```\r\n",
  "closed_at": null,
  "comments": [],
  "created_at": "2018-12-04T04:07:41Z",
  "number": 8391,
  "state": "open",
  "title": "Test-ModuleManifest should check the manifest / root-module file base name for naming consistency with the enclosing directory",
  "updated_at": "2018-12-04T05:01:20Z"
}