{
  "_url": "https://github.com/PowerShell/PowerShell/issues/3203",
  "author": "PaulHigin",
  "body": "This fixes a rare race condition that can crash the WinRM service when remote sessions are closing.\r\nFrom the crash stack dump it is clear that the exception comes from a SetThreadProperties call that references an invalid unmanaged data handle which was previously released.  The data handle is released when the plugin command instance is closed and the error occurs when two threads contend to close the same object.\r\n\r\nThe close command and close session operations are designed to be multi-thread safe, but the SetThreadProperties call is done before the atomic check is performed.  The fix is to move the SetThreadProperties call after the atomic check to ensure it is only called when the object is in the opened state.",
  "closed_at": "2017-02-27T23:15:59Z",
  "comments": [],
  "created_at": "2017-02-24T21:42:26Z",
  "number": 3203,
  "state": "closed",
  "title": "Fix for race bug in WSMan command plugin instance close operation",
  "updated_at": "2017-02-28T18:02:34Z"
}