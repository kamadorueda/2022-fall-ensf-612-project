{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6929",
  "author": "iSazonov",
  "body": "## PR Summary\r\n\r\nRelated #6874. After the PR we can remove the files - isfile.cpp, isfile.h, isdirectory.cpp, isdirectory.h - from psl.\r\n\r\n- Use File.GetAttributes() instead of p/invokes. The method throws access exceptions (unlike File.Exists and Directory.Exists) which we use for better error messages.\r\n- Remove 'Native' from method names.\r\n- As stated in #6909 we get a regression in rare case (for files like pagefile.sys). Fix is ready in [CoreFX](https://github.com/dotnet/corefx/issues/29782), we get it in 2.1.1. I suggest ignore the regression because this is a very-very rare situation (Get-ChildItem c:\\pagefile.sys -Hidden). The .Net Core team was not even able to create an artificial test for such files and uses a real pagefile.sys file for the test. Also the enumeration is still working (dir c:\\ -hidden).\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [x] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-06-14T18:35:45Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Reopen to restart CIs.",
      "created_at": "2018-05-25T05:44:56Z",
      "updated_at": "2018-05-25T05:44:56Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13 Could you please help - I can not find why CIs failed?",
      "created_at": "2018-05-25T15:21:16Z",
      "updated_at": "2018-05-25T15:21:16Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Feature tests failed with Pester not found. :confused:",
      "created_at": "2018-05-28T12:18:37Z",
      "updated_at": "2018-05-28T12:18:37Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "The Linux failure does not seem related to your change\r\nhttps://travis-ci.org/PowerShell/PowerShell/jobs/385527642#L903\r\n![image](https://user-images.githubusercontent.com/10873629/40935717-cdb4e6de-67ed-11e8-9176-bf5485c670de.png)\r\nI'm restarting the CI run",
      "created_at": "2018-06-04T18:53:09Z",
      "updated_at": "2018-06-04T18:53:09Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@TravisEz13 Thanks! But CIs failed again. I rebased - perhaps it resolve..",
      "created_at": "2018-06-05T04:49:50Z",
      "updated_at": "2018-06-05T04:49:50Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@SteveL-MSFT @TravisEz13 Please review last two commits. I found my mistake. I added new comment and TODO to continue the cleanup process later.",
      "created_at": "2018-06-05T11:23:39Z",
      "updated_at": "2018-06-05T11:23:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw I am trying to keep the PR as small as possible. There are dozens of places where we should consider replacing old code (ItemExists) with File.Exists (Directory.Exists). Do you want I do it in this PR?",
      "created_at": "2018-06-07T03:25:44Z",
      "updated_at": "2018-06-07T03:25:44Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@iSazonov No, you don't need to do it in this PR. Open an issue to track the analysis and migration work (Utils.FileExists/DirectoryExists => File.Exists/Directory.Exists).",
      "created_at": "2018-06-08T18:47:33Z",
      "updated_at": "2018-06-08T18:47:33Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Tracking Issue #7031 ",
      "created_at": "2018-06-09T08:14:49Z",
      "updated_at": "2018-06-09T08:14:49Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw File.Exists() and Directory.Exists() return false for device names so we can remove IsReservedDeviceName call from ItemExists() method at all. What do you think?",
      "created_at": "2018-06-09T14:52:24Z",
      "updated_at": "2018-06-09T14:52:24Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@iSazonov `ItemExists` doesn't call `FileExists` or `Directory.Exists`. Do you mean `File.GetAttributes` returns -1 for reserved device names?",
      "created_at": "2018-06-12T19:12:33Z",
      "updated_at": "2018-06-12T19:12:33Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "The changes LGTM.\r\n@iSazonov Are you going to rename `FileExists`, `DirectoryExists` and `ItemExists` to\r\n`CheckFileExistsAndThrowOnError`, `CheckDirectoryExistsAndThrowOnError` and `CheckItemExistsAndThrowOnError` in this PR?\r\n",
      "created_at": "2018-06-12T19:20:40Z",
      "updated_at": "2018-06-12T19:20:40Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> Are you going to rename FileExists, DirectoryExists and ItemExists to\r\nCheckFileExistsAndThrowOnError, CheckDirectoryExistsAndThrowOnError and CheckItemExistsAndThrowOnError in this PR?\r\n\r\nNo, I'll remove the methods in follow PR.\r\n\r\n>ItemExists doesn't call FileExists or Directory.Exists. Do you mean File.GetAttributes returns -1 for reserved device names?\r\n\r\nNever mind - I hope to remove ItemExists() altogether in follow PR.",
      "created_at": "2018-06-13T05:20:33Z",
      "updated_at": "2018-06-13T05:20:33Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw Should I fix something else?",
      "created_at": "2018-06-14T03:47:44Z",
      "updated_at": "2018-06-14T03:47:44Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@iSazonov It's preferred that you remove the native code from psl-native along with your managed code changes in your following PRs. For the PRs you already finished, I listed the tasks to track removing the corresponding native code in #6874. ",
      "created_at": "2018-06-14T18:31:35Z",
      "updated_at": "2018-06-14T18:31:35Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw My thoughts was that if we have to re-publish psl-native after every change \r\nit is better to finish first the cleanup in the repo and only then cleanup in psl-native repo.",
      "created_at": "2018-06-15T18:31:44Z",
      "updated_at": "2018-06-15T18:31:44Z"
    }
  ],
  "created_at": "2018-05-24T07:56:06Z",
  "number": 6929,
  "state": "closed",
  "title": "Cleanup NativeItemExists()",
  "updated_at": "2018-06-15T18:31:52Z"
}