{
  "_url": "https://github.com/PowerShell/PowerShell/issues/10061",
  "author": "SteveL-MSFT",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->\r\n\r\n# PR Summary\r\n\r\nRe-enable existing code for setting ApartmentState.  Verified WSMan provider works which previously had an issue when I attempted this.\r\nDefault for main thread is STA.  New runspace will be MTA which is consistent with WinPS.\r\nAlso some minor fixes to other console host tests that weren't passing `-noprofile` so they failed locally on my machine.\r\nRuntime checks if running on Nano which doesn't support STA.\r\n\r\n## PR Context\r\n\r\nFix https://github.com/PowerShell/PowerShell/issues/7216\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **[Breaking changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)**\r\n    - [x] None\r\n    - **OR**\r\n    - [ ] [Experimental feature(s) needed](https://github.com/MicrosoftDocs/PowerShell-Docs/blob/staging/reference/6/Microsoft.PowerShell.Core/About/about_Experimental_Features.md)\r\n        - [ ] Experimental feature name(s): <!-- Experimental feature name(s) here -->\r\n- **User-facing changes**\r\n    - [ ] Not Applicable\r\n    - **OR**\r\n    - [X] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission): https://github.com/MicrosoftDocs/PowerShell-Docs/pull/4519\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [ ] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n",
  "closed_at": "2019-07-25T19:38:53Z",
  "comments": [
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "Since WPF requires `-sta`, the open question is whether we should change the default to STA to match Windows PowerShell.",
      "created_at": "2019-07-04T15:51:28Z",
      "updated_at": "2019-07-04T15:51:28Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "What is we lost with default STA?",
      "created_at": "2019-07-04T16:00:02Z",
      "updated_at": "2019-07-04T16:00:02Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov I don't believe we really lose anything defaulting back to STA which is what Windows PowerShell has been since v3.  We had to default to MTA with Windows PowerShell Core since .NET Core didn't support STA at the time.",
      "created_at": "2019-07-05T00:22:11Z",
      "updated_at": "2019-07-05T00:22:11Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Awesome, I vote for making `STA` the default again because most people do not care that much about using MTA IMHO and it is better to have something that works rather than something that gives you headaches.\r\nThis is not a rant about the recent JumpList issue with MTA, I've seen numerous problems with COM interaction in the past that could all be resolved by switching from MTA to STA, for example scripts that were interacting with Excel COM APIs were extremely slow when being run in MTA mode (1 hour versus less than 1 minute in STA).\r\nBruce thought that last year as well that STA should be the default again: https://github.com/PowerShell/PowerShell/issues/6908#issuecomment-390803303",
      "created_at": "2019-07-06T18:12:49Z",
      "updated_at": "2019-07-06T18:12:49Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@PowerShell/powershell-committee reviewed this and agrees to set it to STA as default to have parity with Windows PowerShell and enable use of WinForms/WPF by default.  Need to verify if this impacts NanoServer.",
      "created_at": "2019-07-10T22:18:50Z",
      "updated_at": "2019-07-10T22:18:50Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@SteveL-MSFT  Can you rebase to pickup the new nanoserver test?",
      "created_at": "2019-07-16T00:03:19Z",
      "updated_at": "2019-07-16T00:03:19Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@PoshChan Please remind me in 10 hours.",
      "created_at": "2019-07-24T17:02:02Z",
      "updated_at": "2019-07-24T17:02:02Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, this is the reminder you requested 10 hours. ago",
      "created_at": "2019-07-25T03:02:44Z",
      "updated_at": "2019-07-25T03:02:44Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:`v7.0.0-preview.3` has been released which incorporates this pull request.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.0.0-preview.3)\n",
      "created_at": "2019-08-20T22:36:48Z",
      "updated_at": "2019-08-20T22:36:48Z"
    }
  ],
  "created_at": "2019-07-04T01:32:07Z",
  "number": 10061,
  "state": "closed",
  "title": "Enable -sta and -mta switches for pwsh",
  "updated_at": "2020-03-10T21:02:25Z"
}