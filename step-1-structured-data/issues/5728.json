{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5728",
  "author": "kai-h",
  "body": "Steps to reproduce\r\n------------------\r\nInstall PowerShell 6.0.0-rc2 on macOS\r\nSet the DYLD_LIBRARY_PATH to include /opt/local/lib so that the MacPorts OpenSSL libraries can be found\r\nLaunch pwsh\r\n```\r\n[kai@blackmac ~]$ echo $DYLD_LIBRARY_PATH\r\n\r\n[kai@blackmac ~]$ export DYLD_LIBRARY_PATH=\"/usr/local/microsoft/powershell/6.0.0-rc.2:/opt/local/lib\"\r\n[kai@blackmac ~]$ echo $DYLD_LIBRARY_PATH\r\n/usr/local/microsoft/powershell/6.0.0-rc.2:/opt/local/lib\r\n[kai@blackmac ~]$ pwsh\r\nFailed to load a, error: dlopen(/usr/local/microsoft/powershell/6.0.0-rc.2/libcoreclr.dylib, 1): Symbol not found: __cg_jpeg_resync_to_restart\r\n  Referenced from: /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO\r\n  Expected in: /opt/local/lib/libJPEG.dylib\r\n in /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO\r\nFailed to bind to CoreCLR at '/usr/local/microsoft/powershell/6.0.0-rc.2/libcoreclr.dylib'\r\n[kai@blackmac ~]$ unset DYLD_LIBRARY_PATH\r\n[kai@blackmac ~]$ echo $DYLD_LIBRARY_PATH\r\n\r\n[kai@blackmac ~]$ pwsh\r\nPowerShell v6.0.0-rc.2\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nPS /Users/kai> $PSVersionTable                                                                                                                     \r\n\r\nName                           Value                                                                                                              \r\n----                           -----                                                                                                              \r\nPSVersion                      6.0.0-rc.2                                                                                                         \r\nPSEdition                      Core                                                                                                               \r\nGitCommitId                    v6.0.0-rc.2                                                                                                        \r\nOS                             Darwin 16.7.0 Darwin Kernel Version 16.7.0: Mon Nov 13 21:56:25 PST 2017; root:xnu-3789.72.11~1/RELEASE_X86_64     \r\nPlatform                       Unix                                                                                                               \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                                                            \r\nPSRemotingProtocolVersion      2.3                                                                                                                \r\nSerializationVersion           1.1.0.1                                                                                                            \r\nWSManStackVersion              3.0                                                                                                                \r\n\r\n\r\nPS /Users/kai> exit                                                                                                                                \r\n```\r\n\r\nExpected behavior\r\n-----------------\r\nIt is expected that I can use DYLD_LIBRARY_PATH to point PowerShell to the libraries it requires that were installed by MacPorts.\r\n\r\nActual behavior\r\n---------------\r\nPowerShell fails to load libcoreclr.dylib but it seems to be looking at /opt/local/lib/libJPEG.dylib\r\n\r\nEnvironment data\r\n----------------\r\n```powershell\r\nName                           Value                                                                                                              \r\n----                           -----                                                                                                              \r\nPSVersion                      6.0.0-rc.2                                                                                                         \r\nPSEdition                      Core                                                                                                               \r\nGitCommitId                    v6.0.0-rc.2                                                                                                        \r\nOS                             Darwin 16.7.0 Darwin Kernel Version 16.7.0: Mon Nov 13 21:56:25 PST 2017; root:xnu-3789.72.11~1/RELEASE_X86_64     \r\nPlatform                       Unix                                                                                                               \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                                                            \r\nPSRemotingProtocolVersion      2.3                                                                                                                \r\nSerializationVersion           1.1.0.1                                                                                                            \r\nWSManStackVersion              3.0                                                                                                                \r\n```\r\n",
  "closed_at": "2019-10-13T16:41:39Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "It looks like C# runtime dependency issue.\r\nNow we already on .Net Core 3.0. So re-check with latest build and open new issue if needed.",
      "created_at": "2019-10-13T16:41:15Z",
      "updated_at": "2019-10-13T16:41:15Z"
    }
  ],
  "created_at": "2017-12-20T21:34:59Z",
  "number": 5728,
  "state": "closed",
  "title": "PowerShell on macOS won't launch when DYLD_LIBRARY_PATH is set to include /opt/local/lib",
  "updated_at": "2019-10-13T16:41:39Z"
}