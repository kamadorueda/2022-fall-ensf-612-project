{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4324",
  "author": "mklement0",
  "body": "Steps to reproduce\r\n------------------\r\n\r\n* Clone the repo on macOS 10.12.5\r\n* Open a PowerShell instance from the latest package-installed version (beta4)\r\n* `Set-Location` to the cloned repo.\r\n* Run `ipmo ./build`\r\n* Run `Start-PSBootstrap`\r\n* Run `Start-PSBuild -Clean`\r\n* Run `Start-PSPester`\r\n\r\nExpected behavior\r\n-----------------\r\n\r\nAll steps should succeed, including all tests.\r\n\r\nActual behavior\r\n---------------\r\n\r\nThe `Start-PSPester` step fails as follows:\r\n\r\n```none\r\nDescribing PackageManagement Acceptance Test\r\n [-] Error occurred in Describe block 88ms\r\n   The term 'Register-PackageSource' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\r\n   At /Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PackageManagement/PackageManagement.Tests.ps1:23 char:5\r\nDescribing PowerShellGet - Module tests\r\nImport-Module : The specified module 'PackageManagement' was not loaded because no valid module file was found in any module directory.\r\nAt /Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PowerShellGet/PowerShellGet.Tests.ps1:73 char:5\r\n+     Import-Module PackageManagement\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : ResourceUnavailable: (PackageManagement:String) [Import-Module], FileNotFoundException\r\n    + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand\r\n \r\n [-] Error occurred in Describe block 152ms\r\n   The term 'Get-PackageProvider' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\r\n   At /Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PowerShellGet/PowerShellGet.Tests.ps1:74 char:5\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PowerShellGet/PowerShellGet.Tests.ps1' 139ms\r\n   Cannot index into a null array.\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 117\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PSDesiredStateConfiguration/MOF-Compilation.Tests.ps1' 123ms\r\n   Exception calling \"EnterDescribe\" with \"1\" argument(s): \"You already are in Describe, you cannot enter Describe twice\"\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 85\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Modules/PSReadLine/PSReadLine.Tests.ps1' 115ms\r\n   Exception calling \"EnterDescribe\" with \"1\" argument(s): \"You already are in Describe, you cannot enter Describe twice\"\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 85\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/Provider/ProviderIntrinsics.Tests.ps1' 125ms\r\n   Exception calling \"EnterDescribe\" with \"1\" argument(s): \"You already are in Describe, you cannot enter Describe twice\"\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 85\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/SDK/Json.Tests.ps1' 127ms\r\n   Exception calling \"EnterDescribe\" with \"1\" argument(s): \"You already are in Describe, you cannot enter Describe twice\"\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 85\r\n [-] Error occurred in test script '/Users/mklement/Projects/OSS/PowerShell.Org/test/powershell/SDK/PSDebugging.Tests.ps1' 121ms\r\n   Exception calling \"EnterDescribe\" with \"1\" argument(s): \"You already are in Describe, you cannot enter Describe twice\"\r\n   at Describe, /Users/mklement/Projects/OSS/PowerShell.Org/src/powershell-unix/bin/Linux/netcoreapp2.0/osx.10.12-x64/publish/Modules/Pester/Functions/Describe.ps1: line 85\r\nTests completed in 348.08s\r\nPassed: 5298 Failed: 8 Skipped: 609 Pending: 149\r\n```\r\n\r\nEnvironment data\r\n----------------\r\n\r\n```powershell\r\nPowerShell Core post-v6.0.0-beta.4, with master branch as of 22 Jul 2017\r\n```\r\n",
  "closed_at": "2017-07-24T21:32:15Z",
  "comments": [
    {
      "author": "bmanikm",
      "author_association": "CONTRIBUTOR",
      "body": "@mklement0 \r\nYou will have to specify [-PSModuleRestore switch](https://github.com/PowerShell/PowerShell/blob/76e184b0ba0fc08682bcd0d74d22c10a2c45138c/build.psm1#L108) on Start-PSBuild command.\r\n```powershell\r\nStart-PSBuild -Clean -PSModuleRestore\r\n```",
      "created_at": "2017-07-24T20:18:19Z",
      "updated_at": "2017-07-24T20:18:19Z"
    },
    {
      "author": "mklement0",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks, @bmanikm, that did the trick, _assuming that_:\r\n\r\n* I shouldn't be concerned that today's master branch builds as `v6.0.0-beta.3-86-g905e6978e6e21f803bb71569a4b2956ccb13d4b6` - not the beta **3**.\r\n\r\n* `Start-PSPester` now reporting `Passed: 5343 Failed: 0 Skipped: 611 Pending: 152` is the expected outcome. (Number of skipped tests expected? What are _pending_ tasks?)\r\n\r\nEither way, I suggest updating the existing build instructions \r\n\r\n* https://github.com/PowerShell/PowerShell/blob/master/docs/building/macos.md\r\n* https://github.com/PowerShell/PowerShell/blob/master/docs/building/linux.md\r\n\r\nand the FAQ entry about failing builds (even though this issue was about _tests_, not _builds_ - time for a FAQ entry about failing _tests_?)\r\n\r\n* https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md#why-did-my-build-fail - ) \r\n\r\nwith respect to `-PSModuleRestore` in general, and in particular with respect to _when_ it is needed (always? only after ...?)\r\n\r\n",
      "created_at": "2017-07-24T21:32:15Z",
      "updated_at": "2017-07-24T21:32:15Z"
    }
  ],
  "created_at": "2017-07-22T15:51:51Z",
  "number": 4324,
  "state": "closed",
  "title": "Building on macOS fails as of 22 Jul 2017 (pre-beta 5)",
  "updated_at": "2017-08-03T06:15:57Z"
}