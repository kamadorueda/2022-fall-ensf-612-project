{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15964",
  "author": "Jaykul",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Steps to reproduce\r\n\r\nBasically, ask `Format-Wide` for a property that doesn't exist, or more confusingly, ask it for a property that only exists on a few of the output objects.\r\n\r\n```PowerShell\r\nGet-ChildItem $Home | Format-Wide Parent -Auto\r\n```\r\nSince \"Parent\" is only set on directory items, you'll see $Home printed out for each directory, but when it gets to the files, it crashes unceremoniously with the message: **out-lineoutput : Object reference not set to an instance of an object.**\r\n\r\n![image](https://user-images.githubusercontent.com/192942/130306187-d16205e2-5610-4549-8843-56d0dac50d07.png)\r\n\r\nNote that if the property you specify is missing on the _first_ item, you get no output at all (except the error message).\r\n\r\n![image](https://user-images.githubusercontent.com/192942/130306319-c5bd66fb-4f26-49ec-9615-b1482a54e5a2.png)\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\n```console\r\nIt should output an empty string when there's no property, the way it does on PowerShell 5.1\r\n```\r\n![image](https://user-images.githubusercontent.com/192942/130306217-da3210c3-6069-4db0-ab05-9286e738e0d1.png)\r\n\r\n```console\r\n**Even** when the first few object don't have the property:\r\n```\r\n![image](https://user-images.githubusercontent.com/192942/130306341-b06dd5db-1c4d-433e-a8e0-35d410e8dceb.png)\r\n\r\nI'm not talking about the fact that in PowerShell 5.1 the \"Parent\" is rendered as just the name (instead of the whole path), but about the fact that for items with no value you just get an empty string. \r\n\r\nI would accept no output without stopping (or, just skip over it)\r\n\r\n### Actual behavior\r\n\r\n```console\r\nStops outputting on the first object with a missing property and prints:\r\n\r\nout-lineoutput : Object reference not set to an instance of an object.\r\n```\r\n\r\n### Error details\r\n\r\n```console\r\nType           : System.Management.Automation.CmdletInvocationException\r\nErrorRecord    :\r\n    Exception             :\r\n        Type       : System.NullReferenceException\r\n        TargetSite :\r\n            Name          : GenerateRow\r\n            DeclaringType : Microsoft.PowerShell.Commands.Internal.Format.TableWriter, System.Management.Automation, Version=7.1.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        StackTrace :\r\n   at Microsoft.PowerShell.Commands.Internal.Format.TableWriter.GenerateRow(String[] values, ReadOnlySpan`1 alignment, DisplayCells dc)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.TableWriter.GenerateRow(String[] values, LineOutput lo, Boolean multiLine, ReadOnlySpan`1 alignment, DisplayCells dc, List`1 generatedRows)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.WideOutputContext.WriteStringBuffer()\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessPayload(FormatEntryData fed, OutputContext c)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessObject(PSObject so)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessRecord()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()\r\n        Message    : Object reference not set to an instance of an object.\r\n        Source     : System.Management.Automation\r\n        HResult    : -2147467261\r\n    CategoryInfo          : NotSpecified: (:) [out-lineoutput], NullReferenceException\r\n    FullyQualifiedErrorId : System.NullReferenceException,Microsoft.PowerShell.Commands.OutLineOutputCommand\r\n    InvocationInfo        :\r\n        MyCommand       : out-lineoutput\r\n        HistoryId       : 15\r\n        CommandOrigin   : Internal\r\n    ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    PipelineIterationInfo :\r\n\r\n\r\n\r\nTargetSite     :\r\n    Name          : Invoke\r\n    DeclaringType : System.Management.Automation.Runspaces.PipelineBase, System.Management.Automation, Version=7.1.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n    MemberType    : Method\r\n    Module        : System.Management.Automation.dll\r\nStackTrace     :\r\n   at System.Management.Automation.Runspaces.PipelineBase.Invoke(IEnumerable input)\r\n   at Microsoft.PowerShell.Executor.ExecuteCommandHelper(Pipeline tempPipeline, Exception& exceptionThrown, ExecutionOptions options)\r\nMessage        : Object reference not set to an instance of an object.\r\nInnerException :\r\n    Type       : System.NullReferenceException\r\n    TargetSite :\r\n        Name          : GenerateRow\r\n        DeclaringType : Microsoft.PowerShell.Commands.Internal.Format.TableWriter, System.Management.Automation, Version=7.1.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace :\r\n   at Microsoft.PowerShell.Commands.Internal.Format.TableWriter.GenerateRow(String[] values, ReadOnlySpan`1 alignment, DisplayCells dc)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.TableWriter.GenerateRow(String[] values, LineOutput lo, Boolean multiLine, ReadOnlySpan`1 alignment, DisplayCells dc, List`1 generatedRows)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.WideOutputContext.WriteStringBuffer()\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessPayload(FormatEntryData fed, OutputContext c)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessObject(PSObject so)\r\n   at Microsoft.PowerShell.Commands.Internal.Format.OutCommandInner.ProcessRecord()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()\r\n    Message    : Object reference not set to an instance of an object.\r\n    Source     : System.Management.Automation\r\n    HResult    : -2147467261\r\nSource         : System.Management.Automation\r\nHResult        : -2146233087\r\n```\r\n\r\n\r\n### Environment data\r\n\r\n```powershell\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.4\r\nPSEdition                      Core\r\nGitCommitId                    7.1.4\r\nOS                             Microsoft Windows 10.0.22000\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u0393\u00c7\u00aa}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n_No response_",
  "closed_at": "2021-09-01T04:00:35Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "The NRE is in 6.2.\r\nError is in the line https://github.com/PowerShell/PowerShell/blob/e70ad6ce251d2e1d4ef79e31756cededde7ccc91/src/System.Management.Automation/FormatAndOutput/common/TableWriter.cs#L461\r\n\r\nThe fix could be ` if (values[k] is not null && values[k].Contains(ESC))`",
      "created_at": "2021-08-21T03:56:45Z",
      "updated_at": "2021-08-21T04:20:15Z"
    },
    {
      "author": "DarylGraves",
      "author_association": "CONTRIBUTOR",
      "body": "Please could this be assigned to me?",
      "created_at": "2021-08-23T22:28:00Z",
      "updated_at": "2021-08-23T22:28:00Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as fixed and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2021-09-01T04:00:34Z",
      "updated_at": "2021-09-01T04:00:34Z"
    }
  ],
  "created_at": "2021-08-21T01:46:18Z",
  "number": 15964,
  "state": "closed",
  "title": "REGRESSION: Format-Wide with missing property crashes",
  "updated_at": "2021-09-01T04:00:35Z"
}