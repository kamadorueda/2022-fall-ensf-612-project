{
  "_url": "https://github.com/PowerShell/PowerShell/issues/3796",
  "author": "iSazonov",
  "body": "Plan:\r\n- [ ] - Get feedback for removing ScopeItemOption.AllScope from alias definitions in [InitialSessionState.cs](https://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/engine/InitialSessionState.cs#L4990).\r\n- [ ] - Add internal only support for ScopeItemOption settings in [AliasAttribute](https://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/engine/Attributes.cs#L569).\r\n- [ ] - Migrate alias declarations from InitialSessionState.cs to files with cmdlet implementations.\r\n- [x] - Add tests to control using `ScopeItemOption` in alias definitions. (Done in #3595)\r\n- [x] - Add tests to control exporting aliases. (Done in #3595)\r\n\r\nMotivation is from #3595 (https://github.com/PowerShell/PowerShell/pull/3595#discussion_r116552434)\r\n\r\n@daxian-dbw\r\n> My opinion doesn't stem from the performance concern. I just think we should no longer keep stuffing unnecessary settings to  InitialSessionState.cs . Keep alias declaration in individual cmdlet is good for at least 2 reasons:\r\n1.alias declaration is together with the cmdlet definition -- easy to read/discover and the alias exists in the cmdlet as a metadata information which can be analyzed using reflection by tools (if there is any tool doing so).\r\n2.we want to stop the pattern of declaring aliases in a centralized location, so that when multiple people working on different cmdlets at the same time, they will have less conflicts that are resulted from editing the same file.\r\n\r\n>For those existing alias declarations in  InitialSessionState.cs , we cannot move them out due to the  ScopeItemOption  settings (BTW, I think for some of the aliases there, the authors probably just copied the existing options without knowing if they should actually be applied). But for new aliases, I think it's better to have them coupled with the cmdlet unless an option other than 'none' is really desired.\r\n\r\n@lzybkr \r\n>There are other benefits to the Alias attribute:\r\n* AllScope is terrible for performance - there is little benefit to have most of these aliases as AllScope\r\n* Consistency - if a non-default runspace is constructed and imports one of these modules, that runspace would not get the aliases defined by default. For example:\r\n```powershell\r\n\r\nfunction DoIt($createArg)\r\n{\r\n    [powershell]::Create($createArg).\r\n        AddScript('$ExecutionContext.InvokeCommand.GetCommand(\"clc\", \"Alias\")').\r\n        Invoke()\r\n}\r\n\r\nDoIt ([System.Management.Automation.RunspaceMode]::NewRunspace)\r\nDoIt ([System.Management.Automation.RunspaceMode]::CurrentRunspace)\r\n\r\n$iss = [InitialSessionState]::Create()\r\n$iss.ImportPSModule('Microsoft.PowerShell.Management')\r\n$iss.LanguageMode = 'FullLanguage'\r\n\r\nDoIt $iss\r\n```\r\n\r\nThis prints:\r\n```\r\nCommandType     Name                                               Version    Source\r\n-----------     ----                                               -------    ------\r\nAlias           clc -> Clear-Content\r\nAlias           clc -> Clear-Content\r\n```\r\n\r\n>Note - only 2 results instead of 3. This is a little weird because Clear-Content is in `Microsoft.PowerShell.Management`, so why isn't `clc`?\r\n\r\n>We should perhaps consider adding support for AllScope/ReadOnly in the Alias attribute, perhaps as an internal only option so that it isn't abused.\r\n\r\n",
  "closed_at": "2021-05-25T06:24:07Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Below full list of aliases from InitialSessionState.cs.\r\n\r\n@lzybkr Could you please make a conclusion where we should remove unneeded options?\r\n(Tomorrow I'll push new tests for the options in #3595 - maybe it is easy to make the conclusion by means of the .ps1 file?)\r\n\r\nAlias | Cmdlet | Option1 | Option2 | Conclusion\r\n-|-|-|-|-\r\n\"foreach\" |      \"ForEach-Object\" | ReadOnly | AllScope\r\n\"%\" |      \"ForEach-Object\" | ReadOnly | AllScope\r\n\"where\" |      \"Where-Object\" | ReadOnly | AllScope\r\n\"?\" |      \"Where-Object\" | ReadOnly | AllScope\r\n\"clc\" |      \"Clear-Content\" | ReadOnly | AllScope\r\n\"cli\" |      \"Clear-Item\" | ReadOnly | AllScope\r\n\"clp\" |      \"Clear-ItemProperty\" | ReadOnly | AllScope\r\n\"clv\" |      \"Clear-Variable\" | ReadOnly | AllScope\r\n\"cpi\" |      \"Copy-Item\" | ReadOnly | AllScope\r\n\"cvpa\" |      \"Convert-Path\" | ReadOnly | AllScope\r\n\"dbp\" |      \"Disable-PSBreakpoint\" | ReadOnly | AllScope\r\n\"ebp\" |      \"Enable-PSBreakpoint\" | ReadOnly | AllScope\r\n\"epal\" |      \"Export-Alias\" | ReadOnly | AllScope\r\n\"epcsv\" |      \"Export-Csv\" | ReadOnly | AllScope\r\n\"fl\" |      \"Format-List\" | ReadOnly | AllScope\r\n\"ft\" |      \"Format-Table\" | ReadOnly | AllScope\r\n\"fw\" |      \"Format-Wide\" | ReadOnly | AllScope\r\n\"gal\" |      \"Get-Alias\" | ReadOnly | AllScope\r\n\"gbp\" |      \"Get-PSBreakpoint\" | ReadOnly | AllScope\r\n\"gc\" |      \"Get-Content\" | ReadOnly | AllScope\r\n\"gci\" |      \"Get-ChildItem\" | ReadOnly | AllScope\r\n\"gcm\" |      \"Get-Command\" | ReadOnly | AllScope\r\n\"gdr\" |      \"Get-PSDrive\" | ReadOnly | AllScope\r\n\"gcs\" |      \"Get-PSCallStack\" | ReadOnly | AllScope\r\n\"ghy\" |      \"Get-History\" | ReadOnly | AllScope\r\n\"gi\" |      \"Get-Item\" | ReadOnly | AllScope\r\n\"gl\" |      \"Get-Location\" | ReadOnly | AllScope\r\n\"gm\" |      \"Get-Member\" | ReadOnly | AllScope\r\n\"gmo\" |      \"Get-Module\" | ReadOnly | AllScope\r\n\"gp\" |      \"Get-ItemProperty\" | ReadOnly | AllScope\r\n\"gpv\" |      \"Get-ItemPropertyValue\" | ReadOnly | AllScope\r\n\"gps\" |      \"Get-Process\" | ReadOnly | AllScope\r\n\"group\" |      \"Group-Object\" | ReadOnly | AllScope\r\n\"gu\" |      \"Get-Unique\" | ReadOnly | AllScope\r\n\"gv\" |      \"Get-Variable\" | ReadOnly | AllScope\r\n\"iex\" |      \"Invoke-Expression\" | ReadOnly | AllScope\r\n\"ihy\" |      \"Invoke-History\" | ReadOnly | AllScope\r\n\"ii\" |      \"Invoke-Item\" | ReadOnly | AllScope\r\n\"ipmo\" |      \"Import-Module\" | ReadOnly | AllScope\r\n\"ipal\" |      \"Import-Alias\" | ReadOnly | AllScope\r\n\"ipcsv\" |      \"Import-Csv\" | ReadOnly | AllScope\r\n\"measure\" |      \"Measure-Object\" | ReadOnly | AllScope\r\n\"mi\" |      \"Move-Item\" | ReadOnly | AllScope\r\n\"mp\" |      \"Move-ItemProperty\" | ReadOnly | AllScope\r\n\"nal\" |      \"New-Alias\" | ReadOnly | AllScope\r\n\"ndr\" |      \"New-PSDrive\" | ReadOnly | AllScope\r\n\"ni\" |      \"New-Item\" | ReadOnly | AllScope\r\n\"nv\" |      \"New-Variable\" | ReadOnly | AllScope\r\n\"nmo\" |      \"New-Module\" | ReadOnly | AllScope\r\n\"oh\" |      \"Out-Host\" | ReadOnly | AllScope\r\n\"rbp\" |      \"Remove-PSBreakpoint\" | ReadOnly | AllScope\r\n\"rdr\" |      \"Remove-PSDrive\" | ReadOnly | AllScope\r\n\"ri\" |      \"Remove-Item\" | ReadOnly | AllScope\r\n\"rni\" |      \"Rename-Item\" | ReadOnly | AllScope\r\n\"rnp\" |      \"Rename-ItemProperty\" | ReadOnly | AllScope\r\n\"rp\" |      \"Remove-ItemProperty\" | ReadOnly | AllScope\r\n\"rmo\" |      \"Remove-Module\" | ReadOnly | AllScope\r\n\"rv\" |      \"Remove-Variable\" | ReadOnly | AllScope\r\n\"rvpa\" |      \"Resolve-Path\" | ReadOnly | AllScope\r\n\"sal\" |      \"Set-Alias\" | ReadOnly | AllScope\r\n\"sbp\" |      \"Set-PSBreakpoint\" | ReadOnly | AllScope\r\n\"sc\" |      \"Set-Content\" | ReadOnly | AllScope\r\n\"select\" |      \"Select-Object\" | ReadOnly | AllScope\r\n\"si\" |      \"Set-Item\" | ReadOnly | AllScope\r\n\"sl\" |      \"Set-Location\" | ReadOnly | AllScope\r\n\"sp\" |      \"Set-ItemProperty\" | ReadOnly | AllScope\r\n\"saps\" |      \"Start-Process\" | ReadOnly | AllScope\r\n\"spps\" |      \"Stop-Process\" | ReadOnly | AllScope\r\n\"sv\" |      \"Set-Variable\" | ReadOnly | AllScope\r\n\"irm\" |      \"Invoke-RestMethod\" | ReadOnly | AllScope\r\n\"iwr\" |      \"Invoke-WebRequest\" | ReadOnly | AllScope\r\n\"ac\" |      \"Add-Content\" | ReadOnly | AllScope\r\n\"compare\" |      \"Compare-Object\" | ReadOnly | AllScope\r\n\"cpp\" |      \"Copy-ItemProperty\" | ReadOnly | AllScope\r\n\"diff\" |      \"Compare-Object\" | ReadOnly | AllScope\r\n\"gsv\" |      \"Get-Service\" | ReadOnly | AllScope\r\n\"sleep\" |      \"Start-Sleep\" | ReadOnly | AllScope\r\n\"sort\" |      \"Sort-Object\" | ReadOnly | AllScope\r\n\"start\" |      \"Start-Process\" | ReadOnly | AllScope\r\n\"sasv\" |      \"Start-Service\" | ReadOnly | AllScope\r\n\"spsv\" |      \"Stop-Service\" | ReadOnly | AllScope\r\n\"tee\" |      \"Tee-Object\" | ReadOnly | AllScope\r\n\"write\" |      \"Write-Output\" | ReadOnly | AllScope\r\n\"cat\" |      \"Get-Content\" | | AllScope\r\n\"cp\" |      \"Copy-Item\" | | AllScope\r\n\"ls\" |      \"Get-ChildItem\" | | AllScope\r\n\"man\" |      \"help\" | | AllScope\r\n\"mount\" |      \"New-PSDrive\" | | AllScope\r\n\"mv\" |      \"Move-Item\" | | AllScope\r\n\"ps\" |      \"Get-Process\" | | AllScope\r\n\"rm\" |      \"Remove-Item\" | | AllScope\r\n\"rmdir\" |      \"Remove-Item\" | | AllScope\r\n\"cd\" |      \"Set-Location\" | | AllScope\r\n\"dir\" |      \"Get-ChildItem\" | | AllScope\r\n\"echo\" |      \"Write-Output\" | | AllScope\r\n\"fc\" |      \"Format-Custom\" | ReadOnly | AllScope\r\n\"kill\" |      \"Stop-Process\" | | AllScope\r\n\"pwd\" |      \"Get-Location\" | | AllScope\r\n\"type\" |      \"Get-Content\" | | AllScope\r\n\"clear\" |      \"Clear-Host\" | | AllScope\r\n\"asnp\" |      \"Add-PSSnapIn\" | ReadOnly | AllScope\r\n\"gsnp\" |      \"Get-PSSnapIn\" | ReadOnly | AllScope\r\n\"gwmi\" |      \"Get-WmiObject\" | ReadOnly | AllScope\r\n\"iwmi\" |      \"Invoke-WMIMethod\" | ReadOnly | AllScope\r\n\"ogv\" |      \"Out-GridView\" | ReadOnly | AllScope\r\n\"ise\" |      \"powershell_ise.exe\" | ReadOnly | AllScope\r\n\"rsnp\" |      \"Remove-PSSnapin\" | ReadOnly | AllScope\r\n\"rwmi\" |      \"Remove-WMIObject\" | ReadOnly | AllScope\r\n\"swmi\" |      \"Set-WMIInstance\" | ReadOnly | AllScope\r\n\"shcm\" |      \"Show-Command\" | ReadOnly | AllScope\r\n\"trcm\" |      \"Trace-Command\" | ReadOnly | AllScope\r\n\"wget\" |      \"Invoke-WebRequest\" | | AllScope\r\n\"curl\" |      \"Invoke-WebRequest\" | | AllScope\r\n\"lp\" |      \"Out-Printer\" | | AllScope\r\n\"h\" |      \"Get-History\" | | AllScope\r\n\"history\" |      \"Get-History\" | | AllScope\r\n\"md\" |      \"mkdir\" | | AllScope\r\n\"popd\" |      \"Pop-Location\" | | AllScope\r\n\"pushd\" |      \"Push-Location\" | | AllScope\r\n\"r\" |      \"Invoke-History\" | | AllScope\r\n\"cls\" |      \"Clear-Host\" | | AllScope\r\n\"chdir\" |      \"Set-Location\" | | AllScope\r\n\"copy\" |      \"Copy-Item\" | | AllScope\r\n\"del\" |      \"Remove-Item\" | | AllScope\r\n\"erase\" |      \"Remove-Item\" | | AllScope\r\n\"move\" |      \"Move-Item\" | | AllScope\r\n\"rd\" |      \"Remove-Item\" | | AllScope\r\n\"ren\" |      \"Rename-Item\" | | AllScope\r\n\"set\" |      \"Set-Variable\" | | AllScope\r\n\"icm\" |      \"Invoke-Command\" | | AllScope\r\n\"clhy\" |      \"Clear-History\" | ReadOnly | AllScope\r\n\"gjb\" |      \"Get-Job\" | | AllScope\r\n\"rcjb\" |      \"Receive-Job\" | | AllScope\r\n\"rjb\" |      \"Remove-Job\" | | AllScope\r\n\"sajb\" |      \"Start-Job\" | | AllScope\r\n\"spjb\" |      \"Stop-Job\" | | AllScope\r\n\"wjb\" |      \"Wait-Job\" | | AllScope\r\n\"sujb\" |      \"Suspend-Job\" | | AllScope\r\n\"rujb\" |      \"Resume-Job\" | | AllScope\r\n\"npssc\" |      \"New-PSSessionConfigurationFile\" | ReadOnly | AllScope\r\n\"ipsn\" |      \"Import-PSSession\" | | AllScope\r\n\"epsn\" |      \"Export-PSSession\" | | AllScope\r\n\"cnsn\" |      \"Connect-PSSession\" | ReadOnly | AllScope\r\n\"dnsn\" |      \"Disconnect-PSSession\" | ReadOnly | AllScope\r\n\"nsn\" |      \"New-PSSession\" | | AllScope\r\n\"gsn\" |      \"Get-PSSession\" | | AllScope\r\n\"rsn\" |      \"Remove-PSSession\" | | AllScope\r\n\"etsn\" |      \"Enter-PSSession\" | | AllScope\r\n\"rcsn\" |      \"Receive-PSSession\" | ReadOnly | AllScope\r\n\"exsn\" |      \"Exit-PSSession\" | | AllScope\r\n\"sls\" |      \"Select-String\" | | None\r\n",
      "created_at": "2017-05-17T15:31:20Z",
      "updated_at": "2017-05-17T15:31:20Z"
    }
  ],
  "created_at": "2017-05-17T13:56:57Z",
  "labels": [
    "Issue-Enhancement",
    "WG-Engine",
    "Issue-Discussion"
  ],
  "number": 3796,
  "state": "closed",
  "title": "Add internal only support for ScopeItemOption settings in 'AliasAttribute'",
  "updated_at": "2021-05-25T06:24:07Z"
}