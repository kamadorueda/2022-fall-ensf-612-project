{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17280",
  "author": "kfsone",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nPSVersion 7.2.3\r\n\r\nInvoke-Command seems to be a common source of confusion (c.f https://github.com/PowerShell/PowerShell/issues/17205 and many others, plus quora/so questions), for several factors:\r\n\r\n1- It is frequently perceived as the command to use in order to execute a command with an argument list stored in a variable, the expectation being:\r\n\r\n```\r\n> invoke-command $cmd -argumentlist $arguments\r\ne.g\r\n> $args = $hostname, '-i', $identity\r\n> invoke-command \"ssh\" -argumentlist $args\r\n```\r\n\r\n2- The ambiguity of missing-argument feedback:\r\n```\r\nWin|PS> invoke-command \"ssh\" -argumentlist (1,2,3)\r\nInvoke-Command: Parameter set cannot be resolved using the specified named parameters. One or more parameters issued cannot be used together or an insufficient number of parameters were provided.\r\n```\r\n\r\n3- The arbitrary mixing of required and optional parameters in help makes it impossible to identify which case invoke-command thinks applied:\r\n```\r\n    Invoke-Command [[-ConnectionUri] <Uri[]>] [-ScriptBlock] <ScriptBlock> [-AllowRedirection] [-ArgumentList <Object[]>] [-AsJob] [-Authentication {Default | Basic | Negotiate | NegotiateWithImplicitCredential | Credssp | Digest | Kerberos}] [-CertificateThumbprint <String>] [-ConfigurationName\r\n    <String>] [-Credential <PSCredential>] [-EnableNetworkAccess] [-HideComputerName] [-InDisconnectedSession] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-SessionOption <PSSessionOption>] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [[-ConnectionUri] <Uri[]>] [-FilePath] <String> [-AllowRedirection] [-ArgumentList <Object[]>] [-AsJob] [-Authentication {Default | Basic | Negotiate | NegotiateWithImplicitCredential | Credssp | Digest | Kerberos}] [-ConfigurationName <String>] [-Credential <PSCredential>]\r\n    [-EnableNetworkAccess] [-HideComputerName] [-InDisconnectedSession] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-SessionOption <PSSessionOption>] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [[-ComputerName] <String[]>] [-ScriptBlock] <ScriptBlock> [-ApplicationName <String>] [-ArgumentList <Object[]>] [-AsJob] [-Authentication {Default | Basic | Negotiate | NegotiateWithImplicitCredential | Credssp | Digest | Kerberos}] [-CertificateThumbprint <String>]\r\n    [-ConfigurationName <String>] [-Credential <PSCredential>] [-EnableNetworkAccess] [-HideComputerName] [-InDisconnectedSession] [-InputObject <PSObject>] [-JobName <String>] [-Port <Int32>] [-RemoteDebug] [-SessionName <String[]>] [-SessionOption <PSSessionOption>] [-ThrottleLimit <Int32>]\r\n    [-UseSSL] [<CommonParameters>]\r\n\r\n    Invoke-Command [[-ComputerName] <String[]>] [-FilePath] <String> [-ApplicationName <String>] [-ArgumentList <Object[]>] [-AsJob] [-Authentication {Default | Basic | Negotiate | NegotiateWithImplicitCredential | Credssp | Digest | Kerberos}] [-ConfigurationName <String>] [-Credential\r\n    <PSCredential>] [-EnableNetworkAccess] [-HideComputerName] [-InDisconnectedSession] [-InputObject <PSObject>] [-JobName <String>] [-Port <Int32>] [-RemoteDebug] [-SessionName <String[]>] [-SessionOption <PSSessionOption>] [-ThrottleLimit <Int32>] [-UseSSL] [<CommonParameters>]\r\n\r\n    Invoke-Command [[-Session] <PSSession[]>] [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [[-Session] <PSSession[]>] [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-VMId] <Guid[]> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -Credential <PSCredential> [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -Credential <PSCredential> [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] [-ThrottleLimit <Int32>] -VMName <String[]> [<CommonParameters>]\r\n\r\n    Invoke-Command [-VMId] <Guid[]> [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -Credential <PSCredential> [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -Credential <PSCredential> [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] [-ThrottleLimit <Int32>] -VMName <String[]> [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] -HostName <String[]> [-InputObject <PSObject>] [-KeyFilePath <String>] [-Port <Int32>] [-RemoteDebug] [-SSHTransport {true}] [-UserName <String>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -ContainerId <String[]> [-HideComputerName] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-RunAsAdministrator] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-ArgumentList <Object[]>] [-AsJob] [-ConfigurationName <String>] -ContainerId <String[]> [-HideComputerName] [-InputObject <PSObject>] [-JobName <String>] [-RemoteDebug] [-RunAsAdministrator] [-ThrottleLimit <Int32>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] -SSHConnection <Hashtable[]> [<CommonParameters>]\r\n\r\n    Invoke-Command [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] -HostName <String[]> [-InputObject <PSObject>] [-KeyFilePath <String>] [-RemoteDebug] [-SSHTransport {true}] [-UserName <String>] [<CommonParameters>]\r\n\r\n    Invoke-Command [-FilePath] <String> [-ArgumentList <Object[]>] [-AsJob] [-HideComputerName] [-InputObject <PSObject>] [-RemoteDebug] -SSHConnection <Hashtable[]> [<CommonParameters>]\r\n\r\n    Invoke-Command [-ScriptBlock] <ScriptBlock> [-ArgumentList <Object[]>] [-InputObject <PSObject>] [-NoNewScope] [<CommonParameters>]\r\n```\r\n\r\n4- Despite being extensive, the -example's for Invoke-Command do not use argument list, as is relatively common with more complex built-in powershell cmdlets\r\n\n\n### Expected behavior\n\n```console\n> invoke-command \"ssh\" -argumentlist (1,2,3)\r\nInvoke-Command: Parameter set cannot be resolved using the named parameters provided. \"-ScriptPath\" parameter cannot be used with \"-ArgumentList\"\r\n\r\nor\r\n\r\n> invoke-command \"ssh\" -argumentlist (1,2,3)\r\nInvoke-Command: Parameter set cannot be resolved using the named parameters provided without one or more of \"-Credential\", \"-Hostname\", ...\n```\n\n\n### Actual behavior\n\n```console\nWin|PS> invoke-command \"ssh\" -argumentlist (1,2,3)\r\nInvoke-Command: Parameter set cannot be resolved using the specified named parameters. One or more parameters issued cannot be used together or an insufficient number of parameters were provided.\n```\n\n\n### Error details\n\n```console\nWin|PS> Get-Error\r\n\r\nException             :\r\n    Type              : System.Management.Automation.ParameterBindingException\r\n    Message           : Parameter set cannot be resolved using the specified named parameters. One or more parameters\r\nissued cannot be used together or an insufficient number of parameters were provided.\r\n    ErrorId           : AmbiguousParameterSet\r\n    Line              : 1\r\n    Offset            : 1\r\n    CommandInvocation :\r\n        MyCommand        : Invoke-Command\r\n        BoundParameters  :\r\n            BoundPositionally :\r\n                Length : 12\r\n            Comparer          : System.OrdinalIgnoreCaseComparer\r\n            Count             : 2\r\n            Keys              :\r\n                Length : 12\r\n\r\n                Length : 12\r\n            Values            :\r\n                Length      : 3\r\n                LongLength  : 3\r\n                Rank        : 1\r\n                SyncRoot    :\r\n\r\n\r\n\r\n\r\n\r\n                IsFixedSize : True\r\n                Count       : 3\r\n\r\n                Length      : 1\r\n                LongLength  : 1\r\n                Rank        : 1\r\n                SyncRoot    :\r\n                    Length : 3\r\n                IsFixedSize : True\r\n                Count       : 1\r\n            SyncRoot          :\r\n                BoundPositionally :\r\n                    Length : 12\r\n                Comparer          : System.OrdinalIgnoreCaseComparer\r\n                Count             : 2\r\n                Keys              :\r\n                    Length : 12\r\n\r\n                    Length : 12\r\n                Values            :\r\n                    Length      : 3\r\n                    LongLength  : 3\r\n                    Rank        : 1\r\n                    SyncRoot    :\r\n\r\n\r\n\r\n\r\n\r\n                    IsFixedSize : True\r\n                    Count       : 3\r\n\r\n                    Length      : 1\r\n                    LongLength  : 1\r\n                    Rank        : 1\r\n                    SyncRoot    :\r\n                        Length : 3\r\n                    IsFixedSize : True\r\n                    Count       : 1\r\n                SyncRoot          :\r\n                    BoundPositionally :\r\n                        Length : 12\r\n                    Comparer          : System.OrdinalIgnoreCaseComparer\r\n                    Count             : 2\r\n                    Keys              :\r\n                        Length : 12\r\n\r\n                        Length : 12\r\n                    Values            :\r\n                        Length      : 3\r\n                        LongLength  : 3\r\n                        Rank        : 1\r\n                        SyncRoot    :\r\n\r\n\r\n\r\n\r\n\r\n                        IsFixedSize : True\r\n                        Count       : 3\r\n\r\n                        Length      : 1\r\n                        LongLength  : 1\r\n                        Rank        : 1\r\n                        SyncRoot    :\r\n                            Length : 3\r\n                        IsFixedSize : True\r\n                        Count       : 1\r\n                    SyncRoot          :\r\n                        BoundPositionally :\r\n                            Length : 12\r\n                        Comparer          : System.OrdinalIgnoreCaseComparer\r\n                        Count             : 2\r\n                        Keys              :\r\n                            Length : 12\r\n\r\n                            Length : 12\r\n                        Values            :\r\n                            Length      : 3\r\n                            LongLength  : 3\r\n                            Rank        : 1\r\n                            SyncRoot    :\r\n\r\n\r\n\r\n\r\n\r\n                            IsFixedSize : True\r\n                            Count       : 3\r\n\r\n                            Length      : 1\r\n                            LongLength  : 1\r\n                            Rank        : 1\r\n                            SyncRoot    :\r\n                                Length : 3\r\n                            IsFixedSize : True\r\n                            Count       : 1\r\n                        SyncRoot          :\r\n                            BoundPositionally :\r\n                                Length : 12\r\n                            Comparer          : System.OrdinalIgnoreCaseComparer\r\n                            Count             : 2\r\n                            Keys              :\r\n                                Length : 12\r\n\r\n                                Length : 12\r\n                            Values            :\r\n                                Length      : 3\r\n                                LongLength  : 3\r\n                                Rank        : 1\r\n                                SyncRoot    :\r\n\r\n\r\n\r\n\r\n\r\n                                IsFixedSize : True\r\n                                Count       : 3\r\n\r\n                                Length      : 1\r\n                                LongLength  : 1\r\n                                Rank        : 1\r\n                                SyncRoot    :\r\n                                    Length : 3\r\n                                IsFixedSize : True\r\n                                Count       : 1\r\n                            SyncRoot          :\r\n                                BoundPositionally :\r\n                                    Length : 12\r\n                                Comparer          : System.OrdinalIgnoreCaseComparer\r\n                                Count             : 2\r\n                                Keys              :\r\n                                    Length : 12\r\n\r\n                                    Length : 12\r\n                                Values            :\r\n                                    Length      : 3\r\n                                    LongLength  : 3\r\n                                    Rank        : 1\r\n                                    SyncRoot    : \u2026\r\n                                    IsFixedSize : True\r\n                                    Count       : 3\r\n\r\n                                    Length      : 1\r\n                                    LongLength  : 1\r\n                                    Rank        : 1\r\n                                    SyncRoot    : \u2026\r\n                                    IsFixedSize : True\r\n                                    Count       : 1\r\n                                SyncRoot          :\r\n                                    BoundPositionally : \u2026\r\n                                    Comparer          : System.OrdinalIgnoreCaseComparer\r\n                                    Count             : 2\r\n                                    Keys              : \u2026\r\n                                    Values            : \u2026\r\n                                    SyncRoot          : \u2026\r\n        ScriptLineNumber : 1\r\n        OffsetInLine     : 1\r\n        HistoryId        : 4\r\n        Line             : invoke-command \"ssh\" -argumentlist (1,2,3)\r\n        PositionMessage  : At line:1 char:1\r\n                           + invoke-command \"ssh\" -argumentlist (1,2,3)\r\n                           + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n        InvocationName   : invoke-command\r\n        PipelineLength   : 1\r\n        PipelinePosition : 1\r\n    ErrorRecord       :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Parameter set cannot be resolved using the specified named parameters. One or more parameters\r\nissued cannot be used together or an insufficient number of parameters were provided.\r\n            HResult : -2146233087\r\n        CategoryInfo          : InvalidArgument: (:) [Invoke-Command], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : AmbiguousParameterSet,Microsoft.PowerShell.Commands.InvokeCommandCommand\r\n        InvocationInfo        :\r\n            MyCommand        : Invoke-Command\r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : 4\r\n            Line             : invoke-command \"ssh\" -argumentlist (1,2,3)\r\n            PositionMessage  : At line:1 char:1\r\n                               + invoke-command \"ssh\" -argumentlist (1,2,3)\r\n                               + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    TargetSite        :\r\n        Name          : ThrowAmbiguousParameterSetException\r\n        DeclaringType : System.Management.Automation.CmdletParameterBinderController, System.Management.Automation,\r\nVersion=7.2.3.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    Data              : System.Collections.ListDictionaryInternal\r\n    Source            : System.Management.Automation\r\n    HResult           : -2146233087\r\n    StackTrace        :\r\n   at System.Management.Automation.CmdletParameterBinderController.ThrowAmbiguousParameterSetException(UInt32\r\nparameterSetFlags, MergedCommandParameterMetadata bindableParameters)\r\n   at System.Management.Automation.CmdletParameterBinderController.ValidateParameterSets(Boolean prePipelineInput,\r\nBoolean setDefault)\r\n   at System.Management.Automation.CmdletParameterBinderController.BindCommandLineParameters(Collection`1 arguments)\r\n   at System.Management.Automation.CommandProcessor.BindCommandLineParameters()\r\n   at System.Management.Automation.CommandProcessor.Prepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.CommandProcessorBase.DoPrepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.Internal.PipelineProcessor.Start(Boolean incomingStream)\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n--- End of stack trace from previous location ---\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n   at System.Management.Automation.PipelineOps.InvokePipeline(Object input, Boolean ignoreInput,\r\nCommandParameterInternal[][] pipeElements, CommandBaseAst[] pipeElementAsts, CommandRedirection[][]\r\ncommandRedirections, FunctionContext funcContext)\r\n   at System.Management.Automation.Interpreter.ActionCallInstruction`6.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\nCategoryInfo          : InvalidArgument: (:) [Invoke-Command], ParameterBindingException\r\nFullyQualifiedErrorId : AmbiguousParameterSet,Microsoft.PowerShell.Commands.InvokeCommandCommand\r\nInvocationInfo        :\r\n    MyCommand        : Invoke-Command\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 4\r\n    Line             : invoke-command \"ssh\" -argumentlist (1,2,3)\r\n    PositionMessage  : At line:1 char:1\r\n                       + invoke-command \"ssh\" -argumentlist (1,2,3)\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\n```\n\n\n### Environment data\n\n```powershell\nWin|PS> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.3\r\nPSEdition                      Core\r\nGitCommitId                    7.2.3\r\nOS                             Microsoft Windows 10.0.22000\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [],
  "created_at": "2022-05-06T19:05:04Z",
  "labels": [
    "WG-Cmdlets-Core",
    "Needs-Triage"
  ],
  "number": 17280,
  "state": "open",
  "title": "Invoke-Command pain point from lack of good argument-processing feedback",
  "updated_at": "2022-05-16T18:22:15Z"
}