{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16537",
  "author": "reduckted",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nUse this script:\r\n```powershell\r\nSet-StrictMode -Version 3.0\r\n$ErrorActionPreference = \"Stop\"\r\n\r\n$job = Start-Job -ScriptBlock { Write-Host \"I am a job.\" }\r\nWait-Job -Job $job | Out-Null\r\nReceive-Job -Job $job\r\n```\r\n\r\n\u2714\ufe0f When using PowerShell 7.1.5 as a .NET global tool, the script runs successfully. \r\n\u2714 When using PowerShell 7.2.0 from the MSI installer, the script runs successfully.\r\n\u274c When using PowerShell 7.2.0 as a .NET global tool, the script fails.\r\n\r\nThe error is:\r\n```\r\nThe pwsh executable cannot be found at\r\n     | \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\powershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\"\r\n```\r\nIt's true that the file does not exist:\r\n```\r\n> get-childitem *pwsh*\r\n\r\n    Directory: C:\\Users\\<username>\\.dotnet\\tools\\.store\\powershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\r\n\r\nMode                 LastWriteTime         Length Name\r\n----                 -------------         ------ ----\r\n-a---           2/11/2021    09:04         100424 pwsh.deps.json\r\n-a---           2/11/2021    09:10         143736 pwsh.dll\r\n-a---           2/11/2021    09:04            583 pwsh.runtimeconfig.json\r\n```\r\n\r\nUsing PowerShell 7.1.5, that directory also contains `pwsh.exe`. That file is missing in PowerShell 7.2.0.\n\n### Expected behavior\n\n```console\n> pwsh .\\test.ps1\r\nI am a job\n```\n\n\n### Actual behavior\n\n```console\n> pwsh .\\test.ps1\r\nStart-Job: D:\\test.ps1:4\r\nLine |\r\n   4 |  $job = Start-Job -ScriptBlock { Write-Host \"I am a job.\" }\r\n     |         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n     | The pwsh executable cannot be found at\r\n     | \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\powershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\". Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being hosted in other applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\n```\n\n\n### Error details\n\n```console\nType           : System.Management.Automation.CmdletInvocationException\r\nErrorRecord    :\r\n    Exception             :\r\n        Type        : System.Management.Automation.PSNotSupportedException\r\n        ErrorRecord :\r\n            Exception             :\r\n                Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n                Message : The pwsh executable cannot be found at \"C:\\Users\\<username>\\.dotnet\\tools\\.sto\r\nre\\powershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\".\r\n                          Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being\r\nhosted in other applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\r\n                HResult : -2146233087\r\n            CategoryInfo          : NotImplemented: (:) [], ParentContainsErrorRecordException\r\n            FullyQualifiedErrorId : NotSupported\r\n        TargetSite  :\r\n            Name          : ThrowTerminatingError\r\n            DeclaringType : System.Management.Automation.MshCommandRuntime, System.Management.Automation,\r\nVersion=7.2.0.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        Message     : The pwsh executable cannot be found at \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\p\r\nowershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\".\r\n                      Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being hosted\r\nin other applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\r\n        Source      : System.Management.Automation\r\n        HResult     : -2146233067\r\n        StackTrace  :\r\n   at System.Management.Automation.MshCommandRuntime.ThrowTerminatingError(ErrorRecord errorRecord)\r\n    TargetObject          :\r\nC:\\Users\\<username>\\.dotnet\\tools\\.store\\powershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\r\n    CategoryInfo          : NotInstalled: (C:\\Users\\david.bieg\u2026.0\\any\\win\\pwsh.exe:String) [Start-Job],\r\nPSNotSupportedException\r\n    FullyQualifiedErrorId : IPCPwshExecutableNotFound,Microsoft.PowerShell.Commands.StartJobCommand\r\n    InvocationInfo        :\r\n        MyCommand        : Start-Job\r\n        ScriptLineNumber : 4\r\n        OffsetInLine     : 8\r\n        HistoryId        : 1\r\n        ScriptName       : D:\\test.ps1\r\n        Line             : $job = Start-Job -ScriptBlock { Write-Host \"I am a job.\" }\r\n\r\n        PositionMessage  : At D:\\test.ps1:4 char:8\r\n                           + $job = Start-Job -ScriptBlock { Write-Host \"I am a job.\" }\r\n                           +        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n        PSScriptRoot     : D:\\Code\\Playground\\ps-playground\r\n        PSCommandPath    : D:\\test.ps1\r\n        InvocationName   : Start-Job\r\n        CommandOrigin    : Internal\r\n    ScriptStackTrace      : at <ScriptBlock>, D:\\test.ps1: line 4\r\n                            at <ScriptBlock>, <No file>: line 1\r\nTargetSite     :\r\n    Name          : Invoke\r\n    DeclaringType : System.Management.Automation.Runspaces.PipelineBase, System.Management.Automation,\r\nVersion=7.2.0.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n    MemberType    : Method\r\n    Module        : System.Management.Automation.dll\r\nMessage        : The pwsh executable cannot be found at \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\powers\r\nhell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\".\r\n                 Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being hosted in\r\nother applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\r\nData           : System.Collections.ListDictionaryInternal\r\nInnerException :\r\n    Type        : System.Management.Automation.PSNotSupportedException\r\n    ErrorRecord :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : The pwsh executable cannot be found at \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\p\r\nowershell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\".\r\n                      Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being hosted\r\nin other applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\r\n            HResult : -2146233087\r\n        CategoryInfo          : NotImplemented: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : NotSupported\r\n    TargetSite  :\r\n        Name          : ThrowTerminatingError\r\n        DeclaringType : System.Management.Automation.MshCommandRuntime, System.Management.Automation,\r\nVersion=7.2.0.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    Message     : The pwsh executable cannot be found at \"C:\\Users\\<username>\\.dotnet\\tools\\.store\\power\r\nshell\\7.2.0\\powershell\\7.2.0\\tools\\net6.0\\any\\win\\pwsh.exe\".\r\n                  Note that 'Start-Job' is not supported by design in scenarios where PowerShell is being hosted in\r\nother applications. Instead, usage of the 'ThreadJob' module is recommended in such scenarios.\r\n    Source      : System.Management.Automation\r\n    HResult     : -2146233067\r\n    StackTrace  :\r\n   at System.Management.Automation.MshCommandRuntime.ThrowTerminatingError(ErrorRecord errorRecord)\r\nSource         : System.Management.Automation\r\nHResult        : -2146233087\r\nStackTrace     :\r\n   at System.Management.Automation.Runspaces.PipelineBase.Invoke(IEnumerable input)\r\n   at System.Management.Automation.Runspaces.Pipeline.Invoke()\r\n   at Microsoft.PowerShell.Executor.ExecuteCommandHelper(Pipeline tempPipeline, Exception& exceptionThrown,\r\nExecutionOptions options)\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0\r\nOS                             Microsoft Windows 10.0.18363\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2021-12-02T23:05:55Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Fix for 7.2 #16535",
      "created_at": "2021-12-02T05:00:34Z",
      "updated_at": "2021-12-02T05:00:34Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:This issue was addressed in #16535, which has now been successfully released as `v7.2.1`.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.2.1)\n",
      "created_at": "2021-12-14T18:15:51Z",
      "updated_at": "2021-12-14T18:15:51Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:This issue was addressed in #16535, which has now been successfully released as `v7.3.0-preview.1`.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.3.0-preview.1)\n",
      "created_at": "2021-12-16T19:55:51Z",
      "updated_at": "2021-12-16T19:55:51Z"
    }
  ],
  "created_at": "2021-12-02T03:53:17Z",
  "number": 16537,
  "state": "closed",
  "title": "Start-Job fails on PowerShell 7.2.0 when installed as a .NET global tool",
  "updated_at": "2021-12-16T19:55:51Z"
}