{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13260",
  "author": "JustinGrote",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n@PaulHigin \r\n\r\n## Steps to reproduce\r\nhttps://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/debug-runspace?view=powershell-7#example-1--debug-a-remote-runspace\r\n```powershell\r\nEnter-PSSession -Hostname \"tinycloud.us.to\"\r\n[tinycloud.us.to]: PS /home/jgrote> Enter-PSHostProcess -Id 1152\r\n\r\n```\r\n\r\n## Expected behavior\r\nEnter the secondary process\r\n\r\n## Actual behavior\r\n\r\n```none\r\nType           : System.Management.Automation.CmdletInvocationException\r\nErrorRecord    :\r\n    Exception             :\r\n        Type        : System.Management.Automation.PSNotSupportedException\r\n        ErrorRecord :\r\n            Exception             :\r\n                Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n                Message : Specified method is not supported.\r\n                HResult : -2146233087\r\n            CategoryInfo          : NotImplemented: (:) [], ParentContainsErrorRecordException\r\n            FullyQualifiedErrorId : NotSupported\r\n        TargetSite  :\r\n            Name          : PushRunspace\r\n            DeclaringType : System.Management.Automation.Remoting.ServerDriverRemoteHost,\r\nSystem.Management.Automation, Version=7.0.3.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        StackTrace  :\r\n   at System.Management.Automation.Remoting.ServerDriverRemoteHost.PushRunspace(Runspace runspace)\r\n   at System.Management.Automation.Remoting.ServerRemoteHost.PushRunspace(Runspace runspace)\r\n   at System.Management.Automation.Internal.Host.InternalHost.PushRunspace(Runspace runspace)\r\n   at Microsoft.PowerShell.Commands.EnterPSHostProcessCommand.EndProcessing()\r\n        Message     : Specified method is not supported.\r\n        Source      : System.Management.Automation\r\n        HResult     : -2146233067\r\n    TargetObject          : Microsoft.PowerShell.Commands.EnterPSHostProcessCommand\r\n    CategoryInfo          : InvalidOperation: (Microsoft.PowerShel\u2026SHostProcessCommand:EnterPSHostProcessCommand)\r\n[Enter-PSHostProcess], PSNotSupportedException\r\n    FullyQualifiedErrorId :\r\nEnterPSHostProcessCannotPushRunspace,Microsoft.PowerShell.Commands.EnterPSHostProcessCommand\r\n    InvocationInfo        :\r\n        MyCommand       : Enter-PSHostProcess\r\n        HistoryId       : 1\r\n        InvocationName  : enter-pshostprocess\r\n        CommandOrigin   : Internal\r\n    PipelineIterationInfo :\r\n\r\n\r\n\r\n\r\n\r\nTargetSite     :\r\n    Name          : Throw\r\n    DeclaringType : System.Runtime.ExceptionServices.ExceptionDispatchInfo\r\n    MemberType    : Method\r\n    Module        : System.Private.CoreLib.dll\r\nStackTrace     :\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n   at System.Management.Automation.Runspaces.LocalPipeline.InvokeHelper()\r\n   at System.Management.Automation.Runspaces.LocalPipeline.InvokeThreadProc()\r\nMessage        : Specified method is not supported.\r\nInnerException :\r\n    Type        : System.Management.Automation.PSNotSupportedException\r\n    ErrorRecord :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Specified method is not supported.\r\n            HResult : -2146233087\r\n        CategoryInfo          : NotImplemented: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : NotSupported\r\n    TargetSite  :\r\n        Name          : PushRunspace\r\n        DeclaringType : System.Management.Automation.Remoting.ServerDriverRemoteHost, System.Management.Automation,\r\nVersion=7.0.3.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace  :\r\n   at System.Management.Automation.Remoting.ServerDriverRemoteHost.PushRunspace(Runspace runspace)\r\n   at System.Management.Automation.Remoting.ServerRemoteHost.PushRunspace(Runspace runspace)\r\n   at System.Management.Automation.Internal.Host.InternalHost.PushRunspace(Runspace runspace)\r\n   at Microsoft.PowerShell.Commands.EnterPSHostProcessCommand.EndProcessing()\r\n    Message     : Specified method is not supported.\r\n    Source      : System.Management.Automation\r\n    HResult     : -2146233067\r\nSource         : System.Private.CoreLib\r\nHResult        : -2146233087\r\n```\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.0.3\r\nPSEdition                      Core\r\nGitCommitId                    7.0.3\r\nOS                             Linux 4.15.0-65-generic #74-Ubuntu SMP Tue Sep 17 17:06:04 UTC 2019\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n## Notes\r\nWorks fine with WSMan on windows, but same host using SSH transport throws same error\r\n\r\nAlso, it appears that the runspace is closed prior to the pushrunspace, maybe getting prematurely closed?\r\n\r\n```\r\n[tinycloud.us.to]: PS /home/jgrote> get-runspace\r\n\r\n Id Name            ComputerName    Type          State         Availability\r\n -- ----            ------------    ----          -----         ------------\r\n  1 RemoteHost      localhost       Local         Opened        Busy\r\n  2 PSAttachRunspa\u2026 localhost       Remote        Closed        None\r\n  3 PSAttachRunspa\u2026 localhost       Remote        Closed        None\r\n```",
  "closed_at": "2020-07-27T18:12:17Z",
  "comments": [
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "This is fixed in 7.1.0 (PR #11920)",
      "created_at": "2020-07-27T18:12:17Z",
      "updated_at": "2020-07-27T18:12:17Z"
    },
    {
      "author": "JustinGrote",
      "author_association": "CONTRIBUTOR",
      "body": "@PaulHigin I thought I did it with preview, hmmm. I'll test again, thanks!",
      "created_at": "2020-07-27T18:14:01Z",
      "updated_at": "2020-07-27T18:14:01Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "@JustinGrote  You have to make sure the endpoint (sshd_config subsystem) runs the preview version.  Let me know if you still have problems.",
      "created_at": "2020-07-27T18:41:51Z",
      "updated_at": "2020-07-27T18:41:51Z"
    }
  ],
  "created_at": "2020-07-24T00:31:37Z",
  "labels": [
    "Issue-Question",
    "Resolution-Answered"
  ],
  "number": 13260,
  "state": "closed",
  "title": "Debug-Runspace Example 1 Fails when using SSHTransport to both Windows and Linux SSH targets",
  "updated_at": "2020-07-27T18:41:51Z"
}