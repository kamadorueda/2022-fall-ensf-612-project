{
  "_url": "https://github.com/PowerShell/PowerShell/issues/3641",
  "author": "eosfor",
  "body": "<!--\r\n\r\nIf it is a bug report:\r\n- make sure you are able to repro it on the latest released version. \r\nYou can install the latest version from https://github.com/PowerShell/PowerShell/releases\r\n- Search the existing issues.\r\n- Refer to the [FAQ](../docs/FAQ.md).\r\n- Refer to the [known issues](../docs/KNOWNISSUES.md).\r\n- Fill out the following repro template\r\n\r\nIf it's not a bug, please remove the template and elaborate the issue in your own words.\r\n-->\r\nStrange behavior with \"using module\"\r\n\r\nSteps to reproduce\r\n------------------\r\n1. Install-Module psquickgraph -Scope CurrentUser\r\n\r\n2. save the following script to c:\\temp\\processgraph.ps1\r\n```powershell code\r\nusing module PSQuickGraph\r\n\r\nclass MyProcess : PSGraph.PSGraphVertex {\r\n    [string]$ProcessName\r\n    [int]$ProcessID\r\n    [int]$ParentProcessId\r\n    [string]get_UniqueKey() { return  $this.ProcessID }\r\n}\r\n\r\n\r\n$ps = gwmi win32_process\r\n\r\n$g = New-Graph -Type AdjacencyGraph\r\n\r\n$ps | % {\r\n    $p = [MyProcess]@{\r\n        ProcessName = $_.ProcessName\r\n        ProcessID = $_.ProcessID\r\n        ParentProcessId = $_.ParentProcessId\r\n        Label = $_.ProcessName\r\n    }\r\n    Add-Vertex -Vertex $p -Graph $g\r\n}\r\n\r\n$g.Vertices | % {\r\n    $v1 = $_\r\n    $v1.processname\r\n    $v1.ProcessId\r\n    $g.Vertices | % {\r\n        $v2 = $_\r\n        if ($v1.ProcessId -eq $v2.ParentProcessId){\r\n            Add-Edge -From $v2 -To $v1 -Graph $g\r\n        }\r\n    }\r\n}\r\n\r\n$graphFile = \"c:\\temp\\testGraph.gv\"\r\n$svgOutFile = \"c:\\temp\\testGraph.svg\"\r\n$pngOutFile = \"c:\\temp\\testGraph.png\"\r\n\r\nExport-Graph -Graph $g -Format Graphviz -Path $graphFile -Verbose\r\n$tempFile = Get-Content $graphFile\r\n$tempFile[0] += \"`r`n\" + \"rankdir = LR\"\r\n$tempFile | Out-File $graphFile -Encoding ascii\r\n```\r\n\r\n3. invoke the script by using c:\\temp\\processgraph.ps1\r\n\r\nExpected behavior\r\n-----------------\r\na file c:\\temp\\testGraph.gv should be generated. \r\n\r\nActual behavior\r\n---------------\r\nscript fails with the following message\r\n```\r\nAt C:\\temp\\processGraph.ps1:3 char:19\r\n+ class MyProcess : PSGraph.PSGraphVertex {\r\n+                   ~~~~~~~~~~~~~~~~~~~~~\r\nUnable to find type [PSGraph.PSGraphVertex].\r\n    + CategoryInfo          : ParserError: (:) [], ParseException\r\n    + FullyQualifiedErrorId : TypeNotFound\r\n```\r\n\r\nEnvironment data\r\n----------------\r\nName                           Value\r\n----                           -----\r\nPSVersion                      5.1.14393.953\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.14393.953\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```powershell\r\n> $PSVersionTable\r\n\r\n```\r\n\r\nSource code for PSQuickGraph is [here](https://github.com/eosfor/PSGraph)",
  "closed_at": null,
  "comments": [],
  "created_at": "2017-04-25T14:12:27Z",
  "number": 3641,
  "state": "open",
  "title": "Defining a PowerShell class in a script causes a parser error if the class references external types that aren't currently loaded",
  "updated_at": "2021-07-20T10:20:58Z"
}