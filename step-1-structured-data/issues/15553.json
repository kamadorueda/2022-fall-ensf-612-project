{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15553",
  "author": "datorr2",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\n# Start a BitsTransfer\r\nStart-BitsTransfer -Source '\\\\SERVER\\SHARE\\Path\\To\\File' `\r\n                   -Destination 'C:\\Users\\user\\Downloads\\' `\r\n                   -DisplayName 'My BITS Transfer'\r\n                   -Asynchronous\r\n\r\n$transfer = Get-BitsTransfer\r\n\r\n# Suspend\r\nGet-BitsTransfer | Suspend-BitsTransfer\r\n# or\r\nSuspend-BitsTransfer -BitsJob $transfer\r\n\r\n# Resume\r\nGet-BitsTransfer | Resume-BitsTransfer\r\n# or\r\nResume-BitsTransfer -BitsJob $transfer\r\n\r\n```\r\n\r\n## Expected behavior\r\n\r\n```powershell\r\nStart-BitsTransfer -Source '\\\\SERVER\\SHARE\\Path\\To\\File' `\r\n                   -Destination 'C:\\Users\\user\\Downloads\\' `\r\n                   -DisplayName 'My BITS Transfer'\r\n                   -Asynchronous\r\n\r\nJobId                                DisplayName         TransferType JobState     OwnerAccount\r\n-----                                -----------         ------------ --------     ------------\r\ndeadbeef-dead-beef-dead-beefdeadbeef My Bits Transfer    Download     Transferring WORKGROUP\\user\r\n\r\n$transfer = Get-BitsTransfer\r\n\r\nGet-BitsTransfer | Suspend-BitsTransfer\r\n# or\r\nSuspend-BitsTransfer -BitsJob $transfer\r\n\r\nJobId                                DisplayName         TransferType JobState     OwnerAccount\r\n-----                                -----------         ------------ --------     ------------\r\ndeadbeef-dead-beef-dead-beefdeadbeef My Bits Transfer    Download     Suspended    WORKGROUP\\user\r\n\r\nGet-BitsTransfer | Resume-BitsTransfer\r\n# or\r\nResume-BitsTransfer -BitsJob $transfer\r\n\r\nJobId                                DisplayName         TransferType JobState     OwnerAccount\r\n-----                                -----------         ------------ --------     ------------\r\ndeadbeef-dead-beef-dead-beefdeadbeef My Bits Transfer    Download     Transferring WORKGROUP\\user\r\n\r\n```\r\n\r\n## Actual behavior\r\n\r\n```powershell\r\nStart-BitsTransfer -Source '\\\\SERVER\\SHARE\\Path\\To\\File' `\r\n                   -Destination 'C:\\Users\\user\\Downloads\\' `\r\n                   -DisplayName 'My BITS Transfer'\r\n                   -Asynchronous\r\n\r\nJobId                                DisplayName         TransferType JobState     OwnerAccount\r\n-----                                -----------         ------------ --------     ------------\r\ndeadbeef-dead-beef-dead-beefdeadbeef My Bits Transfer    Download     Transferring WORKGROUP\\user\r\n\r\n$transfer = Get-BitsTransfer\r\n\r\n# Suspend\r\nGet-BitsTransfer | Suspend-BitsTransfer\r\nSuspend-BitsTransfer: The input object cannot be bound to any parameters for the command either because the command \r\ndoes not take pipeline input or the input and its properties do not match any of the parameters that take pipeline input.\r\n# or\r\nSuspend-BitsTransfer -BitsJob $transfer\r\nSuspend-BitsTransfer: Cannot bind parameter 'BitsJob'. Cannot convert value \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" \r\nto type \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\". \r\nError: \"Cannot convert the \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" value of \r\ntype \"Deserialized.Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" to \r\ntype \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\".\"\r\n\r\n# Resume\r\nGet-BitsTransfer | Resume-BitsTransfer\r\n\r\nResume-BitsTransfer: The input object cannot be bound to any parameters for the command either because the command \r\ndoes not take pipeline input or the input and its properties do not match any of the parameters that take pipeline input.\r\n\r\n# or\r\nResume-BitsTransfer -BitsJob $transfer\r\n\r\nResume-BitsTransfer: Cannot bind parameter 'BitsJob'. Cannot convert value \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" \r\nto type \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\". \r\nError: \"Cannot convert the \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" value of \r\ntype \"Deserialized.Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\" to \r\ntype \"Microsoft.BackgroundIntelligentTransfer.Management.BitsJob\".\"\r\n\r\n```\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```powershell\r\n$PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.3\r\nPSEdition                      Core\r\nGitCommitId                    7.1.3\r\nOS                             Microsoft Windows 10.0.18363\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n```\r\nExecuted both in regular user shell as well as an administrative shell.  Ended up having to use `bitsadmin.exe` instead to suspend and resume the transfer.",
  "closed_at": "2022-05-18T00:00:55Z",
  "comments": [
    {
      "author": "datorr2",
      "author_association": "NONE",
      "body": "Affects `Complete-BitsTransfer` as well.",
      "created_at": "2021-06-10T20:26:08Z",
      "updated_at": "2021-06-10T20:26:08Z"
    },
    {
      "author": "jborean93",
      "author_association": "COLLABORATOR",
      "body": "This is down to the implicit remoting mechanism used for this module. When a module hasn't marked itself as compatible with PSCore then PSCore will load it in a Windows PowerShell process and use remoting to send and receive data. This IPC results in the input and output as seen as a serialized instance and thus is considered to be \"dead\". There are 3 ways to avoid this\r\n\r\n* Wait until the Microsoft team responsible for the `BitsTransfer` module to update it to support PSCore so it's used natively\r\n* Try and force the import natively by running `Import-Module -Name BitsTransfer -SkipEditionCheck`\r\n  * This may work or fail catastrophically, it just depends on what .NET functions the module relies on\r\n  * If it fails then you need to wait until it's updated (option 1), or do the below\r\n* Run all the BITS code in it's own PSSession and input/output simple objects like strings\r\n\r\n```powershell\r\n$session = New-PSSession -UseWindowsPowerShell\r\n\r\n$source = '\\\\SERVER\\SHARE\\Path\\To\\File'\r\n$destination = 'C:\\Users\\user\\Downloads\\'\r\n\r\ntry {\r\n    $output = Invoke-Command -Session $session -ScriptBlock {\r\n        # All this runs in the Windows PowerShell process\r\n        Start-BitsTransfer -Source $using:source `\r\n                   -Destination $using:destination `\r\n                   -DisplayName 'My BITS Transfer'\r\n                   -Asynchronous\r\n\r\n        $transfer = Get-BitsTransfer\r\n\r\n        # Suspend\r\n        Get-BitsTransfer | Suspend-BitsTransfer\r\n        # or\r\n        Suspend-BitsTransfer -BitsJob $transfer\r\n\r\n        # Resume\r\n        Get-BitsTransfer | Resume-BitsTransfer\r\n        # or\r\n        Resume-BitsTransfer -BitsJob $transfer\r\n\r\n        'data to send back to the $output variable'\r\n    }\r\n}\r\nfinally {\r\n    $session = Remove-PSSession\r\n}\r\n```\r\n\r\nThe 3rd option is by far the best way to deal with incompatible modules or even in cases where you desire the v5 behaviour for something.",
      "created_at": "2021-06-10T21:41:50Z",
      "updated_at": "2021-06-10T21:42:00Z"
    },
    {
      "author": "datorr2",
      "author_association": "NONE",
      "body": "Excellent explanation, @jborean93 !  Really makes a lot of sense.\r\n\r\nI compared Desktop and Core:\r\n\r\n```powershell\r\n# Desktop\r\nGet-BitsTransfer\r\nGet-Module -Name BitsTransfer\r\n\r\n\r\n    Directory: C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules\r\n\r\n\r\nModuleType Version    Name           ExportedCommands\r\n---------- -------    ----           ----------------\r\nManifest   2.0.0.0    BitsTransfer   {Add-BitsFile, Complete-BitsTransfer, Get-BitsTransfer, ...}\r\n\r\n\r\n```\r\n\r\n```powershell\r\n# Core\r\nGet-BitsTransfer\r\nGet-Module -Name BitsTransfer\r\n\r\nModuleType Version    PreRelease Name           ExportedCommands\r\n---------- -------    ---------- ----           ----------------\r\nScript     1.0                   BitsTransfer   {Add-BitsFile, Complete-BitsTransfer, Get-BitsTransfer, \u2026}\r\n\r\n```\r\n",
      "created_at": "2021-06-10T22:56:04Z",
      "updated_at": "2021-06-10T22:56:04Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as answered and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2022-05-18T00:00:54Z",
      "updated_at": "2022-05-18T00:00:54Z"
    }
  ],
  "created_at": "2021-06-09T21:38:02Z",
  "number": 15553,
  "state": "closed",
  "title": "[Bug] Suspend/Resume/Complete-BitsTransfer Parameter issue",
  "updated_at": "2022-05-18T00:00:55Z"
}