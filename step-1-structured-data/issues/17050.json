{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17050",
  "author": "EpicStep",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nI wrote a small application (you can see its code below) and noticed that powershell split argument by dot. This problem is present on both PowerShell 5.1 and PowerShell 7.2, but on standart shell (cmd) all ok.\r\n\r\n`.\\main.exe -some=some.key -skey=a.main`\r\n```cpp\r\n#include <iostream>\r\n\r\nusing namespace std;\r\n\r\nint main(int argc, char *argv[]) {\r\n    for(int i = 1; i < argc; i++ )\r\n        cout << \"  argv[\" << i << \"]   \"\r\n        << argv[i] << \"\\n\";\r\n\r\n    return 0;\r\n}\r\n```\n\n### Expected behavior\n\n```console\nargv[1] -some=some.key\r\nargv[2] -skey=a.main\r\n(this output from default Windows shell (cmd))\n```\n\n\n### Actual behavior\n\n```console\nargv[1] -some=some\r\nargv[2] .key\r\nargv[3] -skey=a\r\nargv[4] .main\r\n(this output from PowerShell)\n```\n\n\n### Error details\n\n_No response_\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.1\r\nPSEdition                      Core\r\nGitCommitId                    7.2.1\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2022-03-25T19:06:02Z",
  "comments": [
    {
      "author": "jborean93",
      "author_association": "COLLABORATOR",
      "body": "Native executables are treated as just any other command in PowerShell. When PowerShell processes the line it will convert each value into positional arguments and any token that starts with `-` is treated as a parameter name. We can see this behaviour through a simple function that replicates your native executable but also shows the metadata on the arguments that the tokenizer applies:\r\n\r\n```powershell\r\nFunction Test-Function {\r\n    [System.Management.Automation.PSSerializer]::Serialize($args)\r\n    for ($i = 0; $i -lt $args.Length; $i++) {\r\n        \"[$i] $($args[$i])\"\r\n    }\r\n}\r\n\r\nTest-Function -some=some.key -skey=a.main\r\n\r\n<Objs Version=\"1.1.0.1\" xmlns=\"http://schemas.microsoft.com/powershell/2004/04\">\r\n  <Obj RefId=\"0\">\r\n    <TN RefId=\"0\">\r\n      <T>System.Object[]</T>\r\n      <T>System.Array</T>\r\n      <T>System.Object</T>\r\n    </TN>\r\n    <LST>\r\n      <Obj RefId=\"1\">\r\n        <S>-some=some</S>\r\n        <MS>\r\n          <S N=\"&lt;CommandParameterName&gt;\">some=some</S>\r\n        </MS>\r\n      </Obj>\r\n      <S>.key</S>\r\n      <Obj RefId=\"2\">\r\n        <S>-skey=a</S>\r\n        <MS>\r\n          <S N=\"&lt;CommandParameterName&gt;\">skey=a</S>\r\n        </MS>\r\n      </Obj>\r\n      <S>.main</S>\r\n    </LST>\r\n  </Obj>\r\n</Objs>\r\n[0] -some=some\r\n[1] .key\r\n[2] -skey=a\r\n[3] .main\r\n```\r\n\r\nYou can see that the arguments starting with `-` have the special note properties `<CommandParameterName>` and stop just before `.` because `.` cannot be used in a parameter name (with the tokenizer). PowerShell doesn't do anything different for native executables, it needs to still tokenize the raw input from that string into an array and this is how it works.\r\n\r\nTo avoid this issue is to quote the entire value so it's treated as a single value or use an array.\r\n\r\n```powershell\r\n# Quoting will have the parser read it all until the quote is ended\r\nmy.exe '-some=some.key' '-skey=a.main'\r\n\r\n# Note this won't work for the Test-Function above but is fine for native exes\r\nmy.exe @('-some=some.key', '-skey=a.main')\r\n```",
      "created_at": "2022-03-23T20:44:06Z",
      "updated_at": "2022-03-23T20:44:06Z"
    }
  ],
  "created_at": "2022-03-23T13:14:06Z",
  "number": 17050,
  "state": "closed",
  "title": "Unexpected behavior when parsing command line arguments",
  "updated_at": "2022-03-25T19:06:04Z"
}