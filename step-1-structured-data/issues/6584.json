{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6584",
  "author": "mcbobke",
  "body": "## PR Summary\r\n\r\nIf the `Path` argument to `New-Item` is the root of a drive such as `C:\\`, the LocationGlobber attempts to generate a drive root relative path from the path `C:`. `GetDriveRootRelativePathFromPSPath` determines that this is an absolute path, and strips the drive name and colon from the path; originally, this would result in `GenerateRelativePath` determining that the current working directory should be given as the relative path. Now, a check is made on whether stripping the drive name and colon results in an empty string; if it does, the root of the current PSDrive `context.Drive.Root` is returned as the relative path.\r\n\r\nThis fixes #5228.\r\n\r\n## PR Checklist\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [X] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [X] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [X] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [X] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [X] Issue filed - Issue link: https://github.com/PowerShell/PowerShell/issues/5228#\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [X] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-04-09T05:45:06Z",
  "comments": [
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Running the tests in question that are failing seem to be failing both on the current preview build (6.1.0-preview.1) and my build. I can't determine if this is a breaking change,",
      "created_at": "2018-04-06T19:21:50Z",
      "updated_at": "2018-04-06T19:21:50Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "For now, I will leave this as ready to merge and non-breaking until review.",
      "created_at": "2018-04-06T19:38:28Z",
      "updated_at": "2018-04-06T19:38:28Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Confirmed that this broke Get-ChildItem when `Path` is not specified (by default, then attempts to use $pwd).",
      "created_at": "2018-04-06T23:28:59Z",
      "updated_at": "2018-04-06T23:28:59Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@mcbobke Feel free to ask if you need help.",
      "created_at": "2018-04-07T10:53:27Z",
      "updated_at": "2018-04-07T10:53:27Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "I've been working on a different solution and am currently testing it before I commit. Thanks for the encouragement, I will definitely be asking some questions once it's up!",
      "created_at": "2018-04-08T08:51:34Z",
      "updated_at": "2018-04-08T08:51:34Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Alright, I think I'm on the right track this time. Because the argument for `Path` may not be given if that parameter is not specified when using the cmdlet, returning an empty string in the spot that I was doing so before would break the expected functionality of creating an item in the current working directory.\r\n\r\nTesting for an empty path after `GetDriveRootRelativePathFromPSPath` strips the drive name and colon ensures that the case in which a drive root is specified as the path is handled. Rather than attempt to generate a drive relative path from an empty path (which would generate the relative path to the current working directory), the current context's PSDrive's root is returned.\r\n\r\nLooking forward to review.",
      "created_at": "2018-04-08T10:13:47Z",
      "updated_at": "2018-04-08T10:13:47Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@mcbobke The PR contains alien commits. I suggest you to rebase and squash before we start review.",
      "created_at": "2018-04-08T13:00:00Z",
      "updated_at": "2018-04-08T13:00:00Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov I did my best to clean up the commit history; is there anything I can do to clean it up further?",
      "created_at": "2018-04-08T19:37:39Z",
      "updated_at": "2018-04-08T19:37:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@mcbobke I still see an alien commit https://github.com/PowerShell/PowerShell/pull/6584/commits",
      "created_at": "2018-04-09T03:56:51Z",
      "updated_at": "2018-04-09T03:56:51Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Whoops! Apologies. Looks like it's fixed now.",
      "created_at": "2018-04-09T03:59:43Z",
      "updated_at": "2018-04-09T03:59:43Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@mcbobke No, your commit contains unrelated code.\r\n\r\nI see you make the PR from forked master branch. You should create new branch for every new work.\r\n1. fork the repo\r\n2. create new branch \r\n3. add commits to the new branch \"work\"\r\n4. make PR based on branch \"work\"\r\n5. after merge the PR remove the branch \"work\"\r\n6. rebase your local master branch from the original repo\r\n7. goto 2\r\n",
      "created_at": "2018-04-09T04:40:54Z",
      "updated_at": "2018-04-09T04:40:54Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Understood @iSazonov . How should I branch this work off now that it's in master? Reset to previous commit, create new branch, push changes to new branch?",
      "created_at": "2018-04-09T04:47:27Z",
      "updated_at": "2018-04-09T04:50:34Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "If you haven't experience with git you could simply backup your code (copy files) and re-create your fork, create new branch and copy your files (or changed code blocks) back.",
      "created_at": "2018-04-09T05:06:11Z",
      "updated_at": "2018-04-09T05:07:23Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "I have some experience with Git, but I have learned some things while working on this change. :P Does that mean I need to recreate the PR as well? I can revert the commit and branch it off, if I can also edit the PR. Otherwise, I'd create a new one.",
      "created_at": "2018-04-09T05:10:44Z",
      "updated_at": "2018-04-09T05:10:44Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "You are free to choose a way.\r\nWhen I started with the project I was doing a full reset a couple of times.",
      "created_at": "2018-04-09T05:39:51Z",
      "updated_at": "2018-04-09T05:39:51Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "Okay, what I'll do then is branch off and create a new PR and reference this one. Thanks for all of your help, this has been a learning experience!",
      "created_at": "2018-04-09T05:42:08Z",
      "updated_at": "2018-04-09T05:42:08Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@mcbobke  If our docs is not clear for the repo newbies please feel free to commit additions with your experience.",
      "created_at": "2018-04-09T05:57:46Z",
      "updated_at": "2018-04-09T06:02:58Z"
    },
    {
      "author": "mcbobke",
      "author_association": "CONTRIBUTOR",
      "body": "That's a really good idea. I will look through and see where I can add some clarification.",
      "created_at": "2018-04-09T06:14:26Z",
      "updated_at": "2018-04-09T06:14:26Z"
    }
  ],
  "created_at": "2018-04-06T17:49:28Z",
  "number": 6584,
  "state": "closed",
  "title": "Fix for files/folders created at pwd by New-Item when given path is drive root (#5228)",
  "updated_at": "2018-04-09T06:14:26Z"
}