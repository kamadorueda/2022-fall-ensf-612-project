{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8829",
  "author": "jn-altius",
  "body": "\r\n# Steps to reproduce\r\nBasic steps:\r\n- Go to an existing Azure Storage File Share\r\n- Click the ellipsis at the far right of the Share Name -> Connect\r\n- Copy the code\r\n- Start a Cloud Shell session in the Azure portal\r\n- Paste the code from above and run it\r\n\r\nNB: the 3 powershell commands are:\r\n```powershell\r\nConvertTo-SecureString\r\nNew-Object System.Management.Automation.PSCredential\r\nNew-PSDrive\r\n```\r\nWhen I execute the first 2 lines separately I don't get an error.  It's only the last line.\r\n\r\n# Expected behavior\r\nA new drive is created.\r\nI should be able to type:\r\n```none\r\nCD z:\r\n```\r\n(or whatever letter I pick instead of Z)\r\n\r\n# Actual behavior\r\nRed error message:\r\n```none\r\nNew-PSDrive : The specified drive root \"\\\\<my storage account>.file.core.windows.net\\clouddrive\" either does not exist, or it is not a folder.\r\n```\r\n\r\n# Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.1.2\r\nPSEdition                      Core\r\nGitCommitId                    6.1.2\r\nOS                             Linux 4.15.0-1036-azure #38~16.04.1-Ubuntu SMP Fri Dec 7 03:21:52 UTC 2018\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n# History\r\nThis trick has worked in the past.  I was using it regularly about 12 months ago.  At some point it stopped working, and the code auto-generated by the Azure Portal now errors :-/",
  "closed_at": "2019-02-08T04:56:00Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "/cc @SteveL-MSFT ",
      "created_at": "2019-02-05T14:29:29Z",
      "updated_at": "2019-02-05T14:29:29Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "cc @edyoung who owns CloudShell",
      "created_at": "2019-02-05T16:07:11Z",
      "updated_at": "2019-02-05T16:07:11Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "@jn-altius around last year July, the cloudshell backend os was switched to Linux from Windows. That change may impact the software behavior by mounting to azure storage file share. Previously in Windows, we used [instructions here](https://docs.microsoft.com/en-ca/azure/storage/files/storage-how-to-use-files-windows) for mounting to Azure. That's why it worked for you new-psdrive.  On Linux, our backend code mounted the user's storage account file share to  $HOME/clouddrive already (you can run df -k . If want to use new-psdrive, you may try the following example:\r\n```\r\nPS Azure:\\> New-PSDrive -Name z -Root /home/jianyun/clouddrive -PSProvider filesystem\r\n\r\nName           Used (GB)     Free (GB) Provider      Root                                                                                   CurrentLocation\r\n----           ---------     --------- --------      ----                                                                                   ---------------\r\nz                   5.20          0.80 FileSystem    /home/jianyun/clouddrive\r\n\r\nPS Azure:\\> cd z:\r\nPS z:/>\r\n\r\n```\r\n\r\nIf you want to view mount details, you may run `df -k`.\r\n",
      "created_at": "2019-02-05T18:28:37Z",
      "updated_at": "2019-02-05T18:28:37Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "Why was this closed?\r\n\r\nThe bug I reported has not been mentioned.  Or a fix or workaround given.\r\n\r\nThe bug I describe is when you go to Connect in the context menu for a File Share.  The auto generated code is wrong.\r\n\r\nWill this be fixed?  Or just left as it is?",
      "created_at": "2019-02-06T08:45:41Z",
      "updated_at": "2019-02-06T08:45:41Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@jn-altius The repo is for PowerShell Core only and it is not right place where the issue should be tracked. I hope MSFT team will share more info for you. \r\nThanks for your report!",
      "created_at": "2019-02-06T09:06:07Z",
      "updated_at": "2019-02-06T09:06:07Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "Can you give me a clue _where_ it should be raised then?  Do you have the URL for the File Storage or Cloud Shell repo?\r\n\r\nCheers",
      "created_at": "2019-02-06T09:11:52Z",
      "updated_at": "2019-02-06T09:11:52Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I am sure MSFT members help you. Please wait.",
      "created_at": "2019-02-06T09:31:02Z",
      "updated_at": "2019-02-06T09:31:02Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "@jianyunt  Your code example does not work :-(\r\n\r\nDid you test that in on-premise PowerShell, or Cloud Shell?\r\n\r\nThe only difference I can see between your code and the auto-generated code is the direction of the slashes in the -Root\r\n\r\nHere is my code, amended to match yours:\r\n````powershell\r\n$acctKey = ConvertTo-SecureString -String \"<key value>\" -AsPlainText -Force\r\n$credential = New-Object System.Management.Automation.PSCredential -ArgumentList \"Azure\\hrxaconfigstored\", $acctKey\r\nNew-PSDrive -Name Z -PSProvider FileSystem -Root \"//hrxaconfigstored.file.core.windows.net/clouddrive\" -Credential $credential\r\n\r\n````\r\n\r\nThe above code still returns the message \"The specified drive root either does not exist or is not a folder\".\r\n\r\nIs New-PSDrive irreparably broken in Cloud Shell now?",
      "created_at": "2019-02-06T10:23:38Z",
      "updated_at": "2019-02-06T10:23:38Z"
    },
    {
      "author": "edyoung",
      "author_association": "CONTRIBUTOR",
      "body": "I closed it because it looked like @jianyunt had addressed your concern. Since that isn't working for you, I'll reopen it. ",
      "created_at": "2019-02-06T14:16:33Z",
      "updated_at": "2019-02-06T14:16:33Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "@jn-altius this might be the Azure portal issue. I just chatted with the portal team, they ask you to open an support ticket via https://ms.portal.azure.com -> ?  -> Help +Support and then \"New Support Request\"\r\n![image](https://user-images.githubusercontent.com/10171679/52362343-38e88680-29f5-11e9-9d4b-998a2788ca94.png)\r\n",
      "created_at": "2019-02-06T17:55:15Z",
      "updated_at": "2019-02-06T17:55:15Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "I ran my sample on cloudshell, \r\n``` PowerShell\r\nNew-PSDrive -Name z -Root $HOME/clouddrive -PSProvider filesystem\r\n```",
      "created_at": "2019-02-06T17:58:06Z",
      "updated_at": "2019-02-06T17:58:06Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "How did you pass Credentials?",
      "created_at": "2019-02-06T18:00:50Z",
      "updated_at": "2019-02-06T18:00:50Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "no. Are you running it in on-prem machines?\r\n\r\nAccording to https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-windows#prerequisites, it needs to make sure port open 445",
      "created_at": "2019-02-06T18:01:55Z",
      "updated_at": "2019-02-06T18:01:55Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "No, not using any machine at all.  I'm using Cloud Shell in the portal:\r\nhttps://shell.azure.com\r\n",
      "created_at": "2019-02-06T18:04:52Z",
      "updated_at": "2019-02-06T18:04:52Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "Please try on your local machines.\r\nOn cloudshell, we cannot mount to any personal Azure file shares through new-psdrive after we switched to Linux based container, except the one cloudshell is using (you can view it df -k).  This is most likely the user you logged on to cloudshell is regular user not sudo (disabled), unlike Windows-based container we used to use on cloudshell which was administrator.",
      "created_at": "2019-02-06T18:19:04Z",
      "updated_at": "2019-02-06T18:19:30Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "I can't use a local machine.  The solution I am building is PaaS-only; there are no IaaS components.\r\n\r\nSo are you saying that as of July last year that the ability to mount a drive in Cloud Shell has been removed from Azure?",
      "created_at": "2019-02-06T18:24:05Z",
      "updated_at": "2019-02-06T18:24:05Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "correct. ",
      "created_at": "2019-02-06T18:26:45Z",
      "updated_at": "2019-02-06T18:26:45Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "That is disappointing :-(\r\n\r\nWill this facility be returned in a future release of Cloud Shell?",
      "created_at": "2019-02-06T18:30:33Z",
      "updated_at": "2019-02-06T18:30:33Z"
    },
    {
      "author": "jianyunt",
      "author_association": "CONTRIBUTOR",
      "body": "looping in @HemantMahawar @maertendMSFT for the above question.",
      "created_at": "2019-02-06T18:32:44Z",
      "updated_at": "2019-02-06T18:32:44Z"
    },
    {
      "author": "maertendMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "Unfortunately, sudo is not currently supported in Cloud Shell and it is not currently planned.  It would be best to submit a feature request at https://aka.ms/cloudshell/feedback so that the request can be tracked and voted upon by other users.\r\n",
      "created_at": "2019-02-07T19:19:57Z",
      "updated_at": "2019-02-07T19:19:57Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Is there something we need to track and fix in _this repo_ or we can close the issue?",
      "created_at": "2019-02-08T04:04:29Z",
      "updated_at": "2019-02-08T04:04:29Z"
    },
    {
      "author": "edyoung",
      "author_association": "CONTRIBUTOR",
      "body": "It's not a powershell bug, so makes sense to close here. MaertendMSFT gave the correct feedback link",
      "created_at": "2019-02-08T04:56:00Z",
      "updated_at": "2019-02-08T04:56:00Z"
    },
    {
      "author": "jn-altius",
      "author_association": "NONE",
      "body": "@maertendMSFT  Thanks for the link.  I have requested the return of this feature.\r\n\r\nMeanwhile Azure is still giving out duff code (click the ellipsis on a File Share and then connect -> the code produced is a dud).  Who is it that needs to be notified about that?",
      "created_at": "2019-02-08T09:43:36Z",
      "updated_at": "2019-02-08T09:43:36Z"
    }
  ],
  "created_at": "2019-02-05T10:57:14Z",
  "number": 8829,
  "state": "closed",
  "title": "New-PSDrive no longer working in Cloud Shell",
  "updated_at": "2019-02-08T09:43:36Z"
}