{
  "_url": "https://github.com/PowerShell/PowerShell/issues/12223",
  "author": "NotNotWrongUsually",
  "body": "I can create an InitialSessionState with just Microsoft.PowerShell.Core included like this:\r\n\r\n```powershell\r\n$session_state = [System.Management.Automation.Runspaces.InitialSessionState]::CreateDefault2()\r\n```\r\nThrough inspection of `$session_State.Commands` I can see that the Core commands list as coming from the snap-in Microsoft.PowerShell.Core\r\n\r\ne.g\r\n```powershell\r\nPS > $session_state.Commands | ? Name -eq \"Get-Command\"\r\n\r\nImplementingType : Microsoft.PowerShell.Commands.GetCommandCommand\r\nHelpFileName     : System.Management.Automation.dll-Help.xml\r\nCommandType      : Cmdlet\r\nVisibility       : Public\r\nName             : Get-Command\r\nPSSnapIn         : Microsoft.PowerShell.Core\r\nModule           :\r\n```\r\n\r\nHowever, if I want to create an empty InitialSessionState, and later dynamically include Microsoft.Powershell.Core I can find no way to do this. Neither `ImportPSSnapIn` nor `ImportPSModule` seem to achieve what I want.\r\n\r\n```powershell\r\nPS > $session_state = [System.Management.Automation.Runspaces.InitialSessionState]::Create()\r\nPS > $session_state.ImportPSSnapIn('Microsoft.PowerShell.Core', [ref]$null)\r\n\r\nMethodInvocationException: Exception calling \"ImportPSSnapIn\" with \"2\" argument(s): \"The PowerShell snap-in 'Microsoft.PowerShell.Core' is not installed on this computer.\"\r\n\r\nPS > $session_state.ImportPSModule('Microsoft.PowerShell.Core')\r\n\r\n# No errors, but $session_state.Commands is empty...\r\nPS > $session_state.Commands\r\n```\r\n\r\n(I am unclear on whether Microsoft.PowerShell.Core is considered a snap-in or a module - it is listed in both the PSSnapIn and Module fields when inspecting a command with `Get-Command`)\r\n\r\n# Steps to reproduce\r\n\r\n```powershell\r\n$session_state = [System.Management.Automation.Runspaces.InitialSessionState]::Create()\r\n$session_state.ImportPSSnapIn('Microsoft.PowerShell.Core', [ref]$null)\r\n```\r\n\r\n# Expected behavior\r\n\r\nThe Microsoft.PowerShell.Core snapin is loaded into the Session State.\r\n\r\n# Actual behavior\r\n\r\n```none\r\nMethodInvocationException: Exception calling \"ImportPSSnapIn\" with \"2\" argument(s): \"The PowerShell snap-in 'Microsoft.PowerShell.Core' is not installed on this computer.\"\r\n```\r\n\r\n# Environment data\r\n\r\nVersion info as below, but reproduces on all Powershell versions I have installed, including 5.1\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.0.0\r\nPSEdition                      Core\r\nGitCommitId                    7.0.0\r\nOS                             Microsoft Windows 10.0.18362\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```",
  "closed_at": null,
  "comments": [],
  "created_at": "2020-03-29T09:05:05Z",
  "number": 12223,
  "state": "open",
  "title": "Unable to load Microsoft.PowerShell.Core into empty SessionState",
  "updated_at": "2020-03-31T18:58:00Z"
}