{
  "_url": "https://github.com/PowerShell/PowerShell/issues/2619",
  "author": "charub",
  "body": "Refer to MSFT:9583626\r\n\r\nPS Core is dependent on Urlmon.dll to get the security zone of a given file.  Urlmon.dll is not available on NanoServer. Make changes to follow an alternative code path if Urlmon.dll is not present.\r\n\r\n## **Following Scenarios should work :**\r\n**Scenario 1 :**\r\n1. Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\r\n2. Set-Content -path .\\TestRemoteFile.ps1 -Value Get-Date\r\n3. $alternateStreamContent = @\"\r\n[ZoneTransfer]\r\nZoneId=3\r\n\"@\r\n4. Add-Content -path E:\\Scripts\\TestRemoteFile.ps1 -Value $alternateStreamContent -Stream Zone.Identifier\r\n5.  .\\TestRemoteFile.ps1\r\n\r\n**Expected behavior :**\r\n\r\n.\\TestRemoteFile.ps1 : File E:\\Scripts\\TestRemoteFile.ps1 cannot be loaded. The file E:\\Scripts\\TestRemoteFile.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see\r\nabout_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.\r\nAt line:1 char:1\r\n+ .\\TestRemoteFile.ps1\r\n+ ~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : SecurityError: (:) [], PSSecurityException\r\n    + FullyQualifiedErrorId : UnauthorizedAccess\r\n\r\n**Scenario 2 :**\r\n1. Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\r\n2. Set-Content -path .\\TestUntrustedFile.ps1 -Value Get-Date\r\n3. $alternateStreamContent = @\"\r\n[ZoneTransfer]\r\nZoneId=4\r\n\"@\r\n4. Add-Content -path .\\TestUntrustedFile.ps1 -Value $alternateStreamContent -Stream Zone.Identifier\r\n5.  .\\TestUntrustedFile.ps1\r\n\r\n**Expected behavior :**\r\n.\\TestUntrustedFile.ps1 : File E:\\Scripts\\TestUntrustedFile.ps1 cannot be loaded. The file E:\\Scripts\\TestUntrustedFile.ps1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see\r\nabout_Execution_Policies at https://go.microsoft.com/fwlink/?LinkID=135170.\r\nAt line:1 char:1\r\n+ .\\TestUntrustedFile.ps1\r\n+ ~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : SecurityError: (:) [], PSSecurityException\r\n    + FullyQualifiedErrorId : UnauthorizedAccess\r\n\r\n**Scenario 3 :**\r\n1. Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\r\n2. Set-Content -path .\\TestLocalFile.ps1 -Value Get-Date\r\n3. $alternateStreamContent = @\"\r\n[ZoneTransfer]\r\nZoneId=0\r\n\"@\r\n4. Add-Content -path E:\\Scripts\\TestLocalFile.ps1 -Value $alternateStreamContent -Stream Zone.Identifier\r\n5.  .\\TestRemoteFile.ps1\r\n\r\n**Expected behavior :**\r\nFriday, November 4, 2016 11:02:46 AM\r\n\r\n\r\n**Scenario 4 :**\r\n1. Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\r\n2. Set-Content -path .\\TestIntranetFile.ps1 -Value Get-Date\r\n3. $alternateStreamContent = @\"\r\n[ZoneTransfer]\r\nZoneId=3\r\n\"@\r\n4. Add-Content -path E:\\Scripts\\TestIntranetFile.ps1 -Value $alternateStreamContent -Stream Zone.Identifier\r\n5.  .\\TestIntranetFile.ps1\r\n\r\n**Expected behavior :**\r\nFriday, November 4, 2016 11:02:46 AM\r\n\r\n**Scenario 5 :**\r\n1. Set-ExecutionPolicy -ExecutionPolicy RemoteSigned\r\n2. Set-Content -path .\\TestTrustedFile.ps1 -Value Get-Date\r\n3. $alternateStreamContent = @\"\r\n[ZoneTransfer]\r\nZoneId=2\r\n\"@\r\n4. Add-Content -path E:\\Scripts\\TestTrustedFile.ps1 -Value $alternateStreamContent -Stream Zone.Identifier\r\n5.  .\\TestTrustedFile.ps1\r\n\r\n**Expected behavior :**\r\nFriday, November 4, 2016 11:02:46 AM\r\n\r\n**Environment data\r\n----------------**\r\nPS C:\\> $PSVersionTable\r\n\r\nName                                        Value\r\n----                                             -----\r\nCLRVersion\r\nPSEdition                                   Core\r\nPSVersion                                  6.0.0-alpha\r\nPSCompatibleVersions              {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nWSManStackVersion                  3.0\r\nBuildVersion                               3.0.0.0\r\nSerializationVersion                    1.1.0.1\r\nGitCommitId                               v6.0.0-alpha.12\r\n",
  "closed_at": "2016-11-04T23:27:46Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Resolved via #2625\n",
      "created_at": "2016-11-04T23:27:46Z",
      "updated_at": "2016-11-04T23:27:46Z"
    }
  ],
  "created_at": "2016-11-04T18:26:27Z",
  "labels": [
    "Resolution-Fixed"
  ],
  "number": 2619,
  "state": "closed",
  "title": "If Urlmon.dll is not present, follow an alternative code path to get security zone of a given file",
  "updated_at": "2016-11-22T01:10:29Z"
}