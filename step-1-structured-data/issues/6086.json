{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6086",
  "author": "dantraMSFT",
  "body": "## PR Summary\r\n\r\nFix: https://github.com/PowerShell/PowerShell/issues/5695 and #6032\r\n\r\nThe original fix for this issue caused analytic events to always be logged on Unix systems, flooding syslog and os_log with unwanted output.\r\n\r\nThere are three underlying problems:\r\n\r\n1: The fix for the issue stripped off the channel keyword when analytic was specified causing it to be interpreted as operational output.\r\n\r\nThis change was removed.\r\n\r\n2: The declaration of PSChannel used the ETW channel id as a bitmask to test for writing to the channel.  This doesn't work because channel ids are integer values that are incremented.  Instead, the associated channel bit mask must be used for filtering. \r\n\r\nPSChannel was updated for UNIX builds to use the channel mask instead of the channel id to enable bitwise operations for filtering.\r\n\r\n3: Calling code does not use keywords correctly; passing either the operational or analytic channel masks as keywords,  instead of using the well-defined keywords.\r\n\r\nInstead of attempting to fix all callers, the change adds the channel mask to the keyword filter to ensure the caller's intent is met.   This is a workaround pending refactoring PowerShell logging initialization (see https://github.com/PowerShell/PowerShell/issues/6085).\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [NA] User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X ] Issue filed - Issue link: https://github.com/PowerShell/PowerShell/issues/5695\r\n- [X ] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [ PENDING] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [NA] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [X ] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n",
  "closed_at": "2018-02-02T18:49:10Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I have verified the changes on Windows and Linux. The script block logging and module logging related to the policy settings are working fine.",
      "created_at": "2018-02-02T18:38:42Z",
      "updated_at": "2018-02-02T18:38:42Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks @daxian-dbw ",
      "created_at": "2018-02-02T19:03:20Z",
      "updated_at": "2018-02-02T19:03:20Z"
    }
  ],
  "created_at": "2018-02-01T19:38:37Z",
  "number": 6086,
  "state": "closed",
  "title": "Fix filtering of analytic events on Unix platforms.",
  "updated_at": "2018-03-08T19:13:56Z"
}