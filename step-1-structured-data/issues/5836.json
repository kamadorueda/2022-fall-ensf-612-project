{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5836",
  "author": "dantraMSFT",
  "body": "Fixes https://github.com/PowerShell/PowerShell/issues/5733\r\nParameter binding has an assert that expects the argument value to be an array when the AST for the argument is an array.  This assertion fails when the argument is encoded, such as when the -encodedarguments command-line parameter is used.  The assert causes a process crash when running tests for debug builds.\r\n\r\nThe fix removes this assert since the method does not know the name of the argument being bound.\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ NA] User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [NA] Issue filed \r\n- [X] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [ NA] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [X] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [X] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n\r\n  ",
  "closed_at": "2018-01-12T20:41:18Z",
  "comments": [
    {
      "author": "lzybkr",
      "author_association": "MEMBER",
      "body": "I used to add too many assertions, but do so much less these days - so I feel like I added this for a good reason.\r\n\r\nI think a better fix would be to not pass the ast for the minishell code path because the parameter values no longer match up with the ast properly anyway.",
      "created_at": "2018-01-09T22:51:58Z",
      "updated_at": "2018-01-09T22:51:58Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "@lzybkr: I'm sure there was a reason but, at the end of the day, test runs consistently fail against debug builds due to this assert and consistently pass in release builds. In short, this assert isn't providing any value since debug builds are only run privately.\r\n\r\nif you do have a good reason for leaving it in, let me know. In lieu of one, I'm reluctant to make a functional change to address this.\r\n",
      "created_at": "2018-01-10T00:40:02Z",
      "updated_at": "2018-01-10T00:40:02Z"
    },
    {
      "author": "lzybkr",
      "author_association": "MEMBER",
      "body": "The assertion caught a contract violation - the ast does not match the argument. Contract violations should not be \"fixed\" by ignoring the assertion.\r\n\r\nIf everything works today, code added in the future might not realize the contract is violated and do strange things.\r\n\r\nYou can make a change in this area with some confidence because it is well tested in our tests, there is plenty of time before the next release, and I will review the fix.",
      "created_at": "2018-01-10T00:54:32Z",
      "updated_at": "2018-01-10T00:54:32Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "Then perhaps it shouldn't be an assert. The contract is being violated multiple times a test run right now.",
      "created_at": "2018-01-10T01:03:09Z",
      "updated_at": "2018-01-10T01:03:09Z"
    },
    {
      "author": "lzybkr",
      "author_association": "MEMBER",
      "body": "It's an internal api for code that changes infrequently - an assert is reasonable.",
      "created_at": "2018-01-10T01:07:28Z",
      "updated_at": "2018-01-10T01:07:28Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "@lzybkr: I have to say that I would be open to your argument if we had a process for running tests against debug builds but we don't and, in fact, this assert always failed in test runs.\r\n\r\nThat said, I'll update the PR with a proposed runtime fix.",
      "created_at": "2018-01-10T18:10:25Z",
      "updated_at": "2018-01-10T18:10:25Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "@lzybkr: Do you have any additional feedback?",
      "created_at": "2018-01-12T17:50:40Z",
      "updated_at": "2018-01-12T17:50:40Z"
    }
  ],
  "created_at": "2018-01-09T20:07:43Z",
  "number": 5836,
  "state": "closed",
  "title": "NativeCommandParameterBinder.appendOneNativeArgument: Remove overly restrictive Diagnostics.Assert - cannot handle -encodedarguments",
  "updated_at": "2018-01-12T21:08:12Z"
}