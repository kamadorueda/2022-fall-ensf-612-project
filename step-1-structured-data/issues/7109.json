{
  "_url": "https://github.com/PowerShell/PowerShell/issues/7109",
  "author": "kiazhi",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\n- Windows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nIf it is a bug report:\r\n- make sure you are able to repro it on the latest released version. \r\nYou can install the latest version from https://github.com/PowerShell/PowerShell/releases\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6?view=powershell-6).\r\n- Fill out the following repro template:\r\n\r\nIf it's not a bug, please remove the template and elaborate the issue in your own words.\r\n-->\r\nNot sure if it is due to #6998 because that is only listed in 6.1.0-preview.3 changes and not 6.1.0-preview.2 changes. As for 6.1.0-preview.1, it is working on Nano Server container image.\r\n\r\nAffected Platform\r\n------------------\r\n1. microsoft/nanoserver:sac2016\r\n2. microsoft/nanoserver:1709\r\n\r\nSteps to reproduce\r\n------------------\r\n1. Pull Nano Server build 1709/sac2016(latest) docker container image\r\n\r\n```shell\r\nC:\\> docker pull microsoft/nanoserver:latest\r\n```\r\n\r\n2. Run Nano Server build 1709/sac2016(latest) docker container\r\n\r\n```shell\r\nC:\\> docker run --rm -it microsoft/nanoserver:latest\r\n```\r\n\r\n3. Download PowerShell 6.1.0-preview.2 / PowerShell 6.1.0-preview.3 win-x64 Binary Zip\r\n\r\n```shell\r\nC:\\> powershell\r\n```\r\n\r\n```powershell\r\nPS C:\\> Invoke-WebRequest `\r\n        -Uri 'https://github.com/PowerShell/PowerShell/releases/download/v6.1.0-preview.2/PowerShell-6.1.0-preview.2-win-x64.zip' `\r\n        -OutFile 'C:\\PowerShell-6.1.0-preview.2-win-x64.zip'\r\n```\r\n\r\n4. Expand PowerShell 6.1.0-preview.2 / PowerShell 6.1.0-preview.3 win-x64 Binary Zip\r\n\r\n```powershell\r\nPS C:\\> Expand-Archive `\r\n        -Path 'C:\\PowerShell-6.1.0-preview.2-win-x64.zip' `\r\n        -DestinationPath \"$ENV:ProgramFiles\\PowerShell\\6.1.0-preview.2\"\r\n```\r\n\r\n```shell\r\nPS C:\\> Exit\r\n```\r\n\r\n5. Run PWSH from command prompt\r\n\r\n```shell\r\nC:\\> cd C:\\Program Files\\PowerShell\\6.1.0-preview.2\r\n```\r\n\r\n```shell\r\nC:\\Program Files\\PowerShell\\6.1.0-preview.2>pwsh\r\nPowerShell v6.1.0-preview.2\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nCannot load PSReadline module.  Console is running without PSReadline.\r\nFailFast: This function is not supported on this system\r\n\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(System.String, System.String[], Int32)\r\n   at Microsoft.PowerShell.ManagedPSEntry.Main(System.String[])\r\n```\r\n\r\nExpected behavior\r\n-----------------\r\n- PowerShell v6.1.0-preview.2 / v6.1.0-preview.3 should run on Nano Server\r\n```none\r\nC:\\Program Files\\PowerShell\\6.1.0-preview.2>pwsh\r\nPowerShell v6.1.0-preview.2\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nPS C:\\>\r\n```\r\n\r\nActual behavior\r\n---------------\r\n\r\n1. PowerShell 6.1.0-preview.2 Error output from Nano Server \r\n\r\n```none\r\nPowerShell v6.1.0-preview.2\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nCannot load PSReadline module.  Console is running without PSReadline.\r\nFailFast: This function is not supported on this system\r\n\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(System.String, System.String[], Int32)\r\n   at Microsoft.PowerShell.ManagedPSEntry.Main(System.String[])\r\n```\r\n\r\n2. PowerShell 6.1.0-preview.3 Error output from Nano Server \r\n\r\n```none\r\nPowerShell v6.1.0-preview.3\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nCannot load PSReadline module.  Console is running without PSReadline.\r\nFailFast:\r\nThis function is not supported on this system\r\n\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(System.String, System.String[], Int32)\r\n   at Microsoft.PowerShell.ManagedPSEntry.Main(System.String[])\r\n\r\nException details:\r\nSystem.ComponentModel.Win32Exception: This function is not supported on this system\r\n   at System.Management.Automation.Internal.SecuritySupport.GetSaferPolicy(String path, SafeHandle handle)\r\n   at System.Management.Automation.Security.SystemPolicy.TestSaferPolicy(String testPathScript, String testPathModule)\r\n   at System.Management.Automation.Security.SystemPolicy.GetAppLockerPolicy(String path, SafeHandle handle)\r\n   at System.Management.Automation.Security.SystemPolicy.GetLockdownPolicy(String path, SafeHandle handle)\r\n   at System.Management.Automation.Security.SystemPolicy.GetSystemLockdownPolicy()\r\n   at Microsoft.PowerShell.ConsoleHost.DoRunspaceInitialization(Boolean skipProfiles, String initialCommand, String configurationName, Collection`1 initialCommandArgs)\r\n   at Microsoft.PowerShell.ConsoleHost.DoCreateRunspace(String initialCommand, Boolean skipProfiles, Boolean staMode, String configurationName, Collection`1 initialCommandArgs)\r\n   at Microsoft.PowerShell.ConsoleHost.CreateRunspace(Object runspaceCreationArgs)\r\n   at Microsoft.PowerShell.ConsoleHost.DoRunspaceLoop(String initialCommand, Boolean skipProfiles, Collection`1 initialCommandArgs, Boolean staMode, String configurationName)\r\n   at Microsoft.PowerShell.ConsoleHost.Run(CommandLineParameterParser cpp, Boolean isPrestartWarned)\r\n   at Microsoft.PowerShell.ConsoleHost.Start(String bannerText, String helpText, String[] args)\r\n   at Microsoft.PowerShell.ConsoleShell.Start(String bannerText, String helpText, String[] args)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(String consoleFilePath, String[] args, Int32 argc)\r\n```\r\n\r\nEnvironment data\r\n----------------\r\n- None, because pwsh.exe cannot load the console.\r\n\r\n```powershell\r\nC:\\Program Files\\PowerShell\\6.1.0-preview.2>pwsh -v\r\nPowerShell v6.1.0-preview.2\r\n```\r\n\r\n```powershell\r\nC:\\Program Files\\PowerShell\\6.1.0-preview.3>pwsh -v\r\nPowerShell v6.1.0-preview.3\r\n```",
  "closed_at": "2018-06-20T02:45:13Z",
  "comments": [
    {
      "author": "kiazhi",
      "author_association": "CONTRIBUTOR",
      "body": "Just found out that PSReadline is suppose to be decouple as a sub module (#1979). I'm just thinking if I should log this issue in [PSReadLine](https://github.com/lzybkr/PSReadLine) repo instead? Please advise? @vors / @lzybkr / @SteveL-MSFT    ",
      "created_at": "2018-06-19T22:49:20Z",
      "updated_at": "2018-06-19T22:49:20Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "I believe that was brough up in https://github.com/PowerShell/PowerShell/issues/6750#issuecomment-397484455",
      "created_at": "2018-06-19T23:18:47Z",
      "updated_at": "2018-06-19T23:18:47Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "I just tried nano/latest with fix #6750 merged in built off master and it works fine so it's the same issue.\r\n\r\n@kiazhi you can use tomorrow's nightly build, build master yourself to get the fix, or wait for our next release which will probably be 2nd week in July",
      "created_at": "2018-06-20T02:45:12Z",
      "updated_at": "2018-06-20T02:45:58Z"
    },
    {
      "author": "kiazhi",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the prompt response, @vors & @SteveL-MSFT.\r\n\r\nI will try to build from master to test it out and wait till the 2nd week in July for the release download link to incorporate it into docker file. Cheers.",
      "created_at": "2018-06-20T09:31:30Z",
      "updated_at": "2018-06-20T09:31:30Z"
    }
  ],
  "created_at": "2018-06-19T03:30:53Z",
  "labels": [
    "Resolution-Answered"
  ],
  "number": 7109,
  "state": "closed",
  "title": "PowerShell 6.1.0-preview.2/6.1.0-preview.3 on Nano Server: Cannot load PSReadline module. Console is running without PSReadline.",
  "updated_at": "2018-06-20T09:31:30Z"
}