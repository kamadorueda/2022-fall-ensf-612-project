{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17331",
  "author": "FSharpCSharp",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nI have imported the PowerShell module BcContainerHelper into my DotNet Host application using the WinPSCompatSession. This works fine when I start my application with the Debug x64 or Release x64 configuration as administrator. The import of the module works smoothly and I can also execute included functions and cmdlets without problems and errors.\r\n\r\nThe error free output can be found under \"Expected Behavior\".\r\n\r\nNow I wanted to publish my application using \"dotnet publish\". To do this, I created a FolderProfile.publishxml in my Visual Studio project that contains the options I need. It also generates a result and I can also look at the exe file.\r\n\r\nIf I now execute the exe created there, I get the strangest errors and problems. Among other things, it strangely cannot find classic .NET assemblies in the WinPSCompatSession, which it can load without problems in the Debug x64 or Release x64 configuration. There it works.\r\n\r\nThe actual error can be found under \"Actual Behavior\". What else should be mentioned. This only occurs when I select \"Self-Contained\" in the Publish options. When I choose the \"Framework Dependend\" option, the errors do not occur.\r\n\r\nWhat am I doing wrong? Unfortunately I can't see any error to my disadvantage. I ask therefore for assistance.\r\n\r\nThe source code for my example can be found [here](https://github.com/FSharpCSharp/PowerShellWinPSCompatSession).\r\n\r\nImportant: The example should always be executed with administrator rights. This is required by the PowerShell module BcContainerHelper to work successfully.\n\n### Expected behavior\n\n```console\nStart Execution\r\nModule BcContainerHelper is loaded in Windows PowerShell using WinPSCompatSession remoting session; please note that all input and output of commands from this module will be deserialized objects. If you want to load this module into PowerShell please use 'Import-Module -SkipEditionCheck' syntax.\r\nDownloading application artifact /onprem/20.1.39764.39901/gb\r\nDownloading C:\\Users\\<UserName>\\AppData\\Local\\Temp\\0845edf1-d999-4f9c-b8e7-608a8e40f360.zip\r\nUnpacking application artifact to tmp folder\r\nusing 7zip\r\nDownloading platform artifact /onprem/20.1.39764.39901/platform\r\nDownloading C:\\Users\\<UserName>\\AppData\\Local\\Temp\\046a21c2-2535-4fa3-9828-e9d4b90e7cae.zip\r\nUnpacking platform artifact to tmp folder\r\nusing 7zip\r\nDownloading Prerequisite Components\r\nDownloading c:\\bcartifacts.cache\\onprem\\20.1.39764.39901\\platform\\Prerequisite Components\\DotNetCore\\DotNetCore.1.0.4_1.1.1-WindowsHosting.exe\r\nDownloading c:\\bcartifacts.cache\\onprem\\20.1.39764.39901\\platform\\Prerequisite Components\\Open XML SDK 2.5 for Microsoft Office\\OpenXMLSDKv25.msi\r\nDownloading c:\\bcartifacts.cache\\onprem\\20.1.39764.39901\\platform\\Prerequisite Components\\IIS URL Rewrite Module\\rewrite_2.0_rtw_x64.msi\r\nc:\\bcartifacts.cache\\onprem\\20.1.39764.39901\\gb\r\nc:\\bcartifacts.cache\\onprem\\20.1.39764.39901\\platform\n```\n\n\n### Actual behavior\n\n```console\nStart Execution\r\nModule BcContainerHelper is loaded in Windows PowerShell using WinPSCompatSession remoting session; please note that all input and output of commands from this module will be deserialized objects. If you want to load this module into PowerShell please use 'Import-Module -SkipEditionCheck' syntax.\r\nDownloading application artifact /onprem/20.1.39764.39901/gb\r\nDownloading C:\\Users\\<UserName>\\AppData\\Local\\Temp\\bcd913d2-d86a-4c96-a801-eef146379367.zip\r\nCould not download from https://bcartifacts.azureedge.net/..., retrying from https://bcartifacts.blob.core.windows.net/...\r\nDownload-Artifacts Telemetry Correlation Id: 9a94466d-fbfb-4bb3-955b-1ce533deb9b5\r\nSystem.Management.Automation.RemoteException: Unable to find type [TimeoutWebClient]: make sure that the assembly containing this type is loaded.\n```\n\n\n### Error details\n\n```console\nThis only occurs when I select \"Self-Contained\" in the Publish options. When I choose the \"Framework Dependend\" option, the errors do not occur.\n```\n\n\n### Environment data\n\n```powershell\nPSVersion                      7.2.3\r\nPSEdition                      Core\r\nGitCommitId                    7.2.3\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@anmenaga Can you take a look and see if it's a known issue?",
      "created_at": "2022-05-16T18:21:28Z",
      "updated_at": "2022-05-16T18:21:28Z"
    }
  ],
  "created_at": "2022-05-13T09:14:55Z",
  "labels": [
    "WG-DevEx-Portability",
    "Needs-Triage"
  ],
  "number": 17331,
  "state": "open",
  "title": "dotnet publish \"self-contained\": Unable to find type: make sure that the assembly containing this type is loaded.",
  "updated_at": "2022-05-16T18:21:29Z"
}