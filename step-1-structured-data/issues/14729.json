{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14729",
  "author": "diddledani",
  "body": "This is a regression affecting PowerShell Core, when comparing with Windows PowerShell from Windows Insider Build 21301.\r\n\r\nWhen using multiple `Invoke-WebRequest` calls to download content from `raw.githubusercontent.com`, only the first request succeeds with subsequent requests throwing a `System.Net.InternalException`.\r\n\r\nI can reproduce this reliably with `raw.githubusercontent.com` URLs, but I have _not_ succeeded in reproducing against other URLs.\r\n\r\n## Steps to reproduce\r\n\r\nBoth requests should be executed sequentially and without delay. It's easiest to reproduce the issue by putting both requests into a `.ps1` script and execute that.\r\n\r\n```powershell\r\nInvoke-WebRequest -Uri \"https://raw.githubusercontent.com/diddledan/one-script-wsl2-systemd/master/install.ps1\"\r\nInvoke-WebRequest -Uri \"https://raw.githubusercontent.com/diddledan/one-script-wsl2-systemd/master/services.ps1\"\r\n```\r\n\r\n## Expected behavior\r\n\r\nBoth requests are expected to complete successfully, and not throw an exception.\r\n\r\n## Actual behavior\r\n\r\nThe second request throws an exception: `System.Net.InternalException`\r\n\r\n```none\r\nStatusCode        : 200\r\nStatusDescription : OK\r\nContent           : param($Distro, $User, [switch]$NoGPG)\r\n\r\n                    $repoUrl = 'https://github.com/diddlesnaps/one-script-wsl2-systemd/raw/master/'\r\n\r\n                    # The main files to install.\r\n                    $files = @{\r\n                        'systemd' = @{\r\n                            'source' = '\u2026\r\nRawContent        : HTTP/1.1 200 OK\r\n                    Connection: keep-alive\r\n                    Cache-Control: max-age=300\r\n                    Content-Security-Policy: default-src 'none'; style-src 'unsafe-inline'; sandbox\r\n                    ETag: \"850161c65667f2bb9ae21e50e21bd807764ff6b8c05\u2026\r\nHeaders           : {[Connection, System.String[]], [Cache-Control, System.String[]], [Content-Security-Policy,\r\n                    System.String[]], [ETag, System.String[]]\u2026}\r\nImages            : {}\r\nInputFields       : {}\r\nLinks             : {}\r\nRawContentLength  : 9149\r\nRelationLink      : {}\r\n\r\nInvoke-WebRequest: C:\\Users\\yabea\\source\\one-script-wsl2-systemd\\test.ps1:2\r\nLine |\r\n   2 |  Invoke-WebRequest -Uri \"https://raw.githubusercontent.com/diddledan/o \u2026\r\n     |  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n     | Exception of type 'System.Net.InternalException' was thrown. -2146892963\r\n```\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.1\r\nPSEdition                      Core\r\nGitCommitId                    7.1.1\r\nOS                             Microsoft Windows 10.0.21301\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": null,
  "comments": [
    {
      "author": "diddledani",
      "author_association": "CONTRIBUTOR",
      "body": "For completeness, attempting to reproduce on Ubuntu using the Snap Packaged PowerShell Core does not exhibit the issue. That suggests it's either a conflict with the Windows Insider build I'm running or is otherwise Windows-specific.\r\n\r\nMy Ubuntu box, that does not fail, shows the following `$PSVersionTable`:\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.1\r\nPSEdition                      Core\r\nGitCommitId                    7.1.1\r\nOS                             Linux 5.8.0-41-generic #46-Ubuntu SMP Mon Jan 1\u2026\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```",
      "created_at": "2021-02-08T15:41:02Z",
      "updated_at": "2021-02-08T15:41:02Z"
    }
  ],
  "created_at": "2021-02-08T15:34:22Z",
  "labels": [
    "WG-Cmdlets-Utility",
    "Needs-Triage"
  ],
  "number": 14729,
  "state": "open",
  "title": "Regression: Multiple Invoke-WebRequest to raw.githubusercontent.com throws exception",
  "updated_at": "2021-02-08T17:31:01Z"
}