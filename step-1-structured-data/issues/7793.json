{
  "_url": "https://github.com/PowerShell/PowerShell/issues/7793",
  "author": "ThreeFive-O",
  "body": "## PR Summary\r\n\r\nUse newer Pester syntax on Send-MailMessage cmdlet tests:\r\n\r\n- Use Pester test cases\r\n- Add logic to store current mailbox content before running tests\r\n- Refactoring of code\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-11-21T08:01:53Z",
  "comments": [
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@ThreeFive-O It seems that the test is marked as pending on Linux. Is that expected?\r\n\r\nI would prefer not to have a different name when the test is pending versus when it succeeds. This help in tracking history of tests.",
      "created_at": "2018-09-24T16:51:34Z",
      "updated_at": "2018-09-24T16:51:34Z"
    },
    {
      "author": "ThreeFive-O",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan I can't really see the full output of the PowerShell-CI-linux test run from Pester. The test should only be marked as pending, if no SMTP server is available on the CI or if the user password can't be retrieved from /etc/password.\r\nIt's the same logic as the old test. Do you have any information if the PowerShell-CI-linux hosts a local Postfix SMTP server?",
      "created_at": "2018-09-25T17:29:53Z",
      "updated_at": "2018-09-25T17:29:53Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@ThreeFive-O You can go to logs and see that both tests are marked as pending:\r\n\r\n`\r\n2018-09-15T19:08:37.4876307Z   Describing Send-MailMessage\r\n`\r\n`\r\n2018-09-15T19:08:37.5576199Z ??\r\n`\r\n\r\nIf there are not running on Linux-CI then maybe add more logging with `Write-Verbose -Verbose` for the reason on skipping.\r\n\r\n@TravisEz13  would the following work on Linux-CI hosts?\r\n\r\n```PowerShell\r\n$tc = New-Object -TypeName System.Net.Sockets.TcpClient -ArgumentList \"localhost\", 25\r\n```",
      "created_at": "2018-09-25T20:53:50Z",
      "updated_at": "2018-09-25T20:53:50Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "It would only work if a mail host has been installed.",
      "created_at": "2018-09-26T00:57:27Z",
      "updated_at": "2018-09-26T00:57:27Z"
    },
    {
      "author": "ThreeFive-O",
      "author_association": "CONTRIBUTOR",
      "body": "I think that explains why the test is marked as pending. The daily build of the master branch is also marked as pending:\r\n```\r\n2018-09-28T10:15:30.5317964Z   Describing Basic Send-MailMessage tests\r\n2018-09-28T10:15:30.6222472Z ??\r\n```\r\n@TravisEz13 and @adityapatwardhan How should we proceed? Make another PR which installs Postfix mail server on the PowerShell-CI-Linux? Honestly I'm not very familiar with that.\r\n\r\nOn the other hand I'm working on a solution for #3950. But this is time-consuming, given the fact I want to enhance the test for the cmdlet first.\r\n",
      "created_at": "2018-09-28T15:56:40Z",
      "updated_at": "2018-09-28T15:56:40Z"
    },
    {
      "author": "anmenaga",
      "author_association": "CONTRIBUTOR",
      "body": "@TravisEz13 @adityapatwardhan please provide your feedback on questions in the last post.",
      "created_at": "2018-10-10T19:15:11Z",
      "updated_at": "2018-10-10T19:15:11Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "I would recommend adding a setup script for postfix and adding a step to the linux.yml to install it.  Detect if it's there and skip the test if it's not there.  This would give us the most flexibility.",
      "created_at": "2018-10-10T20:39:29Z",
      "updated_at": "2018-10-10T20:39:29Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-11-11T07:29:02Z",
      "updated_at": "2018-11-11T07:29:02Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has be automatically close because it is stale. If you wish to continue working on the PR, please first update the PR, then reopen it.\nThanks again for your contribution.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-11-21T08:01:53Z",
      "updated_at": "2018-11-21T08:01:53Z"
    },
    {
      "author": "ThreeFive-O",
      "author_association": "CONTRIBUTOR",
      "body": "Superseded by PR #8859",
      "created_at": "2019-02-12T12:36:15Z",
      "updated_at": "2019-02-12T12:36:15Z"
    }
  ],
  "created_at": "2018-09-15T18:56:16Z",
  "number": 7793,
  "state": "closed",
  "title": "Improve Send-MailMessage tests",
  "updated_at": "2019-02-12T12:36:15Z"
}