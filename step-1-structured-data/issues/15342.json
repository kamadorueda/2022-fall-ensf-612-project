{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15342",
  "author": "vanillaSprinkles",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n\r\n## Steps to reproduce\r\n\r\npre-setup:\r\n- registry keys: \r\n  - `HKEY_CURRENT_USER\\test\\noslashes`\r\n  - `HKEY_CURRENT_USER\\test\\some/test/key/`\r\n  - `HKEY_CURRENT_USER\\test\\another//caveat/`\r\n- or as a file.reg:\r\n  - ```\r\n    Windows Registry Editor Version 5.00\r\n    [HKEY_CURRENT_USER\\test]\r\n    [HKEY_CURRENT_USER\\test\\another//caveat/]\r\n    [HKEY_CURRENT_USER\\test\\noslashes]\r\n    [HKEY_CURRENT_USER\\test\\some/test/key/]\r\n    ```\r\n\r\n```powershell\r\n## should work (and works)\r\nget-item HKCU:\\test\\noslashes\r\n\r\n\r\n## should error (and it 'works' by triming slashes)\r\nget-item HKCU:\\test\\noslashes//////\r\n\r\n\r\n## should error (and it errors)\r\nget-item HKCU:\\test\\some/test/key\r\n\r\n\r\n## should work (and it shows broken behavior)\r\nget-item HKCU:\\test\\some/test/key/\r\n\r\n\r\n## should error (and it 'works' by triming slashes)\r\nget-item HKCU:\\test\\some/test/key////\r\n\r\n\r\n## should work (and it errors)\r\nget-item HKCU:\\test\\another//caveat/\r\n\r\n```\r\n\r\n\r\n\r\n## Expected behavior\r\n\r\n```none\r\nPS HKCU:\\> ## should work (and works)\r\nPS HKCU:\\> get-item HKCU:\\test\\noslashes\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nnoslashes\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it 'works' by triming slashes)\r\nPS HKCU:\\> get-item HKCU:\\test\\noslashes//////\r\nGet-Item: Cannot find path 'HKCU:\\test\\noslashes//////' because it does not exist.\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it errors)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key\r\nGet-Item: Cannot find path 'HKCU:\\test\\some\\test\\key' because it does not exist.\r\n\r\n\r\n\r\nPS HKCU:\\> ## should work (and it shows broken behavior)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key/\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nsome/test/key/\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it 'works' by triming slashes)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key////\r\nGet-Item: Cannot find path 'HKCU:\\test\\some/test/key////' because it does not exist.\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should work (and it errors)\r\nPS HKCU:\\> get-item HKCU:\\test\\another//caveat/\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nanother//caveat/\r\n```\r\n\r\n\r\n\r\n\r\n## Actual behavior (ps 7.1.3)\r\n\r\n```none\r\nPS HKCU:\\> ## should work (and works)\r\nPS HKCU:\\> get-item HKCU:\\test\\noslashes\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nnoslashes\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it 'works' by triming slashes)\r\nPS HKCU:\\> get-item HKCU:\\test\\noslashes//////\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nnoslashes\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it errors)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key\r\nGet-Item: Cannot find path 'HKCU:\\test\\some\\test\\key' because it does not exist.\r\n\r\n\r\n\r\nPS HKCU:\\> ## should work (and it shows broken behavior)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key/\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nkey\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should error (and it 'works' by triming slashes)\r\nPS HKCU:\\> get-item HKCU:\\test\\some/test/key////\r\n\r\n    Hive: HKEY_CURRENT_USER\\test\r\n\r\nName                           Property\r\n----                           --------\r\nkey\r\n\r\n\r\n\r\n\r\nPS HKCU:\\> ## should work (and it errors)\r\nPS HKCU:\\> get-item HKCU:\\test\\another//caveat/\r\nGet-Item: Cannot find path 'HKCU:\\test\\another\\caveat\\' because it does not exist.\r\n```\r\n\r\n## Environment data (ps 7.1.3)\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.3\r\nPSEdition                      Core\r\nGitCommitId                    7.1.3\r\nOS                             Microsoft Windows 6.3.9600\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0.}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n\r\n## potentially related\r\n- https://github.com/PowerShell/PowerShell/issues/5536\r\n- https://github.com/PowerShell/PowerShell/pull/8587\r\n \r\n",
  "closed_at": "2021-05-29T05:00:06Z",
  "comments": [
    {
      "author": "vanillaSprinkles",
      "author_association": "NONE",
      "body": "somebody correct me if I'm wrong, but I believe the problem is here:\r\n- https://github.com/renehernandez/PowerShell/blob/master/src/System.Management.Automation/namespaces/RegistryProvider.cs#L2937\r\n  - aka (in case master's line refs get clobbered):\r\n    ```\r\n        private string NormalizePath(string path)\r\n        {\r\n            string result = path;\r\n\r\n            if (!string.IsNullOrEmpty(path))\r\n            {\r\n                result = path.Replace(StringLiterals.AlternatePathSeparator, StringLiterals.DefaultPathSeparator);\r\n\r\n                // Remove relative path tokens\r\n                if (HasRelativePathTokens(path))\r\n                {\r\n                    result = NormalizeRelativePath(result, null);\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n    ```\r\n\r\n  - line: `result = path.Replace(StringLiterals.AlternatePathSeparator, StringLiterals.DefaultPathSeparator);` should be removed. Registry key names include `/` - and I am guessing now that `StringLiterals.AlternatePathSeparator` is converting that character to `\\`\r\n \r\n\n\n<blockquote><img src=\"https://opengraph.githubassets.com/446e06e84e1824b48e85dc8a8c69bbf99a95a67ff0df31816fda84589df2b037/renehernandez/PowerShell\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/renehernandez/PowerShell\">renehernandez/PowerShell</a></strong></div><div>PowerShell for every system! Contribute to renehernandez/PowerShell development by creating an account on GitHub.</div></blockquote>",
      "created_at": "2021-05-10T08:56:58Z",
      "updated_at": "2021-05-10T08:57:00Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "As you've linked in the description, this is basically an extension (and thus possibly a duplicate for task-tracking purposes) of https://github.com/PowerShell/PowerShell/issues/5536.\r\n\r\nPowerShell provider path handling is done at a higher layer than the provider itself currently, meaning that there are registry paths that can't currently be represented in PowerShell.\r\n\r\nTo solve this, we'd need to allow providers to handle their own path format in some way. We'd also need to evaluate the breaking change there, since users might be using `/` today with registry paths and would expect that to continue working as it does today.",
      "created_at": "2021-05-25T20:44:00Z",
      "updated_at": "2021-05-25T20:44:00Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Resolve this issue as a duplicate of #5536",
      "created_at": "2021-05-28T02:02:52Z",
      "updated_at": "2021-05-28T02:02:52Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as duplicate and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2021-05-29T05:00:05Z",
      "updated_at": "2021-05-29T05:00:05Z"
    }
  ],
  "created_at": "2021-05-03T21:19:02Z",
  "labels": [
    "Resolution-Duplicate",
    "WG-Engine-Providers"
  ],
  "number": 15342,
  "state": "closed",
  "title": "bug: get-item registry slash-magic trim'ing incorrectly",
  "updated_at": "2021-05-29T05:00:06Z"
}