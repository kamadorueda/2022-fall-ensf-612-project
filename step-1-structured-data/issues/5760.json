{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5760",
  "author": "adityapatwardhan",
  "body": "Fixes #5582\r\n\r\n## PR Summary\r\nThe change added two parameters, `RetryCount` and `RetryIntervalSec` to enable retry functionality.\r\nWhen retrying a verbose message is sent out to inform the user.\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [X] User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Issue filed - Issue link: https://github.com/PowerShell/PowerShell-Docs/issues/1991\r\n- [X] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [X] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [X] [Add `[feature]` if the change is significant or affectes feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [X] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n",
  "closed_at": "2018-06-29T04:06:54Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@adityapatwardhan Could you please continue?",
      "created_at": "2018-02-21T16:13:04Z",
      "updated_at": "2018-02-21T16:13:04Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@adityapatwardhan Please resolve conflicts.",
      "created_at": "2018-03-30T14:47:23Z",
      "updated_at": "2018-03-30T14:47:23Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "I plan to resume work on this next week.",
      "created_at": "2018-03-30T15:56:08Z",
      "updated_at": "2018-03-30T15:56:08Z"
    },
    {
      "author": "ffeldhaus",
      "author_association": "CONTRIBUTOR",
      "body": "Did you consider implementing Exponential Backof or different retry strategies? [AWS SDKs for instance use an Exponential Backof](https://docs.aws.amazon.com/general/latest/gr/api-retries.html) and it is good practice for many other web services.",
      "created_at": "2018-04-05T22:07:36Z",
      "updated_at": "2018-04-05T22:07:36Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@ffeldhaus Please open new Issue for your great suggestion - we shouldn't lost this.",
      "created_at": "2018-04-06T04:59:58Z",
      "updated_at": "2018-04-06T04:59:58Z"
    },
    {
      "author": "ffeldhaus",
      "author_association": "CONTRIBUTOR",
      "body": "I thought about this feature some more and I don't think it should be included in the current form without further discussion to prevent retries to cause issues or unwanted behavior and I don't think a Pull Request is the right place to discuss the design of this feature. As issue #5582 was already created for this feature, we should first discuss the design there and then continue with the Pull Request.\r\n\r\nI will add my concerns and design ideas to issue #5582.",
      "created_at": "2018-04-06T18:53:08Z",
      "updated_at": "2018-04-06T18:53:08Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-05-06T19:12:56Z",
      "updated_at": "2018-05-06T19:12:56Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "We have #6447 - should we close the Issue?\r\n\r\n/cc @SteveL-MSFT @markekraus ",
      "created_at": "2018-05-10T14:22:32Z",
      "updated_at": "2018-05-10T14:22:32Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov Retry and Resume are separate features. Resume continues downloading a partially downloaded file. Retry tries the URI again if a non-susccess status code was received. This PR is for the Retry feature, #6447 is for the Resume feature.",
      "created_at": "2018-05-10T15:45:35Z",
      "updated_at": "2018-05-10T15:45:35Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-06-09T16:32:39Z",
      "updated_at": "2018-06-09T16:32:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I wouldn't want to lose this.",
      "created_at": "2018-06-14T05:20:58Z",
      "updated_at": "2018-06-14T05:20:58Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@adityapatwardhan Please resolve merge conflicts. And I don't see new commits.",
      "created_at": "2018-06-18T06:24:08Z",
      "updated_at": "2018-06-18T06:24:08Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@iSazonov @markekraus @SteveL-MSFT  I have addressed all the feedback. Please have another look.",
      "created_at": "2018-06-19T23:00:23Z",
      "updated_at": "2018-06-19T23:00:23Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@iSazonov code review comments addressed.",
      "created_at": "2018-06-20T20:12:18Z",
      "updated_at": "2018-06-20T20:12:18Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan please document the new WebListener endpoint in https://github.com/PowerShell/PowerShell/blob/master/test/tools/WebListener/README.md",
      "created_at": "2018-06-20T20:26:07Z",
      "updated_at": "2018-06-20T20:26:07Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Added documentation and fixed more CodeFactor issues.",
      "created_at": "2018-06-20T22:34:49Z",
      "updated_at": "2018-06-20T22:34:49Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@SteveL-MSFT  Can you have another look?",
      "created_at": "2018-06-20T22:46:46Z",
      "updated_at": "2018-06-20T22:46:46Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Restarted Travis CI Linux - seems temporary failed.",
      "created_at": "2018-06-21T04:19:08Z",
      "updated_at": "2018-06-21T04:19:08Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@SteveL-MSFT  @markekraus  Please update your reviews.",
      "created_at": "2018-06-21T17:57:03Z",
      "updated_at": "2018-06-21T17:57:03Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan I may not have time until this weekend to give this the attention it deserves. I do want to review it for edge cases before it's pulled.",
      "created_at": "2018-06-21T18:11:49Z",
      "updated_at": "2018-06-21T18:11:49Z"
    },
    {
      "author": "ffeldhaus",
      "author_association": "CONTRIBUTOR",
      "body": "Is it really ok to do the retry for Status Code 304 and 400 to 599? There are several Status Codes were a retry just does not make sense and will just increase the load/error counters on the server. 400, 409, 410, 429, 431, 505 would be some were I don't think a retry should be done. 413 would require special retry handling.",
      "created_at": "2018-06-22T08:48:05Z",
      "updated_at": "2018-06-22T08:48:05Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@ffeldhaus I have plenty of use cases for retries just about every status code. For example, the status code is server side bug, a fix is being released to prod, and I want the script to retry until x amount of time passes or the fix is live.",
      "created_at": "2018-06-22T08:59:03Z",
      "updated_at": "2018-06-22T08:59:03Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Added a test for POST, please have another look. Thanks!",
      "created_at": "2018-06-25T21:50:21Z",
      "updated_at": "2018-06-25T21:50:21Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan That test doesn't provide a body payload nor does it test the response. The WebListener endpoint would need to echo back the body payload and then the pester test would need to check the response from WebListener to ensure the echoed payload matches the sent payload.",
      "created_at": "2018-06-25T22:42:12Z",
      "updated_at": "2018-06-25T22:42:12Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Updated test and controller with echo for sessionId.",
      "created_at": "2018-06-26T01:22:34Z",
      "updated_at": "2018-06-26T01:22:34Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan Two more things and I think this will be done. I just realized there are only tests for `Invoke-Webrequest`. Please add the same tests for `Invoke-RestMethod`. Also, instead of wrapping the tests in `#region Retry tests`, please use a `Context` block.",
      "created_at": "2018-06-26T08:43:51Z",
      "updated_at": "2018-06-26T08:43:51Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Since the code path is same, I believe adding all the tests will be duplication. I will add one test for Invoke-RestMethod to cover the scenario.",
      "created_at": "2018-06-26T16:17:57Z",
      "updated_at": "2018-06-26T16:17:57Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan The convention for the web cmdlets is to test all features on both, even common features. There is always the possibility that the common features clash with the implementation features.",
      "created_at": "2018-06-26T17:00:57Z",
      "updated_at": "2018-06-26T17:00:57Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Please review again. I have added tests for `Invoke-RestMethod`. I moved them to a new describe block so they can be grouped together. The describes for other Invoke-RestMethod and Invoke-WebRequest tests were separate. Thanks for the feedback, very much appreciated.",
      "created_at": "2018-06-26T17:43:40Z",
      "updated_at": "2018-06-26T17:43:40Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan there is a `Describe \"Invoke-WebRequest tests\" -Tags \"Feature\"` block and a `Describe \"Invoke-RestMethod tests\" -Tags \"Feature\"` and in those are various context blocks \r\n\r\nfor example, \r\n\r\nhttps://github.com/PowerShell/PowerShell/blob/e8d2a6b27827dd366f638468f96487ddf2de1db4/test/powershell/Modules/Microsoft.PowerShell.Utility/WebCmdlets.Tests.ps1#L827\r\n\r\nand \r\n\r\nhttps://github.com/PowerShell/PowerShell/blob/e8d2a6b27827dd366f638468f96487ddf2de1db4/test/powershell/Modules/Microsoft.PowerShell.Utility/WebCmdlets.Tests.ps1#L2119",
      "created_at": "2018-06-26T18:00:04Z",
      "updated_at": "2018-06-26T18:00:04Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus I decided to go with a separate `Describe` block so that we can use `TestCase` for `It` and re-use most of the test code. If we have tests for `Invoke-RestMethod` and `Invoke-WebRequest` in separate `Describe` blocks then there will be test code duplication. I prefer a separate `Describe` but since there is precedence I am not completely against adding them to existing `Describe` blocks.\r\n\r\nLet me know your thoughts?",
      "created_at": "2018-06-27T17:05:39Z",
      "updated_at": "2018-06-27T17:05:39Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan For all new features they have been separate context blocks in the top level describe blocks for each cmdlet. I'd prefer to stick to this pattern for now and look at changing things up in one of the open issues I have on refactoring the code and tests.  ",
      "created_at": "2018-06-27T17:10:17Z",
      "updated_at": "2018-06-27T17:10:17Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Ok, agreed. I will send an update in a few minutes.",
      "created_at": "2018-06-27T17:29:57Z",
      "updated_at": "2018-06-27T17:29:57Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus Made the changes to the tests as discussed above.",
      "created_at": "2018-06-27T17:54:04Z",
      "updated_at": "2018-06-27T17:54:04Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus  Good catch! Fixed.",
      "created_at": "2018-06-27T18:00:34Z",
      "updated_at": "2018-06-27T18:00:34Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@markekraus  Fixed documentation.\r\n",
      "created_at": "2018-06-27T19:10:33Z",
      "updated_at": "2018-06-27T19:10:33Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Reopen to restart CIs.",
      "created_at": "2018-06-28T05:07:15Z",
      "updated_at": "2018-06-28T05:07:15Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@iSazonov  Thanks for restarting CIs. All tests passed, ready to merge?",
      "created_at": "2018-06-28T17:21:14Z",
      "updated_at": "2018-06-28T17:21:14Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@adityapatwardhan Thanks for great contribution!",
      "created_at": "2018-06-29T04:07:22Z",
      "updated_at": "2018-06-29T04:07:22Z"
    }
  ],
  "created_at": "2017-12-29T20:25:44Z",
  "number": 5760,
  "state": "closed",
  "title": "Added functionality to retry in Invoke-RestMethod and Invoke-WebRequest.",
  "updated_at": "2018-11-01T17:38:53Z"
}