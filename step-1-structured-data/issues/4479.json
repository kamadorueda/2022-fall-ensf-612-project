{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4479",
  "author": "markekraus",
  "body": "# Synopsis\r\nExtends #4085 to include the `-UserAgent` parameter supplied `User-Agent` header. \r\n\r\n# Description\r\nSome API's, such as [Reddit](https://github.com/reddit/reddit/wiki/API#rules) require special `User-Agent` headers to identify application consumers of the API. Currently, `Invoke-WebRequest`  and `Invoke-RestMethod` are unable to properly use non-compliant `User-Agent` headers. This extends the behavior of the `-SkipHeaderValidation` switch parameter to include the `User-Agent` header supplied by the `-UserAgent` parameter.\r\n\r\n## Test Code\r\n\r\n```powershell\r\n$Uri = 'http://httpbin.org/headers'\r\nInvoke-WebRequest -Uri $Uri -UserAgent 'Invalid:Agent' -SkipHeaderValidation\r\nInvoke-RestMethod -Uri $Uri -UserAgent 'Invalid:Agent' -SkipHeaderValidation\r\n```\r\n\r\n## Current Behavior:\r\n\r\n```none\r\nInvoke-WebRequest : The format of value 'Invalid:Agent' is invalid.\r\nAt line:2 char:1\r\n+ Invoke-WebRequest -Uri $Uri -UserAgent 'Invalid:Agent'\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Invoke-WebRequest], FormatException\r\n    + FullyQualifiedErrorId : System.FormatException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand\r\n\r\nInvoke-RestMethod : The format of value 'Invalid:Agent' is invalid.\r\nAt line:3 char:1\r\n+ Invoke-RestMethod -Uri $Uri -UserAgent 'Invalid:Agent'\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Invoke-RestMethod], FormatException\r\n    + FullyQualifiedErrorId : System.FormatException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\r\n```\r\n\r\n\r\n## New Behavior\r\n\r\n```none\r\n\r\nStatusCode        : 200\r\nStatusDescription : OK\r\nContent           : {\r\n                      \"headers\": {\r\n                        \"Connection\": \"close\",\r\n                        \"Host\": \"httpbin.org\",\r\n                        \"User-Agent\": \"Invalid:Agent\"\r\n                      }\r\n                    }\r\n\r\nRawContent        : HTTP/1.1 200 OK\r\n                    Connection: keep-alive\r\n                    Date: Thu, 03 Aug 2017 10:25:25 GMT\r\n                    Via: 1.1 vegur\r\n                    Server: meinheld/0.6.1\r\n                    Access-Control-Allow-Origin: *\r\n                    Access-Control-Allow-Credentials: true\r\n                    X-Powered-...\r\nForms             :\r\nHeaders           : {[Connection, System.String[]], [Date, System.String[]], [Via, System.String[]], [Server,\r\n                    System.String[]]...}\r\nImages            : {}\r\nInputFields       : {}\r\nLinks             : {}\r\nParsedHtml        :\r\nRawContentLength  : 113\r\nRelationLink      : {}\r\n\r\n\r\nheaders : @{Connection=close; Host=httpbin.org; User-Agent=Invalid:Agent}\r\n```",
  "closed_at": "2017-08-04T16:10:24Z",
  "comments": [
    {
      "author": "msftclas",
      "author_association": "NONE",
      "body": "\r\n@markekraus,\nThanks for having already signed the Contribution License Agreement. Your agreement was validated by Microsoft. We will now review your pull request.\n_Thanks,\nMicrosoft Pull Request Bot_",
      "created_at": "2017-08-03T10:30:41Z",
      "updated_at": "2017-08-03T10:30:41Z"
    }
  ],
  "created_at": "2017-08-03T10:30:37Z",
  "number": 4479,
  "state": "closed",
  "title": "Extend -SkipHeaderValidation to include -UserAgent to support non-standard User-Agent headers",
  "updated_at": "2017-08-25T00:17:24Z"
}