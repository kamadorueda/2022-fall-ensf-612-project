{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6788",
  "author": "felixfbecker",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\n- Windows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nIf it is a bug report:\r\n- make sure you are able to repro it on the latest released version. \r\nYou can install the latest version from https://github.com/PowerShell/PowerShell/releases\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://github.com/PowerShell/PowerShell/blob/master/docs/KNOWNISSUES.md).\r\n- Fill out the following repro template:\r\n\r\nIf it's not a bug, please remove the template and elaborate the issue in your own words.\r\n-->\r\n\r\nWhen I am trying to import my Format.ps1xml file, I get a very unspecific errors message. I am coming here because I couldn't figure out what is wrong about this file after reading the XML reference extensively, asking a [question on StackOverflow](https://stackoverflow.com/questions/50095027/whats-wrong-about-this-format-ps1xml-file-a-node-is-missing-from-tablecontrol/50096396#50096396) and Gitter, and even digging through the PowerShell source code to find out where it is thrown.\r\n\r\nI assume this is not a bug, so it would be great if the error had a more helpful error message. An XSD schema would also help.\r\n\r\nSteps to reproduce\r\n------------------\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\r\n<Configuration>\r\n    <ViewDefinitions>\r\n        <View>\r\n            <Name>MyType</Name>\r\n            <ViewSelectedBy>\r\n                <TypeName>MyTypeName1</TypeName>\r\n                <TypeName>MyTypeName2</TypeName>\r\n            </ViewSelectedBy>\r\n            <ListControl>\r\n                <ListEntries>\r\n                     <ListEntry>\r\n                        <EntrySelectedBy>\r\n                            <TypeName>MyTypeName1</TypeName>\r\n                        </EntrySelectedBy>\r\n                        <ListItems>\r\n                            <ListItem>\r\n                                <PropertyName>myProp1</PropertyName>\r\n                            </ListItem>\r\n                        </ListItems>\r\n                    </ListEntry>\r\n                    <ListEntry>\r\n                        <EntrySelectedBy>\r\n                            <TypeName>MyTypeName2</TypeName>\r\n                        </EntrySelectedBy>\r\n                        <ListItems>\r\n                            <ListItem>\r\n                                <PropertyName>myProp2</PropertyName>\r\n                            </ListItem>\r\n                        </ListItems>\r\n                    </ListEntry>\r\n                </ListEntries>\r\n            </ListControl>\r\n        </View>\r\n    </ViewDefinitions>\r\n</Configuration>\r\n```\r\n```powershell\r\nUpdate-FormatData test.Format.ps1xml\r\n```\r\n\r\nExpected behavior\r\n-----------------\r\n\r\nThis should load without error, and make `MyTypeName1` and `MyTypeName2` display as a list, with `myProp1` being shown for `MyTypeName1` and `myProp2` being shown for `MyTypeName2`.\r\n\r\nActual behavior\r\n---------------\r\n\r\nThis error:\r\n\r\n```\r\nUpdate-FormatData : Errors occurred while loading the format data file:\r\ntest.Format.ps1xml, Error at XPath /Configuration/ViewDefinitions/View[1] in file test.Format.ps1xml: A node is missing from TableControl, ListControl, WideControl, CustomControl.\r\nAt line:1 char:1\r\n+ Update-FormatData ./PSSourcegraph.Format.ps1xml\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n+ CategoryInfo          : InvalidOperation: (:) [Update-FormatData], RuntimeException\r\n+ FullyQualifiedErrorId : FormatXmlUpdateException,Microsoft.PowerShell.Commands.UpdateFormatDataCommand\r\n```\r\n\r\nI don't see what node is missing.\r\nWeirdly, if I remove `EntrySelectedBy`, the error doesn't occur - but I need it to switch between the types, and I don't see what else I am missing from the [documentation](https://msdn.microsoft.com/en-us/library/gg580904(v=vs.85).aspx).\r\n\r\nEnvironment data\r\n----------------\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```powershell\r\n> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.0.1\r\nPSEdition                      Core\r\nGitCommitId                    v6.0.1\r\nOS                             Darwin 17.5.0 Darwin Kernel Version 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": null,
  "comments": [
    {
      "author": "sethvs",
      "author_association": "CONTRIBUTOR",
      "body": "Hello.\r\nThere should be one default `<ListEntry>` without `<EntrySelectedBy>` tag.\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\r\n<Configuration>\r\n    <ViewDefinitions>\r\n        <View>\r\n            <Name>MyType</Name>\r\n            <ViewSelectedBy>\r\n                <TypeName>MyTypeName1</TypeName>\r\n                <TypeName>MyTypeName2</TypeName>\r\n            </ViewSelectedBy>\r\n            <ListControl>\r\n                <ListEntries>\r\n                    <ListEntry>\r\n                        <ListItems>\r\n                            <ListItem>\r\n                                <PropertyName>myDefaultProp</PropertyName>\r\n                            </ListItem>\r\n                        </ListItems>\r\n                    </ListEntry>\r\n                     <ListEntry>\r\n                        <EntrySelectedBy>\r\n                            <TypeName>MyTypeName1</TypeName>\r\n                        </EntrySelectedBy>\r\n                        <ListItems>\r\n                            <ListItem>\r\n                                <PropertyName>myProp1</PropertyName>\r\n                            </ListItem>\r\n                        </ListItems>\r\n                    </ListEntry>\r\n                    <ListEntry>\r\n                        <EntrySelectedBy>\r\n                            <TypeName>MyTypeName2</TypeName>\r\n                        </EntrySelectedBy>\r\n                        <ListItems>\r\n                            <ListItem>\r\n                                <PropertyName>myProp2</PropertyName>\r\n                            </ListItem>\r\n                        </ListItems>\r\n                    </ListEntry>\r\n                </ListEntries>\r\n            </ListControl>\r\n        </View>\r\n    </ViewDefinitions>\r\n</Configuration>\r\n```",
      "created_at": "2018-05-02T08:15:14Z",
      "updated_at": "2018-05-02T08:15:14Z"
    },
    {
      "author": "Stephanevg",
      "author_association": "NONE",
      "body": "I agree with @felixfbecker  This is not a bug, and more an issue related to the documentation of custom types. \r\nI had the same issue, adding that missing node fixed it.",
      "created_at": "2018-05-25T23:50:02Z",
      "updated_at": "2018-05-25T23:50:02Z"
    },
    {
      "author": "felixfbecker",
      "author_association": "CONTRIBUTOR",
      "body": "I am working on XSDs for Format and Types.ps1xml files:\r\n\r\n![image](https://user-images.githubusercontent.com/10532611/45297479-cdfa5880-b505-11e8-88d4-20cf464532f8.png)\r\n\r\nThis is with the [vscode-xml](https://github.com/redhat-developer/vscode-xml) extension.\r\nSchemas are here: https://github.com/felixfbecker/PowerShellXSD\r\n\r\nI currently just autogenerated this schema from the Format file in that repo.\r\n\r\nI will investigate writing a script that parses the official schema markdown reference [here](https://github.com/PowerShell/PowerShell-Docs/blob/staging/developer/format/format-schema-xml-reference.md) and converts it into an XSD (probably with manual edits afterwards).\r\n\r\nI couldn't find reference docs for Types.ps1xml files unfortunately, but they also seem simpler.\r\n\r\nAnother unfortunate thing to mention is that schema validation won't work if you want to use ANSI color codes in Format files because of https://github.com/PowerShell/PowerShell/issues/7526",
      "created_at": "2018-09-10T12:34:11Z",
      "updated_at": "2018-09-10T12:34:11Z"
    },
    {
      "author": "felixfbecker",
      "author_association": "CONTRIBUTOR",
      "body": "Filed https://github.com/PowerShell/PowerShell/issues/7749 to track work on schemas",
      "created_at": "2018-09-10T12:51:32Z",
      "updated_at": "2018-09-10T12:51:32Z"
    }
  ],
  "created_at": "2018-05-01T18:33:32Z",
  "labels": [
    "Issue-Question",
    "WG-Engine"
  ],
  "number": 6788,
  "state": "open",
  "title": "Unspecific error when importing Format.ps1xml: A node is missing from TableControl, ListControl, WideControl, CustomControl",
  "updated_at": "2021-01-15T05:48:02Z"
}