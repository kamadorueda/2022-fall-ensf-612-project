{
  "_url": "https://github.com/PowerShell/PowerShell/issues/11091",
  "author": "mklement0",
  "body": "When you specify `-SimpleMatch`, the output objects' `.Matches` property isn't populated at all - the only information about the input string's _content_ is the `.Line` property.\r\n\r\nSince all matches per input object would only be available via `.Matches`, specifying `-AllMatches` in combination with `-SimpleMatch` is pointless and _should be prevented_.\r\n\r\nMy guess is that the -rare -  instances of this pointless combination in existing code stem from a misconception of what `-AllMatches` does; users may mistakenly think that `-AllMatches` is necessary to find all matches in a _file_ (which happens by default), whereas in reality it is used to find all matches on each _line_.\r\n\r\nAs an aside: The alternative would be to also capture literal matches with `-SimpleMatch` (both one by default, and all with `-AllMatches`), but (a) that would be a nontrivial enhancement and (b) is of less interest than with regexes; that said, it would still be of interest in two respects:\r\n\r\n* if you match literally, but case-INsensitively with `-SimpleMatch`, and are interested in the specific case variation of the matching parts of the input line.\r\n\r\n* Even with literal matching you may be interested in _how many_ matches occurred per line.\r\n\r\n# Steps to reproduce\r\n\r\n```powershell\r\n# Without `-SimpleMatch`: OK, because .Matches is populated\r\n('foo,foo' | Select-String -Pattern foo -AllMatches).Matches.Count | Should -Be 2\r\n\r\n# With -SimpleMatch:\r\n# The matching parts of the input lines aren't captured at all, so -AllMatches makes no sense.\r\n# An error should be thrown, but currently isn't:\r\n{ 'foo,foo' | Select-String -SimpleMatch foo -AllMatches } | Should -Throw\r\n```\r\n\r\n# Expected behavior\r\n\r\nBoth tests should pass.\r\n\r\n# Actual behavior\r\n\r\nThe 2nd test fails:\r\n\r\n```none\r\n Expected an exception, to be thrown, but no exception was thrown\r\n```\r\n\r\n# Environment data\r\n\r\n```none\r\nPowerShell Core 7.0.0-preview.5\r\n```\r\n",
  "closed_at": null,
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I prepared the fix but it is a breaking change if now we will throw in the case.",
      "created_at": "2019-11-18T11:45:14Z",
      "updated_at": "2019-11-18T11:46:31Z"
    },
    {
      "author": "mklement0",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks, @iSazonov.\r\n\r\nGood point - since specifying the inapplicable switch has currently no effect whatsoever, current code that uses it - meaninglessly - could conceivably break.\r\n\r\nMy _hunch_ is that we're talking about a Bucket 3: Unlikely Grey Area](https://github.com/PowerShell/PowerShell/blob/master/docs/dev-process/breaking-change-contract.md#bucket-3-unlikely-grey-area) change, however, given that `-SimpleMatch` itself appears not to be used all that frequently.\r\n\r\nSearching for https://github.com/search?q=select-string++simplematch+allmatches&type=Code\r\nbrings up only 79 code matches (most of them duplicates, and most of them PowerShell documentation / source code), but I did find 4 instances of combining `-AllMatches` with `-SimpleMatch`, across 3 repos:\r\n\r\n*  https://github.com/AditiTechnologies/Brewmaster.ElasticSearch\r\n   * https://github.com/AditiTechnologies/Brewmaster.ElasticSearch/blob/46376ba98ad458a3ddb022287046d5073d589377/Brewmaster%20Elastic%20Search%20Template.linq\r\n   * https://github.com/AditiTechnologies/Brewmaster.ElasticSearch/blob/46376ba98ad458a3ddb022287046d5073d589377/Template.json\r\n\r\n* https://github.com/bmmcclint/ps_scripts\r\n  * https://github.com/bmmcclint/ps_scripts/blob/1088d614e4122d4a9de5343531d45785e15ac14d/slack_themer.ps1\r\n  * Repo read-me states that is a WIP.\r\n\r\n* https://github.com/miwaniza/Autodesk_Vault_Programmers_Cookbook\r\n  * Repo is associated with a book whose linked page no longer seems to exists (don't follow the links).\r\n  * https://github.com/miwaniza/Autodesk_Vault_Programmers_Cookbook/blob/f07962969e92ce07573adf969b17a4826c9c12c7/test/licensed%20users.ps1\r\n\r\nGiven this, my vote is to make the change, not least because users should know that the combination doesn't make sense, so that the code doesn't end up not doing what they think it does.\r\n\r\n\r\n\r\n\r\n\n\n<blockquote><img src=\"https://repository-images.githubusercontent.com/49609581/96590180-07d7-11ea-89b1-2f719dc4bb9c\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/PowerShell\">PowerShell/PowerShell</a></strong></div><div>PowerShell for every system! Contribute to PowerShell/PowerShell development by creating an account on GitHub.</div></blockquote>\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/2028427?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/AditiTechnologies/Brewmaster.ElasticSearch\">AditiTechnologies/Brewmaster.ElasticSearch</a></strong></div><div>Brewmaster template for ElasticSearch on Windows Azure IaaS - AditiTechnologies/Brewmaster.ElasticSearch</div></blockquote>\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/2028427?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/AditiTechnologies/Brewmaster.ElasticSearch\">AditiTechnologies/Brewmaster.ElasticSearch</a></strong></div><div>Brewmaster template for ElasticSearch on Windows Azure IaaS - AditiTechnologies/Brewmaster.ElasticSearch</div></blockquote>\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/2028427?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/AditiTechnologies/Brewmaster.ElasticSearch\">AditiTechnologies/Brewmaster.ElasticSearch</a></strong></div><div>Brewmaster template for ElasticSearch on Windows Azure IaaS - AditiTechnologies/Brewmaster.ElasticSearch</div></blockquote>\n<blockquote><img src=\"https://avatars2.githubusercontent.com/u/15059502?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/bmmcclint/ps_scripts\">bmmcclint/ps_scripts</a></strong></div><div>Various PowerShell Scripts . Contribute to bmmcclint/ps_scripts development by creating an account on GitHub.</div></blockquote>\n<blockquote><img src=\"https://avatars2.githubusercontent.com/u/15059502?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/bmmcclint/ps_scripts\">bmmcclint/ps_scripts</a></strong></div><div>Various PowerShell Scripts . Contribute to bmmcclint/ps_scripts development by creating an account on GitHub.</div></blockquote>\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/6231326?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/miwaniza/Autodesk_Vault_Programmers_Cookbook\">miwaniza/Autodesk_Vault_Programmers_Cookbook</a></strong></div><div>Code examples for Autodesk Vault Programmers Cookbook on http://zippybytes.blogspot.com - miwaniza/Autodesk_Vault_Programmers_Cookbook</div></blockquote>\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/6231326?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/miwaniza/Autodesk_Vault_Programmers_Cookbook\">miwaniza/Autodesk_Vault_Programmers_Cookbook</a></strong></div><div>Code examples for Autodesk Vault Programmers Cookbook on http://zippybytes.blogspot.com - miwaniza/Autodesk_Vault_Programmers_Cookbook</div></blockquote>",
      "created_at": "2019-11-18T13:15:48Z",
      "updated_at": "2019-11-18T13:15:50Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "Seems like a fairly sound analysis to me. If users are using switches in tandem that simply don't work that way, they should be notified of that fact.",
      "created_at": "2019-11-18T13:37:39Z",
      "updated_at": "2019-11-18T13:37:39Z"
    }
  ],
  "created_at": "2019-11-16T18:02:02Z",
  "number": 11091,
  "state": "open",
  "title": "Select-String -SimpleMatch should be mutually exclusive with -AllMatches, but the combination is currently accepted and quietly ignored",
  "updated_at": "2019-11-18T14:15:19Z"
}