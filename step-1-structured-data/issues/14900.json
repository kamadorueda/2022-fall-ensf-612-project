{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14900",
  "author": "johandeclercqdemocon",
  "body": "with below script I can authenticate on AzureAd with a secret but not on teams. \r\nCan you please point me in the right direction how to do this for MicrosoftTeams ? \r\n\r\n\r\nimport-module Az \r\nImport-Module MicrosoftTeams \r\n$azureAplicationId =\"xxxx\"\r\n$azureTenantId= \"yyyyy\"\r\n$azurePassword = ConvertTo-SecureString \"secret\" -AsPlainText -Force\r\n$psCred = New-Object System.Management.Automation.PSCredential($azureAplicationId , $azurePassword)\r\nConnect-AzAccount -Credential $psCred -TenantId $azureTenantId -ServicePrincipal\r\n$context = [Microsoft.Azure.Commands.Common.Authentication.Abstractions.AzureRmProfileProvider]::Instance.Profile.DefaultContext\r\n$aadToken = [Microsoft.Azure.Commands.Common.Authentication.AzureSession]::Instance.AuthenticationFactory.Authenticate($context.Account, $context.Environment, $context.Tenant.Id.ToString(), $null, [Microsoft.Azure.Commands.Common.Authentication.ShowDialog]::Never, $null, \"https://graph.windows.net\").AccessToken\r\n\r\nConnect-AzureAD -AadAccessToken $aadToken -AccountId $context.Account.Id -TenantId $context.tenant.id\r\n\r\nConnect-MicrosoftTeams -Credential $psCred\r\n\r\n\r\n\r\noutput: \r\n\r\n\r\nWARNING: The provided service principal secret will be included in the 'AzureRmContext.json' file found in the user profile ( C:\\Users\\jdeclerc\\.Azure ). Please ensure th\r\nat this directory has appropriate protections.\r\n\r\nAccount                              SubscriptionName TenantId                             Environment\r\n-------                              ---------------- --------                             -----------\r\nxxxxx                                yyyyyy                               AzureCloud \r\n\r\nAccount      : xxxxx\r\nEnvironment  : AzureCloud\r\nTenant       : yyyyy\r\nTenantId     : yyyyy\r\nTenantDomain : yyyyy\r\n\r\nConnect-MicrosoftTeams : One or more errors occurred.: unknown_user_type: Unknown User Type\r\nAt line:13 char:1\r\n+ Connect-MicrosoftTeams -Credential $psCred\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : AuthenticationError: (:) [Connect-MicrosoftTeams], AadAuthenticationFailedException\r\n    + FullyQualifiedErrorId : Connect-MicrosoftTeams,Microsoft.Open.Teams.CommonLibrary.ConnectMicrosoftTeams\r\n \r\nConnect-MicrosoftTeams : One or more errors occurred.\r\nAt line:13 char:1\r\n+ Connect-MicrosoftTeams -Credential $psCred\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : AuthenticationError: (:) [Connect-MicrosoftTeams], AggregateException\r\n    + FullyQualifiedErrorId : Connect-MicrosoftTeams,Microsoft.Open.Teams.CommonLibrary.ConnectMicrosoftTeams\r\n \r\nConnect-MicrosoftTeams : unknown_user_type: Unknown User Type\r\nAt line:13 char:1\r\n+ Connect-MicrosoftTeams -Credential $psCred\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : AuthenticationError: (:) [Connect-MicrosoftTeams], AdalException\r\n    + FullyQualifiedErrorId : Connect-MicrosoftTeams,Microsoft.Open.Teams.CommonLibrary.ConnectMicrosoftTeams\r\n \r\nConnect-MicrosoftTeams : One or more errors occurred.: unknown_user_type: Unknown User Type\r\nAt line:13 char:1\r\n+ Connect-MicrosoftTeams -Credential $psCred\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Connect-MicrosoftTeams], AadAuthenticationFailedException\r\n    + FullyQualifiedErrorId : Microsoft.Open.Teams.CommonLibrary.AadAuthenticationFailedException,Microsoft.Open.Teams.CommonLibrary.ConnectMicrosoftTeams\r\n \r\n\r\n\r\n",
  "closed_at": "2021-02-24T18:10:21Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@johandeclercqdemocon Please post your question to StackOverflow or the [discussion](https://github.com/PowerShell/PowerShell/discussions) forum. You may be able to get an answer there.",
      "created_at": "2021-02-24T18:10:21Z",
      "updated_at": "2021-02-24T18:10:21Z"
    }
  ],
  "created_at": "2021-02-24T14:54:43Z",
  "number": 14900,
  "state": "closed",
  "title": "connect-microsoftteams from powershell with secret. ",
  "updated_at": "2021-02-24T18:10:21Z"
}