{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17975",
  "author": "nmbell",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nUsing the example code from the [about_Functions_Argument_Completion](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_functions_argument_completion?view=powershell-7.2#argumentcompleter-script-block) page, with a line added to inspect the value of the $fakeBoundParameters variable:\r\n```\r\nfunction MyArgumentCompleter{\r\n    param ( $commandName,\r\n            $parameterName,\r\n            $wordToComplete,\r\n            $commandAst,\r\n            $fakeBoundParameters )\r\n\r\n    $fakeBoundParameters | Out-String | Add-Content -Path \"C:\\Temp\\Debug.txt\" # testing\r\n\r\n    $possibleValues = @{\r\n        Fruits = @('Apple', 'Orange', 'Banana')\r\n        Vegetables = @('Tomato', 'Squash', 'Corn')\r\n    }\r\n\r\n    if ($fakeBoundParameters.ContainsKey('Type')) {\r\n        $possibleValues[$fakeBoundParameters.Type] | Where-Object {\r\n            $_ -like \"$wordToComplete*\"\r\n        }\r\n    } else {\r\n        $possibleValues.Values | ForEach-Object {$_}\r\n    }\r\n}\r\n\r\nfunction Test-ArgumentCompleter {\r\n[CmdletBinding()]\r\n param (\r\n        [Parameter(Mandatory=$true)]\r\n        [ValidateSet('Fruits', 'Vegetables')]\r\n        $Type,\r\n\r\n        [Parameter(Mandatory=$true)]\r\n        [ArgumentCompleter({ MyArgumentCompleter @args })]\r\n        $Value\r\n      )\r\n}\r\n```\r\nThen try the following:\r\n```\r\nSet-Content -Path \"C:\\Temp\\Debug.txt\" -Value $null\r\nTest-ArgumentCompleter -Type Fruits -Value Apple,{tab}\r\n# i.e. Test-ArgumentCompleter -Type Fruits -Value Apple,Apple\r\nGet-Content -Path \"C:\\Temp\\Debug.txt\"\r\n```\r\nReturns the following:\r\n```\r\nName                           Value\r\n----                           -----\r\nType                           Fruits\r\n```\r\n\r\nNow try: \r\n```\r\nSet-Content -Path \"C:\\Temp\\Debug.txt\" -Value $null\r\nTest-ArgumentCompleter -Type Fruits -Value Apple,B{tab}\r\n# i.e. Test-ArgumentCompleter -Type Fruits -Value Apple,Banana\r\nGet-Content -Path \"C:\\Temp\\Debug.txt\"\r\n```\r\nReturns the following:\r\n```\r\nName                           Value\r\n----                           -----\r\nType                           Fruits\r\nValue                          {Apple, B}\r\n```\r\n\n\n### Expected behavior\n\n```console\nIn the first example above, should return:\r\n\r\nName                           Value\r\n----                           -----\r\nType                           Fruits\r\nValue                          {Apple}\r\n```\n```\n\n\n### Actual behavior\n\n```console\nIn the first example above, actually returns:\r\n\r\nName                           Value\r\n----                           -----\r\nType                           Fruits\r\n```\r\nThe missing argument value makes it impossible to implement logic that sets or limits the autocomplete list based on arguments already selected.\n```\n\n\n### Error details\n\n```console\nn/a\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.6\r\nPSEdition                      Core\r\nGitCommitId                    7.2.6\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0, 5.0, 5.1.10032.0, 6.0.0, 6.1.0, 6.2.0, 7.0.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\nn/a",
  "closed_at": null,
  "comments": [
    {
      "author": "jhoneill",
      "author_association": "NONE",
      "body": "I think the problem lies with how fakeBoundParameters is determined \r\nif you have `-Type (\"Fru\" + \"its\")`  it is evaluated and fakeBoundParameters  holds type = \"Fruits\" , but if it is not complete syntactically it won't evaluate. \r\nIt is possible to use commandAst to do what you want, but it is a lot more work.\r\n  ",
      "created_at": "2022-08-27T14:26:47Z",
      "updated_at": "2022-08-27T14:26:47Z"
    }
  ],
  "created_at": "2022-08-27T03:26:46Z",
  "number": 17975,
  "state": "open",
  "title": "Existing arguments are not being passed from $PSBoundParameters to $fakeBoundParameters during argument completion",
  "updated_at": "2022-08-27T14:26:47Z"
}