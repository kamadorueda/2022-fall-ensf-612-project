{
  "_url": "https://github.com/PowerShell/PowerShell/issues/1694",
  "author": "mirichmo",
  "body": "- [x] Resolves issue #1689.\n- [x] Code is [rebased][sync] on `origin/master`.\n\nFixes the bug where PowerShell failed to start locally when run for the first time as a regular user.\n\nHere is the fixed behavior:\n\n``` powershell\nPS C:\\Program Files\\PowerShell\\6.0.0.7> set-executionpolicy -Scope localmachine bypass\nset-executionpolicy : Access to the path 'c:\\Program Files\\PowerShell\\6.0.0.7\\PowerShellProperties.json' is denied.\nTo change the execution policy for the default (LocalMachine) scope, start Windows PowerShell with the \"Run as\nadministrator\" option. To change the execution policy for the current user, run \"Set-ExecutionPolicy -Scope\nCurrentUser\".\nAt line:1 char:1\n+ set-executionpolicy -Scope localmachine bypass\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], UnauthorizedAccessException\n    + FullyQualifiedErrorId : System.UnauthorizedAccessException,Microsoft.PowerShell.Commands.SetExecutionPolicyCo\n   mmand\nPS C:\\Program Files\\PowerShell\\6.0.0.7> set-executionpolicy -Scope CurrentUser bypass\nPS C:\\Program Files\\PowerShell\\6.0.0.7> get-executionpolicy -list\n\n        Scope ExecutionPolicy\n        ----- ---------------\nMachinePolicy       Undefined\n   UserPolicy       Undefined\n      Process       Undefined\n  CurrentUser          Bypass\n LocalMachine       Undefined\n```\n\nCompared to inbox PowerShell's behavior in the same scenario:\n\n``` powershell\nPS C:\\Users\\mirichmo> set-executionpolicy -Scope LocalMachine Unrestricted\n\nExecution Policy Change\nThe execution policy helps protect you from scripts that you do not trust. Changing the execution policy might expose you to the security risks described in\nthe about_Execution_Policies help topic at http://go.microsoft.com/fwlink/?LinkID=135170. Do you want to change the execution policy?\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"N\"): y\nset-executionpolicy : Access to the registry key 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PowerShell\\1\\ShellIds\\Microsoft.PowerShell' is denied. To change the\nexecution policy for the default (LocalMachine) scope, start Windows PowerShell with the \"Run as administrator\" option. To change the execution policy for the\ncurrent user, run \"Set-ExecutionPolicy -Scope CurrentUser\".\nAt line:1 char:1\n+ set-executionpolicy -Scope LocalMachine Unrestricted\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], UnauthorizedAccessException\n    + FullyQualifiedErrorId : System.UnauthorizedAccessException,Microsoft.PowerShell.Commands.SetExecutionPolicyCommand\n```\n",
  "closed_at": "2016-08-10T01:04:42Z",
  "comments": [
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "Waiting on @mirichmo  to fix tests.\n",
      "created_at": "2016-08-09T19:15:37Z",
      "updated_at": "2016-08-09T19:15:37Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@mirichmo You should have added a test to verify this does not regress...\n",
      "created_at": "2016-08-10T00:41:23Z",
      "updated_at": "2016-08-10T00:41:23Z"
    }
  ],
  "created_at": "2016-08-09T04:10:51Z",
  "number": 1694,
  "state": "closed",
  "title": "Resolves a JsonConfigFileAccessor constructor exception to fix #1689",
  "updated_at": "2016-08-10T01:04:58Z"
}