{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6069",
  "author": "markekraus",
  "body": "## PR Summary\r\n\r\n* Change Web Cmdlets Tests to Use 127.0.0.1 instead of localhost due to dotnet/corefx#24104 \r\n* This provides a decent speed boost to the WebCmdlet tests.\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [NA] User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [NA] Issue filed - Issue link:\r\n- [X] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [NA] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [X] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n",
  "closed_at": "2018-02-01T04:26:06Z",
  "comments": [
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@markekraus reading the dotnet thread, it seems that this is a side effect of DNS and not specifically httpclient.  If so, should we globally change all tests using `localhost` to `127.0.0.1`?",
      "created_at": "2018-01-30T23:00:15Z",
      "updated_at": "2018-01-30T23:00:15Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "Well it depends on how you look at it.. DNS and the IPv6 vs IPv4 certainly plays a key role... but the fact that ,NET Core is orders of magnitude slower than .NET Framework at dealing with the exact same name resolution dilemma.. I'd say that is a .NET Core problem.... pretty much al HTTP APIs are wrapping the same low level API as HttpClient and some of the others (such as WebRequest) are wrapping HttpClient... anyway semantics aside...\r\n\r\nAre there other tests outside of the Web Cmdlets that are accessing something on localhost? If they are and they are using any of the HTTP APIs then they could be converted to 127.0.0.1 for some performance gain. I wasn't aware of any such tests.\r\n\r\nIt's really important for the Web Client tests because we are breaking 5 seconds for redirect tests and the sheer volume of calls made to localhost really add up the test time. ",
      "created_at": "2018-01-30T23:25:09Z",
      "updated_at": "2018-01-30T23:25:09Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@markekraus I simply did a search for `localhost` in the test folder and had many hits.  The WSMan configuration ones should stay localhost as that's what the config path is called.  Specially for HTTP, I see some proxy tests that explicitly use `localhost`.",
      "created_at": "2018-01-31T00:59:11Z",
      "updated_at": "2018-01-31T00:59:11Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@SteveL-MSFT  The proxy tests in the Web Cmdlets are probably unaffected. I believe they are all immediate errors. I'll give the a second look, but last I checked they never get to the point where an HTTP call is made. I'll look at the other tests as well.",
      "created_at": "2018-01-31T01:13:39Z",
      "updated_at": "2018-01-31T01:13:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Other PRs is experiencing problems with these web tests. I suggest fast merge the PR and continue explorations in next PR.",
      "created_at": "2018-01-31T05:35:24Z",
      "updated_at": "2018-01-31T05:35:24Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov #6055 will also stop the false positives. the -TimeOutSec needs to be removed from tests not related to -TimeOutSec anyway because of the potential for a regression to be missed due to feature clash. That PR is ready.",
      "created_at": "2018-01-31T09:29:36Z",
      "updated_at": "2018-01-31T09:29:36Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "I changed #6068 to include looking at localhost usage in all tests, not just Web Cmdlets. We can merge this PR and cover the rest which are not as numerous nor show stopping as the ones fixed by this PR.",
      "created_at": "2018-01-31T20:09:19Z",
      "updated_at": "2018-01-31T20:09:19Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@markekraus Thanks for the temporary fix!\r\n\r\nWe definitely need performance/benchmark tests.",
      "created_at": "2018-02-01T04:29:25Z",
      "updated_at": "2018-02-01T04:29:25Z"
    }
  ],
  "created_at": "2018-01-30T18:29:39Z",
  "number": 6069,
  "state": "closed",
  "title": "Change Web Cmdlet Tests to Use 127.0.0.1 not Localhost",
  "updated_at": "2018-02-01T04:29:25Z"
}