{
  "_url": "https://github.com/PowerShell/PowerShell/issues/3681",
  "author": "alfredopalhares",
  "body": "Hello,\r\n\r\nI am running ArchLinux (updated today) and trying to build Powershell version 6.0.0.alpha.17-2 from the [AUR](https://aur.archlinux.org/packages/powershell)\r\n\r\n\r\nSteps to reproduce\r\n------------------\r\nBuild powershell from the AUR\r\n\r\nExpected behavior\r\n-----------------\r\nIt should compile.\r\n\r\nActual behavior\r\n---------------\r\n```\r\n/tmp/pkgbuild-1000/powershell/src/powershell\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Crypto' threw an exception. ---> System.TypeInitializationException: The type initializer for 'CryptoInitializer' threw an exception. ---> System.DllNotFoundException: Unable to load DLL 'System.Security.Cryptography.Native.OpenSsl': The specified module could not be found.\r\n (Exception from HRESULT: 0x8007007E)\r\n   at Interop.CryptoInitializer.EnsureOpenSslInitialized()\r\n   at Interop.CryptoInitializer..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto.GetRandomBytes(Byte* buf, Int32 num)\r\n   at System.IO.Path.GetCryptoRandomBytesOpenSsl(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetCryptoRandomBytes(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetRandomFileName()\r\n   at Microsoft.DotNet.InternalAbstractions.TemporaryDirectory..ctor()\r\n   at Microsoft.Extensions.EnvironmentAbstractions.DirectoryWrapper.CreateTemporaryDirectory()\r\n   at Microsoft.DotNet.Configurer.NuGetPackagesArchiver..ctor()\r\n   at Microsoft.DotNet.Cli.Program.ConfigureDotNetForFirstTimeUse(INuGetCacheSentinel nugetCacheSentinel)\r\n   at Microsoft.DotNet.Cli.Program.ProcessArgs(String[] args, ITelemetry telemetryClient)\r\n   at Microsoft.DotNet.Cli.Program.Main(String[] args)\r\nproot info: pid 5886: terminated with signal 6\r\nproot info: pid 5888: terminated with signal 6\r\nproot info: pid 5887: terminated with signal 6\r\nproot info: pid 5885: terminated with signal 6\r\nproot info: pid 5884: terminated with signal 6\r\nproot info: pid 5883: terminated with signal 6\r\nproot info: pid 5882: terminated with signal 6\r\n/tmp/pkgbuild-1000/powershell/src/build.sh: line 3:  5882 Aborted                 (core dumped) dotnet restore\r\n/tmp/pkgbuild-1000/powershell/src/powershell/src/ResGen /tmp/pkgbuild-1000/powershell/src/powershell\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Crypto' threw an exception. ---> System.TypeInitializationException: The type initializer for 'CryptoInitializer' threw an exception. ---> System.DllNotFoundException: Unable to load DLL 'System.Security.Cryptography.Native.OpenSsl': The specified module could not be found.\r\n (Exception from HRESULT: 0x8007007E)\r\n   at Interop.CryptoInitializer.EnsureOpenSslInitialized()\r\n   at Interop.CryptoInitializer..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto.GetRandomBytes(Byte* buf, Int32 num)\r\n   at System.IO.Path.GetCryptoRandomBytesOpenSsl(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetCryptoRandomBytes(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetRandomFileName()\r\n   at Microsoft.DotNet.InternalAbstractions.TemporaryDirectory..ctor()\r\n   at Microsoft.Extensions.EnvironmentAbstractions.DirectoryWrapper.CreateTemporaryDirectory()\r\n   at Microsoft.DotNet.Configurer.NuGetPackagesArchiver..ctor()\r\n   at Microsoft.DotNet.Cli.Program.ConfigureDotNetForFirstTimeUse(INuGetCacheSentinel nugetCacheSentinel)\r\n   at Microsoft.DotNet.Cli.Program.ProcessArgs(String[] args, ITelemetry telemetryClient)\r\n   at Microsoft.DotNet.Cli.Program.Main(String[] args)\r\nproot info: pid 5897: terminated with signal 6\r\nproot info: pid 5896: terminated with signal 6\r\nproot info: pid 5895: terminated with signal 6\r\nproot info: pid 5894: terminated with signal 6\r\nproot info: pid 5893: terminated with signal 6\r\nproot info: pid 5892: terminated with signal 6\r\nproot info: pid 5891: terminated with signal 6\r\n/tmp/pkgbuild-1000/powershell/src/build.sh: line 6:  5891 Aborted                 (core dumped) dotnet run -c Linux\r\n/tmp/pkgbuild-1000/powershell/src/powershell\r\n/tmp/pkgbuild-1000/powershell/src/powershell/src/TypeCatalogParser /tmp/pkgbuild-1000/powershell/src/powershell\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Crypto' threw an exception. ---> System.TypeInitializationException: The type initializer for 'CryptoInitializer' threw an exception. ---> System.DllNotFoundException: Unable to load DLL 'System.Security.Cryptography.Native.OpenSsl': The specified module could not be found.\r\n (Exception from HRESULT: 0x8007007E)\r\n   at Interop.CryptoInitializer.EnsureOpenSslInitialized()\r\n   at Interop.CryptoInitializer..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto.GetRandomBytes(Byte* buf, Int32 num)\r\n   at System.IO.Path.GetCryptoRandomBytesOpenSsl(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetCryptoRandomBytes(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetRandomFileName()\r\n   at Microsoft.DotNet.InternalAbstractions.TemporaryDirectory..ctor()\r\n   at Microsoft.Extensions.EnvironmentAbstractions.DirectoryWrapper.CreateTemporaryDirectory()\r\n   at Microsoft.DotNet.Configurer.NuGetPackagesArchiver..ctor()\r\n   at Microsoft.DotNet.Cli.Program.ConfigureDotNetForFirstTimeUse(INuGetCacheSentinel nugetCacheSentinel)\r\n   at Microsoft.DotNet.Cli.Program.ProcessArgs(String[] args, ITelemetry telemetryClient)\r\n   at Microsoft.DotNet.Cli.Program.Main(String[] args)\r\nproot info: pid 5914: terminated with signal 6\r\nproot info: pid 5913: terminated with signal 6\r\nproot info: pid 5912: terminated with signal 6\r\nproot info: pid 5911: terminated with signal 6\r\nproot info: pid 5910: terminated with signal 6\r\nproot info: pid 5909: terminated with signal 6\r\nproot info: pid 5908: terminated with signal 6\r\n/tmp/pkgbuild-1000/powershell/src/build.sh: line 10:  5908 Aborted                 (core dumped) dotnet run -c Linux\r\n/tmp/pkgbuild-1000/powershell/src/powershell\r\n/tmp/pkgbuild-1000/powershell/src/powershell/src/TypeCatalogGen /tmp/pkgbuild-1000/powershell/src/powershell\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Crypto' threw an exception. ---> System.TypeInitializationException: The type initializer for 'CryptoInitializer' threw an exception. ---> System.DllNotFoundException: Unable to load DLL 'System.Security.Cryptography.Native.OpenSsl': The specified module could not be found.\r\n (Exception from HRESULT: 0x8007007E)\r\n   at Interop.CryptoInitializer.EnsureOpenSslInitialized()\r\n   at Interop.CryptoInitializer..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto.GetRandomBytes(Byte* buf, Int32 num)\r\n   at System.IO.Path.GetCryptoRandomBytesOpenSsl(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetCryptoRandomBytes(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetRandomFileName()\r\n   at Microsoft.DotNet.InternalAbstractions.TemporaryDirectory..ctor()\r\n   at Microsoft.Extensions.EnvironmentAbstractions.DirectoryWrapper.CreateTemporaryDirectory()\r\n   at Microsoft.DotNet.Configurer.NuGetPackagesArchiver..ctor()\r\n   at Microsoft.DotNet.Cli.Program.ConfigureDotNetForFirstTimeUse(INuGetCacheSentinel nugetCacheSentinel)\r\n   at Microsoft.DotNet.Cli.Program.ProcessArgs(String[] args, ITelemetry telemetryClient)\r\n   at Microsoft.DotNet.Cli.Program.Main(String[] args)\r\nproot info: pid 5927: terminated with signal 6\r\nproot info: pid 5926: terminated with signal 6\r\nproot info: pid 5925: terminated with signal 6\r\nproot info: pid 5924: terminated with signal 6\r\nproot info: pid 5923: terminated with signal 6\r\nproot info: pid 5922: terminated with signal 6\r\nproot info: pid 5921: terminated with signal 6\r\n/tmp/pkgbuild-1000/powershell/src/build.sh: line 14:  5921 Aborted                 (core dumped) dotnet run -c Linux ../Microsoft.PowerShell.CoreCLR.AssemblyLoadContext/CorePsTypeCatalog.cs powershell.inc\r\n/tmp/pkgbuild-1000/powershell/src/powershell\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Crypto' threw an exception. ---> System.TypeInitializationException: The type initializer for 'CryptoInitializer' threw an exception. ---> System.DllNotFoundException: Unable to load DLL 'System.Security.Cryptography.Native.OpenSsl': The specified module could not be found.\r\n (Exception from HRESULT: 0x8007007E)\r\n   at Interop.CryptoInitializer.EnsureOpenSslInitialized()\r\n   at Interop.CryptoInitializer..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Interop.Crypto.GetRandomBytes(Byte* buf, Int32 num)\r\n   at System.IO.Path.GetCryptoRandomBytesOpenSsl(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetCryptoRandomBytes(Byte* bytes, Int32 byteCount)\r\n   at System.IO.Path.GetRandomFileName()\r\n   at Microsoft.DotNet.InternalAbstractions.TemporaryDirectory..ctor()\r\n   at Microsoft.Extensions.EnvironmentAbstractions.DirectoryWrapper.CreateTemporaryDirectory()\r\n   at Microsoft.DotNet.Configurer.NuGetPackagesArchiver..ctor()\r\n   at Microsoft.DotNet.Cli.Program.ConfigureDotNetForFirstTimeUse(INuGetCacheSentinel nugetCacheSentinel)\r\n   at Microsoft.DotNet.Cli.Program.ProcessArgs(String[] args, ITelemetry telemetryClient)\r\n   at Microsoft.DotNet.Cli.Program.Main(String[] args)\r\nproot info: pid 5941: terminated with signal 6\r\nproot info: pid 5940: terminated with signal 6\r\nproot info: pid 5939: terminated with signal 6\r\nproot info: pid 5938: terminated with signal 6\r\nproot info: pid 5937: terminated with signal 6\r\nproot info: pid 5936: terminated with signal 6\r\nproot info: pid 5935: terminated with signal 6\r\n/tmp/pkgbuild-1000/powershell/src/build.sh: line 18:  5935 Aborted                 (core dumped) dotnet build -c Linux\r\n\r\n```\r\n\r\nEnvironment data\r\n----------------\r\nNot at that point yet.\r\n\r\nRegards,\r\nAlfredo Palhares\r\n\r\n",
  "closed_at": "2017-05-04T17:28:28Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@kylesferrazza Could you please comment the Issue?",
      "created_at": "2017-05-04T14:02:38Z",
      "updated_at": "2017-05-04T14:02:38Z"
    },
    {
      "author": "kylesferrazza",
      "author_association": "CONTRIBUTOR",
      "body": "Dotnet's most recent AUR pkgbuild has been failing to build with clang 4. I also tried downgrading llvm and clang to 3.5 and it still failed. As soon as I'm able to build dotnet I can fix the Powershell PKGBUILDs.",
      "created_at": "2017-05-04T16:12:30Z",
      "updated_at": "2017-05-04T16:12:30Z"
    },
    {
      "author": "kylesferrazza",
      "author_association": "CONTRIBUTOR",
      "body": "There is a known issue: https://bbs.archlinux.org/viewtopic.php?id=225790",
      "created_at": "2017-05-04T16:21:59Z",
      "updated_at": "2017-05-04T16:21:59Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@kylesferrazza Thanks! PowerShell repo was moved to .Net Core 2.0. You can asks CoreFX/CoreCLR team to help - I believe they are interested in promoting .Net Core on Unix.\r\n@masterkorp PowerShell team don't support officially ArchLinux so we close the Issue as external.",
      "created_at": "2017-05-04T17:28:17Z",
      "updated_at": "2017-05-04T17:28:17Z"
    }
  ],
  "created_at": "2017-05-02T13:53:19Z",
  "number": 3681,
  "state": "closed",
  "title": "Failed to compile on Archlinux from AUR",
  "updated_at": "2017-05-04T17:28:28Z"
}