{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6263",
  "author": "daxian-dbw",
  "body": "## PR Summary\r\n\r\nRemove the use of `Add-AppveyorCompilationMessage` from `Start-NativeExecution`.\r\n`Add-AppveyorCompilationMessage` is an AppVeyor specific cmdlet which won't work when running `Start-NativeExecution` in Travis CI.\r\n\r\n#6111 seems to cause CI to fail in master (Travis CI, macOS only) when running `dotnet restore`: https://travis-ci.org/PowerShell/PowerShell/jobs/346997722\r\nHowever, the CI builds for the PR were successful: https://travis-ci.org/PowerShell/PowerShell/builds/346459731?utm_source=github_status&utm_medium=notification\r\n\r\nI also tried on Macbook locally and the restore is successful. I'm not sure what might cause the failure in the master CI, and will wait till tomorrow morning to see if the subsequent daily builds will also fail for the same error. When looking at the `dotnet restore` failure, I found errors about `Add-AppveyorCompilationMessage` in Travis CI, so fixing it in this PR.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-03-01T00:07:27Z",
  "comments": [
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "If `Add-AppveyorCompilationMessage` is useful in AppVeyor CI, then maybe we can use `$env:APPVEYOR`.\r\n\r\nIt so happened that `$env:CI` is defined by both Travis-CI and AppVeyor.\r\n\r\nhttps://www.appveyor.com/docs/environment-variables/\r\nhttps://docs.travis-ci.com/user/environment-variables/",
      "created_at": "2018-02-28T01:40:12Z",
      "updated_at": "2018-02-28T01:40:12Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "According to @TravisEz13, `Add-AppveyorCompilationMessage` is to make sure the AppVeyor build fails. But the `throw` statement already makes the build fails, no matter in AppVeyor or Travis CI, so I don't think this is really needed here.",
      "created_at": "2018-02-28T16:37:37Z",
      "updated_at": "2018-02-28T16:37:37Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "It seems the failure in `dotnet restore` was because of the outdated cache content. After running `dotnet nuget locals all --clear` before `dotnet restore`, the macOS CI build worked fine (see [build result](https://travis-ci.org/PowerShell/PowerShell/builds/347362201?utm_source=github_status&utm_medium=notification)).\r\n\r\nHowever, the cache was not updated in the last build because `cache.push` timeout was reached. So I temporarily increase the timeout to make the cache update succeed.\r\nOnce the new cache content was uploaded successfully, I will revert `dotnet nuget locals all --clear` and `cache timeout` changes and verify the build again.",
      "created_at": "2018-02-28T17:46:35Z",
      "updated_at": "2018-02-28T18:21:27Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "CI builds passed. It looks to me refreshing the cache fixed the build break. I will merge this PR and see how it goes.",
      "created_at": "2018-03-01T00:06:37Z",
      "updated_at": "2018-03-01T00:06:37Z"
    }
  ],
  "created_at": "2018-02-28T00:13:32Z",
  "number": 6263,
  "state": "closed",
  "title": "Remove AppVeyor specific cmdlet from 'Start-NativeExecution'",
  "updated_at": "2018-03-01T00:07:31Z"
}