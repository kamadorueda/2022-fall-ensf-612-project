{
  "_url": "https://github.com/PowerShell/PowerShell/issues/7292",
  "author": "somewhatlogical",
  "body": "I am unsure if this is a bug in task scheduler and how it registers itself with CIM, or if there's something on the PS end.  This effects at least 5 and core (guessing like everything though).  These and others basically result in the inability to use the built-in PS5 task scheduler Cmdlets to add triggers for these types that aren't handled on the Cmdlet (ie:  by manually creating CimClass for the trigger types missing to try to put them in that means).  Also, invalid data is returned since the PS class returns these cim instances.\r\n\r\n\r\n\r\nI've noticed two issues (I'm guessing there are more):\r\n\r\n1. Classes do not have correct types on the properties.  Note I've only included one example, though have seen several other instances.  I think most of these triggers should be gone through to type appropriately, since I know I've seen at least one other somewhere that seemed like it was incorrect.  The problem is that the values cannot be set because they become out of range due to incorrect typing on the CIM class (ie:  it's impossible to pass all available combinations through using a CIM instance and the existing New-ScheduledTask*, which basically removes some of the various combinations of months/days/weeks/etc. you can use).  I presume this also makes the values impossible to retrieve reliably using the built in *-ScheduledTask* cmdlets for scheduled tasks (or on Core through CIM directly... would sure be cool if getting working functionality on Windows for these extremely common administrative tasks was a priority before abstracting out the OS layer).\r\n\r\n\r\n\r\nSteps to reproduce\r\n------------------\r\n$tempCimClass = Get-CimClass -ClassName MSFT_TaskMonthlyTrigger  `\r\n                -Namespace Root/Microsoft/Windows/TaskScheduler:MSFT_TaskMonthlyTrigger\r\n$tempCimClass | Select *\r\n\r\nExpected behavior\r\n-----------------\r\nName               : DaysOfMonth\r\nValue              :\r\nCimType            : UInt32 (really, if going by the API this should be a non-nullable long)\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nActual behavior\r\n---------------\r\nName               : DaysOfMonth\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\n---------------------------------------\r\n\r\n2.  Some classes are not typed correctly.  The instance I saw of this was on both the Monthly and MonthlyDOWTrigger.  When it is returned, it is typed as its base class (MSFT_TaskTrigger), and thus does not have the all the properties available on it for retrieval.  You can get the actual classes (as they currently exist in CIM, **but note issue 1 where the types on these and possibly others are incorrect**; this example is just pulling the existing from CIM, not showing what the corrected data types would be since I don't know what standard you guys use for that) here:\r\n$tempCimClass = Get-CimClass -ClassName MSFT_TaskMonthlyTrigger  `\r\n                -Namespace Root/Microsoft/Windows/TaskScheduler:MSFT_TaskMonthlyTrigger\r\n            $tempCreatedTrigger = New-CimInstance -CimClass $tempCimClass -ClientOnly\r\n$tempCimClass.CimClassProperties | Select *\r\n\r\n$tempCimClass = Get-CimClass -ClassName MSFT_TaskMonthlyDOWTrigger  `\r\n                -Namespace Root/Microsoft/Windows/TaskScheduler:MSFT_TaskMonthlyDOWTrigger\r\n            $tempCreatedTrigger = New-CimInstance -CimClass $tempCimClass -ClientOnly\r\n$tempCimClass.CimClassProperties | Select *\r\n\r\nSteps to reproduce\r\n------------------\r\n\r\nCreate monthly and monthly DOW trigger\r\n![image](https://user-images.githubusercontent.com/26860540/42737231-51367384-8836-11e8-80c0-77374af0c570.png)\r\n\r\nIn PS:\r\n\r\n$temp = (get-ciminstance -ClassName 'MSFT_ScheduledTask' `\r\n        -Namespace 'Root/Microsoft/Windows/TaskScheduler' `\r\n        -Shallow:$false\r\n    ) `\r\n| Where-Object { `\r\n    $_.TaskName -like 'test2' `\r\n}\r\n\r\n$temp.Triggers | Select *\r\n\r\nExpected behavior\r\n-----------------\r\n\r\nEnabled               : False\r\nEndBoundary           : 2019-07-13T21:50:17-05:00\r\nExecutionTimeLimit    :\r\nId                    :\r\nRepetition            : MSFT_TaskRepetitionPattern\r\nStartBoundary         : 2018-07-13T21:50:15-05:00\r\nPSComputerName        :\r\nCimClass              : Root/Microsoft/Windows/TaskScheduler:MSFT_**TaskMonthlyTrigger**\r\nCimInstanceProperties : {Enabled, EndBoundary, ExecutionTimeLimit, Id...}\r\nCimSystemProperties   : Microsoft.Management.Infrastructure.CimSystemProperties\r\n\r\n...CimInstanceProperties\r\nName               : Enabled\r\nValue              :\r\nCimType            : Boolean\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : EndBoundary\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : ExecutionTimeLimit\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : Id\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : Repetition\r\nValue              :\r\nCimType            : Instance\r\nFlags              : Property, NullValue\r\nQualifiers         : {EmbeddedInstance}\r\nReferenceClassName : MSFT_TaskRepetitionPattern\r\n\r\nName               : StartBoundary\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : DaysOfMonth\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : MonthOfYear\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : RandomDelay\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : RunOnLastDayOfMonth\r\nValue              :\r\nCimType            : Boolean\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\n--------------------------------\r\nEnabled               : False\r\nEndBoundary           :\r\nExecutionTimeLimit    :\r\nId                    :\r\nRepetition            : MSFT_TaskRepetitionPattern\r\nStartBoundary         : 2018-07-15T13:47:26\r\nPSComputerName        :\r\nCimClass              : Root/Microsoft/Windows/TaskScheduler:MSFT_**TaskMonthlyDOWTrigger**\r\nCimInstanceProperties : {Enabled, EndBoundary, ExecutionTimeLimit, Id...}\r\nCimSystemProperties   : Microsoft.Management.Infrastructure.CimSystemProperties\r\n\r\n...CimInstanceProperties\r\n\r\nName               : Enabled\r\nValue              :\r\nCimType            : Boolean\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : EndBoundary\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : ExecutionTimeLimit\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : Id\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : Repetition\r\nValue              :\r\nCimType            : Instance\r\nFlags              : Property, NullValue\r\nQualifiers         : {EmbeddedInstance}\r\nReferenceClassName : MSFT_TaskRepetitionPattern\r\n\r\nName               : StartBoundary\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : DaysOfWeek\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : MonthOfYear\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : RandomDelay\r\nValue              :\r\nCimType            : String\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : RunOnLastWeekOfMonth\r\nValue              :\r\nCimType            : Boolean\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\r\nName               : WeeksOfMonth\r\nValue              :\r\nCimType            : UInt16\r\nFlags              : Property, NullValue\r\nQualifiers         : {}\r\nReferenceClassName :\r\n\u2026\u2026\u2026.\r\n\r\n\r\n\r\nActual behavior\r\n---------------\r\n\r\nEnabled               : False\r\nEndBoundary           : 2019-07-13T21:50:17-05:00\r\nExecutionTimeLimit    :\r\nId                    :\r\nRepetition            : MSFT_TaskRepetitionPattern\r\nStartBoundary         : 2018-07-13T21:50:15-05:00\r\nPSComputerName        :\r\nCimClass              : Root/Microsoft/Windows/TaskScheduler:MSFT_**TaskTrigger**\r\nCimInstanceProperties : {Enabled, EndBoundary, ExecutionTimeLimit, Id...}\r\nCimSystemProperties   : Microsoft.Management.Infrastructure.CimSystemProperties\r\n\r\n\u2026.CimInstanceProperties\r\n\r\nName            : Enabled\r\nValue           : False\r\nCimType         : Boolean\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : EndBoundary\r\nValue           : 2019-07-13T21:50:17-05:00\r\nCimType         : String\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : ExecutionTimeLimit\r\nValue           :\r\nCimType         : String\r\nFlags           : Property, NotModified, NullValue\r\nIsValueModified : False\r\n\r\nName            : Id\r\nValue           :\r\nCimType         : String\r\nFlags           : Property, NotModified, NullValue\r\nIsValueModified : False\r\n\r\nName            : Repetition\r\nValue           : MSFT_TaskRepetitionPattern\r\nCimType         : Instance\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : StartBoundary\r\nValue           : 2018-07-13T21:50:15-05:00\r\nCimType         : String\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\n-------\r\n\r\nEnabled               : False\r\nEndBoundary           :\r\nExecutionTimeLimit    :\r\nId                    :\r\nRepetition            : MSFT_TaskRepetitionPattern\r\nStartBoundary         : 2018-07-15T13:47:26\r\nPSComputerName        :\r\nCimClass              : Root/Microsoft/Windows/TaskScheduler:MSFT_**TaskTrigger**\r\nCimInstanceProperties : {Enabled, EndBoundary, ExecutionTimeLimit, Id...}\r\nCimSystemProperties   : Microsoft.Management.Infrastructure.CimSystemProperties\r\n\r\n\u2026CimInstanceProperties\r\n\r\nName            : Enabled\r\nValue           : False\r\nCimType         : Boolean\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : EndBoundary\r\nValue           : 2019-07-13T21:50:17-05:00\r\nCimType         : String\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : ExecutionTimeLimit\r\nValue           :\r\nCimType         : String\r\nFlags           : Property, NotModified, NullValue\r\nIsValueModified : False\r\n\r\nName            : Id\r\nValue           :\r\nCimType         : String\r\nFlags           : Property, NotModified, NullValue\r\nIsValueModified : False\r\n\r\nName            : Repetition\r\nValue           : MSFT_TaskRepetitionPattern\r\nCimType         : Instance\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\nName            : StartBoundary\r\nValue           : 2018-07-13T21:50:15-05:00\r\nCimType         : String\r\nFlags           : Property, NotModified\r\nIsValueModified : False\r\n\r\n\u2026\u2026...",
  "closed_at": null,
  "comments": [
    {
      "author": "danielboth",
      "author_association": "NONE",
      "body": "Having the same issue with the Monthly and MonthlyDOW trigger types. Additionally, it is also not possible to create a task using one of these schedule types in PowerShell. ",
      "created_at": "2019-03-29T06:40:23Z",
      "updated_at": "2019-03-29T06:40:23Z"
    },
    {
      "author": "gmitch64",
      "author_association": "NONE",
      "body": "I'm also having issues creating a task with a Monthly DoW trigger. Been bashing my head again the wall trying to get it to work before someone pointed me here.",
      "created_at": "2022-05-09T17:12:28Z",
      "updated_at": "2022-05-09T17:12:28Z"
    }
  ],
  "created_at": "2018-07-15T19:26:43Z",
  "labels": [
    "WG-Cmdlets",
    "Issue-Discussion"
  ],
  "number": 7292,
  "state": "open",
  "title": "Task Scheduler CIM Issues",
  "updated_at": "2022-05-09T17:12:28Z"
}