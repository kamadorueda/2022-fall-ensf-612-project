{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17055",
  "author": "michaeltlombardi",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Context\r\n\r\nAfter investigating PowerShell Session Configuration for MicrosoftDocs/PowerShell-Docs#8583 (relevant notes below for reference) and talking to @PaulHigin, my understanding is that:\r\n\r\n1. The functionality covered by these parameters is not _intended_ to work in PowerShell.\r\n1. The existing behavior of these parameters is unexpected as a user and undocumented.\r\n1. The **PowerShellVersion** parameter should be removed from `New-PSSessionConfigurationFile`.\r\n1. The **PSVersion** parameter should be removed from `Register-PSSessionConfiguration` and `Set-PSSessionConfiguration`.\r\n1. `Test-PSSessionConfigurationFile` should, if the **PowerShellVersion** key is set, inform the user (error, warn, or something else) that the key cannot be used for PowerShell session configurations.\r\n\r\n### Steps to reproduce\r\n\r\nIn PowerShell 7+, the **PSSessionConfiguration** cmdlets (enumerated below) still include a parameter for specifying the version of PowerShell associated with a session configuration.\r\n\r\n| Cmdlet | Parameter |\r\n| ------ | --------- |\r\n| `New-PSSessionConfigurationFile` | **PowerShellVersion** |\r\n| `Register-PSSessionConfiguration` | **PSVersion** |\r\n| `Set-PSSessionConfiguration` | **PSVersion** |\r\n\r\nTo confirm this:\r\n\r\n```powershell\r\n$null -eq ((Get-Command -Name New-PSSessionConfigurationFile).Parameters.Keys -match 'PowerShellVersion')\r\n$null -eq ((Get-Command -Name Register-PSSessionConfiguration).Parameters.Keys -match 'PSVersion')\r\n$null -eq ((Get-Command -Name Set-PSSessionConfiguration).Parameters.Keys -match 'PSVersion')\r\n```\r\n\r\n### Expected behavior\r\n\r\n```console\r\n$true\r\n$true\r\n$true\r\n```\r\n\r\n\r\n### Actual behavior\r\n\r\n```console\r\n$false\r\n$false\r\n$false\r\n```\r\n\r\n\r\n### Error details\r\n\r\n_No response_\r\n\r\n### Environment data\r\n\r\n```powershell\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.3.0-preview.2\r\nPSEdition                      Core\r\nGitCommitId                    7.3.0-preview.2\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n_No response_\r\n\r\n### Investigation Notes\r\n\r\n1. Valid versions for session config are reported as 2.0 -> 5.1\r\n   - When using the value in a PSSC:\r\n\r\n     ```text\r\n     Register-PSSessionConfiguration: The value 7.2 is not valid for the PSVersion parameter.\r\n     The available values are 2.0, 3.0, 4.0, 5.0, 5.1.\r\n     ```\r\n\r\n   - When overriding with the `-PSVersion` flag of `Register-PSSessionConfiguration`:\r\n\r\n     ```text\r\n     Register-PSSessionConfiguration:\r\n        Cannot bind parameter 'PSVersion' to the target. Exception setting \"PSVersion\": \"The value 7.2 is not valid for the PSVersion parameter.\r\n        The available values are 2.0, 3.0, 4.0, 5.0, 5.1.\"\r\n     ```\r\n\r\n   - Default Session Configurations with 7.2.2 (after calling `Enable-PSRemoting`):\r\n\r\n     ```text\r\n     Name          : PowerShell.7\r\n     PSVersion     : 7.2\r\n     StartupScript :\r\n     RunAsUser     :\r\n     Permission    : NT AUTHORITY\\INTERACTIVE AccessAllowed, ...\r\n \r\n     Name          : PowerShell.7.2.2\r\n     PSVersion     : 7.2\r\n     StartupScript :\r\n     RunAsUser     :\r\n     Permission    : NT AUTHORITY\\INTERACTIVE AccessAllowed, ...\r\n     ```\r\n\r\n1. `Test-PSSessionConfigurationFile` does not catch this.\r\n1. There is no apparent way to _choose_ a new session configuration for 7x _but_ new session configurations created in 7x are automatically created with their PSVersion and `Enable-PSRemoting` in 7x will register a session configuration for that version (ie `PowerShell.7.2.2`) _and_ set (or register if it does not exist).\r\n1. Repro:\r\n\r\n   ```powershell\r\n   New-PSSessionConfigurationFile -Path ./test.pssc -MountUser\r\n   Register-PSSessionConfiguration -Path ./test.pssc -Name mount_test_7x\r\n   Get-PSSessionConfiguration -Name mount_test* | Format-List -Property Name, PSVersion\r\n   ```\r\n\r\n   ```text\r\n   Name      : mount_test_7x\r\n   PSVersion : 7.2\r\n   ```\r\n\r\n   Open a Windows PowerShell prompt and:\r\n\r\n   ```powershell\r\n   Register-PSSessionConfiguration -Path ./test.pssc -Name mount_test_5x\r\n   Get-PSSessionConfiguration -Name mount_test | Format-List -Property Name, PSVersion\r\n   ```\r\n\r\n   ```text\r\n   Name      : mount_test_7x\r\n   PSVersion : 7.2\r\n\r\n   Name      : mount_test_5x\r\n   PSVersion : 5.1\r\n   ```",
  "closed_at": null,
  "comments": [],
  "created_at": "2022-03-23T19:34:25Z",
  "number": 17055,
  "state": "open",
  "title": "The `PSVersion` and `PowerShellVersion` parameters should be removed from `*-PSSessionConfiguration*` cmdlets",
  "updated_at": "2022-03-24T10:41:14Z"
}