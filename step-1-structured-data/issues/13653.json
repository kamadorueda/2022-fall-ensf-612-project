{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13653",
  "author": "Safirion",
  "body": "Hi, it's maybe a bug of .Net 5. \r\n\r\n## Steps to reproduce\r\n\r\nOpen a runspacepool in a .Net5 Web Api published as a single file.\r\n\r\n## Expected behavior\r\n\r\nThe runspace pool is open and works fine like before (before the update of .Net or powershell package)\r\n\r\n## Actual behavior\r\n\r\n```\r\nSystem.TypeInitializationException: The type initializer for 'System.Management.Automation.PSVersionInfo' threw an exception.\r\n ---> System.ArgumentException: The path is empty. (Parameter 'path')\r\n   at System.IO.Path.GetFullPath(String path)\r\n   at System.Diagnostics.FileVersionInfo.GetVersionInfo(String fileName)\r\n   at System.Management.Automation.PSVersionInfo..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at System.Management.Automation.PSVersionInfo.get_SerializationVersion()\r\n   at System.Management.Automation.Remoting.RemoteSessionCapability..ctor(RemotingDestination remotingDestination)\r\n   at System.Management.Automation.Remoting.RemoteSessionCapability.CreateClientCapability()\r\n   at System.Management.Automation.Remoting.ClientRemoteSessionImpl..ctor(RemoteRunspacePoolInternal rsPool, URIDirectionReported uriRedirectionHandler)\r\n   at System.Management.Automation.Internal.ClientRunspacePoolDataStructureHandler.CreateClientRemoteSession(RemoteRunspacePoolInternal rsPoolInternal)\r\n   at System.Management.Automation.Internal.ClientRunspacePoolDataStructureHandler..ctor(RemoteRunspacePoolInternal clientRunspacePool, TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.Internal.RemoteRunspacePoolInternal.CreateDSHandler(TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.Internal.RemoteRunspacePoolInternal..ctor(Int32 minRunspaces, Int32 maxRunspaces, TypeTable typeTable, PSHost host, PSPrimitiveDictionary applicationArguments, RunspaceConnectionInfo connectionInfo, String name)\r\n   at System.Management.Automation.Runspaces.RunspacePool..ctor(Int32 minRunspaces, Int32 maxRunspaces, TypeTable typeTable, PSHost host, PSPrimitiveDictionary applicationArguments, RunspaceConnectionInfo connectionInfo, String name)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host, TypeTable typeTable, PSPrimitiveDictionary applicationArguments)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host, TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo)\r\n   at System.Management.Automation.Remoting.RemoteSessionCapability.CreateClientCapability()\r\n   at System.Management.Automation.Remoting.ClientRemoteSessionImpl..ctor(RemoteRunspacePoolInternal rsPool, URIDirectionReported uriRedirectionHandler)\r\n   at System.Management.Automation.Internal.ClientRunspacePoolDataStructureHandler.CreateClientRemoteSession(RemoteRunspacePoolInternal rsPoolInternal)\r\n   at System.Management.Automation.Internal.ClientRunspacePoolDataStructureHandler..ctor(RemoteRunspacePoolInternal clientRunspacePool, TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.Internal.RemoteRunspacePoolInternal.CreateDSHandler(TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.Internal.RemoteRunspacePoolInternal..ctor(Int32 minRunspaces, Int32 maxRunspaces, TypeTable typeTable, PSHost host, PSPrimitiveDictionary applicationArguments, RunspaceConnectionInfo connectionInfo, String name)\r\n   at System.Management.Automation.Runspaces.RunspacePool..ctor(Int32 minRunspaces, Int32 maxRunspaces, TypeTable typeTable, PSHost host, PSPrimitiveDictionary applicationArguments, RunspaceConnectionInfo connectionInfo, String name)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host, TypeTable typeTable, PSPrimitiveDictionary applicationArguments)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host, TypeTable typeTable)\r\n   at System.Management.Automation.Runspaces.RunspaceFactory.CreateRunspacePool(Int32 minRunspaces, Int32 maxRunspaces, RunspaceConnectionInfo connectionInfo, PSHost host)\r\n   at Perseus.API.Helpers.PowerShell.PowerShellHelper.VerifyRunspacePool(RunspacePool rp, Func`1 creator, Boolean retry)\r\n   at Perseus.API.Helpers.PowerShell.PowerShellHelper.VerifyRunspacePool(RunspacePool rp, Func`1 creator, Boolean retry)\r\n   at Perseus.API.Helpers.PowerShell.PowerShellHelper.VerifyRunspacePool(RunspacePool rp, Func`1 creator, Boolean retry)\r\n   at Perseus.API.Services.RDS.RDSService.GetRunspacePool(RDSPlatformEnum platform)\r\n   at Perseus.API.Services.HostedExchange.HostedExchangeService.GetRunspacePool(ExchangeVersionEnum version)\r\n   at Perseus.API.Services.RDS.RapsManager.UpdateRaps()\r\n   at Perseus.API.Services.HostedExchange.Mailbox.MailboxDatabasesManager.UpdateServersCache()\r\n   at Perseus.API.Services.RDS.RapsManager.GetCache(Boolean forceRefresh)\r\n   at Perseus.API.Services.RDS.RapsManager.RefreshRapsRoles()\r\n   at Perseus.API.Services.HostedExchange.Mailbox.MailboxDatabasesManager.GetCache(Boolean forceRefresh)\r\n   at Perseus.API.Services.HostedExchange.Mailbox.MailboxDatabasesManager.RefreshDatabaseEval()\r\n```\r\n\r\n## Environment data\r\n\r\nSystem.Management.Automation Version 7.1.0 Preview 7\r\n.Net 5 RC-1\r\n\r\n## Workaround\r\n\r\nIf I publish the Web API to IIS without single file generation, it's work fine.",
  "closed_at": "2020-09-18T17:46:36Z",
  "comments": [
    {
      "author": "SeeminglyScience",
      "author_association": "COLLABORATOR",
      "body": "Duplicate of #13540 ",
      "created_at": "2020-09-18T12:39:24Z",
      "updated_at": "2020-09-18T12:39:24Z"
    }
  ],
  "created_at": "2020-09-18T08:35:30Z",
  "number": 13653,
  "state": "closed",
  "title": " The type initializer for 'System.Management.Automation.PSVersionInfo' threw an exception",
  "updated_at": "2020-09-18T17:46:36Z"
}