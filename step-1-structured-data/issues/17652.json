{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17652",
  "author": "jeffythedragonslayer",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nIn this document,\r\n\r\nhttps://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_command_precedence?view=powershell-7.2\r\n\r\nwe have:\r\n\r\n> As a security feature, PowerShell does not run executable (native) commands, including PowerShell scripts, unless the command is located in a path that is listed in the Path environment variable $env:path or unless you specify the path to the script file.\r\n\r\nWhen I put \".\" in my PATH environment variable, I still can't run commands without .\\\r\n\r\nWhy I can't I override this behavior?  Unix shells allow me to do this.  Is there another way?\n\n### Expected behavior\n\n```console\nPS E:\\echotest> echo.bat\r\nhi\r\nPS E:\\echotest>\n```\n\n\n### Actual behavior\n\n```console\nPS E:\\echotest> echo.bat\r\necho.bat: The term 'echo.bat' is not recognized as a name of a cmdlet, function, script file, or executable program.\r\nCheck the spelling of the name, or if a path was included, verify that the path is correct and try again.\r\n\r\nSuggestion [3,General]: The command echo.bat was not found, but does exist in the current location. PowerShell does not load commands from the current location by default. If you trust this command, instead type: \".\\echo.bat\". See \"get-help about_Command_Precedence\" for more details.\r\nPS E:\\echotest>\n```\n\n\n### Error details\n\n```console\nException             :\r\n    Type        : System.Management.Automation.CommandNotFoundException\r\n    ErrorRecord :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : The term 'echo.bat' is not recognized as a name of a cmdlet, function, script file, or executable program.\r\n                      Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\r\n            HResult : -2146233087\r\n        TargetObject          : echo.bat\r\n        CategoryInfo          : ObjectNotFound: (echo.bat:String) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : CommandNotFoundException\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : 6\r\n            Line             : echo.bat\r\n            PositionMessage  : At line:1 char:1\r\n                               + echo.bat\r\n                               + ~~~~~~~~\r\n            InvocationName   : echo.bat\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    CommandName : echo.bat\r\n    TargetSite  :\r\n        Name          : LookupCommandInfo\r\n        DeclaringType : System.Management.Automation.CommandDiscovery, System.Management.Automation, Version=7.2.5.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    Message     : The term 'echo.bat' is not recognized as a name of a cmdlet, function, script file, or executable program.\r\n                  Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\r\n    Data        : System.Collections.ListDictionaryInternal\r\n    Source      : System.Management.Automation\r\n    HResult     : -2146233087\r\n    StackTrace  :\r\n   at System.Management.Automation.CommandDiscovery.LookupCommandInfo(String commandName, CommandTypes commandTypes, SearchResolutionOptions searchResolutionOptions, CommandOrigin commandOrigin, ExecutionContext context)\r\n   at System.Management.Automation.ExecutionContext.CreateCommand(String command, Boolean dotSource)\r\n   at System.Management.Automation.PipelineOps.AddCommand(PipelineProcessor pipe, CommandParameterInternal[] commandElements, CommandBaseAst commandBaseAst, CommandRedirection[] redirections, ExecutionContext context)\r\n   at System.Management.Automation.PipelineOps.InvokePipeline(Object input, Boolean ignoreInput, CommandParameterInternal[][] pipeElements, CommandBaseAst[] pipeElementAsts, CommandRedirection[][] commandRedirections, FunctionContext funcContext)\r\n   at System.Management.Automation.Interpreter.ActionCallInstruction`6.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\nTargetObject          : echo.bat\r\nCategoryInfo          : ObjectNotFound: (echo.bat:String) [], CommandNotFoundException\r\nFullyQualifiedErrorId : CommandNotFoundException\r\nInvocationInfo        :\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 6\r\n    Line             : echo.bat\r\n    PositionMessage  : At line:1 char:1\r\n                       + echo.bat\r\n                       + ~~~~~~~~\r\n    InvocationName   : echo.bat\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2022-07-12T21:01:12Z",
  "comments": [
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "> Why I can't I override this behavior? Unix shells allow me to do this. Is there another way?\r\n\r\nIn Windows (unlike Unix) the current directory is in the PATH by design. If you add `.` to the PATH environment variable you're doing an useless job. To avoid typing `.\\` you can try to rewrite `$env:PATH` in `$funcion:prompt`, something like:\r\n\r\n```powershell\r\n# $profile\r\n\r\n$env:Path += \";$pwd\"\r\n\r\n# function Global:prompt {   ### Maybe you have to make Global function\r\n\r\nfunction prompt {\r\n...\r\n$env:Path = $env:PATH -replace ';[^;]+$', \";$pwd\"\r\n}\r\n```",
      "created_at": "2022-07-09T05:53:31Z",
      "updated_at": "2022-07-09T06:38:09Z"
    },
    {
      "author": "jhoneill",
      "author_association": "NONE",
      "body": "> > Why I can't I override this behavior? Unix shells allow me to do this. Is there another way?\r\n> \r\n> In Windows (unlike Unix) the current directory is in the PATH by design. If you add `.` to the PATH environment variable you're doing an useless job. To avoid typing `.\\` you can try to rewrite `$env:PATH` in `$funcion:prompt`, something like:\r\n> \r\n\r\n@237dmitry   Sorry, that's not correct.   In `Cmd`  the current directory is treated as being on the path as it was in command.com and CP/M. PowerShell does not, and explains that it does not. \r\n\r\n![image](https://user-images.githubusercontent.com/16209593/178100828-870385c5-fbd4-437a-a0ff-98ae2a0354a2.png)\r\n\r\nUsing prompt to do it is not very reliable; `cd <apppath>; <appName>` wouldn't work \r\n\r\n\r\nBecause I have scripts in my `WindowsPowerShell` directory which I need to run in PowerShell 7 where the profile directory is `PowerShell`\r\nI have these 4 lines in my profile - the last one handles the issue of modules sometimes not being on `PSModulepath.`  \r\n```\r\n$psDir = Join-path ([System.Environment]::GetFolderPath( [System.Environment+SpecialFolder]::MyDocuments)) \"\\windowsPowershell\"\r\nif (-not (Test-Path $psDir)) {$psdir = $PSScriptRoot}\r\nSet-Item -Path \"Env:\\PATH\" (\".;$psDir\\;\"+(Get-Content \"ENV:\\PATH\"))  #Linux is case sensitive and uses \"PATH\"; windows isnt and uses \"Path\".\r\nif ($env:PSModulePath -notmatch [regex]::Escape($psDir)) { $env:PSModulePath += \";$psDir\\Modules\" }\r\n ```\r\n\r\n\r\n@jeffythedragonslayer  - you want a version of line 3 -  I think some variation of     \r\n`Set-Item -Path \"Env:\\PATH\" (\".;\"+(Get-Content \"ENV:\\PATH\") ) `     \r\nhas been in my profile since 2007 or 2008 - and if I trust my memory just setting it in the Path environment variable before PowerShell starts doesn't work, you need to do it in the PowerShell session.  I can't recall if there is a reason I couldn't use `$env:path` and used `Set-item` and `Get-Content`\r\n \r\nThat works. \r\n<img width=\"688\" alt=\"image\" src=\"https://user-images.githubusercontent.com/16209593/178101014-e761e9f0-1502-4912-9490-d2c3a5d26a51.png\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at": "2022-07-09T10:10:13Z",
      "updated_at": "2022-07-09T10:10:13Z"
    },
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "> PowerShell does not\r\n\r\nThis is a security restriction. Is not it so?\r\n\r\n> Using prompt to do it is not very reliable; `cd <apppath>; <appName>` wouldn't work\r\n\r\nI will note that I am absolutely satisfied with how it is now.  I just suggested a solution. And, I don't have any file with the ';' symbol in its full name.",
      "created_at": "2022-07-09T11:15:59Z",
      "updated_at": "2022-07-09T11:15:59Z"
    },
    {
      "author": "jhoneill",
      "author_association": "NONE",
      "body": "> > PowerShell does not\r\n> \r\n> This is a security restriction. Is not it so?\r\n\r\nBecause a malicious script could be placed in the users directory with a name like \"notepad.ps1\" powershell broke with previous practice so that in its default state things were slightly more secure. It is also easy to add \".\" but hard to remove it.  So following \"secure by default\" is good and the inconvenience is small.  \r\n\r\n\r\n> \r\n> > Using prompt to do it is not very reliable; `cd <apppath>; <appName>` wouldn't work\r\n> \r\n> I will note that I am absolutely satisfied with how it is now. I just suggested a solution. And, I don't have any file with the ';' symbol in its full name.\r\n\r\nYou wouldn't have files with ; in their name. But you might want to do \r\n\r\n```\r\ncd 'C:\\Program Files\\Notepad++\\'  ;   'Notepad++.exe'\r\n```\r\nentering two commands as one. \r\n\r\n  \r\n\r\n\r\n\r\n",
      "created_at": "2022-07-09T13:33:39Z",
      "updated_at": "2022-07-09T19:48:56Z"
    },
    {
      "author": "237dmitry",
      "author_association": "NONE",
      "body": "> entering two commands as one.\r\n\r\nMy variant does not work ((",
      "created_at": "2022-07-09T14:47:51Z",
      "updated_at": "2022-07-09T14:47:51Z"
    },
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "This is a security feature that you could override by adding `.` to your path.  It's not something I would do.  And I would NOT RECOMMEND it but a quick test indicates it works:\r\n```powershell\r\nPS> $env:PATH += \".\"  # Don't do this!\r\nPS> '@echo \"This is a bat script\"' > echo.bat\r\nPS> echo.bat\r\n\"This is a bat script\"\r\n```\r\nThe reason PowerShell doesn't automatically run scripts in the current dir is that bad things can happen.  For example, if a bad actor places a native command in the current dir (that your credentials allow), that effectively overrides another, potentially built-in command you use without your knowledge, you invoke the bad script without even knowing it:\r\n```powershell\r\nPS> $env:PATH = \".;$env:PATH\" # Don't do this!\r\nPS> '@echo \"This is a bat script, might do something you would not like\" && certmgr.msc' > certmgr.bat\r\nPS> certmgr\r\n\"This is a bat script, might do something you would not like\"\r\n```\r\nHere you might have thought you were going to invoke the Windows `certmgr.msc` utility, but the bat file was able to interject itself, and normally you wouldn't know that it did.  BTW even with the dot at the end of the PATH, a bad actor could rely on frequently mistyped commands such as `dit`, `gti` or `gx` (instead of dir, git, gc).\r\n \r\nIMO PowerShell is working \"as designed\". \r\n \r\nDoes anybody know if there is a tag or something you can place on a fenced code block to indicate to tools like Copilot not to EVER recommend this code?\r\n ",
      "created_at": "2022-07-09T20:41:32Z",
      "updated_at": "2022-07-09T20:43:15Z"
    },
    {
      "author": "jhoneill",
      "author_association": "NONE",
      "body": "> This is a security feature that you could override by adding `.` to your path. It's not something I would do. And I would NOT RECOMMEND it \r\n\r\nIt is something I do myself, but advise people to think carefully about before doing it\r\n\r\n> a quick test indicates it works:\r\n> \r\n> ```powershell\r\n> PS> $env:PATH += \".\"  # Don't do this!\r\n> PS> '@echo \"This is a bat script\"' > echo.bat\r\n> PS> echo.bat\r\n> \"This is a bat script\"\r\n> ```\r\n\r\nNote that in this case `echo.bat` runs the script but `echo`  will run the PowerShell alias (and would run a function or cmdlet before searching the path). \r\n\r\n> \r\n> The reason PowerShell doesn't automatically run scripts in the current dir is that bad things can happen. For example, if a bad actor places a native command in the current dir (that your credentials allow), that effectively overrides another, potentially built-in command you use without your knowledge, you invoke the bad script without even knowing it:\r\n> \r\n> ```powershell\r\n> PS> $env:PATH = \".;$env:PATH\" # Don't do this!\r\n> PS> '@echo \"This is a bat script, might do something you would not like\" && certmgr.msc' > certmgr.bat\r\n> PS> certmgr\r\n> \"This is a bat script, might do something you would not like\"\r\n> ```\r\n\r\nThis is correct in all regards and is the logic behind the original design. However. \r\n1. In your first example you put \".\" last on the path, if a user does that, then the original executable is found. In this version \".\" comes first allowing the script to be found. \r\n2. The bad actor needs to drop scripts which match names of _commands which will be run_ into directories you will be in when you issue those commands. I need to know that you run `certmgr` from the prompt and not via [win]R , and that you put yourself in the a \"cert files\" directory first.  \r\n3. If the directory is being attacked is the where your profile is found. why not just append `set-alias certmgr \"~\\certmgr.bat\"` to the profile? Or add a module to the `modules` directory which defines `certmgr` that will then be loaded on demand? If anywhere on the path or PSModulePath is attackable, it's a place for malicious scripts, \".\" is a moving target. But with access to the profile an attacker can add somewhere to the path/psmodulepath.  \r\n4. If a bad actor was able to do this, in reality there were dozens of worse things they could do, and probably did do. \r\n\r\n\r\n> IMO PowerShell is working \"as designed\".\r\n\r\nIt is. The correct decision was made - i.e. where there are choices for configuration and one is even slightly more secure it  should be the default.  \r\n\r\n In reality the example I gave above:\r\n```\r\ncd \\program files\\notepad++\r\nnotepad++\r\n```\r\nisn't something I'd ever type.  I would type `\\prog[TAB]\\note[tab]\\not[tab]`   even in the current directory I'd type `note[tab]` and PowerShell would expand it to `.\\notepad++.exe`   the message \"Save typing AND improve security with tab completion\" is probably the right one to give. But if people have a way of working which they want to stick to, and understand the small risk that comes with it, PowerShell allows them to make that choice. \r\n",
      "created_at": "2022-07-10T11:46:16Z",
      "updated_at": "2022-07-10T11:46:16Z"
    },
    {
      "author": "StevenBucher98",
      "author_association": "COLLABORATOR",
      "body": "Thanks for submitting this issue! We are marking by design for some of the listed reasons above. ",
      "created_at": "2022-07-11T17:40:18Z",
      "updated_at": "2022-07-11T17:40:18Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as by-design and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2022-07-12T21:01:11Z",
      "updated_at": "2022-07-12T21:01:11Z"
    }
  ],
  "created_at": "2022-07-09T03:35:33Z",
  "number": 17652,
  "state": "closed",
  "title": "can't omit .\\ when running commands in current working directory",
  "updated_at": "2022-07-12T21:01:12Z"
}