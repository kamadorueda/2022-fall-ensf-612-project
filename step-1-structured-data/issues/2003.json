{
  "_url": "https://github.com/PowerShell/PowerShell/issues/2003",
  "author": "Jaykul",
  "body": "## Steps to reproduce\n1. Follow [Install-Win32-OpenSSH[(https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH) steps\n   2, Follow [SSH Remoting](https://github.com/PowerShell/PowerShell/tree/master/demos/SSHRemoting) walkthrough.\n\nBottom line: get SSHd running on Linux, and then try creating a session:\n\n```\nPS C:\\Users\\Joel> $session = New-PSSession -HostName ubuntu-test -UserName jaykul\n```\n## Expected behavior\n\nA new session should be created.\n## Actual behavior\n\n```\nPS C:\\Users\\Joel> $session = New-PSSession -HostName ubuntu-test -UserName jaykul\n\nNew-PSSession : [ubuntu-test] An error has occurred which Windows PowerShell cannot handle. \n    A remote session might have ended.\nAt line:1 char:12\n+ $session = New-PSSession -HostName ubuntu-test -UserName jaykul\n+            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : OpenError: (System.Manageme....RemoteRunspace:RemoteRunspace)\n    [New-PSSession], PSRemotingDataStructureException\n    + FullyQualifiedErrorId : PSSessionOpenFailed\n\n\nPS C:\\Users\\Joel> $Error[0] | fl * -force\n\nwriteErrorStream      : True\nPSMessageDetails      :\nException             : System.Management.Automation.Remoting.PSRemotingDataStructureException:\n                        An error has occurred which Windows PowerShell cannot handle. A remote\n                        session might have ended. --->\n                        System.Management.Automation.CommandNotFoundException: The term\n                        'ssh.exe' is not recognized as the name of a cmdlet, function, script\n                        file, or operable program. Check the spelling of the name, or if a path\n                        was included, verify that the path is correct and try again.\n                           at\n                        System.Management.Automation.CommandDiscovery.LookupCommandInfo(String\n                        commandName, CommandTypes commandTypes, SearchResolutionOptions\n                        searchResolutionOptions, CommandOrigin commandOrigin, ExecutionContext\n                        context)\n                           at System.Management.Automation.Runspaces.SSHConnectionInfo.StartSSHP\n                        rocess(StreamWriter& stdInWriterVar, StreamReader& stdOutReaderVar,\n                        StreamReader& stdErrReaderVar)\n                           at System.Management.Automation.Remoting.Client.SSHClientSessionTrans\n                        portManager.CreateAsync()\n                           at System.Management.Automation.Remoting.ClientRemoteSessionDSHandler\n                        Impl.SendNegotiationAsync(RemoteSessionState sessionState)\n                           at System.Management.Automation.Remoting.ClientRemoteSessionDSHandler\n                        Impl.HandleStateChanged(Object sender, RemoteSessionStateEventArgs arg)\n                           at System.Management.Automation.ExtensionMethods.SafeInvoke[T](EventH\n                        andler`1 eventHandler, Object sender, T eventArgs)\n                           at System.Management.Automation.Remoting.ClientRemoteSessionDSHandler\n                        StateMachine.RaiseStateMachineEvents()\n                           at System.Management.Automation.Remoting.ClientRemoteSessionDSHandler\n                        StateMachine.ProcessEvents()\n                           --- End of inner exception stack trace ---\nTargetObject          : System.Management.Automation.RemoteRunspace\nCategoryInfo          : OpenError: (System.Manageme....RemoteRunspace:RemoteRunspace)\n                        [New-PSSession], PSRemotingDataStructureException\nFullyQualifiedErrorId : PSSessionOpenFailed\nErrorDetails          : [ubuntu-test] An error has occurred which Windows PowerShell cannot\n                        handle. A remote session might have ended.\nInvocationInfo        : System.Management.Automation.InvocationInfo\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\nPipelineIterationInfo : {0, 1}\n```\n\nI think a step is missing from the setup instructions. Before trying to create a session, I should have added `$Env:ProgramFiles\\OpenSSH` to my path, permanently: \n\n``` posh\n[Environment]::SetEnvironmentVariable(\n    \"Path\",\n    ([Environment]::GetEnvironmentVariable(\"Path\",\"Machine\") + \n        [IO.Path]::PathSeparator + \n        (Join-Path ${Env:ProgramFiles} OpenSsh)), \n    \"Machine\")\n```\n\nAnd (or just) temporarily:\n\n``` posh\n$Env:Path += [IO.Path]::PathSeparator + (Join-Path ${Env:ProgramFiles} OpenSsh)\n```\n\n... then it works.\n### However, that error message. Whaaaaaat?\n## Environment\n\nPowerShell Core on Windows 10\n\nI'm trying to connect to ... a Linux machine\n\n```\nPS C:\\Users\\Joel> $PSVersionTable                      \n\nName                           Value                   \n----                           -----                   \nGitCommitId                    v6.0.0-alpha.9          \nWSManStackVersion              3.0                     \nPSEdition                      Core                    \nPSVersion                      6.0.0-alpha             \nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...} \nPSRemotingProtocolVersion      2.3                     \nSerializationVersion           1.1.0.1                 \nBuildVersion                   3.0.0.0                 \n```\n",
  "closed_at": "2016-09-16T18:30:11Z",
  "comments": [
    {
      "author": "joeyaiello",
      "author_association": "CONTRIBUTOR",
      "body": "Moderated the title here to be a bit more descriptive. Keep in mind the SSH over PSRP code is _extremely_ WIP, and we definitely don't expect anyone to be using it in a production scenario yet. Keeping this here because it's one of many things that need to be polished before it's \"ready\".\n",
      "created_at": "2016-08-22T06:21:50Z",
      "updated_at": "2016-08-22T06:21:50Z"
    },
    {
      "author": "bgelens",
      "author_association": "CONTRIBUTOR",
      "body": "https://github.com/PowerShell/PowerShell/pull/1833#issuecomment-240246809\n",
      "created_at": "2016-08-27T07:24:32Z",
      "updated_at": "2016-08-27T07:24:32Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "The error you received is from the PowerShell remoting transport and wraps the actual error.  You need to look at the inner exception to get the specific error.\n\n$err = $error[0]\n$err.Exception.InnerException\nThe term 'ssh.exe' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.\n\nAlso, PR 2249 added more ssh client error reporting for errors when resolving host name and user account validation.\n",
      "created_at": "2016-09-16T18:30:11Z",
      "updated_at": "2016-09-16T18:30:11Z"
    }
  ],
  "created_at": "2016-08-22T05:39:29Z",
  "number": 2003,
  "state": "closed",
  "title": "Improve error message for PSRP over SSH when ssh.exe is unavailable in your PATH",
  "updated_at": "2016-09-16T18:30:11Z"
}