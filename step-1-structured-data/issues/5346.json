{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5346",
  "author": "bergmeister",
  "body": "To fix #5194: Use the first 3 characters of the passed `-Runtime` parameter for the .inc file (the full runtime name could not be used since the separation characters ike e.g. the the hyphen would make dotnet crash when building).\r\n\r\nA separate issue is that the runtime does not get determined if is not being passed (which is OK since dotnet takes then care of choosing the right one) but maybe given this scenario would it make sense to determine and set it as a convenience?\r\n",
  "closed_at": "2017-11-15T18:52:07Z",
  "comments": [
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "This should slot in nicely with my tweak to build.psm1 #5341 ",
      "created_at": "2017-11-05T20:09:53Z",
      "updated_at": "2017-11-05T20:09:53Z"
    },
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "I think you need to update this .gitignore file to make it handle the platform specific inc files:\r\n```\r\n40:121ms> gc .\\src\\TypeCatalogGen\\.gitignore\r\npowershell.inc\r\n```\r\nI was noticing that Git thought I had a new file with powershell_win.inc.",
      "created_at": "2017-11-05T21:58:08Z",
      "updated_at": "2017-11-05T21:58:08Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks. Well spotted, I updated it to ignore now `powershell**.inc`. I find it a bit odd that there is a special `.gitignore` file in this folder and am wondering if we can move this to the top level `.gitignore` file?\r\nI see that @andschwa moved out ignoring the `.inc` file from the top level `.gitignore` file in [this](https://github.com/PowerShell/PowerShell/commit/426e70565a47671d318f85e59d927e05cbb3b722#diff-ba9d5e3298372a80a644670c3aba07bd) commit. What was the reasoning for this?",
      "created_at": "2017-11-05T22:21:25Z",
      "updated_at": "2017-11-05T22:57:47Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@bergmeister Because this ignore rule doesn't apply to anywhere else in the repository, just keeping it simple \ud83d\ude04 ",
      "created_at": "2017-11-05T22:35:21Z",
      "updated_at": "2017-11-05T22:35:21Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@andschwa My thinking is rather that if there will never be any other `.inc` files somewhere else, it would be nice to put it into the top one to have a more central place, especially since there is only one entry in it. But this is probably more of a stylistic preference with no 'right' answer depending on how big the central place can become (to me the output of `gci -Recurse .gitignore | % {cat $_}` did not seem to be too long)... But I'll leave it then as it is if that's your preference.",
      "created_at": "2017-11-05T22:53:18Z",
      "updated_at": "2017-11-05T22:53:18Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "NB: The build was red because NuGet has a global outage (see [here](https://twitter.com/nuget/status/927630886509539332))",
      "created_at": "2017-11-06T20:58:31Z",
      "updated_at": "2017-11-07T07:21:11Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I'd prefer to fix the issue more natively like #3870.\r\n\r\nAlso I'm not sure that's the only runtime addiction. Should we clean up if our files contains \"#if UNIX\"?",
      "created_at": "2017-11-07T04:37:50Z",
      "updated_at": "2017-11-07T04:37:50Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "I'll address the comments next Monday when I'm back from travelling.",
      "created_at": "2017-11-09T12:45:05Z",
      "updated_at": "2017-11-09T12:45:05Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@daxian-dbw Thanks for your useful feedback. I have addressed all issues and left comments there. But basically the 2 remaining questions are:\r\n\r\n- Should we be strict about string interpolation (i.e. use `$()`) since there are gotchas as I pointed out?\r\n- Should `Start-TypeGen` have a default value for the new `$IncFileName` parameter or should we automatically determine it in there similarly as in `Start-PSBuild`?",
      "created_at": "2017-11-13T20:54:37Z",
      "updated_at": "2017-11-13T20:54:37Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@bergmeister For the two questions, I answered them in the corresponding comment threads: https://github.com/PowerShell/PowerShell/pull/5346#discussion_r150988197 and https://github.com/PowerShell/PowerShell/pull/5346#discussion_r150988544",
      "created_at": "2017-11-14T22:59:32Z",
      "updated_at": "2017-11-14T22:59:32Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@daxian-dbw Thanks for the review. I have addressed your comments.",
      "created_at": "2017-11-14T23:45:55Z",
      "updated_at": "2017-11-14T23:45:55Z"
    }
  ],
  "created_at": "2017-11-05T18:29:22Z",
  "number": 5346,
  "state": "closed",
  "title": "Fix Start-PSBuild on WSL if repository was already built on Windows",
  "updated_at": "2017-11-15T18:52:07Z"
}