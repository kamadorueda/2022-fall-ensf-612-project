{
  "_url": "https://github.com/PowerShell/PowerShell/issues/10725",
  "author": "bergmeister",
  "body": "# PR Summary\r\n\r\nFixes #10578\r\n\r\nCheckbox not ticked by default, i.e. telemetry is still on by default (via UI and silent install)\r\n\r\n![image](https://user-images.githubusercontent.com/9250262/97085638-8320f980-1616-11eb-82bd-843b1422d6c1.png)\r\n\r\n\r\n## PR Context\r\n\r\nTo support community request in linked issue. Also a common enterprise scenario.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **[Breaking changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)**\r\n    - [x] None\r\n    - **OR**\r\n    - [ ] [Experimental feature(s) needed](https://github.com/MicrosoftDocs/PowerShell-Docs/blob/staging/reference/6/Microsoft.PowerShell.Core/About/about_Experimental_Features.md)\r\n        - [ ] Experimental feature name(s): <!-- Experimental feature name(s) here -->\r\n- **User-facing changes**\r\n    - [ ] Not Applicable\r\n    - **OR**\r\n    - [x] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [ ] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n- **Tooling**\r\n    - [x] I have considered the user experience from a tooling perspective and don't believe tooling will be impacted.\r\n    - **OR**\r\n    - [ ] I have considered the user experience from a tooling perspective and enumerated concerns in the summary. This may include:\r\n        - Impact on [PowerShell Editor Services](https://github.com/PowerShell/PowerShellEditorServices) which is used in the [PowerShell extension](https://github.com/PowerShell/vscode-powershell) for VSCode (which runs in a different PS Host).\r\n        - Impact on Completions (both in the console and in editors) - one of PowerShell's most powerful features.\r\n        - Impact on [PSScriptAnalyzer](https://github.com/PowerShell/PSScriptAnalyzer) (which provides linting & formatting in the editor extensions).\r\n        - Impact on [EditorSyntax](https://github.com/PowerShell/EditorSyntax) (which provides syntax highlighting with in VSCode, GitHub, and many other editors).",
  "closed_at": null,
  "comments": [
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "@bergmeister this looks promising :-)",
      "created_at": "2020-05-21T16:45:52Z",
      "updated_at": "2020-05-21T16:45:52Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@kilasuit Please see my 2 recent review comments. I thought the change was easy to make but it turned out to be more complex than I initially thought and wasn't always working as expected, hence why it is still in draft, but thanks for the ping as I haven't looked at it for a few months.",
      "created_at": "2020-05-21T17:19:13Z",
      "updated_at": "2020-05-21T17:19:13Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Update: I still need to fix the build failure due to the missing component registration (trivial but not on a PC atm) but apart from that I don't plan to push too many more changes.\r\nWill post results and different scenarios of manual testing. What I think should happen at the moment is that if the checkbox is ticked (or MSI switch with value 1 is passed), then the environment variable will be set to 1. On uninstall, the environment variable should be removed. At the moment  the GUID is hard coded, which means one would have to uninstall stable and preview to remove the environment variable because MSI keeps a component ref count. Maybe that's a reason why we should let WIX autogenerate a unique component guid for every installation/msi but that also mean we'd have to check/test what the behaviour is during MSI upgrade.",
      "created_at": "2020-05-22T00:09:12Z",
      "updated_at": "2020-05-22T00:10:58Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "This is the final implementation and it's ready to be merged. I've tested it and scenarios are:\r\n- On uninstall, the environment variable gets removed\r\n- If the checkbox is ticked, then the env variable gets set to 1. If it is not ticked, no action is being performed, i.e. there is no action to remove/change the env variable if it is already pre-defined\r\n- Given one installs one version (e.g. stable) and disables telemetry and then installs preview but does not disable telemetry: If one then uninstalls stable, the telemetry env variable gets removed. This was surprising at first as I thought that it would only get removed once preview got uninstalled as well due to the component GUID being hard-coded but that is probably not the case because the parent directory is different. This is good behaviour and better than I expected.\r\n\r\n![image](https://user-images.githubusercontent.com/9250262/82700770-c68dcb00-9c66-11ea-9647-206992bdaa7a.png)",
      "created_at": "2020-05-22T19:06:48Z",
      "updated_at": "2020-05-22T19:08:01Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "cc @joeyaiello  to review the language",
      "created_at": "2020-05-22T20:06:01Z",
      "updated_at": "2020-05-22T20:06:01Z"
    },
    {
      "author": "JamesWTruher",
      "author_association": "MEMBER",
      "body": "my response to the tool-tip for telemetry is that it is over long and over wrought. The whole reboot pending sentence seems unneeded. Also, it's very _engineer_ centric - we should be redirecting to documentation so those that want more information can get it. I think that we need to short 2 sentences: Processes may need to be restarted for the setting to take effect. See <doc ref> for more information.\r\n\r\nMy use of _may_ is deliberate. We needn't talk about `WM_SETTINGSCHANGE` in the tool-tip.\r\nI don't think this is ready as is.",
      "created_at": "2020-05-27T17:24:53Z",
      "updated_at": "2020-05-27T17:24:53Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Fair point @JamesWTruher about it being the message being to technical. Because not many people read the tooltip, I thought I'd be very explicit but I went a bit overboard with it but WiX/MSI at least provides line wrapping in case there is not enough horizontal space.\r\nIs the text in parenthesis at least OK?\r\nThe problem with WiX is that it cannot provide a tooltip that can be copy-paste able or have a click-able URL because otherwise I'd have linked to this: https://wixtoolset.org/documentation/manual/v3/customactions/wixsettingchange.html\r\nDo we still need the tooltip then? Happy to accept and apply any suggestion you have as-is.\n\n<blockquote><img src=\"https://wixtoolset.org/content/fblogo.png\" width=\"48\" align=\"right\"><div><img src=\"/favicon-16x16.png\" height=\"14\"> WiX Toolset</div><div><strong><a href=\"https://wixtoolset.org//documentation/manual/v3/customactions/wixsettingchange.html\">WiX toolset</a></strong></div><div>WixBroadcastSettingChange and WixBroadcastEnvironmentChange Custom Actions</div></blockquote>",
      "created_at": "2020-05-27T17:47:08Z",
      "updated_at": "2020-05-27T17:47:10Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@heaths Can you please review as well from a WiX point of view. I see in your recent PR you removed some of  the GUIDs but in this case, WiX would complain when removing the GUID or using an autogenerated one...",
      "created_at": "2020-06-01T21:15:19Z",
      "updated_at": "2020-06-01T21:15:19Z"
    },
    {
      "author": "heaths",
      "author_association": "CONTRIBUTOR",
      "body": "@bergmeister, GUIDs aren't necessary *most* times, and WiX recommends against them. I removed the GUIDs because, when the path changes (\"7\" vs. \"7-preview\"), having the same GUID ref-counts different files/registry values in different locations, thus leading to all sorts of problems.\r\n\r\nBut they are necessary when you don't have a single automatic key path, namely files, registry, and a couple others.\r\n\r\nI'll take a look.",
      "created_at": "2020-06-01T21:44:07Z",
      "updated_at": "2020-06-01T21:44:07Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "Updated the tooltip @JamesWTruher . WDYT? Happy to accept any other proposal as-is.\r\n![image](https://user-images.githubusercontent.com/9250262/83670647-68000f80-a5cb-11ea-8eb9-9686d6772886.png)",
      "created_at": "2020-06-03T17:53:08Z",
      "updated_at": "2020-06-03T17:53:08Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMainainer, Please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2020-06-11T02:00:20Z",
      "updated_at": "2020-06-11T02:00:20Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "> \r\n> \r\n> Updated the tooltip @JamesWTruher . WDYT? Happy to accept any other proposal as-is.\r\n> ![image](https://user-images.githubusercontent.com/9250262/83670647-68000f80-a5cb-11ea-8eb9-9686d6772886.png)\r\n\r\nI personally think that should point to a PowerShell Doc not the wix docs as it just confuses the end user as they are more likely to be looking for info about the telemetry, not about why the tickbox may / may not mean a reboot is required. Though that should also be covered on the same doc page too",
      "created_at": "2020-06-11T13:32:45Z",
      "updated_at": "2020-06-11T13:32:45Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "> I personally think that should point to a PowerShell Doc not the wix docs as it just confuses the end user as they are more likely to be looking for info about the telemetry, not about why the tickbox may / may not mean a reboot is required. Though that should also be covered on the same doc page too\r\n\r\nGood point, how about `Sets environment variable POWERSHELL_TELEMETRY_OPTOUT to 1`? Is there an aka.ms link to pointing to something like https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_telemetry ?\r\n\n\n<blockquote><div><strong><a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_telemetry\">about_Telemetry - PowerShell</a></strong></div></blockquote>",
      "created_at": "2020-06-11T14:07:32Z",
      "updated_at": "2020-06-11T14:07:34Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "I agree with @bergmeister  about what docs it should point to.  \r\n",
      "created_at": "2020-06-14T20:25:30Z",
      "updated_at": "2020-06-14T20:25:30Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "/azp run",
      "created_at": "2020-06-14T20:25:39Z",
      "updated_at": "2020-06-14T20:25:39Z"
    },
    {
      "author": "azure-pipelines[bot]",
      "author_association": "NONE",
      "body": "<samp>\nAzure Pipelines successfully started running 4 pipeline(s).<br>\r\n\n</samp>",
      "created_at": "2020-06-14T20:26:03Z",
      "updated_at": "2020-06-14T20:26:03Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMainainer, Please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2020-06-22T02:00:18Z",
      "updated_at": "2020-06-22T02:00:18Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "It looks like this PR needs to be rebased.",
      "created_at": "2020-06-22T16:27:47Z",
      "updated_at": "2020-06-22T16:27:47Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@TravisEz13 Pulled upstream changes cleanly in by commit https://github.com/PowerShell/PowerShell/pull/10725/commits/4a77c26a6d0604859c4bd87b522938d8c037a71c and updated the tooltip message in https://github.com/PowerShell/PowerShell/pull/10725/commits/bb56c32e227b934b7cc1fc5a83d12a49bf11cf8e\r\nCould the PS Team consider creating an aka.ms link for that telemetry docs link since one cannot copy/click on tooltips?",
      "created_at": "2020-06-22T17:47:38Z",
      "updated_at": "2020-06-22T17:47:38Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMaintainer, please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2020-06-30T02:00:25Z",
      "updated_at": "2020-06-30T02:00:25Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "Maybe in 2022 ;)",
      "created_at": "2020-10-12T19:11:42Z",
      "updated_at": "2020-10-12T19:11:42Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@TravisEz13 pulled in changes from master and build seems to be green again. What is your take? Has the team already branched off for the `7.1` release? If so, then I guess it could be merged so that it would be ready for the first 7.2 preview (assuming you are still happy with the proposed change)? I also updated the screenshot in the PR summary to be the latest version.",
      "created_at": "2020-10-24T15:27:25Z",
      "updated_at": "2020-10-25T18:40:33Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "ping @joeyaiello ",
      "created_at": "2020-10-25T16:09:38Z",
      "updated_at": "2020-10-25T16:09:38Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMaintainer, please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2020-11-02T02:00:06Z",
      "updated_at": "2020-11-02T02:00:06Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "@SteveL-MSFT @joeyaiello can we get this reviewed and merged in please as this really should have made it in for 7.1",
      "created_at": "2020-11-14T16:26:04Z",
      "updated_at": "2020-11-14T16:26:04Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "Open PRs should not be assigned to milestone, so they are not assigned to the wrong milestone after they are merged.  For backport consideration, use a `backport` label. ",
      "created_at": "2020-12-09T23:18:33Z",
      "updated_at": "2020-12-09T23:18:33Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "It would be good to get this in before 7.2.0 GA's\r\n",
      "created_at": "2021-04-16T00:23:04Z",
      "updated_at": "2021-04-16T00:23:04Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "@SteveL-MSFT any chance we look to get this in for the GA of 7.2 ",
      "created_at": "2021-08-13T02:04:38Z",
      "updated_at": "2021-08-13T02:04:38Z"
    },
    {
      "author": "adityapatwardhan",
      "author_association": "MEMBER",
      "body": "@TravisEz13 - can you have a look?\r\n@bergmeister - can you resolve the merge conflict.",
      "created_at": "2021-09-15T18:37:39Z",
      "updated_at": "2021-09-15T18:37:39Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan resolved merge conflict",
      "created_at": "2021-09-20T16:25:52Z",
      "updated_at": "2021-09-20T16:25:52Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMaintainer, please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2021-09-28T02:00:39Z",
      "updated_at": "2021-09-28T02:00:39Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "Hey, @TravisEz13 what's the latest Issue on this, need another year to review?",
      "created_at": "2022-09-30T00:01:07Z",
      "updated_at": "2022-09-30T00:01:07Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "> Maybe in 2022 ;)\r\n\r\n... and I thought back then it was funny ...\r\n",
      "created_at": "2022-10-02T00:08:41Z",
      "updated_at": "2022-10-02T00:08:41Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@TravisEz13 can you re-review this?  We can take for 7.4",
      "created_at": "2022-10-05T00:55:35Z",
      "updated_at": "2022-10-05T00:55:35Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "> @TravisEz13 can you re-review this? We can take for 7.4\r\n\r\nC'mon, Travis, its just been at least 3 years+ for that review :-)",
      "created_at": "2022-10-05T02:57:15Z",
      "updated_at": "2022-10-05T02:57:15Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMaintainer, please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2022-10-12T14:01:27Z",
      "updated_at": "2022-10-12T14:01:27Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "Never ending story ... how serious is this whole debacle? I started another issue at least 3+ years ago **about opt-out being ignored** - and this is still the case: I can post Netlimiter prompts from pwsh.exe process to whomever is interested. \r\nI was told back then that it has to be, quote: \"some other component\", despite the process trying to send \"something\" being **pwsh.exe**. How do I opt out of \"some component\", btw? \r\n\r\nIt would be cool if **someone could explain** to me what the problem is and why its taking you guys so long",
      "created_at": "2022-10-12T16:55:48Z",
      "updated_at": "2022-10-14T19:12:52Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "<img width=\"1602\" alt=\"NLClientApp_8QH3Cbggni\" src=\"https://user-images.githubusercontent.com/1571074/195405420-e1378852-4566-4fed-8340-794e7bc7f313.png\">\r\n\r\nI wonder what is being served @ 184.24.11.74 though :-) and why is pwsh.exe continually try to connect there?\r\n\r\n**UPDATE**\r\nSo... no answer to the above?",
      "created_at": "2022-10-12T17:08:26Z",
      "updated_at": "2022-10-14T19:09:18Z"
    },
    {
      "author": "inoperable",
      "author_association": "NONE",
      "body": "So how about it NOW?",
      "created_at": "2022-11-06T03:31:20Z",
      "updated_at": "2022-11-06T03:31:20Z"
    }
  ],
  "created_at": "2019-10-07T22:12:08Z",
  "number": 10725,
  "state": "open",
  "title": "MSI installer: Add checkbox and MSI property DISABLE_TELEMETRY to optionally disable telemetry.",
  "updated_at": "2022-11-06T03:31:21Z"
}