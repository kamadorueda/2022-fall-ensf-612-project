{
  "_url": "https://github.com/PowerShell/PowerShell/issues/850",
  "author": "andschwa",
  "body": "The latest xUnit packages fix the \"could not resolve coreclr path\" problem we were having. To resolve all dependencies, the cli-deps feed was replaced with the aspnet feeds.\n\nHowever, the latest xUnit packages do not allow us to set the default AssemblyLoadContext. So we have to allow PowerShell to continue with a test harness's ALC.\n\nWe do not (yet) support running the tests on OS X, so we pretend they pass for now.\n\nThis resolves #806.\n\n<!-- Reviewable:start -->\n\n---\n\nThis change is [<img src=\"https://reviewable.io/review_button.svg\" height=\"35\" align=\"absmiddle\" alt=\"Reviewable\"/>](https://reviewable.io/reviews/powershell/powershell/850)\n\n<!-- Reviewable:end -->\n",
  "closed_at": "2016-04-19T02:27:55Z",
  "comments": [
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "/cc @vors @paulcallen @daxian-dbw \n",
      "created_at": "2016-04-15T01:11:07Z",
      "updated_at": "2016-04-15T01:11:07Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "/cc @vors @daxian-dbw @SteveL-MSFT Waiting for review to merge.\n",
      "created_at": "2016-04-18T18:31:59Z",
      "updated_at": "2016-04-18T18:31:59Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "Looks fine to me, but I don't know much about ALC. I think @daxian-dbw should sign-up on that before merge.\n",
      "created_at": "2016-04-18T19:24:35Z",
      "updated_at": "2016-04-18T19:24:35Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@andschwa  core powershell assumes the PowerShellAssemblyLoadContext to be the default ALC. With this change the assumption is broken, and I don't know how we can trust core powershell running that way.\n",
      "created_at": "2016-04-18T21:14:01Z",
      "updated_at": "2016-04-18T21:14:01Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "We can log a message for debugging later if we need. But under the test harness, the PowerShell ALC cannot be the default. I don't see this breaking PowerShell itself, as it would still run with its own ALC when outside the test harness.\n",
      "created_at": "2016-04-18T21:20:39Z",
      "updated_at": "2016-04-18T21:20:39Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I think when testing core powershell, the tests should run in the same core powershell settings as when presented to the user. If they are running in a different core powershell settings, then it's hard to say if the test results are reflecting the true issues.\n",
      "created_at": "2016-04-18T23:25:35Z",
      "updated_at": "2016-04-18T23:25:35Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "That is not currently possible under the available xUnit runner. If you can find a way, please do, but AFAICT the harness sets the default ALC before running any of our code.\n",
      "created_at": "2016-04-18T23:29:08Z",
      "updated_at": "2016-04-18T23:29:08Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "> However, the latest xUnit packages do not allow us to set the default AssemblyLoadContext. So we have to allow PowerShell to continue with a test harness's ALC.\n",
      "created_at": "2016-04-18T23:48:04Z",
      "updated_at": "2016-04-18T23:48:04Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I sign off the PS-ACL changes to unblock the xUnit test run. \nBut I think this is a broader test infrastructure problem and thus opened issue #864 \n",
      "created_at": "2016-04-19T00:23:09Z",
      "updated_at": "2016-04-19T00:23:09Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "Thanks Dongbo! I agree, think the .NET team will be able to help us out here, but we need to get the runner back up first.\n",
      "created_at": "2016-04-19T00:35:48Z",
      "updated_at": "2016-04-19T00:35:48Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@vors should we disable the Reviewable check entirely or require the sign off to go through there?\n",
      "created_at": "2016-04-19T00:36:37Z",
      "updated_at": "2016-04-19T00:36:37Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "Let's disable it\n",
      "created_at": "2016-04-19T00:41:08Z",
      "updated_at": "2016-04-19T00:41:08Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "All right, it should be disabled going forward now.\n",
      "created_at": "2016-04-19T02:27:52Z",
      "updated_at": "2016-04-19T02:27:52Z"
    }
  ],
  "created_at": "2016-04-14T22:12:03Z",
  "number": 850,
  "state": "closed",
  "title": "Re-enable xUnit tests on Linux",
  "updated_at": "2016-04-19T02:27:59Z"
}