{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6542",
  "author": "iSazonov",
  "body": "## PR Summary\r\n\r\nIn #4805 we fixed some formats for `-Uformat`.\r\nHere we collect fixes of returned values for `-Uformat`.\r\n\r\n1. Fix %s value\r\nAddress the [comment](https://github.com/PowerShell/PowerShell/issues/2195#issuecomment-375897359)\r\nWe use local datetime in evaluating %s format and UTC in epoch constant so returned value contains time zone shift compared to the value returned by Unix `date` utility.\r\nIn the PR we convert  local datetime to UTC.\r\nhttps://stackoverflow.com/questions/2883576/how-do-you-convert-epoch-time-in-c\r\n\r\n2. Fix %l uformat\r\nCurrently we have 0 .. 11 format.\r\nRight format is 1..12 \r\nSee http://man7.org/linux/man-pages/man1/date.1.html\r\n\r\n3. Fix %V uformat\r\n\r\nPowerShell Committee conclusion https://github.com/PowerShell/PowerShell/pull/4508#issuecomment-325052526\r\n\r\nCurrently we use simple formula.\r\nRight algorifm is described in https://en.wikipedia.org/wiki/ISO_week_date#Relation_with_the_Gregorian_calendar\r\n\r\nOutput format is changed from 1..53 to 01..53. See http://man7.org/linux/man-pages/man1/date.1.html\r\n\r\n[Previous discussion](https://github.com/PowerShell/PowerShell/pull/4508/commits/f13a8b5d7e64ba5ea9c16c7e5408c5ca722f8bf7#r131528088).\r\n\r\n.Net haven't ISO-compatible implementation.\r\nI opened Issue in .Net Core repo https://github.com/dotnet/corefx/issues/28808 and get recomendation to use the workaround https://blogs.msdn.microsoft.com/shawnste/2006/01/24/iso-8601-week-of-year-format-in-microsoft-net/ with corrections based on comments.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-04-10T04:13:20Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "/cc chuanjiao10",
      "created_at": "2018-04-02T12:30:04Z",
      "updated_at": "2018-04-02T12:30:04Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov Would you mind updating the PR description?  Your item #1 indicates your switching to UTC from local time but it doesn't indicate what problem is being fixed? (i.e., we do we need this change?)\r\n\r\nThanks,",
      "created_at": "2018-04-02T18:14:13Z",
      "updated_at": "2018-04-02T18:14:13Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@dantraMSFT Yes, I'll update - after the first commit I discovered there is still some breaking changes (to be compatible with Unix) and I want to bring them all together for consideration by PowerShell Committee.",
      "created_at": "2018-04-03T07:26:00Z",
      "updated_at": "2018-04-03T07:26:00Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@chuanjiao10 I still don't look this cases. After the PR maybe.",
      "created_at": "2018-04-05T14:44:56Z",
      "updated_at": "2018-04-05T14:44:56Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Reopen the PR to restart CIs - last days sometimes they failed on restoring dotnet.",
      "created_at": "2018-04-05T14:59:24Z",
      "updated_at": "2018-04-05T14:59:24Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "The tests is not reliable. I'll work on this in next PR.",
      "created_at": "2018-04-09T15:38:18Z",
      "updated_at": "2018-04-09T15:38:18Z"
    }
  ],
  "created_at": "2018-04-02T12:28:35Z",
  "number": 6542,
  "state": "closed",
  "title": "Some fixes  in Get-Date -UFormat",
  "updated_at": "2018-04-10T04:13:37Z"
}