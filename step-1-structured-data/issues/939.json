{
  "_url": "https://github.com/PowerShell/PowerShell/issues/939",
  "author": "andschwa",
  "body": "This resolves #495 and #912. ~~This is a _work-in-progress_, **do not merge**.~~\n\nNext steps:\n- [x] ~~fully deprecate `powershell-native` custom host~~\n- [x] ensure FullCLR build can still work\n- [x] remove deprecated `CoreConsoleHost` project\n- [x] ~~deprecate or reimplement `consoleHostFile` feature~~\n- [x] ~~fix~~ mark failing tests as pending\n- [x] ~~deploy modules in build script rather than as content~~ ~~use `files` like in [libuv](https://github.com/aspnet/libuv-package/blob/dev/src/Libuv/project.json#L15)~~ use shim project\n- [x] ~~merge our managed ReadLine backup~~ use `System.Console.ReadLine()`\n- [x] accept --flags\n- [x] fix stdin/stdout/stderr stream writers\n- [x] fix non-interactive use of `BufferSize`\n- [x] fix Linux CI\n- [x] fix OS X CI (~31 marked as pending until further notice)\n- [x] fix Windows CI\n- [x] fix output when there is no TTY (mostly)\n\nHow it was done:\n\nThe managed `RawUserInterface` from `CoreConsoleHost` was used to replace the Windows-centric `ConsoleControl` of the `ConsoleHost`. The work done to port `PSReadLine` to Linux enabled a much easier replacement of the `ReadLine` aspects of `ConsoleHostUserInterface`. While this deprecates our previous `ReadLine` implementation; it was required to push .NET Core to implement the APIs necessary to port `PSReadLine`. The managed entrance `Start` function is replaced with a `Main` function for the `dotnet` native host to build an app.\n\n<!-- Reviewable:start -->\n\n---\n\nThis change is [<img src=\"https://reviewable.io/review_button.svg\" height=\"35\" align=\"absmiddle\" alt=\"Reviewable\"/>](https://reviewable.io/reviews/powershell/powershell/939)\n\n<!-- Reviewable:end -->\n",
  "closed_at": "2016-05-17T21:44:36Z",
  "comments": [
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "This is seriously annoying. These pass _locally_ on both Windows and Linux... but I'm having problems getting them to run correctly in AppVeyor's environment where there are no `Console` handles.\n",
      "created_at": "2016-05-11T23:51:24Z",
      "updated_at": "2016-05-11T23:51:24Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "The non-pending Linux, OS X, and Windows tests _all_ pass locally.\n",
      "created_at": "2016-05-12T21:19:27Z",
      "updated_at": "2016-05-12T21:19:27Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "I've narrowed down the OS X test failures to be caused by the lack of a TTY on the OS X test runner (which is strange, considering that the Linux runner has a TTY, and Travis already tracked and fixed a bug where OS X did not have a TTY allocated; thus I believe it to be a regression).\n",
      "created_at": "2016-05-13T17:48:45Z",
      "updated_at": "2016-05-13T17:48:45Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "For reference, previous Travis bug is travis-ci/travis-ci/issues/2872. Nonetheless, I think that `ConsoleHost` _should_ work properly without a TTY.\n",
      "created_at": "2016-05-13T17:50:47Z",
      "updated_at": "2016-05-13T17:50:47Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@lzybkr @vors @SteveL-MSFT this is ready for review please. It's pretty large.\n",
      "created_at": "2016-05-14T21:00:21Z",
      "updated_at": "2016-05-14T21:00:21Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "I started a review so far looks good to me.\n",
      "created_at": "2016-05-15T20:21:34Z",
      "updated_at": "2016-05-15T20:21:34Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "BAH for some reason RC3 packages are attempting to be downloaded.\n",
      "created_at": "2016-05-17T19:28:32Z",
      "updated_at": "2016-05-17T19:28:32Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "Fixing build failure in #986.\n",
      "created_at": "2016-05-17T19:35:50Z",
      "updated_at": "2016-05-17T19:35:50Z"
    },
    {
      "author": "lzybkr",
      "author_association": "MEMBER",
      "body": "LGTM\n",
      "created_at": "2016-05-17T21:38:49Z",
      "updated_at": "2016-05-17T21:39:41Z"
    }
  ],
  "created_at": "2016-05-03T00:17:36Z",
  "number": 939,
  "state": "closed",
  "title": "Converge the console hosts",
  "updated_at": "2016-05-17T21:44:41Z"
}