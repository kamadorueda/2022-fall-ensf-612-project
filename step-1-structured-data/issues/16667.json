{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16667",
  "author": "sql-sith",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nWhen I try to upgrade to pwsh 7.2.1 on my Windows laptops, I get a dialog that says \"installation terminated prematurely.\" This happens if I let vscode try to do the upgrade if I try to do the upgrade via winget, and if I download the MSI and attempt the upgrade manually.\r\n\r\nThe installer log has these messages. I will attach the entire log of one of the attempts using winget.\r\n\r\n```\r\nAction 21:42:49: ExecuteAction. \r\nAction start 21:42:49: ExecuteAction.\r\nMSI (s) (38:04) [21:42:58:775]: Internal MSI error. Installer terminated prematurely.\r\n\r\nInstaller stopped prematurely.\r\n[WinGet-Microsoft.PowerShell.7.2.1.0-2021-12-23-21-42-15.421.log](https://github.com/PowerShell/PowerShell/files/7772517/WinGet-Microsoft.PowerShell.7.2.1.0-2021-12-23-21-42-15.421.log)\r\n\r\nAction ended 21:43:48: ExecuteAction. Return value 3.\r\nAction 21:43:48: FatalError. \r\nAction start 21:43:48: FatalError.\r\nAction 21:43:48: FatalError. Dialog created\r\nAction ended 21:43:50: FatalError. Return value 2.\r\nAction ended 21:43:50: INSTALL. Return value 3.\r\n```\r\n\r\nI am not sure how to diagnose this further and would appreciate some guidance. Thanks!\n\n### Expected behavior\n\n```console\nUpgrade succeeds.\n```\n\n\n### Actual behavior\n\n```console\nUpgrade fails, in the manner described previously.\n```\n\n\n### Error details\n\n```console\n=== Logging started: 12/23/2021  21:42:17 ===\r\nAction 21:42:17: INSTALL. \r\nAction start 21:42:17: INSTALL.\r\nAction 21:42:17: FindRelatedProducts. Searching for related applications Found application: [1]\r\nAction start 21:42:17: FindRelatedProducts.\r\nFindRelatedProducts: \r\nAction ended 21:42:17: FindRelatedProducts. Return value 1.\r\nAction 21:42:17: PrepareDlg. \r\nAction start 21:42:17: PrepareDlg.\r\nInfo 2898.For WixUI_Font_Normal textstyle, the system created a 'Tahoma' font, in 0 character set, of 33 pixels height.\r\nInfo 2898.For WixUI_Font_Bigger textstyle, the system created a 'Tahoma' font, in 0 character set, of 48 pixels height.\r\nAction 21:42:17: PrepareDlg. Dialog created\r\nAction ended 21:42:17: PrepareDlg. Return value 1.\r\nAction 21:42:17: AppSearch. Searching for installed applications Property: [1], Signature: [2]\r\nAction start 21:42:17: AppSearch.\r\nAppSearch: \r\nAppSearch: \r\nAppSearch: \r\nAction ended 21:42:17: AppSearch. Return value 1.\r\nAction 21:42:17: LaunchConditions. Evaluating launch conditions\r\nAction start 21:42:17: LaunchConditions.\r\nAction ended 21:42:17: LaunchConditions. Return value 1.\r\nAction 21:42:17: ValidateProductID. \r\nAction start 21:42:17: ValidateProductID.\r\nAction ended 21:42:17: ValidateProductID. Return value 1.\r\nAction 21:42:17: CostInitialize. Computing space requirements\r\nAction start 21:42:17: CostInitialize.\r\nAction ended 21:42:17: CostInitialize. Return value 1.\r\nAction 21:42:17: FileCost. Computing space requirements\r\nAction start 21:42:17: FileCost.\r\nAction ended 21:42:17: FileCost. Return value 1.\r\nAction 21:42:17: CostFinalize. Computing space requirements\r\nAction start 21:42:17: CostFinalize.\r\nAction ended 21:42:19: CostFinalize. Return value 1.\r\nAction 21:42:19: MigrateFeatureStates. Migrating feature states from related applications Application: [1]\r\nAction start 21:42:19: MigrateFeatureStates.\r\nAction ended 21:42:21: MigrateFeatureStates. Return value 1.\r\nAction 21:42:21: WelcomeDlg. \r\nAction start 21:42:21: WelcomeDlg.\r\nAction 21:42:21: WelcomeDlg. Dialog created\r\nInfo 2898.For WixUI_Font_Title textstyle, the system created a 'Tahoma' font, in 0 character set, of 36 pixels height.\r\nAction 21:42:44: InstallDirDlg. Dialog created\r\nAction 21:42:45: WixUIValidatePath. \r\nAction start 21:42:45: WixUIValidatePath.\r\nAction ended 21:42:45: WixUIValidatePath. Return value 1.\r\nAction 21:42:45: ExplorerContextMenuDialog. Dialog created\r\nAction 21:42:46: MuDialog. Dialog created\r\nAction 21:42:48: VerifyReadyDlg. Dialog created\r\nAction ended 21:42:49: WelcomeDlg. Return value 1.\r\nAction 21:42:49: ProgressDlg. \r\nAction start 21:42:49: ProgressDlg.\r\nAction 21:42:49: ProgressDlg. Dialog created\r\nAction ended 21:42:49: ProgressDlg. Return value 1.\r\nAction 21:42:49: ExecuteAction. \r\nAction start 21:42:49: ExecuteAction.\r\nMSI (s) (38:04) [21:42:58:775]: Internal MSI error. Installer terminated prematurely.\r\n\r\nInstaller stopped prematurely.\r\nAction ended 21:43:48: ExecuteAction. Return value 3.\r\nAction 21:43:48: FatalError. \r\nAction start 21:43:48: FatalError.\r\nAction 21:43:48: FatalError. Dialog created\r\nAction ended 21:43:50: FatalError. Return value 2.\r\nAction ended 21:43:50: INSTALL. Return value 3.\r\nProperty(C): UpgradeCode = {31AB5147-9A97-4452-8443-D9709F0516E1}\r\nProperty(C): WINDOWS_PRODUCT_NAME = Windows 10 Pro\r\nProperty(C): ProductName = PowerShell 7-x64\r\nProperty(C): UNIVERSAL_C_RUNTIME_INSTALLED = C:\\WINDOWS\\System32\\ucrtbase.dll\r\nProperty(C): PWRSHPLUGIN_VERSION = C:\\WINDOWS\\System32\\pwrshplugin.dll\r\nProperty(C): ADD_PATH = 1\r\nProperty(C): REGISTER_MANIFEST = 1\r\nProperty(C): USE_MU = 1\r\nProperty(C): ENABLE_MU = 1\r\nProperty(C): VersionFolder = C:\\Program Files\\PowerShell\\7\\\r\nProperty(C): ApplicationProgramsFolder = C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\PowerShell\\\r\nProperty(C): dir23E9C47466D341314C603F5C7118348B = C:\\Program Files\\PowerShell\\7\\ref\\\r\nProperty(C): dirC72EEAF9434D4AD066E0F4D20D8E816C = C:\\Program Files\\PowerShell\\7\\en-US\\\r\nProperty(C): dirA620CA71E6FF4F50B6D7BB0761D17036 = C:\\Program Files\\PowerShell\\7\\preview\\\r\nProperty(C): dir47C9B30879BAE4DA41C8786181D82A02 = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Utility\\\r\nProperty(C): dirECE37E3EC3637A365744D075BD8132E9 = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Management\\\r\nProperty(C): dir308F699462177A4A4EB081FCF3943B79 = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Host\\\r\nProperty(C): dir13107C3357D29AD16DC8ABBEF9C683BE = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.WSMan.Management\\\r\nProperty(C): dirA79CCA5D413E4146FF519185BC266FCA = C:\\Program Files\\PowerShell\\7\\Modules\\CimCmdlets\\\r\nProperty(C): dir972F7D2C0F3B28314172B665FFBF282C = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Diagnostics\\\r\nProperty(C): dir814D10C6FCD49781C626235B1DB22D76 = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Security\\\r\nProperty(C): dirDD3349AACE61FF0B4AEC004BF05FF2F9 = C:\\Program Files\\PowerShell\\7\\Modules\\PSDiagnostics\\\r\nProperty(C): dir02254C0ADC034F44B87B754FAEB409FC = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\DSCResources\\\r\nProperty(C): dir467F7C8961D842AEBB4188D2F3004198 = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\DSCResources\\MSFT_PackageManagementSource\\\r\nProperty(C): dirBFCFB87C5E0E43C5BE7FD2C052C5946A = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\DSCResources\\MSFT_PackageManagement\\\r\nProperty(C): dir7412D53B0487498E8197451AA63B9953 = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\coreclr\\netstandard2.0\\\r\nProperty(C): dir0029FE7DDE1F47CF801DAD706A3A47F5 = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\\r\nProperty(C): dirD041DEE4F67848958E0D4AF104E4088C = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Archive\\\r\nProperty(C): dirE0F5BE4076F149AC80E2FD3536CD3209 = C:\\Program Files\\PowerShell\\7\\Modules\\Microsoft.PowerShell.Archive\\en-US\\\r\nProperty(C): dir863FE8E11F754A92B789BDA7F952862C = C:\\Program Files\\PowerShell\\7\\Modules\\PSReadLine\\\r\nProperty(C): dirF5EBE6CBD04149359D3582351CB4438D = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\en-US\\\r\nProperty(C): dir49159A33EB06456C9C2C971815311A6A = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\\r\nProperty(C): dirDD4171A90E3249BAAE0CBA188ACFAEA9 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\DSCResources\\MSFT_PSRepository\\\r\nProperty(C): dirB2E345CF157E4ED9BB8BE952ACA7FDA9 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\DSCResources\\MSFT_PSRepository\\en-US\\\r\nProperty(C): dir1742395372DB42ED87FA324564C49BB8 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\DSCResources\\MSFT_PSModule\\en-US\\\r\nProperty(C): dir906ECD1469A442A3850AD971ED7DE6C7 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\DSCResources\\MSFT_PSModule\\\r\nProperty(C): dir2FB3A08F38A54A418CDB46CAD7DE2832 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\Modules\\PowerShellGet.ResourceHelper\\en-US\\\r\nProperty(C): dirD20C27FB9850453FAADC804153DB8FD8 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\Modules\\PowerShellGet.ResourceHelper\\\r\nProperty(C): dirD76614DCAA9244BB8D1AD7A18F117390 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\Modules\\PowerShellGet.LocalizationHelper\\\r\nProperty(C): dir507D08FD3D324A449516FEFAFCC90874 = C:\\Program Files\\PowerShell\\7\\Modules\\ThreadJob\\\r\nProperty(C): dir20D076755BAF7EA1D1A980368C4F81A2 = C:\\Program Files\\PowerShell\\7\\assets\\\r\nProperty(C): dirC93D10F1DE914404E3248A7E28901CDC = C:\\Program Files\\PowerShell\\7\\cs\\\r\nProperty(C): dirEA0127D6607E68B508B9DB9CE315A2CE = C:\\Program Files\\PowerShell\\7\\de\\\r\nProperty(C): dir5B65D7353FBDCD17AB60A674B3FDF93B = C:\\Program Files\\PowerShell\\7\\es\\\r\nProperty(C): dir23063512FA8C884E1B4F08FDF0A44516 = C:\\Program Files\\PowerShell\\7\\fr\\\r\nProperty(C): dir42B03840AE19D1498CC524F2B6C0389D = C:\\Program Files\\PowerShell\\7\\it\\\r\nProperty(C): dir086D21BE309BE4C7081FC60E3524890F = C:\\Program Files\\PowerShell\\7\\ja\\\r\nProperty(C): dir43D6CAD5F3ED1060009918D06D84FB18 = C:\\Program Files\\PowerShell\\7\\ko\\\r\nProperty(C): dirE8201C74A7184D11233BAD63C6DB37BD = C:\\Program Files\\PowerShell\\7\\pl\\\r\nProperty(C): dir47ED939BFA870848E0764E862CD6B4D7 = C:\\Program Files\\PowerShell\\7\\pt-BR\\\r\nProperty(C): dir37B8DFAE26D5F8E9948851F7D19F9E20 = C:\\Program Files\\PowerShell\\7\\ru\\\r\nProperty(C): dirA7E9CC01273A7FED89FC8D3A368E00CC = C:\\Program Files\\PowerShell\\7\\tr\\\r\nProperty(C): dir47E993970F74AA9F393D23500827D12C = C:\\Program Files\\PowerShell\\7\\zh-Hans\\\r\nProperty(C): dirB1FFB91EED6FD71EA866548CEA3A5298 = C:\\Program Files\\PowerShell\\7\\zh-Hant\\\r\nProperty(C): dirAC38B2C7629B42DC836E01F976A10EC9 = C:\\Program Files\\PowerShell\\7\\Schemas\\PSMaml\\\r\nProperty(C): dirA36413FB3A534FDF8657D62728080E9F = C:\\Program Files\\PowerShell\\7\\_manifest\\spdx_2.2\\\r\nProperty(C): WixUIRMOption = UseRM\r\nProperty(C): WIXUI_INSTALLDIR = INSTALLFOLDER\r\nProperty(C): ALLUSERS = 1\r\nProperty(C): ARPNOMODIFY = 1\r\nProperty(C): INSTALLFOLDER = C:\\Program Files\\PowerShell\\\r\nProperty(C): ProgramFiles64Folder = C:\\Program Files\\\r\nProperty(C): TARGETDIR = C:\\\r\nProperty(C): ProgramMenuFolder = C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\\r\nProperty(C): SourceDir = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Temp\\WinGet\\Microsoft.PowerShell.7.2.1.0\\\r\nProperty(C): dir9956A485678594F33C936BA160AD06C4 = C:\\Program Files\\PowerShell\\7\\Modules\\\r\nProperty(C): dirDC3198AB09D84802BC00C697A113698B = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\Configuration\\BaseRegistration\\en-US\\\r\nProperty(C): dir46B77C0AFD5642C9A8A00107796F3AF0 = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\Configuration\\BaseRegistration\\\r\nProperty(C): dir709A20AD6F5242A1805E8C5D775F584C = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\Configuration\\\r\nProperty(C): dirAB5880051B03D55D6C333CF1F67C7F76 = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\\r\nProperty(C): dir4774426A44B041E1A377AE889D3FFB19 = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\helpers\\\r\nProperty(C): dir28499A54B1694A25BB7EFA06CAE3272E = C:\\Program Files\\PowerShell\\7\\Modules\\PSDesiredStateConfiguration\\en-US\\\r\nProperty(C): dir95255D69241447C5A82808FD961E1DD0 = C:\\Program Files\\PowerShell\\7\\Modules\\PackageManagement\\coreclr\\\r\nProperty(C): dir3D05031A285040E2A7B1C358D1A874D2 = C:\\Program Files\\PowerShell\\7\\Modules\\PSReadLine\\en-US\\\r\nProperty(C): dirAB16AE2D3D8B4288AE7576FDEC086E52 = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\DSCResources\\\r\nProperty(C): dir4CE087A20269471C9857E1035913C22C = C:\\Program Files\\PowerShell\\7\\Modules\\PowerShellGet\\Modules\\\r\nProperty(C): dir1DB5B24CC3494785974A51F28F128069 = C:\\Program Files\\PowerShell\\7\\Schemas\\\r\nProperty(C): dir81094D6B916B4BC8B1BA0E1DADB93A02 = C:\\Program Files\\PowerShell\\7\\_manifest\\\r\nProperty(C): ARPPRODUCTICON = PowerShellExe.ico\r\nProperty(C): ARPHELPLINK = https://github.com/PowerShell/PowerShell\r\nProperty(C): WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT = Open PowerShell\r\nProperty(C): WixShellExecTarget = [VersionFolder]pwsh.exe\r\nProperty(C): REINSTALLMODE = dmus\r\nProperty(C): Manufacturer = Microsoft Corporation\r\nProperty(C): ProductCode = {11E117C7-01D0-4C4E-9096-2E90843A173E}\r\nProperty(C): ProductLanguage = 1033\r\nProperty(C): ProductVersion = 7.2.1.0\r\nProperty(C): DefaultUIFont = WixUI_Font_Normal\r\nProperty(C): WixUI_Mode = InstallDir\r\nProperty(C): ErrorDialog = ErrorDlg\r\nProperty(C): SecureCustomProperties = PWRSHPLUGIN_VERSION;UNIVERSAL_C_RUNTIME_INSTALLED;WIX_DOWNGRADE_DETECTED;WIX_UPGRADE_DETECTED\r\nProperty(C): WIX_UPGRADE_DETECTED = {D91EDB21-FCD5-45AE-B983-CAFA80899437}\r\nProperty(C): MsiLogFileLocation = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Packages\\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe\\LocalState\\DiagOutputDir\\WinGet-Microsoft.PowerShell.7.2.1.0-2021-12-23-21-42-15.421.log\r\nProperty(C): PackageCode = {E0110C73-076A-4C76-BCD4-E027ED302D02}\r\nProperty(C): ProductState = -1\r\nProperty(C): PackagecodeChanging = 1\r\nProperty(C): CURRENTDIRECTORY = C:\\Users\\chris.CAHOKIA\r\nProperty(C): CLIENTUILEVEL = 0\r\nProperty(C): CLIENTPROCESSID = 3644\r\nProperty(C): VersionDatabase = 200\r\nProperty(C): MsiSystemRebootPending = 1\r\nProperty(C): VersionMsi = 5.00\r\nProperty(C): VersionNT = 603\r\nProperty(C): VersionNT64 = 603\r\nProperty(C): WindowsBuild = 9600\r\nProperty(C): ServicePackLevel = 0\r\nProperty(C): ServicePackLevelMinor = 0\r\nProperty(C): MsiNTProductType = 1\r\nProperty(C): WindowsFolder = C:\\WINDOWS\\\r\nProperty(C): WindowsVolume = C:\\\r\nProperty(C): System64Folder = C:\\WINDOWS\\system32\\\r\nProperty(C): SystemFolder = C:\\WINDOWS\\SysWOW64\\\r\nProperty(C): RemoteAdminTS = 1\r\nProperty(C): TempFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Temp\\\r\nProperty(C): ProgramFilesFolder = C:\\Program Files (x86)\\\r\nProperty(C): CommonFilesFolder = C:\\Program Files (x86)\\Common Files\\\r\nProperty(C): CommonFiles64Folder = C:\\Program Files\\Common Files\\\r\nProperty(C): AppDataFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Roaming\\\r\nProperty(C): FavoritesFolder = C:\\Users\\chris.CAHOKIA\\Favorites\\\r\nProperty(C): NetHoodFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Roaming\\Microsoft\\Windows\\Network Shortcuts\\\r\nProperty(C): PersonalFolder = C:\\Users\\chris.CAHOKIA\\Documents\\\r\nProperty(C): PrintHoodFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Roaming\\Microsoft\\Windows\\Printer Shortcuts\\\r\nProperty(C): RecentFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\\r\nProperty(C): SendToFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Roaming\\Microsoft\\Windows\\SendTo\\\r\nProperty(C): TemplateFolder = C:\\ProgramData\\Microsoft\\Windows\\Templates\\\r\nProperty(C): CommonAppDataFolder = C:\\ProgramData\\\r\nProperty(C): LocalAppDataFolder = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\\r\nProperty(C): MyPicturesFolder = C:\\Users\\chris.CAHOKIA\\Pictures\\\r\nProperty(C): AdminToolsFolder = C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools\\\r\nProperty(C): StartupFolder = C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\r\nProperty(C): StartMenuFolder = C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\\r\nProperty(C): DesktopFolder = C:\\Users\\Public\\Desktop\\\r\nProperty(C): FontsFolder = C:\\WINDOWS\\Fonts\\\r\nProperty(C): GPTSupport = 1\r\nProperty(C): OLEAdvtSupport = 1\r\nProperty(C): ShellAdvtSupport = 1\r\nProperty(C): MsiAMD64 = 6\r\nProperty(C): Msix64 = 6\r\nProperty(C): Intel = 6\r\nProperty(C): PhysicalMemory = 32620\r\nProperty(C): VirtualMemory = 13972\r\nProperty(C): LogonUser = chris\r\nProperty(C): UserSID = S-1-5-21-973405767-2978931947-3375908547-1050\r\nProperty(C): UserLanguageID = 1033\r\nProperty(C): ComputerName = CAHOKIA\r\nProperty(C): SystemLanguageID = 1033\r\nProperty(C): ScreenX = 3840\r\nProperty(C): ScreenY = 2160\r\nProperty(C): CaptionHeight = 56\r\nProperty(C): BorderTop = 1\r\nProperty(C): BorderSide = 1\r\nProperty(C): MsiTabletPC = 1\r\nProperty(C): TextHeight = 37\r\nProperty(C): TextInternalLeading = 5\r\nProperty(C): ColorBits = 32\r\nProperty(C): TTCSupport = 1\r\nProperty(C): Time = 21:43:50\r\nProperty(C): Date = 12/23/2021\r\nProperty(C): MsiNetAssemblySupport = 4.8.9014.0\r\nProperty(C): MsiWin32AssemblySupport = 6.3.22523.1000\r\nProperty(C): RedirectedDllSupport = 2\r\nProperty(C): AdminUser = 1\r\nProperty(C): Privileged = 1\r\nProperty(C): DATABASE = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Temp\\WinGet\\Microsoft.PowerShell.7.2.1.0\\PowerShell-7.2.1-win-x64.msi\r\nProperty(C): OriginalDatabase = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Temp\\WinGet\\Microsoft.PowerShell.7.2.1.0\\PowerShell-7.2.1-win-x64.msi\r\nProperty(C): SOURCEDIR = C:\\Users\\chris.CAHOKIA\\AppData\\Local\\Temp\\WinGet\\Microsoft.PowerShell.7.2.1.0\\\r\nProperty(C): VersionHandler = 5.00\r\nProperty(C): UILevel = 5\r\nProperty(C): ACTION = INSTALL\r\nProperty(C): EXECUTEACTION = INSTALL\r\nProperty(C): MIGRATE = {D91EDB21-FCD5-45AE-B983-CAFA80899437}\r\nProperty(C): ROOTDRIVE = C:\\\r\nProperty(C): CostingComplete = 1\r\nProperty(C): OutOfDiskSpace = 0\r\nProperty(C): OutOfNoRbDiskSpace = 0\r\nProperty(C): PrimaryVolumeSpaceAvailable = 0\r\nProperty(C): PrimaryVolumeSpaceRequired = 0\r\nProperty(C): PrimaryVolumeSpaceRemaining = 0\r\nProperty(C): INSTALLLEVEL = 1\r\nProperty(C): WIXUI_INSTALLDIR_VALID = 1\r\n=== Logging stopped: 12/23/2021  21:43:50 ===\r\nMSI (c) (3C:54) [21:43:50:704]: Product: PowerShell 7-x64 -- Installation failed.\r\n\r\nMSI (c) (3C:54) [21:43:50:705]: Windows Installer installed the product. Product Name: PowerShell 7-x64. Product Version: 7.2.1.0. Product Language: 1033. Manufacturer: Microsoft Corporation. Installation success or error status: 1603.\n```\n\n\n### Environment data\n\n```powershell\nThis is run as an MSI install, but $PSVersionTable for pwsh is as follows:\r\n\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0\r\nOS                             Microsoft Windows 10.0.22523\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2021-12-30T18:28:24Z",
  "comments": [
    {
      "author": "sql-sith",
      "author_association": "NONE",
      "body": "Additional information: I tried installing, and upgrading to, 7.3.0-preview using both winget and by manually running the MSI, and got the same results. I ensured that the windows installer service is working, that no process held locks on \"C:\\Program Files\\Powershell\", that System has full permissions on that folder, that the folder is not encrypted, and that there is plenty of drive space.",
      "created_at": "2021-12-24T15:46:47Z",
      "updated_at": "2021-12-24T15:46:47Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@sql-sith Can you _uninstall_ previous version and then install 7.2.1?",
      "created_at": "2021-12-24T19:08:11Z",
      "updated_at": "2021-12-24T19:08:11Z"
    },
    {
      "author": "sql-sith",
      "author_association": "NONE",
      "body": "I thought I added this note yesterday, so I apologize if I added it somewhere else. Just a little bit of extra information: I tried adding the current preview version, both by manually downloading and executing the MSI and by using winget (interactive) and got the same result. I verified that no handles were present on the target directory (C:\\Program Files\\Powershell) and that this same folder was not encrypted and had full access granted to the system account. I also verified that there is plenty of disk space available (some 100s of GB).",
      "created_at": "2021-12-25T23:15:57Z",
      "updated_at": "2021-12-25T23:15:57Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "If you can not install pwsh with both methods (msi and winget) this says your system was corrupted in some way.\r\nYou could run msiexec from command line with verbose logging parameters and learn the log in order to try recover your environment.",
      "created_at": "2021-12-27T04:41:00Z",
      "updated_at": "2021-12-27T04:41:00Z"
    },
    {
      "author": "sql-sith",
      "author_association": "NONE",
      "body": "@iSazonov I will try verbose logging (seems obvious, sorry I didn't think of it but I almost never use msiexec because things usually work so well :) ). If that doesn't let me know what's going on, I will try the uninstall/reinstall you suggested earlier.\r\n\r\nI have a question about the uninstall/reinstall: will that leave my profile intact? what about my installed modules and scripts?",
      "created_at": "2021-12-27T16:05:31Z",
      "updated_at": "2021-12-27T16:05:31Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> I have a question about the uninstall/reinstall: will that leave my profile intact? what about my installed modules and scripts?\r\n\r\nMSI will preserve your profile, scripts and module installed.",
      "created_at": "2021-12-27T17:20:37Z",
      "updated_at": "2021-12-27T17:20:37Z"
    },
    {
      "author": "sql-sith",
      "author_association": "NONE",
      "body": "Hello, @iSazonov . Thank you again for your help, and I apologize for the delay. My update is puzzling. I swear that in real life I am a sane and very technically competent person who has never even been drunk. I have a wonderful wife and four awesome adult children, and I'm even nice to dogs, but to you, I do this. My apologies. Here's what I have:\r\n\r\n1. On one of my laptops, running Windows 10 21H1 (OS Build 19043.1415) Enterprise, it all just suddenly worked. VS Code asked me again if I wanted to upgrade pwsh, and not wanting to miss out on any chance that things might somehow work, I said yes again. And this time, it worked.\r\n2. On my other laptop, running Windows 11 Version Dev (OS Build 22523.1000) Pro Insider Preview, I am still unable to install pwsh 7.2.1. However, just to make things more interesting, I can't uninstall it either. This seems like an edge case that you (MS) may not want to work on with me if I'm the only one reporting it. If that's the case, that's fine. I work in a somewhat similar position, so I get it. If we don't chase this down, are there any instructions on how to manually perform a complete uninstallation of pwsh 7.2.0? If that's possible, I'm certainly willing to go that route. I already have a \"last resort\" plan: I did an administrative installation and I can run pwsh 7.2.1 directly from the folder it created (but that workaround feels pretty \"dirty\"). Advice?\r\n\r\nThanks again for your time.",
      "created_at": "2021-12-30T02:16:56Z",
      "updated_at": "2021-12-30T02:16:56Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@sql-sith I am happy to know that pwsh update works on Windows 10 for you. As for Windows 11 Insider Preview it is better to use Windows Feedback tool to report the issue to inform Windows team.",
      "created_at": "2021-12-30T03:12:14Z",
      "updated_at": "2021-12-30T03:12:14Z"
    },
    {
      "author": "sql-sith",
      "author_association": "NONE",
      "body": "Will do, and thank you. Please DM me if there is a way to manually remove PowerShell 7.2.0 so that I don't go dumpster diving in the registry. :)",
      "created_at": "2021-12-30T18:28:24Z",
      "updated_at": "2021-12-30T18:28:24Z"
    }
  ],
  "created_at": "2021-12-24T04:01:04Z",
  "labels": [
    "Issue-Question",
    "Area-Maintainers-Build"
  ],
  "number": 16667,
  "state": "closed",
  "title": "Upgrades to 7.2.1 on Windows fails on two laptops",
  "updated_at": "2021-12-30T18:28:26Z"
}