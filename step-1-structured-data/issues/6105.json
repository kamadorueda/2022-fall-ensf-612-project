{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6105",
  "author": "bergmeister",
  "body": "## PR Summary\r\n\r\n[PR 6043](https://github.com/PowerShell/PowerShell/pull/6043) broke the installer (issue #6095). To prevent this from happening in the future, add a smoke test that installs the msi in appveyor build and make build fail if installation failed.\r\nIt uses the exit code to determine the success. The reason why it does not fail in the current state is because as I pointed out [here](https://github.com/PowerShell/PowerShell/pull/6099#issuecomment-363075516), the failing custom action is not returning its exit code.\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [x] Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] NA User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [ ] Issue filed - Issue link:\r\n- [ ] NA [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [ ] NA [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n",
  "closed_at": "2018-02-07T23:00:43Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "For completeness we need to check all packages.\r\nWe could change the sequence from \"install PS - build - test on builded version\" to \"install PS - build - install - test on builded installed version\" - ",
      "created_at": "2018-02-06T06:24:40Z",
      "updated_at": "2018-02-06T06:24:40Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "We don't currently support testing from an installed version.  You can file an issue for that.",
      "created_at": "2018-02-07T21:45:26Z",
      "updated_at": "2018-02-07T21:45:26Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "Verified feature build here:  https://ci.appveyor.com/project/bergmeister/powershell/build/v6.1.0-preview.276\r\n",
      "created_at": "2018-02-07T23:00:15Z",
      "updated_at": "2018-02-07T23:00:15Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@bergmeister thanks for your contribution! and dealing with all our questions.",
      "created_at": "2018-02-07T23:01:15Z",
      "updated_at": "2018-02-07T23:01:15Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@TravisEz13 You're welcome. A small improvement that came to my mind now is that we could wrap the exiting statement in a `if ($null -ne $env:CI)` or `if ($null -ne $env:APPVEYOR)` statement because those 2 environment variables are automatically defined in AppVeyor environments.",
      "created_at": "2018-02-07T23:08:14Z",
      "updated_at": "2018-02-07T23:08:14Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I created #6136\r\n/cc @TravisEz13 ",
      "created_at": "2018-02-08T03:23:09Z",
      "updated_at": "2018-02-08T03:23:09Z"
    }
  ],
  "created_at": "2018-02-05T22:35:43Z",
  "number": 6105,
  "state": "closed",
  "title": "Msi installer: smoke test",
  "updated_at": "2018-02-08T03:23:09Z"
}