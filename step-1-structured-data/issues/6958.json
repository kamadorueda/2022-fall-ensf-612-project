{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6958",
  "author": "SteveL-MSFT",
  "body": "## PR Summary\r\n\r\nTo support PowerShell Modules built with .Net Windows Compatibility Pack, we decided that it was best to ship the WCP assemblies with PSCore6.  This also adds many new .Net apis be default while only adding ~3.5 MB additional disk footprint (to a ~137 MB install currently).\r\n\r\nAdded ref to WCP 2.0.0 to SDK csproj.\r\n\r\nUpdated all refs of 4.5.0-RC1 to 4.5.0 final.\r\n\r\nUpdate dotnetcore2.1 to final build\r\n\r\nUpdate WebListener to aspnetcore.app 2.1.0 final\r\n(Microsoft.VisualStudio.Web.CodeGeneration.Tools is not final yet, so no change)\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-06-04T05:06:27Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Ha, it looks dotnet core 2.1 is officially out: https://www.nuget.org/packages/Microsoft.NETCore.App/2.1.0\r\nShall we update our build to use the official 2.1?",
      "created_at": "2018-05-30T17:59:45Z",
      "updated_at": "2018-05-30T18:00:10Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@SteveL-MSFT Can you push a commit with `[feature]` to ensure that the version bump didn't cause any regressions? ",
      "created_at": "2018-05-30T19:11:48Z",
      "updated_at": "2018-05-30T19:11:48Z"
    },
    {
      "author": "bergmeister",
      "author_association": "CONTRIBUTOR",
      "body": "@SteveL-MSFT I believe you also need to update the installer for .Net Core 2.1 RTM and cleanup comments, see my commit [here](https://github.com/bergmeister/PowerShell/commit/189940143cbacceb5e99ded85a388eca81173ccd)",
      "created_at": "2018-05-30T19:12:31Z",
      "updated_at": "2018-05-30T22:40:52Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "We have a issue with `System.Text.Encoding.CodePages`. Maybe not still published.",
      "created_at": "2018-05-31T06:50:39Z",
      "updated_at": "2018-05-31T06:50:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "We could use Version=\"4.5.*\" for packages.",
      "created_at": "2018-05-31T06:52:51Z",
      "updated_at": "2018-05-31T06:52:51Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": ">we decided that it was best to ship the WCP assemblies with PSCore6\r\n\r\nCan we use it directly - to access registry, perfcounters and so on?",
      "created_at": "2018-05-31T15:31:44Z",
      "updated_at": "2018-05-31T15:31:44Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov System.Text.Encoding.CodePages 4.5.0 is published: https://www.nuget.org/packages/System.Text.Encoding.CodePages/\r\n",
      "created_at": "2018-05-31T16:37:31Z",
      "updated_at": "2018-05-31T16:37:31Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "Can't tell why System.Text.Encoding.CodePages is failing to load as the signature matches the assembly.  ",
      "created_at": "2018-06-01T14:34:07Z",
      "updated_at": "2018-06-01T14:34:07Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I suspect this is a publishing error. Could you ask .Net team?",
      "created_at": "2018-06-01T15:02:00Z",
      "updated_at": "2018-06-01T15:02:00Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov that xunit test passes fine on my desktop machine, just not in AppVeyor though",
      "created_at": "2018-06-01T16:35:44Z",
      "updated_at": "2018-06-01T16:35:44Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I see the following from `Start-PSxUnit`:\r\n```powershell\r\n            $requiredDependencies = @(\r\n                $nativeLib,\r\n                \"$Content/Microsoft.Management.Infrastructure.dll\",\r\n                \"$Content/System.Text.Encoding.CodePages.dll\"\r\n            )\r\n```\r\nThe `codepages.dll` line is suspicious to me. But I haven't spent time digging further yet.",
      "created_at": "2018-06-01T17:36:27Z",
      "updated_at": "2018-06-01T17:36:27Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Errors in Appveyor tests:\r\n```\r\n[00:21:47]   Describing CmsMessage cmdlets thorough tests\r\n[00:21:48] +++++++++++++++++++?+\r\n[00:21:48] \r\n[00:21:48] New-Item : The directory specified, 'Modules', is not a subdirectory of 'C:\\'.\r\n[00:21:48] Parameter name: path\r\n[00:21:48] At C:\\projects\\powershell\\test\\powershell\\Modules\\Microsoft.PowerShell.Security\\ConstrainedLanguageRestriction.Tests.ps1:87 char:21\r\n[00:21:48] + ...          $null = New-Item -ItemType Directory $moduleDirectory -Force\r\n[00:21:48] +                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n[00:21:48] + CategoryInfo          : InvalidArgument: (C:\\Modules:String) [New-Item], ArgumentException\r\n[00:21:48] + FullyQualifiedErrorId : CreateDirectoryArgumentError,Microsoft.PowerShell.Commands.NewItemCommand\r\n```\r\n\r\n```\r\n[00:22:22]   Describing Invoke-Item basic tests\r\n[00:22:22] \r\n[00:22:22]     Context Invoke a text file on Unix\r\n[00:22:22] !!\r\n[00:22:22] Get-Process : Cannot find a process with the name \"notepad\". Verify the process name and call the cmdlet again.\r\n[00:22:22] At C:\\projects\\powershell\\test\\powershell\\Modules\\Microsoft.PowerShell.Utility\\Invoke-Item.Tests.ps1:70 char:17\r\n[00:22:22] +                 Get-Process -Name $notepadProcessName | Stop-Process  ...\r\n[00:22:22] +                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n[00:22:22] + CategoryInfo          : ObjectNotFound: (notepad:String) [Get-Process], ProcessCommandException\r\n[00:22:22] + FullyQualifiedErrorId : NoProcessFoundForGivenName,Microsoft.PowerShell.Commands.GetProcessCommand\r\n```\r\n\r\n```\r\n[00:37:57] new file {$(env.ProductSourcePath)\\Microsoft.Win32.SystemEvents.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.CodeDom.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.ComponentModel.Composition.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Configuration.ConfigurationManager.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Data.DataSetExtensions.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Data.Odbc.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Diagnostics.PerformanceCounter.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.DirectoryServices.AccountManagement.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.DirectoryServices.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.DirectoryServices.Protocols.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Drawing.Common.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.IO.Ports.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Management.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Runtime.Caching.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Security.Cryptography.ProtectedData.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.Security.Cryptography.Xml.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] new file {$(env.ProductSourcePath)\\System.ServiceModel.Syndication.dll} need to be added to {C:\\projects\\powershell\\tools\\packaging\\..\\..\\assets\\Files.wxs}\r\n[00:37:57] \r\n```",
      "created_at": "2018-06-01T18:05:45Z",
      "updated_at": "2018-06-01T18:05:45Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "Ok, figured out the problem with System.Text.Encoding.CodePages.dll.  The nupkg doesn't contain unix runtime only Windows.  Older version has both.  Created https://github.com/dotnet/corefx/issues/30059\r\n\r\nMoving back to v4.3.0 fixes that issue.  Will update files.wxs and submit new commit.  (v4.4.0 also doesn't have unix runtime)",
      "created_at": "2018-06-01T20:33:08Z",
      "updated_at": "2018-06-01T20:40:10Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "PSXunit tests passed on my machine (consistently failing previously) after I update the xunit packages. So push a change to see if that also fixes the issue in CI.",
      "created_at": "2018-06-02T00:05:45Z",
      "updated_at": "2018-06-02T00:05:45Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "AppVeyor failure is due to recent PR to migrate the install docs, the aka.ms link now returned 404.  I updated the aka.ms link so restarting AppVeyor.",
      "created_at": "2018-06-02T01:16:42Z",
      "updated_at": "2018-06-02T01:16:42Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Newtonsoft.Json latest version is 11.0.1\r\nhttps://github.com/JamesNK/Newtonsoft.Json/releases\r\n\r\nNJsonSchema latest version is 9.10.50\r\nhttps://www.nuget.org/packages/NJsonSchema/ ",
      "created_at": "2018-06-02T18:10:37Z",
      "updated_at": "2018-06-02T18:10:37Z"
    }
  ],
  "created_at": "2018-05-30T16:30:05Z",
  "number": 6958,
  "state": "closed",
  "title": "Add Windows Compat Pack 2.0.0 to PSCore6 and update package references to final versions including dotnetcore 2.1",
  "updated_at": "2018-06-05T01:15:28Z"
}