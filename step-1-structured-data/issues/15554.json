{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15554",
  "author": "daxian-dbw",
  "body": "# PR Summary\r\n\r\nFixes #15535\r\n\r\n`AppDomain.CreateAppDomain` and `AppDomain.Unload` were used for binary module analysis originally -- loading the binary module into another `AppDomain` so the analysis doesn't pollute the current app domain. However, the code path was disabled when moving to .NET Core because there has been only one `AppDomain` since the beginning in .NET Core.\r\n\r\nThat code path was for analyzing a DLL module (without a module manifest `.psd1` file), and it's really not that useful in real world scenarios because all modules should have a module manifest file, which defines what commands are exposed from the module. Therefore, nothing is really affected even though that code path was disabled since 2016.\r\n\r\nThis cleanup removed that code path that creates an `AppDomain` all together, as well as the relevant code for cleaning up the `AppDomain`.\r\n\r\nAlso, a simple `NullReferenceException` is fixed in `Parser.ParseInput`.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **[Breaking changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)**\r\n    - [x] None\r\n    - **OR**\r\n    - [ ] [Experimental feature(s) needed](https://github.com/MicrosoftDocs/PowerShell-Docs/blob/staging/reference/6/Microsoft.PowerShell.Core/About/about_Experimental_Features.md)\r\n        - [ ] Experimental feature name(s): <!-- Experimental feature name(s) here -->\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [x] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n- **Tooling**\r\n    - [x] I have considered the user experience from a tooling perspective and don't believe tooling will be impacted.",
  "closed_at": "2021-06-10T16:16:06Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "It's easier to review by ignoring the white space changes: https://github.com/PowerShell/PowerShell/pull/15554/files?w=1\n\n<blockquote><img src=\"https://avatars.githubusercontent.com/u/127450?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/PowerShell/pull/15554\">Clean up code regarding `AppDomain.CreateDomain` and `AppDomain.Unload` by daxian-dbw \u00b7 Pull Request #15554 \u00b7 PowerShell/PowerShell</a></strong></div><div>PR Summary\nAddress #15535\nAppDomain.CreateAppDomain and AppDomain.Unload were used for binary module analysis originally -- loading the binary module into another AppDomain so the analysis doesn&#3...</div></blockquote>",
      "created_at": "2021-06-10T05:26:46Z",
      "updated_at": "2021-06-10T05:26:47Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:`v7.2.0-preview.7` has been released which incorporates this pull request.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.2.0-preview.7)\n",
      "created_at": "2021-06-17T16:58:42Z",
      "updated_at": "2021-06-17T16:58:42Z"
    }
  ],
  "created_at": "2021-06-10T05:25:29Z",
  "number": 15554,
  "state": "closed",
  "title": "Clean up code regarding `AppDomain.CreateDomain` and `AppDomain.Unload`",
  "updated_at": "2021-06-17T16:58:42Z"
}