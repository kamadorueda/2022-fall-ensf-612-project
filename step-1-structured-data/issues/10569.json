{
  "_url": "https://github.com/PowerShell/PowerShell/issues/10569",
  "author": "iSazonov",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->\r\n\r\n# PR Summary\r\n\r\nComments says that the code was optimized in Windows PowerShell but there is still room for improvements that is important for scenarios actively using runspaces and startup.\r\n\r\n1. Remove check that file exist.\r\n    The code came from Windows PowerShell but now all the standard dlls is placed in $PSHome and we have no need to search them in other paths by the dll name.\r\n![image](https://user-images.githubusercontent.com/22290914/65128298-aa1ffb80-da12-11e9-901b-f7c6c1265d1e.png)\r\n\r\n2. Remove some obvious allocations\r\n- Assembly.GetName() allocates - put it in temp variable.\r\n- Move Version.ToString() out of the cycle.\r\n\r\n## PR Context\r\n\r\n<!-- Provide a little reasoning as to why this Pull Request helps and why you have opened it. -->\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **[Breaking changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)**\r\n    - [x] None\r\n    - **OR**\r\n    - [ ] [Experimental feature(s) needed](https://github.com/MicrosoftDocs/PowerShell-Docs/blob/staging/reference/6/Microsoft.PowerShell.Core/About/about_Experimental_Features.md)\r\n        - [ ] Experimental feature name(s): <!-- Experimental feature name(s) here -->\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [x] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n- **Tooling**\r\n    - [ ] I have considered the user experience from a tooling perspective and don't believe tooling will be impacted.\r\n    - **OR**\r\n    - [ ] I have considered the user experience from a tooling perspective and enumerated concerns in the summary. This may include:\r\n        - Impact on [PowerShell Editor Services](https://github.com/PowerShell/PowerShellEditorServices) which is used in the [PowerShell extension](https://github.com/PowerShell/vscode-powershell) for VSCode (which runs in a different PS Host).\r\n        - Impact on Completions (both in the console and in editors) - one of PowerShell's most powerful features.\r\n        - Impact on [PSScriptAnalyzer](https://github.com/PowerShell/PSScriptAnalyzer) (which provides linting & formatting in the editor extensions).\r\n        - Impact on [EditorSyntax](https://github.com/PowerShell/EditorSyntax) (which provides syntax highlighting with in VSCode, GitHub, and many other editors).\r\n",
  "closed_at": "2019-10-15T22:01:20Z",
  "comments": [
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Can you update your PR description to not say a 2.3% perf win?\r\nAlso, when having a screenshot of profiling result, I suggest to describe what was profiled (e.g. the command executed by PerfView->Run), so there is more context.",
      "created_at": "2019-10-10T15:48:11Z",
      "updated_at": "2019-10-10T15:48:58Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "PerfView shows follow code paths:\r\n![image](https://user-images.githubusercontent.com/22290914/66592711-09ef6980-ebaf-11e9-8b95-6e657344ea28.png)\r\n\r\nSo expected win is up to 1.8%.\r\n\r\nI tested Runspace.Open() if I remember right three weeks later :-)\r\n",
      "created_at": "2019-10-10T17:46:24Z",
      "updated_at": "2019-10-10T17:46:24Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "It's still not accurate as there may be other calls to `File.Exist` within the code paths hit by `RunspaceFactory.CreateRunspace`. I suggest to remove the `Perf Win` part in the PR description.",
      "created_at": "2019-10-10T18:30:56Z",
      "updated_at": "2019-10-10T18:30:56Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Done.",
      "created_at": "2019-10-10T18:36:15Z",
      "updated_at": "2019-10-10T18:36:15Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw Could you please merge?",
      "created_at": "2019-10-15T09:58:09Z",
      "updated_at": "2019-10-15T09:58:09Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@iSazonov Sorry I forgot this :)",
      "created_at": "2019-10-15T22:01:40Z",
      "updated_at": "2019-10-15T22:01:40Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:`v7.0.0-preview.5` has been released which incorporates this pull request.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.0.0-preview.5)\n",
      "created_at": "2019-10-23T19:07:01Z",
      "updated_at": "2019-10-23T19:07:01Z"
    }
  ],
  "created_at": "2019-09-18T07:58:59Z",
  "number": 10569,
  "state": "closed",
  "title": "Minor performance improvements for runspace initialization",
  "updated_at": "2019-10-23T19:07:02Z"
}