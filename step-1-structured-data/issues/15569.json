{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15569",
  "author": "iSazonov",
  "body": "/cc @TravisEz13\r\nI see two issues today in CI build:\r\n1.\r\n```\r\nImport-Module : Must be run from Windows PowerShell\r\nAt D:\\a\\1\\s\\tools\\ci.psm1:25 char:5\r\n+     Import-Module (Join-Path $PSScriptRoot 'WindowsCI.psm1') -Scope G \u2026\r\n```\r\n2. Fixed\r\n```\r\nWARNING: dotnet-install: Using branch name with -Channel option is no longer supported with newer releases. Use \r\n-Quality option with a channel in X.Y format instead, such as \"-Channel 5.0 -Quality Daily.\"\r\n```\r\n\r\nSource https://dev.azure.com/powershell/PowerShell/_build/results?buildId=79256&view=logs&j=69ceb723-764d-5bc2-ea34-985f6795a822&t=77efb26f-5f9c-5dce-57de-0fa87c932ed4\r\n```\r\nStarting: Bootstrap\r\n==============================================================================\r\nTask         : PowerShell\r\nDescription  : Run a PowerShell script on Linux, macOS, or Windows\r\nVersion      : 2.186.0\r\nAuthor       : Microsoft Corporation\r\nHelp         : https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/powershell\r\n==============================================================================\r\nGenerating script.\r\n========================== Starting Command Output ===========================\r\n\"C:\\Program Files\\PowerShell\\7\\pwsh.exe\" -NoLogo -NoProfile -NonInteractive -ExecutionPolicy Unrestricted -Command \". 'D:\\a\\_temp\\dae6ca2b-b960-4fe4-9cd8-4a62d1612429.ps1'\"\r\nImport-Module : Must be run from Windows PowerShell\r\nAt D:\\a\\1\\s\\tools\\ci.psm1:25 char:5\r\n+     Import-Module (Join-Path $PSScriptRoot 'WindowsCI.psm1') -Scope G \u2026\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n+ CategoryInfo          : OperationStopped: (Must be run from Windows PowerShell:String) [Import-Module], RuntimeException\r\n+ FullyQualifiedErrorId : Must be run from Windows PowerShell,Microsoft.PowerShell.Commands.ImportModuleCommand\r\nInstalling PowerShell build dependencies\r\nWARNING: The 'dotnet' in the current path can't find SDK version 6.0.100-preview.4.21255.9, prepending C:\\Users\\VssAdministrator\\AppData\\Local\\Microsoft\\dotnet to PATH.\r\nCould not execute because the application was not found or a compatible .NET SDK is not installed.\r\nPossible reasons for this include:\r\n  * You intended to execute a .NET program:\r\n      The application '--version' does not exist.\r\n  * You intended to execute a .NET SDK command:\r\n      A compatible installed .NET SDK for global.json version [6.0.100-preview.4.21255.9] from [D:\\a\\1\\s\\global.json] was not found.\r\n      Install the [6.0.100-preview.4.21255.9] .NET SDK or update [D:\\a\\1\\s\\global.json] with an installed .NET SDK:\r\ndotnet out of date (        1.1.14 [C:\\Program Files\\dotnet\\sdk]         2.1.300 [C:\\Program Files\\dotnet\\sdk]         2.1.301 [C:\\Program Files\\dotnet\\sdk]         2.1.302 [C:\\Program Files\\dotnet\\sdk]         2.1.401 [C:\\Program Files\\dotnet\\sdk]         2.1.402 [C:\\Program Files\\dotnet\\sdk]         2.1.403 [C:\\Program Files\\dotnet\\sdk]         2.1.500 [C:\\Program Files\\dotnet\\sdk]         2.1.502 [C:\\Program Files\\dotnet\\sdk]         2.1.503 [C:\\Program Files\\dotnet\\sdk]         2.1.504 [C:\\Program Files\\dotnet\\sdk]         2.1.505 [C:\\Program Files\\dotnet\\sdk]         2.1.506 [C:\\Program Files\\dotnet\\sdk]         2.1.507 [C:\\Program Files\\dotnet\\sdk]         2.1.508 [C:\\Program Files\\dotnet\\sdk]         2.1.509 [C:\\Program Files\\dotnet\\sdk]         2.1.510 [C:\\Program Files\\dotnet\\sdk]         2.1.511 [C:\\Program Files\\dotnet\\sdk]         2.1.512 [C:\\Program Files\\dotnet\\sdk]         2.1.513 [C:\\Program Files\\dotnet\\sdk]         2.1.514 [C:\\Program Files\\dotnet\\sdk]         2.1.515 [C:\\Program Files\\dotnet\\sdk]         2.1.516 [C:\\Program Files\\dotnet\\sdk]         2.1.517 [C:\\Program Files\\dotnet\\sdk]         2.1.518 [C:\\Program Files\\dotnet\\sdk]         2.1.519 [C:\\Program Files\\dotnet\\sdk]         2.1.520 [C:\\Program Files\\dotnet\\sdk]         2.1.521 [C:\\Program Files\\dotnet\\sdk]         2.1.522 [C:\\Program Files\\dotnet\\sdk]         2.1.523 [C:\\Program Files\\dotnet\\sdk]         2.1.524 [C:\\Program Files\\dotnet\\sdk]         2.1.602 [C:\\Program Files\\dotnet\\sdk]         2.1.603 [C:\\Program Files\\dotnet\\sdk]         2.1.604 [C:\\Program Files\\dotnet\\sdk]         2.1.605 [C:\\Program Files\\dotnet\\sdk]         2.1.606 [C:\\Program Files\\dotnet\\sdk]         2.1.607 [C:\\Program Files\\dotnet\\sdk]         2.1.608 [C:\\Program Files\\dotnet\\sdk]         2.1.609 [C:\\Program Files\\dotnet\\sdk]         2.1.610 [C:\\Program Files\\dotnet\\sdk]         2.1.611 [C:\\Program Files\\dotnet\\sdk]         2.1.612 [C:\\Program Files\\dotnet\\sdk]         2.1.613 [C:\\Program Files\\dotnet\\sdk]         2.1.614 [C:\\Program Files\\dotnet\\sdk]         2.1.615 [C:\\Program Files\\dotnet\\sdk]         2.1.616 [C:\\Program Files\\dotnet\\sdk]         2.1.617 [C:\\Program Files\\dotnet\\sdk]         2.1.700 [C:\\Program Files\\dotnet\\sdk]         2.1.701 [C:\\Program Files\\dotnet\\sdk]         2.1.801 [C:\\Program Files\\dotnet\\sdk]         2.1.802 [C:\\Program Files\\dotnet\\sdk]         2.1.803 [C:\\Program Files\\dotnet\\sdk]         2.1.804 [C:\\Program Files\\dotnet\\sdk]         2.1.805 [C:\\Program Files\\dotnet\\sdk]         2.1.806 [C:\\Program Files\\dotnet\\sdk]         2.1.807 [C:\\Program Files\\dotnet\\sdk]         2.1.808 [C:\\Program Files\\dotnet\\sdk]         2.1.809 [C:\\Program Files\\dotnet\\sdk]         2.1.810 [C:\\Program Files\\dotnet\\sdk]         2.1.811 [C:\\Program Files\\dotnet\\sdk]         2.1.812 [C:\\Program Files\\dotnet\\sdk]         2.1.813 [C:\\Program Files\\dotnet\\sdk]         2.1.814 [C:\\Program Files\\dotnet\\sdk]         2.1.815 [C:\\Program Files\\dotnet\\sdk]         2.1.816 [C:\\Program Files\\dotnet\\sdk]         3.1.100 [C:\\Program Files\\dotnet\\sdk]         3.1.101 [C:\\Program Files\\dotnet\\sdk]         3.1.102 [C:\\Program Files\\dotnet\\sdk]         3.1.103 [C:\\Program Files\\dotnet\\sdk]         3.1.104 [C:\\Program Files\\dotnet\\sdk]         3.1.105 [C:\\Program Files\\dotnet\\sdk]         3.1.106 [C:\\Program Files\\dotnet\\sdk]         3.1.107 [C:\\Program Files\\dotnet\\sdk]         3.1.108 [C:\\Program Files\\dotnet\\sdk]         3.1.109 [C:\\Program Files\\dotnet\\sdk]         3.1.110 [C:\\Program Files\\dotnet\\sdk]         3.1.111 [C:\\Program Files\\dotnet\\sdk]         3.1.112 [C:\\Program Files\\dotnet\\sdk]         3.1.113 [C:\\Program Files\\dotnet\\sdk]         3.1.114 [C:\\Program Files\\dotnet\\sdk]         3.1.115 [C:\\Program Files\\dotnet\\sdk]         3.1.116 [C:\\Program Files\\dotnet\\sdk]         3.1.200 [C:\\Program Files\\dotnet\\sdk]         3.1.201 [C:\\Program Files\\dotnet\\sdk]         3.1.202 [C:\\Program Files\\dotnet\\sdk]         3.1.300 [C:\\Program Files\\dotnet\\sdk]         3.1.301 [C:\\Program Files\\dotnet\\sdk]         3.1.302 [C:\\Program Files\\dotnet\\sdk]         3.1.401 [C:\\Program Files\\dotnet\\sdk]         3.1.402 [C:\\Program Files\\dotnet\\sdk]         3.1.403 [C:\\Program Files\\dotnet\\sdk]         3.1.404 [C:\\Program Files\\dotnet\\sdk]         3.1.405 [C:\\Program Files\\dotnet\\sdk]         3.1.406 [C:\\Program Files\\dotnet\\sdk]         3.1.407 [C:\\Program Files\\dotnet\\sdk]         3.1.408 [C:\\Program Files\\dotnet\\sdk]         3.1.409 [C:\\Program Files\\dotnet\\sdk]         3.1.410 [C:\\Program Files\\dotnet\\sdk]         5.0.100 [C:\\Program Files\\dotnet\\sdk]         5.0.101 [C:\\Program Files\\dotnet\\sdk]         5.0.102 [C:\\Program Files\\dotnet\\sdk]         5.0.103 [C:\\Program Files\\dotnet\\sdk]         5.0.104 [C:\\Program Files\\dotnet\\sdk]         5.0.200 [C:\\Program Files\\dotnet\\sdk]         5.0.201 [C:\\Program Files\\dotnet\\sdk]         5.0.202 [C:\\Program Files\\dotnet\\sdk]         5.0.203 [C:\\Program Files\\dotnet\\sdk]         5.0.204 [C:\\Program Files\\dotnet\\sdk]         5.0.300 [C:\\Program Files\\dotnet\\sdk]         5.0.301 [C:\\Program Files\\dotnet\\sdk]).  Updating dotnet.\r\ndotnet-install: Note that the intended use of this script is for Continuous Integration (CI) scenarios, where:\r\ndotnet-install: - The SDK needs to be installed without user interaction and without admin rights.\r\ndotnet-install: - The SDK installation doesn't need to persist across multiple CI runs.\r\ndotnet-install: To set up a development environment or to run apps, use installers rather than this script. Visit https://dotnet.microsoft.com/download to get the installer.\r\n\r\nWARNING: dotnet-install: Using branch name with -Channel option is no longer supported with newer releases. Use \r\n-Quality option with a channel in X.Y format instead, such as \"-Channel 5.0 -Quality Daily.\"\r\ndotnet-install: Downloading primary link https://dotnetcli.azureedge.net/dotnet/Sdk/6.0.100-preview.4.21255.9/dotnet-sdk-6.0.100-preview.4.21255.9-win-x64.zip\r\ndotnet-install: Extracting zip from https://dotnetcli.azureedge.net/dotnet/Sdk/6.0.100-preview.4.21255.9/dotnet-sdk-6.0.100-preview.4.21255.9-win-x64.zip\r\ndotnet-install: Adding to current process PATH: \"C:\\Users\\VssAdministrator\\AppData\\Local\\Microsoft\\dotnet\\\". Note: This change will not be visible if PowerShell was run as a child process.\r\ndotnet-install: Note that the script does not resolve dependencies during installation.\r\ndotnet-install: To check the list of dependencies, go to https://docs.microsoft.com/dotnet/core/install/windows#dependencies\r\ndotnet-install: Installation finished\r\nFinishing: Bootstrap\r\n\r\n```",
  "closed_at": "2022-04-16T19:03:02Z",
  "comments": [
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "Somewhat related is this [issue](https://github.com/Azure/powershell/issues/39) I submitted to the Azure DevOps repo that provides the `powershell` / `pwsh` steps.  The steps as implemented are not really good for CI/CD.  There are several embarrassing cases where they give false positives - indicate `PASS` when the step has obviously failed if you look at the log output.  This is a bad look for PowerShell.  FWIW the Jenkins `durable-task-plugin` had a very similar issue.  I got a PR merged to address the issue the same way I suggest addressing it in the Azure DevOps issue.  \r\n\r\nThis change would likely have caused the script to bomb out and FAIL the step after the Import-Module failure.   Wrapping the script in a `try/catch` does change the script's behavior but in general it makes the script fail more which you can deal with in your script IF you don't want a non-terminating error to stop your script.",
      "created_at": "2021-06-12T20:16:09Z",
      "updated_at": "2021-06-12T20:16:09Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Second was fixed.\r\n\r\nThe first comes from \r\nhttps://github.com/PowerShell/PowerShell/blob/0f2f23f67a2c3ec53cf82c8d1a67b479f62934e4/tools/ci.psm1#L22-L26\r\nhttps://github.com/PowerShell/PowerShell/blob/0f2f23f67a2c3ec53cf82c8d1a67b479f62934e4/tools/WindowsCI.psm1#L4-L7\r\n\r\nIs it intentional? /cc @adityapatwardhan @TravisEz13 ",
      "created_at": "2021-07-29T06:28:06Z",
      "updated_at": "2021-07-29T06:28:06Z"
    }
  ],
  "created_at": "2021-06-12T19:06:50Z",
  "number": 15569,
  "state": "closed",
  "title": "Two warmings in CI build process",
  "updated_at": "2022-04-16T19:03:05Z"
}