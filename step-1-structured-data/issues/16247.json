{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16247",
  "author": "officialh1",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nThis is a PS 5.1 vs PS 7.1.4 behavior\r\n\r\nI am trying to get information from the Web.  When you submit the form data to the site, it sends to you a site that returns many different 30x codes including 308, 302 and 301.  In PS 5.1 I had to work around this by erroring silently and manually picking up the next URL and continue this until I get to the final page.  The same code will not work in PS 7.1.4.  PS 7.1.4 Errors and never sets the response object information with:\r\nInvoke-RestMethod: Object moved\r\nObject moved to here.\r\n\r\nI did adjust for the differences between the two concerning -MaximumRedirection values (I tried with both zero and non-zero in PS 7.1.4, 0 only works in PS 5.1)\r\n\r\nMaybe my problem is with -MaximumRedirection, not sure.  It would be nice if -MaximumRedirection actually worked and followed to the final site, but that didnt work in PS 5.1 either.\n\n### Expected behavior\n\n```console\n$URL = \"https://www.house.mi.gov/MHRPublic/frmFindARep.aspx\"\r\n$NewForm = @{\r\n\t__VIEWSTATE = \"/wEPDwUKMTg0NjQzMjc3MmRkBuNUB5KimRXurClxgRghZ2iO1Go+8M7cuUyliKPvmLw=\"\r\n\t__VIEWSTATEGENERATOR = \"198DD409\"\r\n\t__SCROLLPOSITIONX = 0\r\n\t__SCROLLPOSITIONY = 360.5\r\n\t__EVENTTARGET = \"\"\r\n\t__EVENTARGUMENT = \"\"\r\n\t__EVENTVALIDATION = \"/wEdAAcfDlizqjSQxG3MopasYgsWq+/5lC5Dfq9OI8O6z0tv6ZqPnR1JXGHWscSP1P0vWV0rmtCHLRrNXCrKIKqPA4/Y5rWBbqmpI2g3SVFNwbNmiJmBxNgbZoDGCpe4awpYx8p13HaNCmKPXwtSIMJvlpwqEw7fcrrJNQQPsugholuaz+Tm3c8Xf5WRgoGXZLzvHpA=\"\r\n\ttxtDistrictNumber  = 74\r\n\tbtnFindARep = \"Find A Representative\"\r\n}\r\n\r\n$FollowURL = $URL\r\n\r\n$RedirectResponse = Invoke-WebRequest -Uri $FollowURL -Method POST -Body $NewForm -ErrorAction SilentlyContinue -MaximumRedirection 0\r\n\r\n$RedirectResponse.Headers.Location to have a value to be able to process the next jump\n```\n\n\n### Actual behavior\n\n```console\n$URL = \"https://www.house.mi.gov/MHRPublic/frmFindARep.aspx\"\r\n$NewForm = @{\r\n\t__VIEWSTATE = \"/wEPDwUKMTg0NjQzMjc3MmRkBuNUB5KimRXurClxgRghZ2iO1Go+8M7cuUyliKPvmLw=\"\r\n\t__VIEWSTATEGENERATOR = \"198DD409\"\r\n\t__SCROLLPOSITIONX = 0\r\n\t__SCROLLPOSITIONY = 360.5\r\n\t__EVENTTARGET = \"\"\r\n\t__EVENTARGUMENT = \"\"\r\n\t__EVENTVALIDATION = \"/wEdAAcfDlizqjSQxG3MopasYgsWq+/5lC5Dfq9OI8O6z0tv6ZqPnR1JXGHWscSP1P0vWV0rmtCHLRrNXCrKIKqPA4/Y5rWBbqmpI2g3SVFNwbNmiJmBxNgbZoDGCpe4awpYx8p13HaNCmKPXwtSIMJvlpwqEw7fcrrJNQQPsugholuaz+Tm3c8Xf5WRgoGXZLzvHpA=\"\r\n\ttxtDistrictNumber  = 74\r\n\tbtnFindARep = \"Find A Representative\"\r\n}\r\n\r\n$FollowURL = $URL\r\n\r\n$RedirectResponse = Invoke-WebRequest -Uri $FollowURL -Method POST -Body $NewForm -ErrorAction SilentlyContinue -MaximumRedirection 100\r\n\r\nInvoke-WebRequest: Object moved\r\nObject moved to here.\n```\n\n\n### Error details\n\n```console\nException             :\r\n    Type       : Microsoft.PowerShell.Commands.HttpResponseException\r\n    Response   : StatusCode: 302, ReasonPhrase: 'Found', Version: 1.1, Content: System.Net.Http.HttpConnectionResponseContent, Headers:\r\n                 {\r\n                 Cache-Control: private\r\n                 Location: http://gophouse.org/representatives/westmi/huizenga/\r\n                 Server: Microsoft-IIS/10.0\r\n                 Set-Cookie: ASP.NET_SessionId=l4jrqorprompojbv1a0v5v4j; path=/; HttpOnly; SameSite=Lax\r\n                 X-AspNet-Version: 4.0.30319\r\n                 X-Powered-By: ASP.NET\r\n                 Date: Thu, 14 Oct 2021 20:37:04 GMT\r\n                 Content-Type: text/html; charset=utf-8\r\n                 Content-Length: 169\r\n                 }\r\n    TargetSite :\r\n        Name          : ThrowTerminatingError\r\n        DeclaringType : System.Management.Automation.MshCommandRuntime, System.Management.Automation, Version=7.1.4.0, Culture=neutral,\r\nPublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace :\r\n   at System.Management.Automation.MshCommandRuntime.ThrowTerminatingError(ErrorRecord errorRecord)\r\n    Message    : Response status code does not indicate success: 302 (Found).\r\n    Source     : System.Management.Automation\r\n    HResult    : -2146233088\r\nTargetObject          : Method: POST, RequestUri: 'https://www.house.mi.gov/MHRPublic/frmFindARep.aspx', Version: 1.1, Content:\r\nSystem.Net.Http.ByteArrayContent, Headers:\r\n                        {\r\n                        User-Agent: Mozilla/5.0\r\n                        User-Agent: (Windows NT 10.0; Microsoft Windows 10.0.19043; en-US)\r\n                        User-Agent: PowerShell/7.1.4\r\n                        Content-Length: 478\r\n                        Content-Type: application/x-www-form-urlencoded\r\n                        }\r\nCategoryInfo          : InvalidOperation: (Method: POST, Reque\u2026-form-urlencoded\r\n                        }:HttpRequestMessage) [Invoke-WebRequest], HttpResponseException\r\nFullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand\r\nErrorDetails          : Object moved\r\n                        Object moved to here.\r\n\r\n\r\nInvocationInfo        :\r\n    MyCommand        : Invoke-WebRequest\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 21\r\n    HistoryId        : 28\r\n    Line             : $RedirectResponse = Invoke-WebRequest -Uri $FollowURL -Method POST -Body $NewForm -ErrorAction SilentlyContinue\r\n-MaximumRedirection 0\r\n    PositionMessage  : At line:1 char:21\r\n                       + \u2026 tResponse = Invoke-WebRequest -Uri $FollowURL -Method POST -Body $New \u2026\r\n                       +               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : Invoke-WebRequest\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.4\r\nPSEdition                      Core\r\nGitCommitId                    7.1.4\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Please check with latest PowerShell 7.2 Preview version.",
      "created_at": "2021-10-15T12:06:41Z",
      "updated_at": "2021-10-15T12:06:41Z"
    },
    {
      "author": "officialh1",
      "author_association": "NONE",
      "body": "> Please check with latest PowerShell 7.2 Preview version.\r\n\r\nI have tried this on 7.1.5 just released and 7.2 Preview 10.  Same behavior.  Same with Invoke-RestMethod too.",
      "created_at": "2021-10-16T20:46:32Z",
      "updated_at": "2021-10-16T20:46:32Z"
    },
    {
      "author": "officialh1",
      "author_association": "NONE",
      "body": "Invoke-RestMethod does the same, this is in 7.2 preview:\r\n\r\nPS > get-error\r\n\r\nException             :\r\n    Type       : Microsoft.PowerShell.Commands.HttpResponseException\r\n    Response   : StatusCode: 302, ReasonPhrase: 'Found', Version: 1.1, Content:\r\nSystem.Net.Http.HttpConnectionResponseContent, Headers:\r\n                 {\r\n                 Cache-Control: private\r\n                 Location: http://gophouse.org/representatives/westmi/huizenga/\r\n                 Server: Microsoft-IIS/10.0\r\n                 Set-Cookie: ASP.NET_SessionId=hrqkjj3lw1xt1011u2k4j40l; path=/; HttpOnly; SameSite=Lax\r\n                 X-AspNet-Version: 4.0.30319\r\n                 X-Powered-By: ASP.NET\r\n                 Date: Sat, 16 Oct 2021 20:46:19 GMT\r\n                 Content-Type: text/html; charset=utf-8\r\n                 Content-Length: 169\r\n                 }\r\n    TargetSite :\r\n        Name          : ThrowTerminatingError\r\n        DeclaringType : System.Management.Automation.MshCommandRuntime, System.Management.Automation,\r\nVersion=7.2.0.10, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    Message    : Response status code does not indicate success: 302 (Found).\r\n    Source     : System.Management.Automation\r\n    HResult    : -2146233088\r\n    StackTrace :\r\n   at System.Management.Automation.MshCommandRuntime.ThrowTerminatingError(ErrorRecord errorRecord)\r\nTargetObject          : Method: GET, RequestUri: 'https://www.house.mi.gov/MHRPublic/frmFindARep.aspx?__SCROLLPOSITIONY\r\n=360.5&txtDistrictNumber=74&__EVENTVALIDATION=%2FwEdAAcfDlizqjSQxG3MopasYgsWq%2B%2F5lC5Dfq9OI8O6z0tv6ZqPnR1JXGHWscSP1P0\r\nvWV0rmtCHLRrNXCrKIKqPA4%2FY5rWBbqmpI2g3SVFNwbNmiJmBxNgbZoDGCpe4awpYx8p13HaNCmKPXwtSIMJvlpwqEw7fcrrJNQQPsugholuaz%2BTm3c\r\n8Xf5WRgoGXZLzvHpA%3D&__SCROLLPOSITIONX=0&btnFindARep=Find+A+Representative&__EVENTTARGET=&__VIEWSTATE=%2FwEPDwUKMTg0NjQ\r\nzMjc3MmRkBuNUB5KimRXurClxgRghZ2iO1Go%2B8M7cuUyliKPvmLw%3D&__VIEWSTATEGENERATOR=198DD409&__EVENTARGUMENT=', Version:\r\n1.1, Content: System.Net.Http.StringContent, Headers:\r\n                        {\r\n                        User-Agent: Mozilla/5.0\r\n                        User-Agent: (Windows NT 10.0; Microsoft Windows 10.0.19043; en-US)\r\n                        User-Agent: PowerShell/7.2.0\r\n                        Content-Length: 0\r\n                        }\r\nCategoryInfo          : InvalidOperation: (Method: GET, Reques\u2026ontent-Length: 0\r\n                        }:HttpRequestMessage) [Invoke-RestMethod], HttpResponseException\r\nFullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\r\nErrorDetails          : Object moved\r\n                        Object moved to here.\r\n\r\n\r\nInvocationInfo        :\r\n    MyCommand        : Invoke-RestMethod\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 21\r\n    HistoryId        : 6\r\n    Line             : $RedirectResponse = Invoke-RestMethod -Uri $FollowURL -Body $NewForm -ErrorAction\r\nSilentlyContinue -MaximumRedirection 0\r\n    PositionMessage  : At line:1 char:21\r\n                       + \u2026 tResponse = Invoke-RestMethod -Uri $FollowURL -Body $NewForm -ErrorAc \u2026\r\n                       +               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : Invoke-RestMethod\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n\r\n<blockquote><img src=\"https://dtj5wlj7ond0z.cloudfront.net/uploads/2020/07/HS_HUIZENGA_0119.jpg\" width=\"48\" align=\"right\"><div>https://gophouse.org</div><div><strong><a href=\"https://gophouse.org/member/repmarkhuizenga/posts\">Mark Huizenga Posts | Michigan House Republicans</a></strong></div><div>Mark Huizenga Posts</div></blockquote>\r\n<blockquote><div><strong><a href=\"https://www.house.mi.gov/MHRPublic/frmFindARep.aspx?__SCROLLPOSITIONY\">Michigan House of Representatives</a></strong></div></blockquote>",
      "created_at": "2021-10-16T20:48:01Z",
      "updated_at": "2021-10-16T20:48:26Z"
    }
  ],
  "created_at": "2021-10-14T20:47:42Z",
  "number": 16247,
  "state": "open",
  "title": "Invoke-WebRequest/Invoke-RestMethod doesn't error silently and doesn't return object",
  "updated_at": "2021-10-18T03:48:06Z"
}