{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17656",
  "author": "tolgabalci",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [x] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Steps to reproduce\r\n\r\nIssue is `-Force` does not seem to understand junctions. It thinks they are directories and fails to remove them because they are not empty.\r\n\r\nWorks fine with file types. (see screenshot)\r\n\r\nMost types including registry entries allow `-Force` to overwrite the item. Logically `-Force` should do the same for a Junction.\r\n\r\nDue to `-Force` not working you must first `Remove-Item` prior to `New-Item`, which works perfectly fine.  `Remove-Item` simply removes the junction and does not complain that it is not empty.  `New-Item -Force` needs the same intelligence.\r\n\r\n\r\n### Expected behavior\r\n\r\n```console\r\nPS> New-Item MyWindows -Type Junction -Value C:\\Windows\\\r\nPS> New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\r\nPS>\r\n```\r\n\r\n\r\n### Actual behavior\r\n\r\n```console\r\nPS> New-Item MyWindows -Type Junction -Value C:\\Windows\\\r\nPS> New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\r\nNew-Item: Directory C:\\Temp\\MyWindows cannot be removed because it is not empty.\r\nPS>\r\n```\r\n\r\n\r\n### Error details\r\n\r\n```console\r\nException             :\r\n    Type    : System.IO.IOException\r\n    Message : Directory C:\\Temp\\MyWindows cannot be removed because it is not empty.\r\n    HResult : -2146232800\r\nTargetObject          : C:\\Temp\\MyWindows\r\nCategoryInfo          : WriteError: (C:\\Temp\\MyWindows:String) [New-Item], IOException\r\nFullyQualifiedErrorId : DirectoryNotEmpty,Microsoft.PowerShell.Commands.NewItemCommand\r\nInvocationInfo        :\r\n    MyCommand        : New-Item\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 5\r\n    Line             : New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\r\n    PositionMessage  : At line:1 char:1\r\n                       + New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : New-Item\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo :\r\n```\r\n\r\n\r\n### Environment data\r\n\r\n```powershell\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n![image](https://user-images.githubusercontent.com/2467618/178114827-34b53f8f-a177-4daf-abc3-c0a4d0640187.png)\r\n",
  "closed_at": null,
  "comments": [
    {
      "author": "Jeverett3000",
      "author_association": "NONE",
      "body": "On Sat, Jul 9, 2022 at 11:55 AM Tolga Balci ***@***.***>\nwrote:\n\n> Prerequisites\n>\n>    - Write a descriptive title.\n>    - Make sure you are able to repro it on the latest released version\n>    <https://github.com/PowerShell/PowerShell/releases>\n>    - Search the existing issues.\n>    - Refer to the FAQ\n>    <https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md>.\n>    - Refer to Differences between Windows PowerShell 5.1 and PowerShell\n>    <https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell>\n>    .\n>\n> Steps to reproduce\n>\n> Issue is -Force does not seem to understand junctions. It thinks they are\n> directories and fails to remove them because they are not empty.\n>\n> Works fine with file types. (see screenshot)\n>\n> Most types including registry entries allow -Force to overwrite the item.\n> Logically -Force should do the same for a Junction.\n>\n> Due to -Force not working you must first Remove-Item prior to New-Item,\n> which works perfectly fine. Remove-Item simply removes the junction and\n> does not complain that it is not empty. New-Item -Force needs the same\n> intelligence.\n> Expected behavior\n>\n> PS> New-Item MyWindows -Type Junction -Value C:\\Windows\\\n> PS> New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\n> PS>\n>\n> Actual behavior\n>\n> PS> New-Item MyWindows -Type Junction -Value C:\\Windows\\\n> PS> New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\n> New-Item: Directory C:\\Temp\\MyWindows cannot be removed because it is not empty.\n> PS>\n>\n> Error details\n>\n> \ufffd[92mException             : \ufffd[0m\n>     \ufffd[92mType    : \ufffd[0mSystem.IO.IOException\n>     \ufffd[92mMessage : \ufffd[0m\ufffd[31;1mDirectory C:\\Temp\\MyWindows cannot be removed because it is not empty.\n>     \ufffd[92mHResult : \ufffd[0m-2146232800\n> \ufffd[92mTargetObject          : \ufffd[0mC:\\Temp\\MyWindows\n> \ufffd[92mCategoryInfo          : \ufffd[0mWriteError: (C:\\Temp\\MyWindows:String) [New-Item], IOException\n> \ufffd[92mFullyQualifiedErrorId : \ufffd[0mDirectoryNotEmpty,Microsoft.PowerShell.Commands.NewItemCommand\n> \ufffd[92mInvocationInfo        : \ufffd[0m\n>     \ufffd[92mMyCommand        : \ufffd[0mNew-Item\n>     \ufffd[92mScriptLineNumber : \ufffd[0m1\n>     \ufffd[92mOffsetInLine     : \ufffd[0m1\n>     \ufffd[92mHistoryId        : \ufffd[0m5\n>     \ufffd[92mLine             : \ufffd[0mNew-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\n>     \ufffd[92mPositionMessage  : \ufffd[0mAt line:1 char:1\n>                        + New-Item MyWindows -Type Junction -Value C:\\Windows\\ -Force\n>                        + \ufffd[31;1m~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n>     \ufffd[92mInvocationName   : \ufffd[0mNew-Item\n>     \ufffd[92mCommandOrigin    : \ufffd[0mInternal\n> \ufffd[92mScriptStackTrace      : \ufffd[0mat <ScriptBlock>, <No file>: line 1\n> \ufffd[92mPipelineIterationInfo : \ufffd[0m\n>\n> Environment data\n>\n> \ufffd[32;1mName                           Value\ufffd[0m\n>\n> \ufffd[32;1m----                           -----\ufffd[0m\n> PSVersion                      7.2.5\n> PSEdition                      Core\n> GitCommitId                    7.2.5\n> OS                             Microsoft Windows 10.0.19044\n> Platform                       Win32NT\n> PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u0393\u00c7\u00aa}\n> PSRemotingProtocolVersion      2.3\n> SerializationVersion           1.1.0.1\n> WSManStackVersion              3.0\n>\n> Visuals\n>\n> [image: image]\n> <https://user-images.githubusercontent.com/2467618/178114827-34b53f8f-a177-4daf-abc3-c0a4d0640187.png>\n>\n> \u2014\n> Reply to this email directly, view it on GitHub\n> <https://github.com/PowerShell/PowerShell/issues/17656>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AV4PEMAP2EE3PI32D6U3RYDVTGVINANCNFSM53DUCNBA>\n> .\n> You are receiving this because you are subscribed to this thread.Message\n> ID: ***@***.***>\n>\n-- \nJennifer Everett\n",
      "created_at": "2022-07-09T16:56:05Z",
      "updated_at": "2022-10-17T16:57:51Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@PowerShell/wg-powershell-cmdlets reviewed this.  We agree that the behavior using -Force should be consistent for different filesystem types including junctions, so this is a bug that should be fixed.",
      "created_at": "2022-10-05T16:58:14Z",
      "updated_at": "2022-10-05T16:58:14Z"
    }
  ],
  "created_at": "2022-07-09T16:54:08Z",
  "labels": [
    "Issue-Bug",
    "Up-for-Grabs",
    "Hacktoberfest",
    "WG-Cmdlets-Management",
    "In-PR"
  ],
  "number": 17656,
  "state": "open",
  "title": "New-Item -Force does not have expected behavior for all types",
  "updated_at": "2022-10-17T16:57:51Z"
}