{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5900",
  "author": "rkeithhill",
  "body": "<!--- Provide a general summary of the issue in the Title above -->\r\nFor every version of a module I have installed, gmo PSReadLine -list -all shows two entries.\r\n\r\nNOTE: I originally submitted this against PowerShellGet but was asked to re-submit it here.\r\n\r\n<!--\r\n- Search the existing issues.\r\n- Fill out the following template\r\n- If it is a bug report, make sure you are able to repro it with latest PowerShellGet module from master branch.\r\n-->\r\n\r\n## Expected Behavior\r\nI expect to see this:\r\n```\r\n> gmo PSReadLine -list -all\r\n\r\n\r\n    Directory: /home/hillr/.local/share/powershell/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     2.0.0      PSReadLine                          {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHandler, Remov...\r\n\r\n\r\n    Directory: /opt/microsoft/powershell/6.0.0/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     1.2        PSReadLine                          {Get-PSReadlineKeyHandler, Set-PSReadlineKeyHandler, Remov...\r\n```\r\n\r\n## Current Behavior\r\nI see this:\r\n```\r\n> gmo PSReadLine -list -all\r\n\r\n\r\n    Directory: /home/hillr/.local/share/powershell/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     2.0.0      PSReadLine                          {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHandler, Remov...\r\nScript     2.0.0      PSReadLine                          {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHandler, Remov...\r\n\r\n\r\n    Directory: /opt/microsoft/powershell/6.0.0/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     1.2        PSReadLine                          {Get-PSReadlineKeyHandler, Set-PSReadlineKeyHandler, Remov...\r\nScript     1.2        PSReadLine                          {Get-PSReadlineKeyHandler, Set-PSReadlineKeyHandler, Remov...\r\n```\r\n## Possible Solution\r\n<!--- Not obligatory, but suggest a fix/reason for the bug, -->\r\n<!--- or ideas how to implement the addition or change -->\r\n\r\n## Steps to Reproduce (for bugs)\r\n<!--- Provide a link to a live example, or an unambiguous set of steps to -->\r\n<!--- reproduce this bug. Include code to reproduce, if relevant -->\r\n1.  I'm trying this on WSL on Windows 10 1709. I'm using the Ubuntu 16.04 from the Windows Store.\r\n2. Install PS Core 6.0.0 (GA)\r\n3. install-module psreadline -RequiredVersion 2.0.0-beta1 -AllowPrerelease -Scope CurrentUser\r\n4. gmo PSReadLine -list -all\r\n\r\n## Context\r\nThe output is simply (embarrassingly) wrong.\r\n\r\n## Your Environment\r\n<!--- Include at least the output from $PSVersionTable -->\r\n\r\n```PowerShell\r\n\r\n> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.0.0\r\nPSEdition                      Core\r\nGitCommitId                    v6.0.0\r\nOS                             Linux 4.4.0-43-Microsoft #1-Microsoft Wed Dec 31 14:42:53 PST 2014\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n> Get-Module\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nManifest   3.1.0.0    Microsoft.PowerShell.Management     {Add-Content, Clear-Content, Clear-Item, Clear-ItemPropert...\r\nManifest   3.1.0.0    Microsoft.PowerShell.Utility        {Add-Member, Add-Type, Clear-Variable, Compare-Object...}\r\nScript     1.0.0      posh-git                            {Add-PoshGitToProfile, Add-SshKey, Format-GitBranchName, G...\r\nScript     1.2        PSReadLine                          {Get-PSReadlineKeyHandler, Get-PSReadlineOption, Remove-PS...\r\n\r\n> Get-Module -ListAvailable PowerShellGet,PackageManagement\r\n\r\n\r\n    Directory: /home/hillr/.local/share/powershell/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     1.6.0      PowerShellGet                       {Install-Module, Find-Module, Save-Module, Update-Module...}\r\n\r\n\r\n    Directory: /opt/microsoft/powershell/6.0.0/Modules\r\n\r\n\r\nModuleType Version    Name                                ExportedCommands\r\n---------- -------    ----                                ----------------\r\nScript     1.1.7.0    PackageManagement                   {Find-Package, Get-Package, Get-PackageProvider, Get-Packa...\r\nScript     1.6.0      PowerShellGet                       {Install-Module, Find-Module, Save-Module, Update-Module...}\r\n\r\n> Get-PackageProvider\r\nName                     Version          DynamicOptions\r\n----                     -------          --------------\r\nNuGet                    2.8.5.210        Destination, ExcludeVersion, Scope, SkipDependencies, Headers, FilterOnTag...\r\nPowerShellGet            1.6.0.0          PackageManagementProvider, Type, Scope, AllowClobber, SkipPublisherCheck, ...\r\n\r\n> Get-PackageProvider -ListAvailable\r\nName                     Version          DynamicOptions\r\n----                     -------          --------------\r\nNuGet                    2.8.5.210        Destination, ExcludeVersion, Scope, SkipDependencies, Headers, FilterOnTag...\r\nPowerShellGet            1.6.0.0          PackageManagementProvider, Type, Scope, AllowClobber, SkipPublisherCheck, ...\r\n```",
  "closed_at": "2022-05-24T21:00:46Z",
  "comments": [
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "@rkeithhill Is this still happening? I wonder if @daxian-dbw might have already fixed it in work he did earlier in the year",
      "created_at": "2018-11-13T23:59:31Z",
      "updated_at": "2018-11-13T23:59:31Z"
    },
    {
      "author": "rkeithhill",
      "author_association": "COLLABORATOR",
      "body": "Yes, it is still happening.  I'm running PS Core 6.1.0 on WSL (Ubuntu 16.04) on Windows 10 1809:\r\n```\r\n1:115ms> gmo PSReadLine -list -all\r\n\r\n\r\n    Directory: /home/hillr/.local/share/powershell/Modules\r\n\r\n\r\nModuleType Version    Name                                PSEdition ExportedCommands\r\n---------- -------    ----                                --------- ----------------\r\nScript     2.0.0      PSReadLine                          Desk      {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHand...\r\nScript     0.0        PSReadLine                          Desk      {Get-PSReadLineKeyHandler, Get-PSReadLineOption,...\r\nScript     2.0.0      PSReadLine                          Desk      {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHand...\r\nScript     0.0        PSReadLine                          Desk      PSConsoleHostReadLine\r\n\r\n\r\n    Directory: /usr/local/share/powershell/Modules\r\n\r\n\r\nModuleType Version    Name                                PSEdition ExportedCommands\r\n---------- -------    ----                                --------- ----------------\r\nScript     2.0.0      PSReadLine                          Desk      {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHand...\r\nScript     0.0        PSReadLine                          Desk      PSConsoleHostReadLine\r\n\r\n\r\n    Directory: /opt/microsoft/powershell/6/Modules\r\n\r\n\r\nModuleType Version    Name                                PSEdition ExportedCommands\r\n---------- -------    ----                                --------- ----------------\r\nScript     2.0.0      PSReadLine                          Desk      {Get-PSReadLineKeyHandler, Set-PSReadLineKeyHand...\r\nScript     0.0        PSReadLine                          Desk      PSConsoleHostReadLine\r\n```",
      "created_at": "2018-11-26T05:22:34Z",
      "updated_at": "2018-11-26T05:22:34Z"
    },
    {
      "author": "jagrock",
      "author_association": "NONE",
      "body": "This happens for me as well, 5.1 and 6.x.  From looking at all properties, it seems to be the RootModule property.\r\n\r\nOne entry will just have the filename and the other would have the full path.  All other properties match.  It also shows included DLLs, like EPPlus which is included with ImportExcel but not it's own listed module.  It same Module Base but the module name shows as EPPlus.\r\n\r\nE.g. RootModule values for a duplicate entry.\r\nImportExcel.psm1\r\nC:\\Users\\%UserName%\\Documents\\WindowsPowerShell\\Modules\\ImportExcel\\6.2.3\\ImportExcel.psd1",
      "created_at": "2019-11-20T20:30:55Z",
      "updated_at": "2019-11-20T20:30:55Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "I'm not seeing this in preview.5 -- has it been fixed recently?\r\n![image](https://user-images.githubusercontent.com/32407840/69277297-0c7daf80-0bae-11ea-8637-3598c59a0b6e.png)\r\n",
      "created_at": "2019-11-20T20:54:36Z",
      "updated_at": "2019-11-20T20:54:36Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "Didn't realise this was originally for `gmo -list -all`. The behaviour @vexx32 looks about right to me, although I've discussed with @daxian-dbw before and it wasn't entirely clear to us what `-All` is really supposed to do or why; it blindly recursively searches for things with a module extension. I suspect the duplicate might have been a directory vs module file phenomenon (`PSReadLine/PSReadLine.psm1`, `PSReadLine/PSReadLine.psd1`, `PSReadLine.psm1`, `PSReadLine.psd1`).\r\n\r\nEvery time `-All` has come up, there's been disagreement about what it's supposed to do and what its use case is, so we try not to touch it (and I'm not sure there are many tests around it). But its implementation is interleaved with `gmo -List`, so it might have been changed unintentionally.",
      "created_at": "2019-11-20T21:25:30Z",
      "updated_at": "2019-11-20T21:25:30Z"
    },
    {
      "author": "rokejulianlockhart",
      "author_association": "NONE",
      "body": "@vexx32, does \"http://user-images.githubusercontent.com/32407840/69277297-0c7daf80-0bae-11ea-8637-3598c59a0b6e.png\" not depict the problem?\r\n\r\n(Additionally, paste output as text if possible, encapsulated by \"```\". It assists people with slow connections to the internet, and allows quotation to be easy rather than difficult.)",
      "created_at": "2022-05-21T16:57:37Z",
      "updated_at": "2022-05-21T16:59:09Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "`gmo -list -all` search recursively into all directories in the module path, and try to find all files with a valid PS module extension and return them as `PSModuleInfo` objects.\r\n\r\nI believe the scenario for it is to discover nested modules files within the available modules. One example is `PSDesiredStateConfiguration`, an in-box module under `System32` folder. It contains many DSC resources in sub-folders of the `PSDesiredStateConfiguration` directory, and many of them are `.psm1` module files, so you can find them by running the following:\r\n```\r\nPS:2> gmo *Resource -ListAvailable -All\r\n\r\n    Directory: C:\\program files\\powershell\\7\\Modules\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nManifest   0.0                   PSGet.Resource                      Desk\r\n\r\n    Directory: C:\\Program Files\\WindowsPowerShell\\Modules\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nManifest   0.0                   PSGet.Resource                      Desk\r\n\r\n    Directory: C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules\\PSDesiredStateConfiguration\\DSCResources\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nScript     0.0                   MSFT_ArchiveResource                Desk      {Mount-NetworkPath, Open-ZipFile, Assert-ValidStandardArgs, Trace-Mes\u2026\r\nScript     0.0                   MSFT_EnvironmentResource            Desk      {GetItemProperty, Set-EnvVar, Set-TargetResource, FindPath\u2026}\r\nScript     0.0                   MSFT_GroupResource                  Desk      {Test-TargetResource, IsLocalMachine, Parse-Scope, Set-TargetResource\u2026\r\nScript     0.0                   MSFT_PackageResource                Desk      {Get-MsiProductEntry, Trace-Message, Set-TargetResource, Throw-Termin\u2026\r\nScript     0.0                   MSFT_ProcessResource                Desk      {AssertAbsolutePath, GetWin32ProcessOwner, IsRunFromLocalSystemUser, \u2026\r\nScript     0.0                   MSFT_RegistryResource               Desk      {IsValidRegistryRoot, Get-TargetResourceInternal, ConvertByteArrayToH\u2026\r\nScript     0.0                   MSFT_RoleResource                   Desk      {Test-TargetResource, ValidatePrerequisites, Get-TargetResource, Set-\u2026\r\nScript     0.0                   MSFT_ScriptResource                 Desk      {CheckDeviceGuardStatus, Set-TargetResource, ScriptExecutionHelper, G\u2026\r\nScript     0.0                   MSFT_ServiceResource                Desk      {StartService, NormalizeStartupType, TestStartupType, StopService\u2026}\r\nScript     0.0                   MSFT_UserResource                   Desk      {Set-TargetResourceOnFullSKU, Test-TargetResourceOnFullSKU, Set-Targe\u2026\r\n\r\n    Directory: C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nManifest   0.0                   PnpDevice.Resource                  Desk\r\n```\r\n\r\nThe `-All` parameter is not for searching a regular PowerShell module scenario, and `gmo PSReadLine -list` can already return all installed `PSReadLine` modules under the module paths. [The doc](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/get-module?view=powershell-7.2#parameters) for this parameter is clear on its behavior in my opinion, and I think we can close this one as by-design.",
      "created_at": "2022-05-23T16:47:42Z",
      "updated_at": "2022-05-23T16:51:37Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as by-design and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2022-05-24T21:00:46Z",
      "updated_at": "2022-05-24T21:00:46Z"
    }
  ],
  "created_at": "2018-01-13T23:30:49Z",
  "labels": [
    "Resolution-By Design",
    "WG-Cmdlets-Core"
  ],
  "number": 5900,
  "state": "closed",
  "title": "Get-Module -List -All lists duplicates",
  "updated_at": "2022-05-24T21:00:46Z"
}