{
  "_url": "https://github.com/PowerShell/PowerShell/issues/9494",
  "author": "iSazonov",
  "body": "Come form #9362\r\nThe comment in code says that interactive input should works\r\n- with -File:\r\nhttps://github.com/PowerShell/PowerShell/blob/ceed73d7375cb98a199ceb19796bb2311b0b0002/src/Microsoft.PowerShell.ConsoleHost/host/msh/CommandLineParameterParser.cs#L1133-L1141\r\n\r\n- with -Command:\r\nhttps://github.com/PowerShell/PowerShell/blob/ceed73d7375cb98a199ceb19796bb2311b0b0002/src/Microsoft.PowerShell.ConsoleHost/host/msh/CommandLineParameterParser.cs#L1296-L1304\r\n\r\nThe comments differ in \"no prompts\" vs \"with prompts\" - it is not clear is it comments and behaviors right.\r\n\r\nAlso using dash is documented only for `-Command` (`not for -File`)\r\nhttps://docs.microsoft.com/en-us/powershell/scripting/components/console/powershell.exe-command-line-help?view=powershell-6#-command\r\n\r\n  \r\n# Steps to reproduce\r\n\r\n```powershell\r\npwsh -file C:\\temp\\q1.ps1 -\r\n```\r\n\r\n# Expected behavior\r\n\r\n```none\r\npwsh -file C:\\1\\q1.ps1 -\r\n<wait interactive inout>\r\n```\r\n\r\n# Actual behavior\r\n\r\n```none\r\npwsh -file C:\\1\\q1.ps1 -\r\n-\r\n```\r\n\r\n# Expected behavior\r\n\r\n```none\r\npwsh -command -\r\n<wait interactive inout>\r\n```\r\n\r\n# Actual behavior\r\n\r\n```none\r\n'-' was specified as the argument to -Command but standard input has not been redirected for this process.\r\n\r\nUsage: pwsh[.exe] [[-File] <filePath> [args]]\r\n                  [-Command { - | <script-block> [-args <arg-array>]\r\n                                | <string> [<CommandParameters>] } ]\r\n                  [-ConfigurationName <string>] [-CustomPipeName <string>]\r\n                  [-EncodedCommand <Base64EncodedCommand>]\r\n                  [-ExecutionPolicy <ExecutionPolicy>] [-InputFormat {Text | XML}]\r\n                  [-Interactive] [-NoExit] [-NoLogo] [-NonInteractive] [-NoProfile]\r\n                  [-OutputFormat {Text | XML}] [-Version] [-WindowStyle <style>]\r\n                  [-WorkingDirectory <directoryPath>]\r\n\r\n       pwsh[.exe] -h | -Help | -? | /?\r\n\r\nPowerShell Online Help https://aka.ms/pscore6-docs\r\n\r\nAll parameters are case-insensitive.\r\n-\r\n```\r\n\r\n# Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.2.0-rc.1\r\nPSEdition                      Core\r\nGitCommitId                    6.2.0-rc.1-204-g262d86c691519ff7d5adacbae6424e2c87accce6\r\nOS                             Microsoft Windows 10.0.17763\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": "2021-08-25T04:28:09Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Perhaps we could discuss this in #3223.\r\n",
      "created_at": "2019-04-29T05:03:37Z",
      "updated_at": "2019-04-29T05:03:37Z"
    },
    {
      "author": "mklement0",
      "author_association": "CONTRIBUTOR",
      "body": "The `-` in `pwsh -file C:\\temp\\q1.ps1 -` is just a positional argument; `-` is only special as the _first_ argument after `-file` or `-command`; that is, if it is specified _instead of_ a file name / code snippet.\r\n\r\nDo note that **the primary use of these idioms is to provide input via _stdin_  / the pipeline, not _interactive_ use.**\r\n\r\nGiven that, when called from the outside, `-` should represent _stdin_, the following commands should all be equivalent on Unix:\r\n\r\n```powershell\r\npwsh -noprofile -file -\r\npwsh -noprofile -file /dev/stdin\r\n```\r\n\r\n`pwsh -noprofile  -file -` is broken (as is `pwsh -noprofile -command -`, as demonstrated in your OP).\r\n\r\n`pwsh -noprofile -file /dev/stdin` works in principle with interactive input, but, once the input is submitted with ^D, it then displays pseudo-interactive _output_ behavior, as discussed in #3223.\r\n\r\n(As an aside, `bash` actually prompts _line by line_ in this scenario,  because, in the Unix world, _non-redirected_, i.e., interactive stdin input is processed line by line, whereas _redirected_ stdin is typically processed as a whole. Again, however: interactive input is _not_ the typical or useful use case - if you want to submit commands interactively, one by one, just start a new session with `pwsh`.)\r\n\r\nReturning to the typical use case:\r\n\r\nThe following two commands should be equivalent (with the exception of what the script reports in `$PSCommandPath`, `$PSScriptRoot`, ...):\r\n\r\n* `pwsh -noprofile -file foo.ps1`\r\n* `cat foo.ps1 | pwsh -noprofile -file -`\r\n\r\nIt is what enables the powerful `curl ... | sh` install-from-the-web idiom in POSIX-like shells - that is, feeding the _content_ of a script to the shell rather than needing to provide a _file_['s path].\r\n\r\nIf `-file -` worked that way, there would really be no need for `-command -` at all.\r\nGiven that we cannot remove support for it, it should be made to work the same, but [soft]-deprecated.\r\n\r\nThere's also no reason to disallow _arguments_ to follow `-file -` - it's an unnecessary restriction that violates the equivalence of the two commands above. It prevents passing the script content via stdin / the pipeline while also accepting _arguments_.\r\n\r\n(Given how `-command` currently works, there _is_ a good reason to disallow following `-command -` with arguments (the way that `-command` currently works - stitching together a script from _all_ arguments following `-command` - is highly unfortunate, but cannot be changed), but if we fix `-file -`, that restriction can then easily be bypassed by using `-file -` instead).\r\n\r\nNote that it still makes sense to combine `-command` - _not_ with `-` - with stdin input: The `-command` argument then specifies the command to run, as usual, and stdin input becomes its _pipeline input_.\r\n\r\nHere's a `bash` example:\r\n\r\n```sh\r\n$ printf 'hi\\nthere\\n' | bash -c 'cat -n'\r\n     1\thi\r\n     2\tthere\r\n```\r\n\r\nRegrettably, stdin input passed to `pwsh` currently does _not_ become pipeline input - see #9497 -  so that the following does _not_ work analogously:\r\n\r\n```powershell\r\n$ printf 'hi\\nthere\\n' | pwsh -noprofile -command '% { $i=0 } { \"{0}`t{1}\" -f ++$i, $_ }'\r\n1   # !! stdin input did NOT become pipeline input\r\n```\r\n\r\nAs a doleful aside: if you tried to run this _from PowerShell_, the broken quoting for external programs (PowerShell itself, in this case), would make the command _fail_.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at": "2019-04-29T15:18:02Z",
      "updated_at": "2019-04-29T15:19:59Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> Do note that the primary use of these idioms is to provide input via stdin / the pipeline, not interactive use.\r\n\r\nDocumentation is silent about it that confuses me. Make sense to open new issue in Docs repo?\r\n\r\nThe question remains about the input from the console. Although it could also be documented that it is not supported.",
      "created_at": "2019-04-29T15:32:23Z",
      "updated_at": "2019-04-29T15:32:23Z"
    },
    {
      "author": "mklement0",
      "author_association": "CONTRIBUTOR",
      "body": "The docs definitely need improvement: The CLI help doesn't mention `-File -` at all, and doesn't mention the requirement of _redirected_ stdin input for `-Command -`\r\n\r\nThe current behavior is conceptually backwards and fundamentally broken, as shown in #3223:\r\n\r\n* It is designed around _line-by-line_ processing, so clearly focused on _interactive_ use.\r\n\r\n  * By contrast, the real value comes from providing commands via _redirected_ stdin  / piping.\r\n\r\n* It is `-Command -` that is implemented with _redirected_ stdin input in mind - yet line-by-line process is _still_ applied (but at least the prompt string isn't printed the way it is with `-File -`), unlike when you pass a multi-line command string as an _argument_.\r\n\r\n  * Conceptually, `-File -` makes more sense  for redirected stdin input - and it is the _only_ form needed.\r\n\r\n> The question remains about the input from the console.\r\n\r\n`pwsh -File -` without redirected stdin input simply starts a regular session - the same as not specifying `-File -` at all.\r\nWhile technically somewhat defensible, it's certainly surprising.\r\n\r\nThere _is_ a way in which `-File -` could be useful with _interactive_ input:\r\nIf it allowed you to type an entire script ad hoc, and then submit it at once - **it is what `pwsh -File /dev/stin` _already does_ on Unix**, albeit accidentally:\r\n\r\n```powershell\r\n$ pwsh -File -  # type the ad hoc script on the following lines, then submit with ^D (+ Enter on Windows)\r\nget-date\r\nget-childItem -Directory\r\n^D\r\n```\r\n\r\nThis is what `ruby` supports, for instance.\r\n\r\nThe caveat is that this form of supplying multi-line stdin input is probably more familiar to Unix users than Windows users, and it would be a first in the context of PowerShell.\r\n(I suppose submitting an empty extra line could be taken as the end-of-input signal, the same way as with array-valued mandatory parameter prompts, but that preclude use of blank lines for readability.)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at": "2019-04-29T16:28:39Z",
      "updated_at": "2019-04-29T16:38:31Z"
    }
  ],
  "created_at": "2019-04-29T05:03:06Z",
  "labels": [
    "Issue-Enhancement",
    "WG-Engine"
  ],
  "number": 9494,
  "state": "closed",
  "title": "Interactive input should works with -File parameter",
  "updated_at": "2021-08-25T06:32:59Z"
}