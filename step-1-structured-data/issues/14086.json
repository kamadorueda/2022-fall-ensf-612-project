{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14086",
  "author": "marvelcz89",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n\r\n## Steps to reproduce\r\n1) Allow plain text password in configuration MOF files\r\n2) Push following configuration to server (this will be successfull): \r\n```powershell \r\nnode $ComputerName\r\n    {    \r\n        User CreateUser {\r\n            Ensure                   = 'Present'\r\n            UserName                 = \"DscUser\"\r\n            FullName                 = \"Full Name\"\r\n            Description              = \"Created by DSC\"\r\n            Disabled                 = $false  \r\n            Password                 = New-Object -TypeName pscredential -ArgumentList @(\"localhost\\DscUser\", (ConvertTo-SecureString \"Supersecret111+\" -AsPlainText -Force))           \r\n            PasswordNeverExpires     = $true\r\n            PasswordChangeRequired   = $false\r\n            PasswordChangeNotAllowed = $true           \r\n        }\r\n\r\n        Group AllowRDP {\r\n            Ensure           = 'Present'\r\n            GroupName        = \"Remote Desktop Users\"\r\n            MembersToInclude = \"DscUser\"\r\n            DependsOn        = '[User]CreateUser'\r\n        }\r\n    }\r\n```\r\n3) Login to the target server and manually disable created user\r\n4) Push configuration again to replicate the issue. Error message in actual behavior below.\r\n\r\n## Expected behavior\r\n-  Disabled = $false + ENABLED_ON_SERVER -> Working as expected - user stays enabled\r\n-  Disabled = $false + DISABLED_ON_SERVER  -> DSC should enable user and set the desired state\r\n-  Disabled = $true + ENABLED_ON_SERVER -> Working as expected - user is disabled during MOF application\r\n-  Disabled = $true + DISABLED_ON_SERVER -> Either set desired state or if the configuration can not be done without having user enabled during processing throw and error message \r\n\r\n## Actual behavior\r\n\r\n\r\nInvalidOperation: PowerShell DSC resource MSFT_UserResource  failed to execute Test-TargetResource functionality with error message: There could be a possible connection error while trying to use the System.DirectoryServices API's.Exception calling \"ValidateCredentials\" with \"2\" argument(s): \"This user can't sign in because this account is currently disabled.\r\n\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0\r\nOS                             Microsoft Windows 10.0.17763\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\nAlso possible to replicate with:\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      5.1.17763.592\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.17763.592\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n```",
  "closed_at": null,
  "comments": [
    {
      "author": "gaelcolas",
      "author_association": "NONE",
      "body": "Please use the `xPSDesiredStateConfiguration` module, `xGroup`resource and report over that repo if any problem: https://github.com/dsccommunity/xPSDesiredStateConfiguration/#xgroup\r\n\r\nThis issue should be closed.\n\n<blockquote><img src=\"https://opengraph.githubassets.com/df849d7a0c8deaaea2e8b524b42f00530ed03be293456d8e6cdf89db9b101e53/dsccommunity/xPSDesiredStateConfiguration\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/dsccommunity/xPSDesiredStateConfiguration\">dsccommunity/xPSDesiredStateConfiguration</a></strong></div><div>DSC resources for configuring common operating systems features, files and settings. - dsccommunity/xPSDesiredStateConfiguration</div></blockquote>",
      "created_at": "2021-04-28T13:55:15Z",
      "updated_at": "2021-04-28T13:55:17Z"
    }
  ],
  "created_at": "2020-11-13T17:29:47Z",
  "labels": [
    "Issue-Question",
    "Area-DSC"
  ],
  "number": 14086,
  "state": "open",
  "title": "DSC cannot enable local users with DSC managed credentials",
  "updated_at": "2021-04-28T13:55:17Z"
}