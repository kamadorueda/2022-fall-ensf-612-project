{
  "_url": "https://github.com/PowerShell/PowerShell/issues/9925",
  "author": "SuperBenji99",
  "body": "I'm new to Powershell, and having a really hard time getting SSH working.\r\nI'm looking at using Powershell on a Win10 machine to remote into some Cisco devices via SSH.\r\nI followed the guides to install Powershell Core 6, OpenSSH, set the environment path, configured the sshd_config, created the systemlink, no matter what I do, I'm unable to use New-PSSession or Enter-PSSession. I get prompted for the SSH password but then it fails with this error msg:\r\n\r\n```\r\nPS C:\\temp> New-PSSession xxx.xxx.xxx.xxx -SSHTransport -UserName admin -Port 22\r\nPassword:\r\nNew-PSSession : [xxx.xxx.xxx.xxx] The background process reported an error with the following message: The SSH client session has ended with error message: subsystem request failed on channel 0.\r\nAt line:1 char:1\r\n+ New-PSSession xxx.xxx.xxx.xxx -SSHTransport -UserName admin -Port 22\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n+ CategoryInfo          : OpenError: (System.Management.A\\u2026tion.RemoteRunspace:RemoteRunspace) [New-PSSession], PSRemotingTransportException\r\n`+` FullyQualifiedErrorId : 2100,PSSessionOpenFailed\r\n```\r\n\r\nHere's my sshd_config file\r\n[sshd_config.txt](https://github.com/PowerShell/PowerShell/files/3301894/sshd_config.txt)\r\n\r\nsshd.log doesn't show anything:\r\n\r\n```\r\n`3268 2019-06-18 09:56:56.409 debug2: fd 3 setting O_NONBLOCK\r\n3268 2019-06-18 09:56:56.409 debug3: sock_set_v6only: set socket 3 IPV6_V6ONLY\r\n3268 2019-06-18 09:56:56.409 debug1: Bind to port 22 on ::.\r\n3268 2019-06-18 09:56:56.409 Server listening on :: port 22.\r\n3268 2019-06-18 09:56:56.409 debug2: fd 4 setting O_NONBLOCK\r\n3268 2019-06-18 09:56:56.409 debug1: Bind to port 22 on 0.0.0.0.\r\n3268 2019-06-18 09:56:56.409 Server listening on 0.0.0.0 port 22.\r\n1832 2019-06-18 10:02:35.566 debug2: fd 3 setting O_NONBLOCK\r\n1832 2019-06-18 10:02:35.567 debug3: sock_set_v6only: set socket 3 IPV6_V6ONLY\r\n1832 2019-06-18 10:02:35.567 debug1: Bind to port 22 on ::.\r\n1832 2019-06-18 10:02:35.567 Server listening on :: port 22.\r\n1832 2019-06-18 10:02:35.567 debug2: fd 4 setting O_NONBLOCK\r\n1832 2019-06-18 10:02:35.567 debug1: Bind to port 22 on 0.0.0.0.\r\n1832 2019-06-18 10:02:35.567 Server listening on 0.0.0.0 port 22.\r\n1108 2019-06-18 10:04:09.232 debug2: fd 3 setting O_NONBLOCK\r\n1108 2019-06-18 10:04:09.232 debug3: sock_set_v6only: set socket 3 IPV6_V6ONLY\r\n1108 2019-06-18 10:04:09.232 debug1: Bind to port 22 on ::.\r\n1108 2019-06-18 10:04:09.232 Server listening on :: port 22.\r\n1108 2019-06-18 10:04:09.232 debug2: fd 4 setting O_NONBLOCK\r\n1108 2019-06-18 10:04:09.232 debug1: Bind to port 22 on 0.0.0.0.\r\n1108 2019-06-18 10:04:09.233 Server listening on 0.0.0.0 port 22.`\r\n```\r\n\r\nOperating system:\r\n\r\n```\r\n`PS C:\\temp> ((Get-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows nt\\CurrentVersion\\\" -Name ProductName).ProductName)\r\nWindows 10 Enterprise`\r\n\r\n```\r\nOpenSSH version:\r\n\r\n```\r\n`PS C:\\temp> ((Get-Item (Get-Command sshd).Source).VersionInfo.FileVersion)\r\n7.9.0.0`\r\n```\r\n\r\nPowershell version:\r\n\r\n```\r\n`PS C:\\temp> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.2.1\r\nPSEdition                      Core\r\nGitCommitId                    6.2.1\r\nOS                             Microsoft Windows 10.0.15063\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0`\r\n```\r\n\r\nI can connect no problem using the ssh command:\r\n\r\n```\r\nPS C:\\temp> ssh xxx.xxx.xxx.xxx -l admin\r\nPassword:\r\nWelcome to xxx\r\n...\r\n*r Login successful\r\nOK\r\n```\r\n\r\nI've spent way too much time debugging this, any help is greatly appreciated!\r\n",
  "closed_at": "2020-05-07T12:50:28Z",
  "comments": [
    {
      "author": "wjk",
      "author_association": "NONE",
      "body": "@SuperBenji99 I don't know if this solution will work for you, because this solution is contingent on (a) being able to edit the sshd_config file for your server, and (b) having PowerShell installed on that server. Nevertheless, to solve this problem you will need to add the following line to your sshd_config file, then restart sshd on the target server:\r\n\r\n```\r\nSubsystem powershell /usr/local/share/powershell/pwsh -sshs -NoLogo -NoProfile\r\n```\r\n\r\nReplace `/usr/local/share/powershell/pwsh` with the full path to the `pwsh` binary on the target system. Once this is done, PowerShell should support remoting into a target Linux or macOS system over SSH, just as it does with Windows hosts. Hope this helps!",
      "created_at": "2019-07-11T00:21:53Z",
      "updated_at": "2019-07-11T00:21:53Z"
    }
  ],
  "created_at": "2019-06-18T14:34:08Z",
  "number": 9925,
  "state": "closed",
  "title": "New-PSSession error \"subsystem request failed on channel 0\"",
  "updated_at": "2020-05-07T12:50:36Z"
}