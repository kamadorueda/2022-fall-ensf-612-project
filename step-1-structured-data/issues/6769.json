{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6769",
  "author": "rjmholt",
  "body": "## PR Summary\r\n\r\n<!-- summarize your PR between here and the checklist -->\r\nUbuntu 17.04 is EOL, so we need to update our packaging for Ubuntu 17.10. This updates the package script and `build.psm1` to use 17.10 rather than 17.04.\r\n\r\nThe other things we should change to fully migrate are:\r\n- The dpkg URL and name\r\n- The README's [Get PowerShell instructions](https://github.com/PowerShell/PowerShell/blob/master/README.md#get-powershell)\r\n- The Ubuntu 17.04 [installation instructions](https://github.com/PowerShell/PowerShell/blob/master/docs/installation/linux.md#ubuntu-1704)\r\n- The Docker Ubuntu 17.10 [template](https://github.com/PowerShell/PowerShell/blob/8aec1585195e6d4871538aaa2ad2b112cf5fbfee/docker/tests/Templates/ubuntu17.10/Dockerfile#L24)\r\n\r\nAlso, Fedora 25 is now EOL and we should move to 27. This should already be handled, but we need to test on in a Fedora 27 environment.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-05-07T19:30:59Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I found 58 results by \"Ubuntu\" string in `*.ps*` files - I see there's something we need to fix, too.",
      "created_at": "2018-04-29T12:22:43Z",
      "updated_at": "2018-04-29T12:22:43Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@rjmholt Can you add a commit with `[Package]` at the beginning of the title?  This will trigger package building.\r\n\r\n> I found 58 results by \"Ubuntu\" string in *.ps* files - I see there's something we need to fix, too.\r\n\r\nI only found one line that needs to be changed.  The docs should be moved to PowerShell/PowerShell-Docs\r\nhttps://github.com/PowerShell/PowerShell/blob/e9b045e8198ffea07de6287d405e6eef1656169b/build.psm1#L137",
      "created_at": "2018-04-30T19:18:00Z",
      "updated_at": "2018-04-30T19:18:00Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "Installing PowerShell on Fedora 28 I notice two things so far:\r\n- The installation manager GUI window you get when you double click on the RPM to install the PowerShell binary says the license is \"proprietary\" rather than \"MIT\".\r\n- I run into #6132.",
      "created_at": "2018-05-02T22:42:01Z",
      "updated_at": "2018-05-02T22:42:01Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I think we should rebase to move to .Net Core 2.1 and then check that #6132 was fixed.",
      "created_at": "2018-05-03T04:44:42Z",
      "updated_at": "2018-05-03T04:44:52Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "Okay I've run successfully installed PowerShell from `master` and run `Start-PSPester -Tag \"CI\",\"Feature\",\"RequireSudoOnLinux\"` under `sudo` on the following platforms:\r\n\r\n|     | Ubuntu 17.10 | Ubuntu 18.04 | Fedora 27 | Fedora 28 |\r\n| :-: | :--------------: | :-------------: | :----------: | :----------: |\r\n| Succeeded | 6226 | 6227 | 6226 | 6232 |\r\n| Failed | 12 | 11 | 9 | 8 |\r\n| Skipped | 1225 | 1225 | 1227 | 1227 |\r\n| Pending | 419 | 419 | 419 | 419 |\r\n| Inconclusive | 0 | 0 | 0 | 0 |\r\n| **Total** | 7882 | 7882 | 7881 | 7886 |\r\n| Pester XML | [pester-tests-ubuntu17.10.xml.zip](https://github.com/PowerShell/PowerShell/files/1972827/pester-tests-ubuntu17.10.xml.zip) | [pester-tests-ubuntu18.04.xml.zip](https://github.com/PowerShell/PowerShell/files/1972828/pester-tests-ubuntu18.04.xml.zip) | [pester-tests-fed27.xml.zip](https://github.com/PowerShell/PowerShell/files/1972823/pester-tests-fed27.xml.zip) | [pester-tests-fed28.xml.zip](https://github.com/PowerShell/PowerShell/files/1972825/pester-tests-fed28.xml.zip) |\r\n\r\nSome of the problems I found:\r\n\r\n* On Fedora 28:\r\n    - https://github.com/PowerShell/PowerShell/blob/090f8761e8a4c53045467c218100ea3404120a77/test/powershell/engine/Remoting/SSHRemotingAPI.Tests.ps1#L18 fails with the message `Cannot process argument transformation on parameter 'Skip'. Cannot convert value \"System.Object[]\" to type \"System.Management.Automation.SwitchParameter\". Boolean parameters accept only Boolean values and numbers, such as $True, $False, 1 or 0.` (line 27, char 102).\r\n    - https://github.com/PowerShell/PowerShell/blob/f0b6ef2eb470c0866f21768547f34af4670467fd/test/powershell/Modules/Microsoft.PowerShell.Management/Get-Process.Tests.ps1#L4 fails with message `Expected regular expression {fedora} to match {root}, but it did not match.` (line 5) (`fedora` is the user on the VM).\r\n    - https://github.com/PowerShell/PowerShell/blob/9ca059dcf8e21db106e82827dc492c611a7c55b6/test/powershell/Modules/Microsoft.PowerShell.Management/New-Item.Tests.ps1#L182 fails with message `Expected an exception, with FullyQualifiedErrorId 'NewItemSymbolicLinkElevationRequired,Microsoft.PowerShell.Commands.NewItemCommand' to be thrown, but no exception was thrown.` (line 185).\r\n    - https://github.com/PowerShell/PowerShell/blob/24cf0204421580b52b31213854737fdf9417963f/test/powershell/Modules/Microsoft.PowerShell.Management/Test-Connection.Tests.ps1#L81 fails with message `Expected exactly {2001:4860:4860::8888}, but got {8.8.8.8}.` (line 84)\r\n    - https://github.com/PowerShell/PowerShell/blob/24cf0204421580b52b31213854737fdf9417963f/test/powershell/Modules/Microsoft.PowerShell.Management/Test-Connection.Tests.ps1#L93 fails with message `Expected exactly {2001:4860:4860::8888}, but got {8.8.8.8}.` (line 98)\r\n    - https://github.com/PowerShell/PowerShell/blob/84344cbb32ec5e2479e00394951832794bf37244/test/powershell/Modules/Microsoft.PowerShell.Management/Test-Connection.Tests.ps1#L185 fails with message `Expected {0}, but got {32}.` (line 195)\r\n    - https://github.com/PowerShell/PowerShell/blob/cc3ffd8349547e968c00e0b175a6abe348087b41/test/powershell/Modules/Microsoft.PowerShell.Utility/Export-Alias.Tests.ps1#L97 fails with message `Expected an exception, with FullyQualifiedErrorId 'FileOpenFailure,Microsoft.PowerShell.Commands.ExportAliasCommand' to be thrown, but no exception was thrown.` (line 108)\r\n    - https://github.com/PowerShell/PowerShell/blob/cc3ffd8349547e968c00e0b175a6abe348087b41/test/powershell/Modules/Microsoft.PowerShell.Utility/Set-Date.Tests.ps1#L15 fails with message `Expected string to be the same, but they were different. ... Expected {System.ComponentModel.Win32Exception,Microsoft.PowerShell.Commands.SetDateCommand}, But Was: {No Exception!}` (line 77)'\r\n\r\n\r\n* On Fedora 27, all the failures experienced in 28, plus a `BeforeAll` block:\r\n    https://github.com/PowerShell/PowerShell/blob/1b3c8aca507de2984cb14f0780dde94d977c7b8d/test/powershell/engine/ParameterBinding/ParameterBinding.Tests.ps1#L374\r\n    fails with `The file '/tmp/TestBindingCmdlet.dll' already exists.` (line 374, char 13).\r\n\r\n\r\n* On Ubuntu 18.04, all the tests failing on Fedora 27 fail, plus:\r\n    - a native command processor test seems to call `less`, which halts the test execution. This test:\r\nhttps://github.com/PowerShell/PowerShell/blob/ceef2e37e93826300d6638c0294ce7b0a5af591b/test/powershell/Language/Scripting/NativeExecution/NativeCommandProcessor.Tests.ps1#L133\r\n    - The above test also fails with message `Expected exactly {/tmp/f581d4d2-b000-43d7-8960-0c9de6081b30/TextFileTest.txt}, but got {}.` (line 210)\r\n    - https://github.com/PowerShell/PowerShell/blob/24cf0204421580b52b31213854737fdf9417963f/test/powershell/Modules/Microsoft.PowerShell.Management/Test-Connection.Tests.ps1#L31 fails with message `Expected {0}, but got {32}.` (line 46).\r\n    - https://github.com/PowerShell/PowerShell/blob/cc3ffd8349547e968c00e0b175a6abe348087b41/test/powershell/Modules/Microsoft.PowerShell.Utility/Invoke-Item.Tests.ps1#L124 fails with message `Expected {/home/ubuntu/PowerShell/src/powershell-unix/bin/Linux/netcoreapp2.1/linux-x64/publish}, but got {}.` (line 148).\r\n\r\n\r\n* On Ubuntu 17.10, all tests failing on Ubuntu18.04 fail, plus:\r\n    - https://github.com/PowerShell/PowerShell/blob/24cf0204421580b52b31213854737fdf9417963f/test/powershell/Modules/Microsoft.PowerShell.Management/Test-Connection.Tests.ps1#L150 fails with message `Expected {0}, but got {2}.` (line 154)",
      "created_at": "2018-05-03T22:36:51Z",
      "updated_at": "2018-05-03T22:37:36Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "I built a .deb the other day for Ubuntu 17.10, but it didn't work. Trying again today.",
      "created_at": "2018-05-03T22:42:00Z",
      "updated_at": "2018-05-03T22:42:00Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "Have verified a working Ubuntu 17.10 package built with this branch.\r\n\r\n(Can't attach due to size)",
      "created_at": "2018-05-04T02:56:30Z",
      "updated_at": "2018-05-04T02:56:30Z"
    },
    {
      "author": "rjmholt",
      "author_association": "COLLABORATOR",
      "body": "Also confirm that the produced Ubuntu 18.04 package works!",
      "created_at": "2018-05-04T03:32:07Z",
      "updated_at": "2018-05-04T03:32:07Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "As for Test-Connection tests I think it is mostly from .Net Core. I have no way to check on other Linux-s.",
      "created_at": "2018-05-04T08:22:22Z",
      "updated_at": "2018-05-04T08:22:22Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Fedora 27 related PR #6819.",
      "created_at": "2018-05-04T09:23:21Z",
      "updated_at": "2018-05-04T09:23:21Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@anmenaga FYI this will change the package name for ubuntu 17.10",
      "created_at": "2018-05-07T19:32:07Z",
      "updated_at": "2018-05-07T19:32:07Z"
    },
    {
      "author": "anmenaga",
      "author_association": "CONTRIBUTOR",
      "body": "@TravisEz13 good point, thx. I'll prepare PR to fix dockerfile; and looks like we need to add dockerfiles for new '18.04' config.",
      "created_at": "2018-05-07T19:35:11Z",
      "updated_at": "2018-05-07T19:39:45Z"
    },
    {
      "author": "kenk667",
      "author_association": "NONE",
      "body": "@rjmholt I may have an interim solution for installing on 18.04 without downgrading curl or libicu, I was able to successfully install on 18.04 by changing the dependencies for https://github.com/PowerShell/PowerShell/releases/download/v6.1.0-preview.2/powershell_6.1.0-preview.2-1.ubuntu.17.04_amd64.deb\r\n\r\n```bash\r\ndpkg-deb --raw-exatrct powershell_6.1.0-preview.2-1.ubuntu.17.04_amd64.deb 6.1.0_patched\r\n```\r\n\r\nThen alter two patterns, curl and libicu dependencies to current versions;\r\n\r\n```bash\r\nsudo awk '{gsub(\"curl3\",\"curl4\");gsub(\"libicu57\",\"libicu60\");print}' 6.1.0_pathched/DEBIAN/control\r\n```\r\n\r\nRepackage as a debian package;\r\n\r\n```bash\r\ndpkg-deb --build 6.1.0_pathched/ powershell_6.1.0-patched.2-1.ubuntu.18.04_amd64.deb\r\n```\r\n\r\nNow just install the newly patched .deb package, I like to use gdebi to install;\r\n\r\n```bash\r\nsudo gdebi powershell_6.1.0-patched.2-1.ubuntu.18.04_amd64.deb\r\n```\r\n\r\nI haven't extensively tested this but seems to be functional and stable so far",
      "created_at": "2018-05-16T05:44:37Z",
      "updated_at": "2018-05-16T05:44:37Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "@kenk667 The required libraries are determined by DotNet Core.  Changing the required libraries could leave you unsupported.",
      "created_at": "2018-05-17T21:56:19Z",
      "updated_at": "2018-05-17T21:56:19Z"
    }
  ],
  "created_at": "2018-04-28T19:21:18Z",
  "number": 6769,
  "state": "closed",
  "title": "Change packaging to support Ubuntu 17.10 and 18.04",
  "updated_at": "2018-06-22T22:55:42Z"
}