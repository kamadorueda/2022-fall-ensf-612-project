{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16094",
  "author": "markdomansky",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Steps to reproduce\r\n\r\nWhen trying to use the DNSServer module, in either native or Windows PowerShell compat mode, saving the results to a variable generates an error.\r\nThis occurs when remote to the DNS Server itself.  (restricted from testing locally on the server)\r\nThis does NOT occur in Windows PowerShell 5.1.  The expected behavior is produced\r\n\r\n### Expected behavior\r\n\r\n```console\r\nPS> $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname\r\nPS> $a\r\nHostName                  RecordType Type       Timestamp            TimeToLive      RecordData\r\n--------                  ---------- ----       ---------            ----------      ----------\r\n<data>\r\n\r\nPS> Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname -ov a\r\nPS> $a\r\nHostName                  RecordType Type       Timestamp            TimeToLive      RecordData\r\n--------                  ---------- ----       ---------            ----------      ----------\r\n<data>\r\n```\r\n\r\n\r\n### Actual behavior\r\n\r\n```console\r\nPS> $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname\r\nMetadataError: Cannot convert the \"System.Object[]\" value of type \"System.Object[]\" to type \"System.Net.IPAddress\".\r\n\r\nPS> Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname -ov a\r\nMetadataError: Cannot convert the \"System.Collections.ArrayList\" value of type \"System.Collections.ArrayList\" to type \"System.Net.IPAddress\".\r\n```\r\n\r\n\r\n### Error details\r\n\r\n```console\r\nPS> Get-Error #output sanitized\r\nException             : \r\n    Type           : System.Management.Automation.ArgumentTransformationMetadataException\r\n    ErrorRecord    : \r\n        Exception             : \r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Cannot convert the \"System.Object[]\" value of type \"System.Object[]\" to type \"System.Net.IPAddress\".\r\n            HResult : -2146233087\r\n        CategoryInfo          : MetadataError: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : RuntimeException\r\n        InvocationInfo        : \r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : -1\r\n            Line             : $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname\r\n            PositionMessage  : At line:1 char:1\r\n                               + $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName \u2026\r\n                               + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    TargetSite     : \r\n        Name          : Transform\r\n        DeclaringType : System.Management.Automation.ArgumentTypeConverterAttribute, System.Management.Automation, Version=7.1.4.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace     : \r\n   at System.Management.Automation.ArgumentTypeConverterAttribute.Transform(EngineIntrinsics engineIntrinsics, Object inputData, Boolean bindingParameters, Boolean bindingScriptCmdlet)\r\n   at System.Management.Automation.ArgumentTypeConverterAttribute.Transform(EngineIntrinsics engineIntrinsics, Object inputData)\r\n   at System.Management.Automation.PSVariable.TransformValue(IEnumerable`1 attributes, Object value)\r\n   at System.Management.Automation.PSVariable.SetValue(Object value)\r\n   at System.Management.Automation.VariableOps.SetVariableValue(VariablePath variablePath, Object value, ExecutionContext executionContext, AttributeBaseAst[] attributeAsts)\r\n   at System.Management.Automation.Interpreter.FuncCallInstruction`5.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n    Message        : Cannot convert the \"System.Object[]\" value of type \"System.Object[]\" to type \"System.Net.IPAddress\".\r\n    Data           : System.Collections.ListDictionaryInternal\r\n    InnerException : \r\n        Type        : System.Management.Automation.PSInvalidCastException\r\n        ErrorRecord : \r\n            Exception             : \r\n                Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n                Message : Cannot convert the \"System.Object[]\" value of type \"System.Object[]\" to type \"System.Net.IPAddress\".\r\n                HResult : -2146233087\r\n            CategoryInfo          : InvalidArgument: (:) [], ParentContainsErrorRecordException\r\n            FullyQualifiedErrorId : ConvertToFinalInvalidCastException\r\n        TargetSite  : \r\n            Name          : ThrowInvalidCastException\r\n            DeclaringType : System.Management.Automation.LanguagePrimitives\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        StackTrace  : \r\n   at System.Management.Automation.LanguagePrimitives.ThrowInvalidCastException(Object valueToConvert, Type resultType)\r\n   at System.Management.Automation.LanguagePrimitives.ConvertNoConversion(Object valueToConvert, Type resultType, Boolean recurse, PSObject originalValueToConvert, IFormatProvider formatProvider, TypeTable\r\nbackupTable)\r\n   at System.Management.Automation.LanguagePrimitives.ConversionData`1.Invoke(Object valueToConvert, Type resultType, Boolean recurse, PSObject originalValueToConvert, IFormatProvider formatProvider, TypeTable     \r\nbackupTable)\r\n   at System.Management.Automation.LanguagePrimitives.ConvertTo(Object valueToConvert, Type resultType, Boolean recursion, IFormatProvider formatProvider, TypeTable backupTypeTable)\r\n   at System.Management.Automation.ArgumentTypeConverterAttribute.Transform(EngineIntrinsics engineIntrinsics, Object inputData, Boolean bindingParameters, Boolean bindingScriptCmdlet)\r\n        Message     : Cannot convert the \"System.Object[]\" value of type \"System.Object[]\" to type \"System.Net.IPAddress\".\r\n        Source      : System.Management.Automation\r\n        HResult     : -2147467262\r\n    Source         : System.Management.Automation\r\n    HResult        : -2146233087\r\nCategoryInfo          : MetadataError: (:) [], ArgumentTransformationMetadataException\r\nFullyQualifiedErrorId : RuntimeException\r\nInvocationInfo        : \r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : -1\r\n    Line             : $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName domain.local -name hostname\r\n    PositionMessage  : At line:1 char:1\r\n                       + $a = Get-DnsServerResourceRecord -ComputerName server.domain.local -ZoneName \u2026\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n```\r\n\r\n\r\n### Environment data\r\n\r\n```powershell\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.4\r\nPSEdition                      Core\r\nGitCommitId                    7.1.4\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n![image](https://user-images.githubusercontent.com/4317290/133321431-0f46b334-edab-41a2-8596-f34268f8475c.png)\r\n",
  "closed_at": "2021-09-21T16:39:21Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Can you reproduce with latest PowerShell 7.2 preview?",
      "created_at": "2021-09-15T04:01:14Z",
      "updated_at": "2021-09-15T04:01:14Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@markdomansky For the script and results shown in the \"Actual Behavior\" section, did you have the module imported with Windows PowerShell compat mode (`-UseWindowsPowerShell`)? If so, can you also share the results when loading the module natively in pwsh with `-SkipEditionCheck`?",
      "created_at": "2021-09-16T18:25:37Z",
      "updated_at": "2021-09-16T18:25:37Z"
    },
    {
      "author": "markdomansky",
      "author_association": "NONE",
      "body": "I'm unable to reproduce on 7.1.4 or 7.2.0-p9.\r\nPatches, reboots, or something else must have resolved.  Closing.\r\nThanks.",
      "created_at": "2021-09-21T16:39:21Z",
      "updated_at": "2021-09-21T16:39:21Z"
    }
  ],
  "created_at": "2021-09-14T19:28:06Z",
  "number": 16094,
  "state": "closed",
  "title": "Get-DNSServerResoruceRecord Fails",
  "updated_at": "2021-09-21T16:39:23Z"
}