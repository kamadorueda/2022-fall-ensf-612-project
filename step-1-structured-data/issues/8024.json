{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8024",
  "author": "powercode",
  "body": "## PR Summary\r\n\r\nBy not doing excessive amounts of extra work, formatting can be sped up quite significantly. \r\n\r\nThe main change comes from adding new, more efficient, primitive to query an object for it's instance members. \r\n\r\nThe formatting system has been checking for properties by retrieving all properties, and then determined whether a set of properties has been among them.\r\n\r\nThat enables early exit and for example responding with a bool instead of a set of objects, which reduces allocations and wastes less cycles. \r\n\r\nTest script:\r\n```\r\n$files = gci -ea:0 c:\\windows -Recurse -File\r\n$files | format-table Name, LastAccessTime, Length | out-null\r\n```\r\nversion| time | speedup\r\n--------|------|---------\r\n6.1| 32.47s | 1.0x\r\nPR 8024 |  ~~6.70s~~ 4.2s   | ~~4.8x~~ 8x\r\n\r\n\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [ ] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [x] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2019-01-29T15:53:32Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@powercode Could you please share performance test scripts and results?",
      "created_at": "2018-10-15T05:20:38Z",
      "updated_at": "2018-10-15T05:20:38Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "@iSazonov I updated the description in the PR.",
      "created_at": "2018-10-17T21:45:39Z",
      "updated_at": "2018-10-17T21:45:39Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-11-20T21:05:52Z",
      "updated_at": "2018-11-20T21:05:52Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "Pinging to keep alive",
      "created_at": "2018-11-27T08:34:54Z",
      "updated_at": "2018-11-27T08:34:54Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Very desirable PR. :-)",
      "created_at": "2018-11-27T09:04:47Z",
      "updated_at": "2018-11-27T09:04:47Z"
    },
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2018-12-27T11:55:18Z",
      "updated_at": "2018-12-27T11:55:18Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Oh, @powercode Could you please rebase to resolve merge conflits? Feel free to move to new PR if it is easy for you.\r\nI hope you continue this useful contribution!",
      "created_at": "2019-01-18T04:13:48Z",
      "updated_at": "2019-03-18T12:29:23Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "I'm on it. Just ran out of midnight oil \ud83d\ude0a",
      "created_at": "2019-01-18T07:25:24Z",
      "updated_at": "2019-01-18T07:25:24Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "I found a much simpler way to achieve the same result, that also was faster, so I force pushed the new version.\r\n\r\nSorry for the force/push, but this requires a new review :(",
      "created_at": "2019-01-29T15:15:04Z",
      "updated_at": "2019-01-29T15:15:04Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "The CodeFactor is so noisy that I'm just going to ignore it.",
      "created_at": "2019-01-29T15:26:29Z",
      "updated_at": "2019-01-29T15:26:29Z"
    },
    {
      "author": "powercode",
      "author_association": "COLLABORATOR",
      "body": "Closing this and reopening in new PR.",
      "created_at": "2019-01-29T15:53:32Z",
      "updated_at": "2019-01-29T15:53:32Z"
    }
  ],
  "created_at": "2018-10-14T18:10:10Z",
  "number": 8024,
  "state": "closed",
  "title": "Adding predicated instance member access to psobject to speed up formatting.",
  "updated_at": "2019-03-18T12:29:24Z"
}