{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16275",
  "author": "daxian-dbw",
  "body": "### Prerequisites\r\n\r\n- [X] Write a descriptive title.\r\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- [X] Search the existing issues.\r\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\r\n\r\n### Steps to reproduce\r\n\r\nThis was originally reported in https://github.com/PowerShell/PSReadLine/issues/2923 by @HumanEquivalentUnit \r\n\r\nRun the following script in pwsh:\r\n```powershell\r\n[System.Management.Automation.Language.Parser]::ParseInput('[int[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]', [ref]$null, [ref]$null)\r\n```\r\n\r\n### Expected behavior\r\n\r\n```console\r\nNo exception thrown from `Parser.ParseInput`\r\n```\r\n\r\n\r\n### Actual behavior\r\n\r\n```console\r\nPS:3> $a = [System.Management.Automation.Language.Parser]::ParseInput('[int[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]', [ref]$null, [ref]$null)\r\nMethodInvocationException: Exception calling \"ParseInput\" with \"3\" argument(s): \"Unrecoverable error in PowerShell.\"\r\n```\r\n\r\n\r\n### Error details\r\n\r\n```console\r\nPS:4> Get-Error\r\n\r\nException             :\r\n    Type           : System.Management.Automation.MethodInvocationException\r\n    ErrorRecord    :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Exception calling \"ParseInput\" with \"3\" argument(s): \"Unrecoverable error in PowerShell.\"\r\n            HResult : -2146233087\r\n        CategoryInfo          : NotSpecified: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : ParseException\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : -1\r\n            Line             : $a = [System.Management.Automation.Language.Parser]::ParseInput('[int[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]',\r\n[ref]$null, [ref]$null)\r\n            PositionMessage  : At line:1 char:1\r\n                               + $a = [System.Management.Automation.Language.Parser]::ParseInput('[int \u2026\r\n                               + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    TargetSite     :\r\n        Name          : ConvertToMethodInvocationException\r\n        DeclaringType : System.Management.Automation.ExceptionHandlingOps, System.Management.Automation, Version=7.1.3.0, Culture=neutral,\r\nPublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace     :\r\n   at System.Management.Automation.ExceptionHandlingOps.ConvertToMethodInvocationException(Exception exception, Type typeToThrow, String methodName,\r\nInt32 numArgs, MemberInfo memberInfo)\r\n   at CallSite.Target(Closure , CallSite , Type , String , PSReference , PSReference )\r\n   at System.Dynamic.UpdateDelegates.UpdateAndExecute4[T0,T1,T2,T3,TRet](CallSite site, T0 arg0, T1 arg1, T2 arg2, T3 arg3)\r\n   at System.Management.Automation.Interpreter.DynamicInstruction`5.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n    Message        : Exception calling \"ParseInput\" with \"3\" argument(s): \"Unrecoverable error in PowerShell.\"\r\n    Data           : System.Collections.ListDictionaryInternal\r\n    InnerException :\r\n        Type           : System.Management.Automation.ParseException\r\n        Message        : Unrecoverable error in PowerShell.\r\n        ErrorRecord    :\r\n            Exception             :\r\n                Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n                Message : Unrecoverable error in PowerShell.\r\n                HResult : -2146233087\r\n            CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException\r\n            FullyQualifiedErrorId : Parse\r\n        TargetSite     :\r\n            Name          : ParseInput\r\n            DeclaringType : System.Management.Automation.Language.Parser\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        StackTrace     :\r\n   at System.Management.Automation.Language.Parser.ParseInput(String input, String fileName, Token[]& tokens, ParseError[]& errors)\r\n   at CallSite.Target(Closure , CallSite , Type , String , PSReference , PSReference )\r\n        InnerException :\r\n            Type       : System.TypeLoadException\r\n            Message    : 'System.Int32[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]' from assembly 'System.Private.CoreLib, Version=5.0.0.0, Culture=neutral,\r\nPublicKeyToken=7cec85d7bea7798e' has too many dimensions.\r\n            TypeName   : System.Int32[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]\r\n            TargetSite :\r\n                Name          : MakeArray\r\n                DeclaringType : System.RuntimeTypeHandle\r\n                MemberType    : Method\r\n                Module        : System.Private.CoreLib.dll\r\n            StackTrace :\r\n   at System.RuntimeTypeHandle.MakeArray(Int32 rank)\r\n   at System.RuntimeType.MakeArrayType(Int32 rank)\r\n   at System.Management.Automation.Language.ArrayTypeName.GetReflectionType()\r\n   at System.Management.Automation.Language.SymbolResolver.VisitArrayTypeName(ArrayTypeName arrayTypeName)\r\n   at System.Management.Automation.Language.SymbolResolver.VisitTypeExpression(TypeExpressionAst typeExpressionAst)\r\n   at System.Management.Automation.Language.TypeExpressionAst.InternalVisit(AstVisitor visitor)\r\n   at System.Management.Automation.Language.CommandExpressionAst.InternalVisit(AstVisitor visitor)\r\n   at System.Management.Automation.Language.PipelineAst.InternalVisit(AstVisitor visitor)\r\n   at System.Management.Automation.Language.StatementBlockAst.InternalVisit(AstVisitor visitor, ReadOnlyCollection`1 traps, ReadOnlyCollection`1\r\nstatements, AstVisitAction action)\r\n   at System.Management.Automation.Language.NamedBlockAst.InternalVisit(AstVisitor visitor)\r\n   at System.Management.Automation.Language.ScriptBlockAst.InternalVisit(AstVisitor visitor)\r\n   at System.Management.Automation.Language.Ast.Visit(AstVisitor astVisitor)\r\n   at System.Management.Automation.Language.SymbolResolver.ResolveSymbols(Parser parser, ScriptBlockAst scriptBlockAst)\r\n   at System.Management.Automation.Language.ScriptBlockAst.PerformPostParseChecks(Parser parser)\r\n   at System.Management.Automation.Language.Parser.ParseTask(String fileName, String input, List`1 tokenList, Boolean recursed, ParseMode parseMode)\r\n   at System.Management.Automation.Language.Parser.Parse(String fileName, String input, List`1 tokenList, ParseError[]& errors, ParseMode parseMode)\r\n   at System.Management.Automation.Language.Parser.ParseInput(String input, String fileName, Token[]& tokens, ParseError[]& errors)\r\n            Source     : System.Private.CoreLib\r\n            HResult    : -2146233054\r\n        Source         : System.Management.Automation\r\n        HResult        : -2146233087\r\n    Source         : System.Management.Automation\r\n    HResult        : -2146233087\r\nCategoryInfo          : NotSpecified: (:) [], MethodInvocationException\r\nFullyQualifiedErrorId : ParseException\r\nInvocationInfo        :\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : -1\r\n    Line             : $a = [System.Management.Automation.Language.Parser]::ParseInput('[int[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]', [ref]$null,\r\n[ref]$null)\r\n    PositionMessage  : At line:1 char:1\r\n                       + $a = [System.Management.Automation.Language.Parser]::ParseInput('[int \u2026\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n```\r\n\r\n\r\n### Environment data\r\n\r\n```powershell\r\nPS:3> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.0-preview.10\r\nPSEdition                      Core\r\nGitCommitId                    7.2.0-preview.10\r\nOS                             Microsoft Windows 10.0.19043\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n\r\n### Visuals\r\n\r\n_No response_",
  "closed_at": "2021-10-29T03:16:26Z",
  "comments": [
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:This issue was addressed in #16276, which has now been successfully released as `v7.3.0-preview.1`.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.3.0-preview.1)\n",
      "created_at": "2021-12-16T20:01:27Z",
      "updated_at": "2021-12-16T20:01:27Z"
    }
  ],
  "created_at": "2021-10-19T20:11:34Z",
  "labels": [
    "Issue-Bug",
    "WG-Engine",
    "Resolution-Fixed"
  ],
  "number": 16275,
  "state": "closed",
  "title": "Parsing an array with too many dimensions throws exception",
  "updated_at": "2021-12-16T20:01:27Z"
}