{
  "_url": "https://github.com/PowerShell/PowerShell/issues/15289",
  "author": "mklement0",
  "body": "Note: The common denominator here is invocation of scripts implicitly _via WSH_ (Windows Scripting Host, `cscript.exe` and `wscript.exe`), which therefore equally affects VBScript and JScript script files.\r\n\r\n## Steps to reproduce\r\n\r\nOn Windows, assuming that experimental feature `PSNativeCommandArgumentPassing` is enabled (and `$PSNativeCommandArgumentPassing` is set to `'Standard'`):\r\n\r\n```powershell\r\n# Switch to a temporary directory.\r\nPush-Location -ea Stop ($tmpDir = (New-Item -Type Directory -Force (Join-Path Temp:/ $PID)).FullName)\r\n\r\ntry {\r\n\r\n  'Wscript.Echo(\"hi\")' > t.vbs\r\n  { ./t.vbs foo  } | Should -Not -Throw\r\n\r\n} finally {\r\n  # Clean up.\r\n  Pop-Location; Remove-Item $tmpDir -Recurse\r\n}\r\n```\r\n\r\n## Expected behavior\r\n\r\nThe test should pass.\r\n\r\n## Actual behavior\r\n\r\nThe test fails with the following error:\r\n\r\n```none\r\nExpected no exception to be thrown, but an exception \"\r\nProgram 't.vbs' failed to run:  Only one of Arguments or ArgumentList may be used. ...\r\n\" was thrown.\r\n```\r\n\r\nIn versions prior to PowerShell Core 7.2.0-preview.5 (and with `$PSNativeCommandArgumentPassing= 'Legacy'`), the test passes.\r\n\r\n## Environment data\r\n\r\n```none\r\nPowerShell Core 7.2.0-preview.5\r\n```\r\n",
  "closed_at": null,
  "comments": [
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@mklement0 good find.  Here's the stack trace:\r\n\r\n```console\r\nPS> gerr\r\n\r\nException             :\r\n    Type           : System.Management.Automation.ApplicationFailedException\r\n    ErrorRecord    :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Program 't.vbs' failed to run: Only one of Arguments or ArgumentList may be used.At line:1 char:1\r\n                      + .\\t.vbs foo\r\n                      + ~~~~~~~~~~~.\r\n            HResult : -2146233087\r\n        CategoryInfo          : ResourceUnavailable: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : NativeCommandFailed\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : -1\r\n            Line             : .\\t.vbs foo\r\n            PositionMessage  : At line:1 char:1\r\n                               + .\\t.vbs foo\r\n                               + ~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    TargetSite     :\r\n        Name          : InitNativeProcess\r\n        DeclaringType : System.Management.Automation.NativeCommandProcessor, System.Management.Automation,\r\nVersion=7.2.0.5, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace     :\r\n   at System.Management.Automation.NativeCommandProcessor.InitNativeProcess()\r\n   at System.Management.Automation.NativeCommandProcessor.Prepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.CommandProcessorBase.DoPrepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.Internal.PipelineProcessor.Start(Boolean incomingStream)\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n--- End of stack trace from previous location ---\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n   at System.Management.Automation.PipelineOps.InvokePipeline(Object input, Boolean ignoreInput,\r\nCommandParameterInternal[][] pipeElements, CommandBaseAst[] pipeElementAsts, CommandRedirection[][] commandRedirections,\r\nFunctionContext funcContext)\r\n   at System.Management.Automation.Interpreter.ActionCallInstruction`6.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n    Message        : Program 't.vbs' failed to run: Only one of Arguments or ArgumentList may be used.At line:1 char:1\r\n                     + .\\t.vbs foo\r\n                     + ~~~~~~~~~~~.\r\n    Data           : System.Collections.ListDictionaryInternal\r\n    InnerException :\r\n        Type       : System.InvalidOperationException\r\n        TargetSite :\r\n            Name          : Start\r\n            DeclaringType : System.Diagnostics.Process\r\n            MemberType    : Method\r\n            Module        : System.Diagnostics.Process.dll\r\n        StackTrace :\r\n   at System.Diagnostics.Process.Start()\r\n   at System.Management.Automation.NativeCommandProcessor.InitNativeProcess()\r\n        Message    : Only one of Arguments or ArgumentList may be used.\r\n        Source     : System.Diagnostics.Process\r\n        HResult    : -2146233079\r\n    Source         : System.Management.Automation\r\n    HResult        : -2146233087\r\nCategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException\r\nFullyQualifiedErrorId : NativeCommandFailed\r\nInvocationInfo        :\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : -1\r\n    Line             : .\\t.vbs foo\r\n    PositionMessage  : At line:1 char:1\r\n                       + .\\t.vbs foo\r\n                       + ~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n```",
      "created_at": "2021-04-22T01:27:14Z",
      "updated_at": "2021-04-22T01:27:14Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "/cc @JamesWTruher for insight.",
      "created_at": "2021-05-03T23:24:01Z",
      "updated_at": "2021-05-03T23:24:01Z"
    },
    {
      "author": "End-of-Eternity",
      "author_association": "NONE",
      "body": "I've also encountered this issue when running python scripts directly.\r\nFor example `test.py someargs` will throw the error \r\n```powershell\r\nResourceUnavailable: Program 'test.py' failed to run: Only one of Arguments or ArgumentList may be used.At line:1 char:1\r\n```\r\n\r\nStack trace:\r\n```powershell\r\nException             :\r\n    Type           : System.Management.Automation.ApplicationFailedException\r\n    ErrorRecord    :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Program 'test.py' failed to run: Only one of Arguments or ArgumentList may be used.At line:1 char:1\r\n                      + ./test.py someargs\r\n                      + ~~~~~~~~~~~~~~~~~~.\r\n            HResult : -2146233087\r\n        CategoryInfo          : ResourceUnavailable: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : NativeCommandFailed\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 1\r\n            OffsetInLine     : 1\r\n            HistoryId        : -1\r\n            Line             : ./test.py someargs\r\n            PositionMessage  : At line:1 char:1\r\n                               + ./test.py someargs\r\n                               + ~~~~~~~~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n    TargetSite     :\r\n        Name          : InitNativeProcess\r\n        DeclaringType : System.Management.Automation.NativeCommandProcessor, System.Management.Automation, Version=7.2.0.5, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace     :\r\n   at System.Management.Automation.NativeCommandProcessor.InitNativeProcess()\r\n   at System.Management.Automation.NativeCommandProcessor.Prepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.CommandProcessorBase.DoPrepare(IDictionary psDefaultParameterValues)\r\n   at System.Management.Automation.Internal.PipelineProcessor.Start(Boolean incomingStream)\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n--- End of stack trace from previous location ---\r\n   at System.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(Object input)\r\n   at System.Management.Automation.PipelineOps.InvokePipeline(Object input, Boolean ignoreInput, CommandParameterInternal[][] pipeElements, CommandBaseAst[] pipeElementAsts, CommandRedirection[][] commandRedirections, FunctionContext\r\nfuncContext)\r\n   at System.Management.Automation.Interpreter.ActionCallInstruction`6.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n    Message        : Program 'test.py' failed to run: Only one of Arguments or ArgumentList may be used.At line:1 char:1\r\n                     + ./test.py someargs\r\n                     + ~~~~~~~~~~~~~~~~~~.\r\n    Data           : System.Collections.ListDictionaryInternal\r\n    InnerException :\r\n        Type       : System.InvalidOperationException\r\n        TargetSite :\r\n            Name          : Start\r\n            DeclaringType : System.Diagnostics.Process\r\n            MemberType    : Method\r\n            Module        : System.Diagnostics.Process.dll\r\n        StackTrace :\r\n   at System.Diagnostics.Process.Start()\r\n   at System.Management.Automation.NativeCommandProcessor.InitNativeProcess()\r\n        Message    : Only one of Arguments or ArgumentList may be used.\r\n        Source     : System.Diagnostics.Process\r\n        HResult    : -2146233079\r\n    Source         : System.Management.Automation\r\n    HResult        : -2146233087\r\nCategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException\r\nFullyQualifiedErrorId : NativeCommandFailed\r\nInvocationInfo        :\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : -1\r\n    Line             : ./test.py someargs\r\n    PositionMessage  : At line:1 char:1\r\n                       + ./test.py someargs\r\n                       + ~~~~~~~~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\n```\r\n\r\nEdit: I should mention that this issue is fixed when setting `$PSNativeCommandArgumentPassing=\"Standard\"`",
      "created_at": "2021-05-25T18:12:53Z",
      "updated_at": "2021-05-25T18:14:06Z"
    },
    {
      "author": "JamesWTruher",
      "author_association": "MEMBER",
      "body": "yep - this is a bug for which I have a fix",
      "created_at": "2021-05-27T23:18:04Z",
      "updated_at": "2021-05-27T23:18:04Z"
    },
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "@JamesWTruher any chance we can get your fix in for this any time soon?",
      "created_at": "2022-05-18T00:46:06Z",
      "updated_at": "2022-05-18T00:46:06Z"
    }
  ],
  "created_at": "2021-04-21T23:14:10Z",
  "labels": [
    "Issue-Bug",
    "WG-Engine-ParameterBinder"
  ],
  "number": 15289,
  "state": "open",
  "title": "Experimental feature PSNativeCommandArgumentPassing breaks invocation of WSH scripts (VBScript, JScript) with arguments",
  "updated_at": "2022-05-18T00:46:06Z"
}