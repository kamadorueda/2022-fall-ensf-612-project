{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16748",
  "author": "sebandraos",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\n- [ ] Open Windows Terminal with Powershell 7.2.1 set as the default profile\r\n- [ ] As it loads the exception occurs and prints the above error message(s)\n\n### Expected behavior\n\n```console\nThe console should allow me to run commands without throwing exceptions. (Not very helpful, I know but as mentioned below it is otherwise pretty much functional)\n```\n\n\n### Actual behavior\n\n```console\nThe terminal is still functional but the exception occurs and prints an error message every time a new line is ready to be typed into. See image 2 below. The exception also occurs if I press tab whilst typing a line. Continuation of the previous screenshot with input \"cd s[tab].\n```\n\n\n### Error details\n\n```console\nGet-Error\r\n\r\nException             :\r\n    Type           : System.Management.Automation.MethodInvocationException\r\n    ErrorRecord    :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Exception calling \"ReadLine\" with \"2\" argument(s): \"Could not load type\r\n'System.Management.Automation.Subsystem.PredictionResult' from assembly 'Microsoft.PowerShell.PSReadLine.Polyfiller,\r\nVersion=1.0.0.0, Culture=neutral, PublicKeyToken=null'.\"\r\n            HResult : -2146233087\r\n        CategoryInfo          : NotSpecified: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : TypeLoadException\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 4\r\n            OffsetInLine     : 5\r\n            HistoryId        : -1\r\n            ScriptName       : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1\r\n            Line             : [Microsoft.PowerShell.PSConsoleReadLine]::ReadLine($host.Runspace, $ExecutionContext)\r\n\r\n            PositionMessage  : At C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1:4 char:5\r\n                               +     [Microsoft.PowerShell.PSConsoleReadLine]::ReadLine($host.Runspace \u2026\r\n                               +     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n            PSScriptRoot     : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\r\n            PSCommandPath    : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at PSConsoleHostReadLine,\r\nC:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1: line 4\r\n    TargetSite     :\r\n        Name          : ConvertToMethodInvocationException\r\n        DeclaringType : System.Management.Automation.ExceptionHandlingOps, System.Management.Automation,\r\nVersion=7.2.1.500, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    Message        : Exception calling \"ReadLine\" with \"2\" argument(s): \"Could not load type\r\n'System.Management.Automation.Subsystem.PredictionResult' from assembly 'Microsoft.PowerShell.PSReadLine.Polyfiller,\r\nVersion=1.0.0.0, Culture=neutral, PublicKeyToken=null'.\"\r\n    Data           : System.Collections.ListDictionaryInternal\r\n    InnerException :\r\n        Type       : System.TypeLoadException\r\n        Message    : Could not load type 'System.Management.Automation.Subsystem.PredictionResult' from assembly\r\n'Microsoft.PowerShell.PSReadLine.Polyfiller, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null'.\r\n        TypeName   : System.Management.Automation.Subsystem.PredictionResult\r\n        TargetSite :\r\n            Name          : Reset\r\n            DeclaringType : Microsoft.PowerShell.PSConsoleReadLine+PredictionViewBase,\r\nMicrosoft.PowerShell.PSReadLine2, Version=2.2.0.0, Culture=neutral, PublicKeyToken=null\r\n            MemberType    : Method\r\n            Module        : Microsoft.PowerShell.PSReadLine2.dll\r\n        Source     : Microsoft.PowerShell.PSReadLine2\r\n        HResult    : -2146233054\r\n        StackTrace :\r\n   at Microsoft.PowerShell.PSConsoleReadLine.PredictionViewBase.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.PredictionInlineView.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.Prediction.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.Initialize(Runspace runspace, EngineIntrinsics engineIntrinsics)\r\n   at Microsoft.PowerShell.PSConsoleReadLine.ReadLine(Runspace runspace, EngineIntrinsics engineIntrinsics,\r\nCancellationToken cancellationToken)\r\n   at Microsoft.PowerShell.PSConsoleReadLine.ReadLine(Runspace runspace, EngineIntrinsics engineIntrinsics)\r\n   at CallSite.Target(Closure , CallSite , Type , Object , Object )\r\n    Source         : System.Management.Automation\r\n    HResult        : -2146233087\r\n    StackTrace     :\r\n   at System.Management.Automation.ExceptionHandlingOps.ConvertToMethodInvocationException(Exception exception, Type\r\ntypeToThrow, String methodName, Int32 numArgs, MemberInfo memberInfo)\r\n   at CallSite.Target(Closure , CallSite , Type , Object , Object )\r\n   at System.Management.Automation.Interpreter.DynamicInstruction`4.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\nCategoryInfo          : NotSpecified: (:) [], MethodInvocationException\r\nFullyQualifiedErrorId : TypeLoadException\r\nInvocationInfo        :\r\n    ScriptLineNumber : 4\r\n    OffsetInLine     : 5\r\n    HistoryId        : -1\r\n    ScriptName       : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1\r\n    Line             : [Microsoft.PowerShell.PSConsoleReadLine]::ReadLine($host.Runspace, $ExecutionContext)\r\n\r\n    PositionMessage  : At C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1:4 char:5\r\n                       +     [Microsoft.PowerShell.PSConsoleReadLine]::ReadLine($host.Runspace \u2026\r\n                       +     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    PSScriptRoot     : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\r\n    PSCommandPath    : C:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at PSConsoleHostReadLine,\r\nC:\\Users\\seban\\Documents\\PowerShell\\Modules\\PSReadLine\\2.2.0\\PSReadLine.psm1: line 4\r\n\r\n\r\n_________________________________________________\r\n\r\nLast 0 Keys\r\n\r\n\r\n```\r\n\r\n### Exception\r\n```\r\nSystem.TypeLoadException: Could not load type 'System.Management.Automation.Subsystem.PredictionResult' from assembly 'Microsoft.PowerShell.PSReadLine.Polyfiller, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null'.\r\n   at Microsoft.PowerShell.PSConsoleReadLine.PredictionViewBase.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.PredictionInlineView.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.Prediction.Reset()\r\n   at Microsoft.PowerShell.PSConsoleReadLine.Initialize(Runspace runspace, EngineIntrinsics engineIntrinsics)\r\n   at Microsoft.PowerShell.PSConsoleReadLine.ReadLine(Runspace runspace, EngineIntrinsics engineIntrinsics, CancellationToken cancellationToken)\r\n```\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.1\r\nPSEdition                      Core\r\nGitCommitId                    7.2.1\r\nOS                             Microsoft Windows 10.0.22000\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n\r\nPSReadLine: 2.2.0-beta1\r\nPowerShell: 7.2.1\r\nOS: Microsoft Windows 10.0.22000\r\nBufferWidth: 120\r\nBufferHeight: 30\n```\n\n\n### Visuals\n\n1. Upon Opening\r\n![image](https://user-images.githubusercontent.com/6084391/149505195-da896d5a-b6f2-4539-8aca-2addf3c062a8.png)\r\n\r\n2. After \"cd ..\"\r\n![image](https://user-images.githubusercontent.com/6084391/149506061-55ec343a-c838-42a3-b377-55dbb2e8b9cc.png)\r\n\r\n3. After \"cd s[tab]\"\r\n![image](https://user-images.githubusercontent.com/6084391/149506358-2717c40d-2b7c-42e9-ba80-88efa418cc8e.png)\r\n",
  "closed_at": "2022-01-14T13:04:27Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@sebandraos Please install latest PSReadline version.",
      "created_at": "2022-01-14T12:00:41Z",
      "updated_at": "2022-01-14T12:00:41Z"
    },
    {
      "author": "sebandraos",
      "author_association": "NONE",
      "body": "Thank you @iSazonov , I actually downgraded PSReadLine to latest stable 2.1.0 and it's all good again. I don't recall upgrading PSReadLine to the prerelease version manually so maybe it's included in the 7.2.1 release of PowerShell. Either way, I'm back up and running so thanks again.",
      "created_at": "2022-01-14T13:04:27Z",
      "updated_at": "2022-01-14T13:04:27Z"
    }
  ],
  "created_at": "2022-01-14T11:51:12Z",
  "labels": [
    "Issue-Question",
    "Resolution-Answered"
  ],
  "number": 16748,
  "state": "closed",
  "title": "PredictionResult Type Load Exception on starting PS in Windows Terminal",
  "updated_at": "2022-01-14T13:04:29Z"
}