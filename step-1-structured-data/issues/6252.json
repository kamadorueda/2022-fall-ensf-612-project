{
  "_url": "https://github.com/PowerShell/PowerShell/issues/6252",
  "author": "daxian-dbw",
  "body": "## PR Summary\r\n\r\nAfter switching to Pester 4.3.1, the format of redirected output when running tests with `runas.exe /trustlevel:0x20000 pwsh ...` is changed, which causes `Write-Terse` to write out the elapsed time for each test case. As a result, the test-run log for AppVeyor builds is super long and rendering it in the browser takes a long time. See the screenshot below:\r\n\r\n![image](https://user-images.githubusercontent.com/127450/36702476-19fbe42c-1b0c-11e8-916b-869a51557b87.png)\r\n\r\n\r\nBefore switching to Pester 4.3.1\r\n```\r\nExecuting script F:\\tmp\\temp\\abc.tests.ps1\r\n\r\n  Describing abc\r\n    [+] it 622ms\r\nTests completed in 622ms\r\nTests Passed: 1, Failed: 0, Skipped: 0, Pending: 0, Inconclusive: 0\r\n```\r\nAfter switching to Pester 4.3.1.\r\n```\r\nPS> runas.exe /trustlevel:0x20000 \"f:\\pscore\\pwsh.exe -noprofile -c invoke-pester F:\\tmp\\temp *> f:\\outputbuff\"\r\n\r\nExecuting script F:\\tmp\\temp\\abc.tests.ps1\r\n\r\n  Describing abc\r\n    [+] it\r\n453ms\r\nTests completed in 453ms\r\nTests Passed: 1,\r\nFailed: 0,\r\nSkipped: 0,\r\nPending: 0,\r\nInconclusive: 0\r\n```\r\nThe fix is to skip the elapsed time for each test run.\r\nThe RegEx pattern used to identify test-run time elapse is `\"^\\d+(\\.\\d+)?m?s$\"`.\r\n```\r\nPS:131> $pattern = \"^\\d+(\\.\\d+)?m?s$\"\r\nPS:132> \"1ms\" -match $pattern\r\nTrue\r\nPS:133> \"12ms\" -match $pattern\r\nTrue\r\nPS:134> \"12s\" -match $pattern\r\nTrue\r\nPS:135> \"1s\" -match $pattern\r\nTrue\r\nPS:137> \"1.1s\" -match $pattern\r\nTrue\r\nPS:138> \"1.15s\" -match $pattern\r\nTrue\r\nPS:139> \"12.15s\" -match $pattern\r\nTrue\r\n```\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-02-27T00:57:28Z",
  "comments": [],
  "created_at": "2018-02-26T23:30:02Z",
  "number": 6252,
  "state": "closed",
  "title": "Fix the terse output on Windows for unelevated test run",
  "updated_at": "2018-02-27T00:58:00Z"
}