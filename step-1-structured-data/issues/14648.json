{
  "_url": "https://github.com/PowerShell/PowerShell/issues/14648",
  "author": "doctordns",
  "body": "This appears to be similar to a bug I raised in PowerShell 7 (which was fixed). It coujld always be my errors, but I can not get JEA to  either register a new session configuration, and it doesn't work in any case:\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\n# 1. Creating a role capabilities file\r\n$RCF = Join-Path -Path $JEACF -ChildPath \"DnsAdmins.psrc\"\r\n$RCHT = @{\r\n  Path            = $RCF\r\n  Author          = 'Reskit Administration'\r\n  CompanyName     = 'Reskit.Org' \r\n  Description     = 'DnsAdminsJEA role capabilities'\r\n  AliasDefinition = @{Name='gh';Value='Get-Help'}\r\n  ModulesToImport = 'Microsoft.PowerShell.Core','DnsServer'\r\n  VisibleCmdlets  = (@{ Name       = \"*-Service\"; \r\n                        Parameters = @{Name = \"DNS\"}},                  \r\n                     @{ Name       = \"Restart-Computer\"; \r\n                        Parameters = @{Name = \"ComputerName\"}\r\n                        ValidateSet = 'DC1, DC2'},\r\n                       'DNSSERVER\\*')\r\n  VisibleExternalCommands = ('C:\\Windows\\System32\\whoami.exe',\r\n                             'C:\\Windows\\System32\\ipconfig.exe')\r\n  VisibleFunctions = 'Get-HW'\r\n  FunctionDefinitions = @{\r\n    Name = 'Get-HW'\r\n    Scriptblock = {'Hello JEA World'}}\r\n}\r\nNew-PSRoleCapabilityFile @RCHT \r\n\r\n# 2. Creating a JEA session configuration file\r\n$P   = Join-Path -Path $SCF -ChildPath 'DnsAdmins.pssc'\r\n$RDHT = @{\r\n  'DnsAdminsJEA' = \r\n      @{'RoleCapabilityFiles' = \r\n        'C:\\JEACapabilities\\DnsAdmins.psrc'}\r\n}\r\n$PSCHT= @{\r\n  Author              = 'DoctorDNS@Gmail.Com'\r\n  Description         = 'Session Definition for DnsAdminsJEA'\r\n  SessionType         = 'RestrictedRemoteServer'   # ie JEA!\r\n  Path                = $P       # Role Capabilties file\r\n  RunAsVirtualAccount = $true\r\n  TranscriptDirectory = 'C:\\JeaTranscripts'\r\n  RoleDefinitions     = $RDHT     # DnsAdminsJEA role mapping\r\n}\r\nNew-PSSessionConfigurationFile @PSCHT\r\n\r\n# 3. Testing the session configuration file\r\nTest-PSSessionConfigurationFile -Path $P \r\n\r\n# 4. Registering the JEA Session Definition\r\n$SCHT = @{\r\n  Path  = $P\r\n  Name  = 'DnsAdminsJEA' \r\n  Force =  $true \r\n}\r\nRegister-PSSessionConfiguration @SCHT \r\n\r\n# 5. Verifying what the user can do\r\nGet-PSSessionCapability -ConfigurationName DnsAdminsJEA -Username 'Reskit\\JerryG' |\r\n  Sort-Object -Property Module\r\n```\r\n\r\n## Expected behavior\r\n\r\nI expected step 4 to register a new session configuration and for Step 5 to reflect what I specified in step 1.\r\n\r\n\r\n## Actual behavior\r\n\r\nSteps 1-3 work as expected, but steps 4 amd 5 fail\r\n```console\r\n# step 4...\r\nPS C:\\Foo> Register-PSSessionConfiguration @SCHT\r\nRegister-PSSessionConfiguration: Could not grant remote access to 'RKDnsAdminsJEA': 'Some or all identity references could not be translated.'. The session configuration has been registered, but this group does not have access. To resolve this error, provide a valid group name and register the session configuration again.\r\n```\r\n\r\n```console\r\n# in step 5\r\n\r\nPS C:\\Foo>Get-PSSessionCapability -ConfigurationName DnsAdminsJEA -Username 'Reskit\\JerryG' |\r\n  Sort-Object -Property Module\r\n\r\nCommandType     Name                                               Version    Source\r\n-----------     ----                                               -------    ------\r\nAlias           clear -> Clear-Host\r\nAlias           cls -> Clear-Host\r\nAlias           exsn -> Exit-PSSession\r\nAlias           gcm -> Get-Command\r\nAlias           measure -> Measure-Object\r\nAlias           select -> Select-Object\r\nFunction        Clear-Host\r\nFunction        Exit-PSSession\r\nFunction        Get-Command\r\nFunction        Get-FormatData\r\nFunction        Get-Help\r\nFunction        Measure-Object\r\nFunction        Out-Default\r\nFunction        Select-Object\r\n```\r\n\r\n```\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nPS C:\\JEACapabilities> $PSVersionTable\r\n\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.1\r\nPSEdition                      Core\r\nGitCommitId                    7.1.1\r\nOS                             Microsoft Windows 10.0.20270\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0, 5.0, 5.1.10032.0, 6.0.0, 6.1.0, 6.2.0, 7.0.0, 7.1.1}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n```\r\n",
  "closed_at": "2021-01-21T16:21:57Z",
  "comments": [
    {
      "author": "doctordns",
      "author_association": "COLLABORATOR",
      "body": "A TYPO - SOrry...",
      "created_at": "2021-01-21T16:21:57Z",
      "updated_at": "2021-01-21T16:21:57Z"
    }
  ],
  "created_at": "2021-01-21T14:51:34Z",
  "number": 14648,
  "state": "closed",
  "title": "JEA not working with PowerShell 7.1",
  "updated_at": "2021-01-22T12:48:08Z"
}