{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8237",
  "author": "iSazonov",
  "body": "## Motivation\r\n\r\nI have a PR where there are many new xUnit tests.\r\nIt would also be useful to create new xUnit tests for public APIs.\r\nThe number of xUnit tests will increase and their ordering is required.\r\n\r\n## PR Summary\r\n\r\n- Move C# xUnit tests in new folder. This allows to put new xUnit tests in directory structure in accordance with directory structure where cs files are.\r\n- Use an xUnit TestCaseOrderer attribute to sequentially process tests for `powershell.config.json`.\r\n- Update README.md\r\n- A race condition was fixed which allowed  to run all XUnit tests in single batch job.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [ ] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-11-29T05:13:33Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "New assert files coped from https://github.com/xunit/samples.xunit/blob/master/TestOrderExamples/TestCaseOrdering/PriorityOrderExamples.cs\r\nI don't know that license header to add. Maybe this? https://github.com/xunit/samples.xunit/blob/master/license.txt",
      "created_at": "2018-11-12T15:28:04Z",
      "updated_at": "2018-11-12T15:28:04Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Fixed race condition when access `powershell.config.json`\r\nhttps://ci.appveyor.com/project/PowerShell/powershell/builds/20262667/job/ta0qkiiemeyxkhyb#L644\r\n```\r\nStarting test execution, please wait...\r\n645\r\ndotnet : [xUnit.net 00:00:03.35]     PSTests.Parallel.FileSystemProviderTests.TestClearProperty [FAIL]\r\n646\r\nAt C:\\projects\\powershell\\build.psm1:1431 char:13\r\n647\r\n+             dotnet test --configuration $Options.configuration --no-r ...\r\n648\r\n+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n649\r\n    + CategoryInfo          : NotSpecified: ([xUnit.net 00:0...Property [FAIL]:String) [], RemoteException\r\n650\r\n    + FullyQualifiedErrorId : NativeCommandError\r\n651\r\n \r\n652\r\nFailed   PSTests.Parallel.FileSystemProviderTests.TestClearProperty\r\n653\r\nError Message:\r\n654\r\n System.IO.IOException : The process cannot access the file 'C:\\projects\\powershell\\test\\xUnit\\bin\\Release\\netcoreapp2.1\\powershell.config.json' because it is being used by another process.\r\n655\r\nStack Trace:\r\n656\r\n   at System.IO.FileStream.ValidateFileHandle(SafeFileHandle fileHandle)\r\n657\r\n   at System.IO.FileStream.CreateFileOpenHandle(FileMode mode, FileShare share, FileOptions options)\r\n658\r\n   at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, FileOptions options)\r\n659\r\n   at System.IO.StreamReader..ctor(String path, Encoding encoding, Boolean detectEncodingFromByteOrderMarks, Int32 bufferSize)\r\n660\r\n   at System.Management.Automation.Configuration.PowerShellConfig.ReadValueFromFile[T](ConfigScope scope, String key, T defaultValue, Func`4 readImpl) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\PSConfiguration.cs:line 358\r\n661\r\n   at System.Management.Automation.Utils.GetPolicySettingFromConfigFile[T](ConfigScope[] preferenceOrder) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\Utils.cs:line 534\r\n662\r\n   at System.Management.Automation.Utils.GetPolicySetting[T](ConfigScope[] preferenceOrder) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\Utils.cs:line 520\r\n663\r\n   at System.Management.Automation.Host.PSHostUserInterface.GetSystemTranscriptOption(TranscriptionOption currentTranscript) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\hostifaces\\MshHostUserInterface.cs:line 910\r\n664\r\n   at System.Management.Automation.Host.PSHostUserInterface.CheckSystemTranscript() in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\hostifaces\\MshHostUserInterface.cs:line 430\r\n665\r\n   at System.Management.Automation.Internal.Host.InternalHostUserInterface..ctor(PSHostUserInterface externalUI, InternalHost parentHost) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\hostifaces\\InternalHostUserInterface.cs:line 23\r\n666\r\n   at System.Management.Automation.Internal.Host.InternalHost..ctor(PSHost externalHost, ExecutionContext executionContext) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\hostifaces\\InternalHost.cs:line 51\r\n667\r\n   at System.Management.Automation.ExecutionContext.InitializeCommon(AutomationEngine engine, PSHost hostInterface) in C:\\projects\\powershell\\src\\System.Management.Automation\\engine\\ExecutionContext.cs:line 1453\r\n668\r\n   at PSTests.Parallel.FileSystemProviderTests.GetExecutionContext() in C:\\projects\\powershell\\test\\xUnit\\csharp\\test_FileSystemProvider.cs:line 45\r\n669\r\n   at PSTests.Parallel.FileSystemProviderTests.GetProvider() in C:\\projects\\powershell\\test\\xUnit\\csharp\\test_FileSystemProvider.cs:line 49\r\n670\r\n   at PSTests.Parallel.FileSystemProviderTests.TestClearProperty() in C:\\projects\\powershell\\test\\xUnit\\csharp\\test_FileSystemProvider.cs:line 151\r\n671\r\nResults File: C:\\projects\\powershell\\ParallelXUnitTestResults.xml\r\n672\r\n673\r\nTotal tests: 35. Passed: 34. Failed: 1. Skipped: 0.\r\n674\r\nTest Run Failed.\r\n675\r\n676\r\n```",
      "created_at": "2018-11-13T13:15:48Z",
      "updated_at": "2018-11-13T13:15:48Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I'll move some fixes in separate PRs. ",
      "created_at": "2018-11-13T15:41:13Z",
      "updated_at": "2018-11-13T15:41:13Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "The PR contains commits from #8249 to fix race conditions. After merging #8249 I will rebase.\r\n\r\nPlease review the PR.",
      "created_at": "2018-11-14T09:57:40Z",
      "updated_at": "2018-11-14T09:57:40Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Close and open new PR #8356",
      "created_at": "2018-11-29T05:13:33Z",
      "updated_at": "2018-11-29T05:13:33Z"
    }
  ],
  "created_at": "2018-11-12T15:23:11Z",
  "number": 8237,
  "state": "closed",
  "title": "Move xUnit tests to new folder",
  "updated_at": "2018-11-29T05:13:45Z"
}