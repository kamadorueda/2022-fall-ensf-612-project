{
  "_url": "https://github.com/PowerShell/PowerShell/issues/686",
  "author": "JumpingYang001",
  "body": "Add FileSystemProvider xUnit test for issue 120\n\n<!-- Reviewable:start -->\n\n---\n\nThis change is [<img src=\"https://reviewable.io/review_button.svg\" height=\"35\" align=\"absmiddle\" alt=\"Reviewable\"/>](https://reviewable.io/reviews/powershell/powershell/686)\n\n<!-- Reviewable:end -->\n",
  "closed_at": "2016-03-23T03:48:23Z",
  "comments": [
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@JumpingYang001 I rebased it on top of `master` now that Travis automatically runs the xUnit tests, and the test failed. You'll want to `git fetch; git checkout FileSystemProviderTest; git reset --hard origin/FileSystemProviderTest`. This will make your local branch point where GitHub's branch now points at (since I moved it by rebasing).\n",
      "created_at": "2016-03-18T02:24:24Z",
      "updated_at": "2016-03-18T02:24:24Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "@andschwa could you help to merge to master for  #686 and #687 ? thank you!\n",
      "created_at": "2016-03-18T04:30:49Z",
      "updated_at": "2016-03-18T04:30:49Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@JamesWTruher Maybe you could help out here.\n",
      "created_at": "2016-03-19T03:06:41Z",
      "updated_at": "2016-03-19T03:06:41Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "@andschwa @JamesWTruher I think our provider should include \"Environment\",\"Certificate\",\"Variable\",\"Alias\",\"Function\",\"FileSystem\",\"Registry\", but the code run out don't find the \"FileSystem\" provider, so guess if we need install or register specified provider to let provider visible for your system? Or is there something wrong with my code? thank you!\n",
      "created_at": "2016-03-21T07:11:14Z",
      "updated_at": "2016-03-21T07:11:14Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "I think I should AddProvider first, because src\\monad\\monad\\src\\engine\\SessionStateProviderAPIs.cs provider AddProvider method, how do you think?\n",
      "created_at": "2016-03-21T07:35:25Z",
      "updated_at": "2016-03-21T07:35:25Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "Init ProviderInfo success, but meet error when GetProperty()\n\nERROR:\n    PSTests.FileSystemProviderTests.TestGetProperty [FAIL]\n      System.NullReferenceException : Object reference not set to an instance of an object.\n      Stack Trace:\n           at System.Management.Automation.Provider.CmdletProvider.get_PSDriveInfo()\n           at System.Management.Automation.Provider.CmdletProvider.WrapOutputInPSObject(Object item, String path)\n           at System.Management.Automation.Provider.CmdletProvider.WriteObject(Object item, String path)\n           at System.Management.Automation.Provider.CmdletProvider.WritePropertyObject(Object propertyValue, String path)\n           at Microsoft.PowerShell.Commands.FileSystemProvider.GetProperty(String path, Collection`1 providerSpecificPickList)\n           at PSTests.FileSystemProviderTests.TestGetProperty()\n\nCode:\n\n``` sh\nusing Xunit;\nusing System;\nusing System.Collections.ObjectModel;\nusing System.Globalization;\nusing System.IO;\nusing System.Linq;\nusing System.Management.Automation;\nusing System.Management.Automation.Host;\nusing System.Management.Automation.Internal;\nusing System.Management.Automation.Internal.Host;\nusing System.Management.Automation.Provider;\nusing System.Management.Automation.Runspaces;\nusing Microsoft.PowerShell;\nusing Microsoft.PowerShell.Commands;\nusing Microsoft.PowerShell.Linux.Host;\n\nprivate static ProviderInfo GetProvider()\n        {\n            CultureInfo currentCulture = CultureInfo.CurrentCulture;\n            PSHost hostInterface =  new DefaultHost(currentCulture,currentCulture);\n            RunspaceConfiguration runspaceConfiguration =  RunspaceConfiguration.Create();\n            InitialSessionState iss = InitialSessionState.CreateDefault2();\n            AutomationEngine engine = new AutomationEngine(hostInterface, runspaceConfiguration, iss);\n            ExecutionContext executionContext = new ExecutionContext(engine, hostInterface, iss);\n            SessionStateInternal sessionState = new SessionStateInternal(executionContext);\n            SessionStateProviderEntry providerEntry = new SessionStateProviderEntry(\"FileSystem\",typeof(FileSystemProvider), null);\n            sessionState.AddSessionStateEntry(providerEntry);\n            ProviderInfo matchingProvider = sessionState.ProviderList.ToList()[0];\n\n            return matchingProvider;\n        }\n[Fact]\n        public static void TestGetProperty()\n        {\n            FileSystemProvider fileSystemProvider = new FileSystemProvider();\n            ProviderInfo providerInfoToSet = GetProvider();\n            fileSystemProvider.SetProviderInformation(providerInfoToSet);\n            fileSystemProvider.GetProperty(@\"/\", new Collection<string>(){\"Attributes\"});\n        }\n```\n",
      "created_at": "2016-03-21T08:08:36Z",
      "updated_at": "2016-03-21T08:51:16Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "I try below code it shows error:\n    PSTests.FileSystemProviderTests.TestGetProperty [FAIL]\n      System.NullReferenceException : Object reference not set to an instance of an object.\n      Stack Trace:\n           at System.Management.Automation.Provider.CmdletProvider.get_Host()\n           at Microsoft.PowerShell.Commands.FileSystemProvider.SetProperty(String path, PSObject propertyToSet)\n           at PSTests.FileSystemProviderTests.TestGetProperty()\n\nCode:\n\n``` sh\n[Fact]\n        public static void TestGetProperty()\n        {\n            string path = @\"/filesystemobject1\";\n            FileSystemProvider fileSystemProvider = new FileSystemProvider();\n            ProviderInfo providerInfoToSet = GetProvider();\n            fileSystemProvider.SetProviderInformation(providerInfoToSet);\n            FileInfo fileSystemObject1 = new FileInfo(path);\n            File.Create(path);\n            fileSystemProvider.SetProperty(path, PSObject.AsPSObject(fileSystemObject1));\n            fileSystemProvider.GetProperty(path, new Collection<string>(){\"Attributes\"});\n            File.Delete(path);\n        }\n```\n",
      "created_at": "2016-03-21T08:49:30Z",
      "updated_at": "2016-03-21T08:49:30Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "Review status: 0 of 1 files reviewed at latest revision, 2 unresolved discussions.\n\n---\n\n_[test/csharp/test_FileSystemProvider.cs, line 44 [r2]](https://reviewable.io:443/reviews/powershell/powershell/686#-KDWNKduJwegt1Jzg8F3:-KDWNKduJwegt1Jzg8F4:-562895743) ([raw file](https://github.com/powershell/powershell/blob/fb6a0dcc86b57976bf74b22d94e6efc96440d9d6/test/csharp/test_FileSystemProvider.cs#L44)):_\nLet's use `[Fact (Skip = \"Need mock\") ]` if we can.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T02:56:38Z",
      "updated_at": "2016-03-23T02:56:38Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "Review status: 0 of 1 files reviewed at latest revision, 2 unresolved discussions.\n\n---\n\n_[test/csharp/test_FileSystemProvider.cs, line 44 [r2]](https://reviewable.io:443/reviews/powershell/powershell/686#-KDWNKduJwegt1Jzg8F3:-KDWPoGGLPCaBpX4-Y1K:811378354) ([raw file](https://github.com/powershell/powershell/blob/fb6a0dcc86b57976bf74b22d94e6efc96440d9d6/test/csharp/test_FileSystemProvider.cs#L44)):_\nGot it, will update, thanks.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T03:07:23Z",
      "updated_at": "2016-03-23T03:07:23Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "@jumpingyang001 I saw the AppVeyor fail. It's because they changed their install script, but I've fixed it. You'll need to rebase this branch on master.\n\n---\n\nReview status: 0 of 1 files reviewed at latest revision, 2 unresolved discussions, some commit checks failed.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686#-:-KDWTqm0uToZhRWuAwfq:-1772935868)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T03:19:24Z",
      "updated_at": "2016-03-23T03:19:24Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "Got it, thanks. will rebase.\n\n---\n\nReview status: 0 of 1 files reviewed at latest revision, 2 unresolved discussions, some commit checks failed.\n\n---\n\n_[test/csharp/test_FileSystemProvider.cs, line 44 [r2]](https://reviewable.io:443/reviews/powershell/powershell/686#-KDWNKduJwegt1Jzg8F3:-KDWTb1PizTFqZonuYvH:-499146009) ([raw file](https://github.com/powershell/powershell/blob/fb6a0dcc86b57976bf74b22d94e6efc96440d9d6/test/csharp/test_FileSystemProvider.cs#L44)):_\nDone.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686#-:-KDWUJi1_ScR4kn3_kVT:982575023)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T03:21:33Z",
      "updated_at": "2016-03-23T03:21:33Z"
    },
    {
      "author": "JumpingYang001",
      "author_association": "CONTRIBUTOR",
      "body": "I try git fetch origin;git rebase origin/master;git pull --rebase origin master, and how do I need to do next for rebase branch on master?\n\n---\n\nReview status: 0 of 1 files reviewed at latest revision, 2 unresolved discussions, some commit checks failed.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686#-:-KDWW25FohdGnmklblcn:2112470040)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T03:30:14Z",
      "updated_at": "2016-03-23T03:30:14Z"
    },
    {
      "author": "andschwa",
      "author_association": "MEMBER",
      "body": "<img class=\"emoji\" title=\":lgtm:\" alt=\":lgtm:\" align=\"absmiddle\" src=\"https://reviewable.io/lgtm.png\" height=\"20\" width=\"61\"/>\n\n---\n\nReviewed 1 of 1 files at r3.\nReview status: all files reviewed at latest revision, 1 unresolved discussion.\n\n---\n\n_[test/csharp/test_FileSystemProvider.cs, line 44 [r2]](https://reviewable.io:443/reviews/powershell/powershell/686#-KDWNKduJwegt1Jzg8F3:-KDW_5WyD2ZngLi6Ct5r:-1369371940) ([raw file](https://github.com/powershell/powershell/blob/fb6a0dcc86b57976bf74b22d94e6efc96440d9d6/test/csharp/test_FileSystemProvider.cs#L44)):_\nFantastic, [this](https://travis-ci.com/PowerShell/PowerShell/builds/22855197#L2099) is what I wanted to see.\n\n---\n\n_Comments from the [review on Reviewable.io](https://reviewable.io:443/reviews/powershell/powershell/686#-:-KDW_LBXA41vGbuWat2x:1417088721)_\n\n<!-- Sent from Reviewable.io -->\n",
      "created_at": "2016-03-23T03:47:18Z",
      "updated_at": "2016-03-23T03:47:18Z"
    }
  ],
  "created_at": "2016-03-17T08:38:29Z",
  "number": 686,
  "state": "closed",
  "title": "Add FileSystemProvider xUnit test for issue 120",
  "updated_at": "2016-03-23T03:48:27Z"
}