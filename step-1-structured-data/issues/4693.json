{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4693",
  "author": "PaulHigin",
  "body": "This is a fix for issue #4686.\r\n\r\nI inadvertently created this regression with PR #4475.  The problem is that connection state is terminated before the session close sequence completes.  The fix is to only clean up connection state on session close if the session was never established.\r\n\r\nI also added code to Enter-PSSession to handle a similar case where the Cmdlet operation is stopped before the connection or session is created.  This is important for SSH remoting because PowerShell interacts with SSH and it is possible to cancel before a connection is even started.\r\n\r\n```powershell\r\nPS > Enter-PSSession -hostname <hostname> -User <username>\r\n<username>@<hostname>'s password:\r\nCtrl+C\r\nPS >\r\n```\r\n",
  "closed_at": "2017-09-12T00:49:29Z",
  "comments": [
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "Thanks!",
      "created_at": "2017-08-29T14:22:28Z",
      "updated_at": "2017-08-29T14:22:28Z"
    },
    {
      "author": "dantraMSFT",
      "author_association": "CONTRIBUTOR",
      "body": ">                         string errorData = data.Substring(System.Management.Automation.Remoting.Server.NamedPipeErrorTextWriter.ErrorPrepend.Length);\r\n\r\nYou continue processing data so why isn't this also considered a _connectionEstablished state?  As it stands, it appears that there is a nebulas state where errors are processed but the connection cannot be closed via CloseAsync.\r\nIf I'm misreading it, a comment would help.\r\n\r\n---\r\nRefers to: src/System.Management.Automation/engine/remoting/fanin/OutOfProcTransportManager.cs:1645 in 5924f77. [](commit_id = 5924f773bffa6d096a5473bc1e8449b858020b7d, deletion_comment = False)",
      "created_at": "2017-08-29T21:43:55Z",
      "updated_at": "2017-08-29T21:43:55Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "Thanks!  Will fix.",
      "created_at": "2017-08-30T20:32:22Z",
      "updated_at": "2017-08-30T20:32:22Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "@mirichmo \r\nI have responded to all CR comments.  Can this be merged?",
      "created_at": "2017-09-06T17:28:59Z",
      "updated_at": "2017-09-06T17:28:59Z"
    },
    {
      "author": "PaulHigin",
      "author_association": "COLLABORATOR",
      "body": "@dantraMSFT \r\nDo you have any more comments or questions?\r\n",
      "created_at": "2017-09-06T20:00:24Z",
      "updated_at": "2017-09-06T20:00:24Z"
    }
  ],
  "created_at": "2017-08-28T23:22:57Z",
  "number": 4693,
  "state": "closed",
  "title": "[Regression] Fix for error on Enter-PSSession exit",
  "updated_at": "2017-09-12T17:25:51Z"
}