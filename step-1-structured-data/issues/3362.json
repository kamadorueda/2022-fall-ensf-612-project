{
  "_url": "https://github.com/PowerShell/PowerShell/issues/3362",
  "author": "SteveL-MSFT",
  "body": "Windows progressbar requires ability to cache the screen buffer contents so it can write it back once progress is done.  Linux doesn't provide a way for console apps to read the screen buffer (security concern).  Changes:\r\n- scroll buffer appropriately by the size needed for progress bar if near bottom of screen, adjust progressbar location to account for scrolling\r\n- create an empty screen buffer used to clear the progress bar once done\r\n\r\nNo easy way to add tests for ProgressBar.\r\n\r\naddresses #1625 \r\n\r\nBefore the change:\r\n![before](https://cloud.githubusercontent.com/assets/11859881/24062767/076a50a8-0b1a-11e7-835f-c5a422280ab3.gif)\r\n\r\nAfter the change:\r\n![after](https://cloud.githubusercontent.com/assets/11859881/24062771/0a89c0d4-0b1a-11e7-96fb-0b4943a551fa.gif)\r\n",
  "closed_at": "2017-03-19T06:47:10Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> No easy way to add tests for ProgressBar.\r\n\r\nWe can try to use our TestHostCS.psm1",
      "created_at": "2017-03-19T17:15:56Z",
      "updated_at": "2017-03-19T17:16:09Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov don't think TestHostCS.psm1 will help here since we're trying to validate how powershell.exe handles progressbar",
      "created_at": "2017-03-19T23:24:38Z",
      "updated_at": "2017-03-19T23:24:38Z"
    },
    {
      "author": "lzybkr",
      "author_association": "MEMBER",
      "body": "Testing this would be similar to how I test PSReadline - I introduce a mock console interface, so instead of `Console.Write`, you write something more like `_console.Write` - then the test framework has a mock for the interface (which doesn't really exist, you need to invent one.)\r\n\r\nIt's a pain to write these tests and there is little return in that investment, so that's why I didn't ask Steve for any tests.",
      "created_at": "2017-03-20T03:22:00Z",
      "updated_at": "2017-03-20T03:22:00Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": ">there is little return in that investment\r\n\r\nIf the stock price change, I may try to enhance our  TestHostCS.psm1 to support this scenarios. \ud83d\ude04 ",
      "created_at": "2017-03-20T03:35:31Z",
      "updated_at": "2017-03-20T03:35:31Z"
    }
  ],
  "created_at": "2017-03-17T21:01:06Z",
  "number": 3362,
  "state": "closed",
  "title": "correctly presenting progressbar when buffer scrolls and clearing at end",
  "updated_at": "2017-03-20T03:35:31Z"
}