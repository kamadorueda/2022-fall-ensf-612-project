{
  "_url": "https://github.com/PowerShell/PowerShell/issues/8901",
  "author": "diddledani",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->  \r\n\r\n## PR Summary\r\n\r\nUpdate the UNIX Environment variable `PWD` to the current location.\r\n\r\n## PR Context  \r\n\r\nFixes #7388\r\n\r\nSet the UNIX Environment variable $env:PWD to the full filesystem path\r\nfor the current working directory upon Set-Location. This also copes\r\nwhen the current location is set to a PSDrive. In such circumstances the\r\nenvironment variable is expanded to the full FileSystem provider path.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.  \r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**  \r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [ ] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` to your commit messages if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2019-03-05T20:04:00Z",
  "comments": [
    {
      "author": "diddledani",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for the thorough review, @kvprasoon, and for sticking with me while I work through your suggestions :-)",
      "created_at": "2019-02-20T11:58:00Z",
      "updated_at": "2019-02-20T11:58:00Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I think we can not accept the PR because PowerShell can create _many runspaces_ each of which has its own value of $PWD. Note that .Net also has \"pwd\" which doesn't correlate with PowerShell $PWD.",
      "created_at": "2019-02-22T13:56:11Z",
      "updated_at": "2019-02-22T13:56:11Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "@iSazonov it would be better to set `$env:PWD` for the current process only, I guess? Is that possible on Unix platforms?",
      "created_at": "2019-02-22T14:37:41Z",
      "updated_at": "2019-02-22T14:37:41Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": ">  for the current process only\r\n\r\n@vexx32 PowerShell can create many runspaces/threads in the same process and everyone will export `$env:PWD` - it is a mess.",
      "created_at": "2019-02-22T14:42:08Z",
      "updated_at": "2019-02-22T14:42:08Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "@iSazonov how do other threaded Unix applications handle this issue? Are there any existing applications we could model behaviour from here?",
      "created_at": "2019-02-22T14:44:20Z",
      "updated_at": "2019-02-22T14:44:20Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@vexx32 `$env:PWD` is _common_ resource. Let's replace it with Set-Date - what result do you get if many process/threads will modify system time in the same time? I guess Unix uses another scenario - a process track PWD for itself or inform subprocess about work directory.",
      "created_at": "2019-02-22T14:56:23Z",
      "updated_at": "2019-02-22T14:56:23Z"
    },
    {
      "author": "diddledani",
      "author_association": "CONTRIBUTOR",
      "body": "Using `Environment.SetEnvironmentVariable` on UNIX will only change the value for the current process and those beneath it in the process tree. You mention multiple run-spaces... how do I start a second run-space within the current `pwsh` process to test the scenario? (I'm not very familiar with PowerShell yet.)",
      "created_at": "2019-02-22T15:24:37Z",
      "updated_at": "2019-02-22T15:24:37Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "An function written in PowerShell that I wrote utilising runspaces can be found [here](https://github.com/vexx32/PSWordCloud/blob/master/PSWordCloud/Public/New-WordCloud.ps1).\r\n\r\nThe runspace pool is created on line [#566](https://github.com/vexx32/PSWordCloud/blob/master/PSWordCloud/Public/New-WordCloud.ps1#L566), and the separate instances are created and invoked on lines [#594-#627](https://github.com/vexx32/PSWordCloud/blob/master/PSWordCloud/Public/New-WordCloud.ps1#L594-L627)\r\n\r\nThis is a bit of a more complex example as I'm batching the tasks to make the best use of it, but it should illustrate the overall idea. \ud83d\ude04 \r\n\r\nThere may be some already-built functions designed to help test these types of cases in amongst some of the existing test files, but I'm not sure of where to look for those.",
      "created_at": "2019-02-22T15:37:43Z",
      "updated_at": "2019-02-22T15:40:04Z"
    },
    {
      "author": "diddledani",
      "author_association": "CONTRIBUTOR",
      "body": "OK, run-spaces definitely share the PWD environment, so this PR as it stands is **not** good-to-go :-)",
      "created_at": "2019-02-22T16:05:25Z",
      "updated_at": "2019-02-22T16:05:25Z"
    },
    {
      "author": "diddledani",
      "author_association": "CONTRIBUTOR",
      "body": "This needs rethinking, so I'm closing the PR.",
      "created_at": "2019-03-05T20:04:00Z",
      "updated_at": "2019-03-05T20:04:00Z"
    }
  ],
  "created_at": "2019-02-15T20:23:03Z",
  "number": 8901,
  "state": "closed",
  "title": "Set-Location: Match $env:PWD & $PWD on UNIX",
  "updated_at": "2020-02-15T01:53:34Z"
}