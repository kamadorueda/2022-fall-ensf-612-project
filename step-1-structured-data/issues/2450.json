{
  "_url": "https://github.com/PowerShell/PowerShell/issues/2450",
  "author": "vors",
  "body": "Fix #559 \r\nImprove pipeline for native commands\r\n- Start native process in Prepare() instead of Complete()\r\n  in NativeCommandProcessor.\r\n- Remove unneeded input, output, error threads. Replaced by\r\n  simpler primitives.\r\n\r\nMotivation example:\r\n\r\n`ping | %{powershell-code} | grep` now works in real-time.\r\nSee the [test](https://github.com/PowerShell/PowerShell/pull/2450/commits/e34a81a30fda95685084b09d4a0d5f60006e4d49#diff-e2e61256a6481fbfcebf5757b220793aR35)\r\n\r\nTODO before merging:\r\n\r\n- [x] replace spin-lock by something like `notify/wait`\r\n- [x] resurrect and test minishell with custom host serialization\r\n- [x] Changelog entry\r\n- [x] Fix feature tests for https://github.com/PowerShell/PowerShell/blob/ae7b857c235203d1fd3708fe05c076e5a376859a/test/powershell/Host/ConsoleHost.Tests.ps1#L57\r\n- [x] Investigate, is this test flaky or not https://ci.appveyor.com/project/PowerShell/powershell/build/6.0.0-alpha.12-1287/tests",
  "closed_at": "2016-11-16T02:00:02Z",
  "comments": [
    {
      "author": "msftclas",
      "author_association": "NONE",
      "body": "Hi **@vors**, I'm your friendly neighborhood Microsoft Pull Request Bot (You can call me MSBOT). Thanks for your contribution!\n    <p>\n        It looks like you're a Microsoft contributor (Sergei Vorobev). If you're full-time, we DON'T require a Contribution License Agreement. If you are a vendor, please DO sign the electronic Contribution License Agreement. It will take 2 minutes and there's no faxing! https://cla.microsoft.com.\n    </p>\n\nTTYL, MSBOT;\n",
      "created_at": "2016-10-11T02:06:04Z",
      "updated_at": "2016-10-11T02:06:04Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@vors could you please resolve the Travis CI failures?\n",
      "created_at": "2016-10-19T02:41:50Z",
      "updated_at": "2016-10-19T02:41:50Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw working on it.\nThere are two parts: PSDSC.psm1 need to be updated: it uses `sort` instead of `sort-object` in one place and worked by accident #2520. The second part is about handing native executable failures because it still should not produce broken pipe error.\n",
      "created_at": "2016-10-19T03:02:19Z",
      "updated_at": "2016-10-22T01:49:03Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "\ud83c\udf89 @daxian-dbw ready for review\n",
      "created_at": "2016-10-22T03:33:15Z",
      "updated_at": "2016-10-22T03:33:15Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "I will update PR with the `notify/wait` code\n",
      "created_at": "2016-10-27T02:07:23Z",
      "updated_at": "2016-10-27T02:07:23Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw I removed spin-lock and employed `BlockedCollection` as you suggested.\n",
      "created_at": "2016-11-08T02:40:25Z",
      "updated_at": "2016-11-08T02:40:25Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Could you please also update your TODO list in the PR description?\n",
      "created_at": "2016-11-09T23:28:46Z",
      "updated_at": "2016-11-09T23:28:46Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw Ready for the final review iteration!\n",
      "created_at": "2016-11-11T22:29:31Z",
      "updated_at": "2016-11-11T22:29:31Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "In `NativeMinishell.Tests.ps1`:\n\n> Its primare use-case\n\nYou missed the typo **primare**. #Closed\n",
      "created_at": "2016-11-14T20:35:43Z",
      "updated_at": "2016-11-16T01:42:23Z"
    },
    {
      "author": "vors",
      "author_association": "COLLABORATOR",
      "body": "Ready for review!\n",
      "created_at": "2016-11-16T00:40:23Z",
      "updated_at": "2016-11-16T00:40:23Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I don't see your updates on the duplicate `_nativeProcessOutputQueue.Take()`. I still think it's unnecessary duplication of code. #Closed\n",
      "created_at": "2016-11-16T01:15:21Z",
      "updated_at": "2016-11-16T01:42:03Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Great! :star2:\n",
      "created_at": "2016-11-16T04:39:39Z",
      "updated_at": "2016-11-16T04:39:39Z"
    }
  ],
  "created_at": "2016-10-11T02:06:00Z",
  "number": 2450,
  "state": "closed",
  "title": "Native pipe",
  "updated_at": "2016-11-16T04:39:39Z"
}