{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5972",
  "author": "markekraus",
  "body": "## PR Summary\r\n\r\n* Closes #2112 \ud83c\udf89 \r\n* Adds `-Form` Parameter to `Invoke-WebRequest` and `Invoke-RestMethod`\r\n* `-Form` Accepts any `IDictionary`.\r\n* Keys are used as `multipart/form-data` field names (`PSObject` unwrapped and `ConvertTo<String>(Object)`)\r\n* `FileInfo` values are added as `StreamContent` with `application/octet-stream` content type and the `FileInfo.Name` as the file name.\r\n* Strings are treated as `StringContent`\r\n* Singe values are converted to string with `ConvertTo<String>(Object)` and treated as `StringContent`\r\n* Top level collections are enumerated and converted as above. Nested collections are treated as a single value and converted accordingly.\r\n* `-Form` is mutually exclusive with `-Body` and `-InFile`\r\n* Per committee decision, `-Form` makes no assumptions about the HTTP method used. It can theoretically be used with any method. User will need to manually supply `-Method POST` to post the form.\r\n* `-ContentType` and content related headers supplied to `-Headers` will be ignored/cleared as `MultipartFormDataContent` requires control of these headers.\r\n\r\n\r\n## PR Checklist\r\n\r\nNote: Please mark anything not applicable to this PR `NA`.\r\n\r\n- [X] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Use the present tense and imperative mood when describing your changes\r\n- [X] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [X] User facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - [X] Issue filed - Issue link: PowerShell/PowerShell-Docs#2077\r\n- [X] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [X] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n    - [X] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n- [X] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n",
  "closed_at": "2018-01-25T05:17:56Z",
  "comments": [
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "I just realized my tests were missing from the commit. They will be included with the PR feedback changes.",
      "created_at": "2018-01-22T09:48:16Z",
      "updated_at": "2018-01-22T09:48:16Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "Revered the content-type tests to `Match`. We can't know the multipart/form-data boundary before the request is sent so we cannot do `BeExactly` assertion. ",
      "created_at": "2018-01-22T18:55:41Z",
      "updated_at": "2018-01-22T18:55:41Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "Remaining test failures are from #5973 being fixed in #5980.",
      "created_at": "2018-01-22T19:39:21Z",
      "updated_at": "2018-01-22T19:39:30Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> We can't know the multipart/form-data boundary before the request is sent so we cannot do BeExactly assertion.\r\n\r\nI want see more information about it and I think we should add appropriate comment in tests.",
      "created_at": "2018-01-23T03:11:57Z",
      "updated_at": "2018-01-23T03:11:57Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov \r\n\r\nmultipart/form-data `Content-Type` header looks like `multipart/form-data; boundary=\"0ab0cb90-f01b-4c15-bd4d-53d073efcc1d\"`. `MultipartFormDataContent` sets a random GUID for the boundary. the boundary is used to distinguish between the form items in the body. testing if the  `Content-Type` header contains `multipart/form-data` and that the expect form elements are there are sufficient. \r\n\r\nNot every tests needs to be `BeExactly`. I see no point in a comment to call out every single instance where they are not. If match was the only test available, then perhaps that makes sense to comment. but we make multiple assertions in each It here.",
      "created_at": "2018-01-23T09:14:16Z",
      "updated_at": "2018-01-23T09:14:16Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@markekraus Thanks! I expected only `multipart/form-data`. The comment will be useful in tests.",
      "created_at": "2018-01-23T10:45:58Z",
      "updated_at": "2018-01-23T10:45:58Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@iSazonov comments added.",
      "created_at": "2018-01-23T16:42:54Z",
      "updated_at": "2018-01-23T16:42:54Z"
    },
    {
      "author": "zhouyoufu",
      "author_association": "NONE",
      "body": "~~\n\n~~\n",
      "created_at": "2018-01-24T05:20:20Z",
      "updated_at": "2018-01-24T05:20:20Z"
    },
    {
      "author": "markekraus",
      "author_association": "CONTRIBUTOR",
      "body": "@SteveL-MSFT GH won't let me reply to the thread, but I added the comments about file contents.",
      "created_at": "2018-01-24T12:27:14Z",
      "updated_at": "2018-01-24T12:27:14Z"
    }
  ],
  "created_at": "2018-01-21T14:40:52Z",
  "number": 5972,
  "state": "closed",
  "title": "Add Simplified multipart/form-data Support to Web Cmdlets Through -Form Parameter",
  "updated_at": "2018-10-15T21:44:20Z"
}