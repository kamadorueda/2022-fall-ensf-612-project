{
  "_url": "https://github.com/PowerShell/PowerShell/issues/7299",
  "author": "jianyunt",
  "body": "\r\n## PR Summary\r\n\r\nTo address the issue https://github.com/PowerShell/PowerShell/issues/7022, the changes are among the following repos:\r\n- PSReadLine, see PR https://github.com/lzybkr/PSReadLine/pull/708\r\n  For example, in the cloudshell, when a user types `get-azurermvmac` and then hits `tab`, we reach out to Azure to fetch the data and pwsh will show progress in the meantime, which in turn changes the cursor position. That requires PSReadLine to adjust the cursor position after calling GetCompletions().\r\n- This PR is for fixing the cursor position calculation issue in PSCore when scrolling up screen is necessary so the PSReadLine can set the cursor to the right location\r\n- With the above two fixes, the nested progress still does not work. I had a long conversation with  @iSazonov in my previous PR  https://github.com/PowerShell/PowerShell/pull/7023. We cannot call hide() because there is a small window where the progress won't get cleaned if ctrl+c.  Looking through the code, I think the easier way is to use the workaround `$ProgressPreference ='SilentlyContinue' `  at the AzurePSDrive module level for nested case, see https://github.com/PowerShell/AzurePSDrive/pull/53.\r\n With that, we can still show the fetching Azure data progress written by SHiPS,  suppress the  progress in the Get-AzureRmWebApp , but it does not change the ProgressPreference setting in the cloudshell. This means when a user type Azure cmdlet, the progress will still show.  That is the behavior we want.\r\n\r\nPlease note that we cannot use `$ProgressPreference ='SilentlyContinue' for both SHiPS and its provider AzurePSDrive because fetching data from Azure can take really long time. Showing progress is needed but keep (try keeping) one progress only. Thus the above fixes are all needed.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [ ] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` to the beginning of the title and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [ ] Not Applicable\r\n    - **OR**\r\n    - [ ] User-facing [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed - Issue link:\r\n- **Testing - New and feature**\r\n    - [x] Not Applicable or can only be tested interactively\r\n    - **OR**\r\n    - [ ] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n        - [ ] [Add `[feature]` if the change is significant or affects feature tests](https://github.com/PowerShell/PowerShell/blob/master/docs/testing-guidelines/testing-guidelines.md#requesting-additional-tests-for-a-pr)\r\n",
  "closed_at": "2018-08-01T20:31:50Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@jianyunt I do not have the ability to check this on Unix, but definitely we have to do many _manual_ tests to make sure everything works without regression.",
      "created_at": "2018-07-18T03:11:39Z",
      "updated_at": "2018-07-18T03:11:39Z"
    },
    {
      "author": "anmenaga",
      "author_association": "CONTRIBUTOR",
      "body": "@adityapatwardhan This looks ready for merge.",
      "created_at": "2018-07-30T20:28:00Z",
      "updated_at": "2018-07-30T20:28:00Z"
    }
  ],
  "created_at": "2018-07-16T22:48:58Z",
  "number": 7299,
  "state": "closed",
  "title": "Set the cursor to the place where a user hits tab key",
  "updated_at": "2018-08-01T20:31:51Z"
}