{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13876",
  "author": "ghost",
  "body": "I have a fairly complex Windows form that utilizes a System.Windows.Forms.ListView object.  The list view shows the items with \"Tile view\" images and works without issues with Windows PowerShell 5.1 and PowerShell 7.0.3.  When I try to run the script with any version of PowerShell 7.1 (currently on RC2), it shows the listview items (the text portion) and I can interact with them normally - but no image appears to the left of each item in the list.\r\n\r\nTo simplify showing the problem, I have written a simple script (below) to illustrate the issue - and it basically exhibits the same problem as the more complex production script I use.\r\n\r\nI believe this is a problem with .Net 5, but since PS 7.1 is built on it I figured I would post that bug here to see if I could get any traction from the PowerShell team first.\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\n#region Assemblies\r\nAdd-Type -AssemblyName System.Windows.Forms\r\n#endregion\r\n\r\n#region Appearance\r\n[System.Windows.Forms.Application]::EnableVisualStyles()\r\n#endregion\r\n\r\n#region Components\r\n$FormMain = New-Object System.Windows.Forms.Form\r\n$ListViewMain = New-Object System.Windows.Forms.ListView\r\n$ImageListMain = New-Object System.Windows.Forms.ImageList\r\n$ButtonCancel = New-Object System.Windows.Forms.Button\r\n#endregion\r\n\r\n#region Forms\r\n$ShowFormMain =\r\n{\r\n    $FormMain.Icon = [Drawing.Icon]::ExtractAssociatedIcon((Get-Process -Id $PID).Path)\r\n    $FormMain.Text = \"ListView Test\"\r\n    $FormMain.Font = New-Object System.Drawing.Font(\"MS Sans Serif\",8)\r\n    $FormMain.ClientSize = New-Object System.Drawing.Size(330,240)\r\n    $FormMain.StartPosition = \"CenterScreen\"\r\n    $FormMain.FormBorderStyle = \"FixedSingle\"\r\n    $FormMain.MaximizeBox = $false\r\n    $FormMain.Add_Load($FormMain_Load)\r\n\r\n    $ListViewMain.MultiSelect = $false\r\n    $ListViewMain.LabelWrap = $false\r\n    $ListViewMain.LargeImageList = $ImageListMain\r\n    $ListViewMain.Location = New-Object System.Drawing.Point(10,15)\r\n    $ListViewMain.Size = New-Object System.Drawing.Size(310,150)\r\n    $ListViewMain.View = \"Tile\"\r\n    $FormMain.Controls.Add($ListViewMain)\r\n\r\n    $ImageListMain.ColorDepth = \"Depth32Bit\"\r\n    $ImageListMain.ImageSize = New-Object System.Drawing.Size(32,32)\r\n\r\n    $ButtonCancel.Location = New-Object System.Drawing.Point(245,200)\r\n    $ButtonCancel.Size = New-Object System.Drawing.Size(75,25)\r\n    $ButtonCancel.Text = \"Cancel\"\r\n    $ButtonCancel.TabIndex = 1\r\n    $ButtonCancel.DialogResult = \"Cancel\"\r\n    $FormMain.Controls.Add($ButtonCancel)\r\n\r\n    [void]$FormMain.ShowDialog()\r\n    $FormMain.Dispose()\r\n}\r\n#endregion\r\n\r\n#region Handlers\r\n$FormMain_Load =\r\n{\r\n    $ImageListMain.Images.Add(0, [Drawing.Icon]::ExtractAssociatedIcon((Get-Process -Id $PID).Path))\r\n    $ListViewMain.Items.Add(\"Test\",0)\r\n}\r\n#endregion\r\n\r\n#region Main\r\nInvoke-Command $ShowFormMain\r\n#endregion\r\n```\r\n\r\n## Expected behavior\r\n\r\n![Screenshot 2020-10-25 200122](https://user-images.githubusercontent.com/61813693/97124375-d457e880-16fd-11eb-99f5-234f29c93615.png)\r\n\r\nThe two far left forms in the screen shot above are Windows PowerShell 5.1 and PowerShell 7.03.  They correctly show the listview image.\r\n\r\n## Actual behavior\r\nThe far right form in the above screenshot is from PowerShell 7.1-rc2.  As you can see there is no image.  When I run the script in PowerShell 7.1-rc2 there is no errors generated - it simply omits showing the image.\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0-rc.2\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0-rc.2\r\nOS                             Microsoft Windows 10.0.17763\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": "2020-10-27T01:43:38Z",
  "comments": [
    {
      "author": "ghost",
      "author_association": "NONE",
      "body": "It looks to be some sort of issue with the order of when I add images to the ImageList.  If I add the image prior to calling ShowDialog(), then it works fine.  I am guessing it is just some poor coding habit on my part that was \"allowed to work\" previously but now .Net 5 is catching it keeping me honest by not allowing it.\r\n\r\n```powershell\r\n#region Assemblies\r\nAdd-Type -AssemblyName System.Windows.Forms\r\nAdd-Type -AssemblyName System.Drawing\r\n#endregion\r\n\r\n#region Appearance\r\n[System.Windows.Forms.Application]::EnableVisualStyles()\r\n#endregion\r\n\r\n#region Components\r\n$FormMain = New-Object System.Windows.Forms.Form\r\n$ListViewMain = New-Object System.Windows.Forms.ListView\r\n$ImageListMain = New-Object System.Windows.Forms.ImageList\r\n$ButtonCancel = New-Object System.Windows.Forms.Button\r\n#endregion\r\n\r\n#region Forms\r\n$ShowFormMain =\r\n{\r\n    $FormMain.Icon = [Drawing.Icon]::ExtractAssociatedIcon((Get-Process -Id $PID).Path)\r\n    $FormMain.Text = \"ListView Test\"\r\n    $FormMain.Font = New-Object System.Drawing.Font(\"MS Sans Serif\",8)\r\n    $FormMain.ClientSize = New-Object System.Drawing.Size(330,240)\r\n    $FormMain.StartPosition = \"CenterScreen\"\r\n    $FormMain.FormBorderStyle = \"FixedSingle\"\r\n    $FormMain.MaximizeBox = $false\r\n    $FormMain.Add_Load($FormMain_Load)\r\n\r\n    $ListViewMain.MultiSelect = $false\r\n    $ListViewMain.LabelWrap = $false\r\n    $ListViewMain.LargeImageList = $ImageListMain\r\n    $ListViewMain.Location = New-Object System.Drawing.Point(10,15)\r\n    $ListViewMain.Size = New-Object System.Drawing.Size(310,150)\r\n    $ListViewMain.View = \"Tile\"\r\n    $FormMain.Controls.Add($ListViewMain)\r\n\r\n    $ImageListMain.TransparentColor = [Drawing.Color]::Transparent\r\n    $ImageListMain.ColorDepth = \"Depth32Bit\"\r\n    $ImageListMain.ImageSize = New-Object System.Drawing.Size(32,32)\r\n    $ImageListMain.Images.Add(0, [Drawing.Icon]::ExtractAssociatedIcon((Get-Process -Id $PID).Path))\r\n    \r\n    $ButtonCancel.Location = New-Object System.Drawing.Point(245,200)\r\n    $ButtonCancel.Size = New-Object System.Drawing.Size(75,25)\r\n    $ButtonCancel.Text = \"Cancel\"\r\n    $ButtonCancel.TabIndex = 1\r\n    $ButtonCancel.DialogResult = \"Cancel\"\r\n    $FormMain.Controls.Add($ButtonCancel)\r\n\r\n    [void]$FormMain.ShowDialog()\r\n    $FormMain.Dispose()\r\n}\r\n#endregion\r\n\r\n#region Handlers\r\n$FormMain_Load =\r\n{\r\n    $ListViewMain.Items.Add(\"Test\", 0)\r\n}\r\n#endregion\r\n\r\n#region Main\r\nInvoke-Command $ShowFormMain\r\n#endregion\r\n```\r\n\r\nI will mess around with it and try to improve the way I am coding it to fall in line with what .Net 5 is expecting.\r\nThanks\r\nNK",
      "created_at": "2020-10-27T01:43:38Z",
      "updated_at": "2020-10-27T01:43:38Z"
    },
    {
      "author": "ghost",
      "author_association": "NONE",
      "body": "This appears to be now fixed in .NET 5.0.2 per:\r\n[Revert \"Explicit ImageList ownership management\" (servicing)](https://github.com/dotnet/winforms/pull/4314)",
      "created_at": "2021-01-15T04:58:50Z",
      "updated_at": "2021-01-15T04:58:50Z"
    }
  ],
  "created_at": "2020-10-26T01:13:33Z",
  "labels": [
    "Issue-Question"
  ],
  "number": 13876,
  "state": "closed",
  "title": "Windows form with System.Windows.Forms.ListView no longer shows image with PowerShell 7.1",
  "updated_at": "2021-01-15T04:58:50Z"
}