{
  "_url": "https://github.com/PowerShell/PowerShell/issues/7605",
  "author": "PoshKazun",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\n- Windows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nIf it is a bug report:\r\n- make sure you are able to repro it on the latest released version. \r\nYou can install the latest version from https://github.com/PowerShell/PowerShell/releases\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6?view=powershell-6).\r\n- Fill out the following repro template:\r\n\r\nIf it's not a bug, please remove the template and elaborate the issue in your own words.\r\n-->\r\n\r\nSteps to reproduce\r\n------------------\r\n\r\n```powershell\r\nclass Test {\r\n    [String]$foo\r\n\r\n    [String] ToString() {\r\n        return \"$this.foo\"\r\n    }\r\n}\r\n\r\n[Test]::new().ToString()\r\n```\r\n\r\nExpected behavior\r\n-----------------\r\n\r\n```none\r\nShould be thrown an exception instead of crash\r\n```\r\n\r\nActual behavior\r\n---------------\r\n\r\n```none\r\nProcess is terminated due to StackOverflowException.\r\n```\r\n\r\nEnvironment data\r\n----------------\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```powershell\r\n> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      5.1.17134.228\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.17134.228\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n\r\n> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      6.0.4\r\nPSEdition                      Core\r\nGitCommitId                    v6.0.4\r\nOS                             Microsoft Windows 10.0.17134\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n> $PSVersionTable\r\n\r\n```\r\n",
  "closed_at": "2018-08-28T13:32:00Z",
  "comments": [
    {
      "author": "anmenaga",
      "author_association": "CONTRIBUTOR",
      "body": "This also repro'es on PS Core 6.1.0-rc.1\r\n`   ExceptionCode: c00000fd (Stack overflow)`\r\n\r\nStack:\r\n```\r\n\r\n...\r\n[TailCallFrame: 000000bb2498d578] \r\nSystem.Management.Automation.PSObject.ToString(System.Management.Automation.ExecutionContext, System.Object, System.String, System.String, System.IFormatProvider, Boolean, Boolean)\r\nSystem.Management.Automation.PSObject.ToStringParser(System.Management.Automation.ExecutionContext, System.Object)\r\nSystem.Management.Automation.Interpreter.DynamicInstruction`3[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]].Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.Interpreter.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.LightLambda.RunVoid1[[System.__Canon, System.Private.CoreLib]](System.__Canon)\r\nSystem.Management.Automation.ScriptBlock.InvokeWithPipeImpl(System.Management.Automation.ScriptBlockClauseToInvoke, Boolean, System.Collections.Generic.Dictionary`2, System.Collections.Generic.List`1, ErrorHandlingBehavior, System.Object, System.Object, System.Object, System.Management.Automation.Internal.Pipe, System.Management.Automation.InvocationInfo, System.Object[])\r\nSystem.Management.Automation.ScriptBlock+c__DisplayClass57_0.b__0()\r\nSystem.Management.Automation.Runspaces.RunspaceBase.RunActionIfNoRunningPipelinesWithThreadCheck(System.Action)\r\nSystem.Management.Automation.ScriptBlock.InvokeWithPipe(Boolean, ErrorHandlingBehavior, System.Object, System.Object, System.Object, System.Management.Automation.Internal.Pipe, System.Management.Automation.InvocationInfo, Boolean, System.Collections.Generic.List`1, System.Collections.Generic.Dictionary`2, System.Object[])\r\nSystem.Management.Automation.ScriptBlock.InvokeAsMemberFunctionT[[System.__Canon, System.Private.CoreLib]](System.Object, System.Object[])\r\nSystem.Management.Automation.Internal.ScriptBlockMemberMethodWrapper.InvokeHelperT[[System.__Canon, System.Private.CoreLib]](System.Object, System.Object, System.Object[])\r\n[TailCallFrame: 000000bb2498de38] \r\nSystem.Management.Automation.PSObject.ToString(System.Management.Automation.ExecutionContext, System.Object, System.String, System.String, System.IFormatProvider, Boolean, Boolean)\r\nSystem.Management.Automation.PSObject.ToStringParser(System.Management.Automation.ExecutionContext, System.Object)\r\nSystem.Dynamic.UpdateDelegates.UpdateAndExecute2[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]](System.Runtime.CompilerServices.CallSite, System.__Canon, System.__Canon)\r\nSystem.Management.Automation.Interpreter.DynamicInstruction`3[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]].Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.Interpreter.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.LightLambda.RunVoid1[[System.__Canon, System.Private.CoreLib]](System.__Canon)\r\nSystem.Management.Automation.ScriptBlock.InvokeWithPipeImpl(System.Management.Automation.ScriptBlockClauseToInvoke, Boolean, System.Collections.Generic.Dictionary`2, System.Collections.Generic.List`1, ErrorHandlingBehavior, System.Object, System.Object, System.Object, System.Management.Automation.Internal.Pipe, System.Management.Automation.InvocationInfo, System.Object[])\r\nSystem.Management.Automation.ScriptBlock+c__DisplayClass57_0.b__0()\r\nSystem.Management.Automation.Runspaces.RunspaceBase.RunActionIfNoRunningPipelinesWithThreadCheck(System.Action)\r\nSystem.Management.Automation.ScriptBlock.InvokeWithPipe(Boolean, ErrorHandlingBehavior, System.Object, System.Object, System.Object, System.Management.Automation.Internal.Pipe, System.Management.Automation.InvocationInfo, Boolean, System.Collections.Generic.List`1, System.Collections.Generic.Dictionary`2, System.Object[])\r\nSystem.Management.Automation.ScriptBlock.InvokeAsMemberFunctionT[[System.__Canon, System.Private.CoreLib]](System.Object, System.Object[])\r\nSystem.Management.Automation.Internal.ScriptBlockMemberMethodWrapper.InvokeHelperT[[System.__Canon, System.Private.CoreLib]](System.Object, System.Object, System.Object[])\r\n[TailCallFrame: 000000bb2498e7a8] \r\nLoadSymbols moduleData.Request FAILED 0x80004005\r\nm.Runtime.CompilerServices.Closure, System.Runtime.CompilerServices.CallSite, System.Object)\r\nSystem.Dynamic.UpdateDelegates.UpdateAndExecute1[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]](System.Runtime.CompilerServices.CallSite, System.__Canon)\r\nSystem.Management.Automation.Interpreter.DynamicInstruction`2[[System.__Canon, System.Private.CoreLib],[System.__Canon, System.Private.CoreLib]].Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.Interpreter.Run(System.Management.Automation.Interpreter.InterpretedFrame)\r\nSystem.Management.Automation.Interpreter.LightLambda.RunVoid1[[System.__Canon, System.Private.CoreLib]](System.__Canon)\r\nSystem.Management.Automation.DlrScriptCommandProcessor.RunClause(System.Action`1, System.Object, System.Object)\r\nSystem.Management.Automation.DlrScriptCommandProcessor.Complete()\r\nSystem.Management.Automation.CommandProcessorBase.DoComplete()\r\nSystem.Management.Automation.Internal.PipelineProcessor.DoCompleteCore(System.Management.Automation.CommandProcessorBase)\r\nSystem.Management.Automation.Internal.PipelineProcessor.SynchronousExecuteEnumerate(System.Object)\r\nSystem.Management.Automation.Runspaces.LocalPipeline.InvokeHelper()\r\nSystem.Management.Automation.Runspaces.LocalPipeline.InvokeThreadProc()\r\nSystem.Management.Automation.Runspaces.PipelineThread.WorkerProc()\r\nSystem.Threading.Thread.ThreadMain_ThreadStart()\r\nSystem.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)\r\n```",
      "created_at": "2018-08-22T20:03:47Z",
      "updated_at": "2018-08-22T20:03:47Z"
    },
    {
      "author": "PetSerAl",
      "author_association": "CONTRIBUTOR",
      "body": "Your `ToString` call itself recursively, `StackOverflowException` is expected behavior there.\r\nNote that this `\"$this.foo\"` mean string version of `$this` plus `.foo` literal string. It is not property access.",
      "created_at": "2018-08-22T21:02:12Z",
      "updated_at": "2018-08-22T21:02:12Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Feel free to reopen the issue if the answer is incomplete.",
      "created_at": "2018-08-28T13:32:00Z",
      "updated_at": "2018-08-28T13:32:00Z"
    }
  ],
  "created_at": "2018-08-22T16:44:04Z",
  "labels": [
    "Issue-Question",
    "Resolution-Answered"
  ],
  "number": 7605,
  "state": "closed",
  "title": "Process crash with StackOverflowException after call ToString() from a custom class",
  "updated_at": "2018-09-11T11:11:19Z"
}