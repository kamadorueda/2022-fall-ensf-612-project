{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17643",
  "author": "b-olesen",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nI am expecting Keysize to be present, but only on Mac 7.1.4 it works, on Linux I haven't been able to. Tested with a couple of versions (7.1.3, 7.1.6, 7.2.5)\r\n\r\nCode executed :\r\n\r\n$url = \"https://www.vmware.com\"\r\n\r\n$today = Get-Date\r\nif ($PSEdition -eq 'Core'){\r\n\r\n$Code = @'\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Net.Http;\r\nusing System.Net.Security;\r\nusing System.Security.Cryptography.X509Certificates;\r\n\r\nnamespace CertificateCapture\r\n{\r\n    public class Utility\r\n    {\r\n         public static Func<HttpRequestMessage,X509Certificate2,X509Chain,SslPolicyErrors,Boolean> ValidationCallback = \r\n            (message, cert, chain, errors) => {\r\n                var newCert = new X509Certificate2(cert);\r\n                var newChain = new X509Chain();\r\n                newChain.Build(newCert);\r\n                CapturedCertificates.Add(new CapturedCertificate(){\r\n                    Certificate =  newCert,\r\n                    CertificateChain = newChain,\r\n                    PolicyErrors = errors,\r\n                    URI = message.RequestUri\r\n                });\r\n                return true; \r\n            };\r\n        public static List<CapturedCertificate> CapturedCertificates = new List<CapturedCertificate>();\r\n    }\r\n\r\n    public class CapturedCertificate \r\n    {\r\n        public X509Certificate2 Certificate { get; set; }\r\n        public X509Chain CertificateChain { get; set; }\r\n        public SslPolicyErrors PolicyErrors { get; set; }\r\n        public Uri URI { get; set; }\r\n    }\r\n}\r\n'@\r\n\r\n                if (-not (\"CertificateCapture.Utility\" -as [Type])) { Add-Type $Code }\r\n\r\n                $Certs = [CertificateCapture.Utility]::CapturedCertificates\r\n\r\n                $Handler = [System.Net.Http.HttpClientHandler]::new()\r\n                $Handler.ServerCertificateCustomValidationCallback = [CertificateCapture.Utility]::ValidationCallback\r\n                $Client = [System.Net.Http.HttpClient]::new($Handler)\r\n                $Result = $Client.GetAsync($Url).Result\r\n\r\n                $sha256 = [Security.Cryptography.SHA256]::Create()\r\n                $certBytes = $Certs[-1].Certificate.GetRawCertData()\r\n                $hash = $sha256.ComputeHash($certBytes)\r\n                $thumbprint = [BitConverter]::ToString($hash).Replace('-',':')\r\n}\r\n\r\n# ----------------------------------------------------------------------------------------\r\n#. Results on Mac:\r\n# ----------------------------------------------------------------------------------------\r\n\r\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.4\r\nPSEdition                      Core\r\nGitCommitId                    7.1.4\r\nOS                             Darwin 21.5.0 Darwin Kernel Version 21.5.0: Tue Apr 26 21:08:22 PDT 2022; root:xnu-8020.121.3~4/RELEASE_X86_64\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n\r\n$Certs[-1].Certificate.PublicKey.Key\r\n\r\nshows\r\n\r\nLegalKeySizes                           KeySize KeyExchangeAlgorithm SignatureAlgorithm\r\n-------------                           ------- -------------------- ------------------\r\n{System.Security.Cryptography.KeySizes}    2048 RSA                  RSA\r\n\r\n\r\nKeysize is available and can be read\r\n\r\n# ----------------------------------------------------------------------------------------\r\n#  Results on Linux:\r\n# ----------------------------------------------------------------------------------------\r\n\r\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.6\r\nPSEdition                      Core\r\nGitCommitId                    7.1.6\r\nOS                             Linux 3.10.0-1160.62.1.el7.x86_64 #1 SMP Wed Mar 23 09:04:02 UTC 2022\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n$Certs[-1].Certificate.PublicKey.Key\r\n\r\nKeySize LegalKeySizes                           KeyExchangeAlgorithm SignatureAlgorithm\r\n------- -------------                           -------------------- ------------------\r\n        {System.Security.Cryptography.KeySizes} RSA                  RSA\r\n\r\nKeysize is available and cannot be read\r\n\r\n\n\n### Expected behavior\n\n```console\n# ----------------------------------------------------------------------------------------\r\n#. Results on Mac:\r\n# ----------------------------------------------------------------------------------------\r\n\r\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.4\r\nPSEdition                      Core\r\nGitCommitId                    7.1.4\r\nOS                             Darwin 21.5.0 Darwin Kernel Version 21.5.0: Tue Apr 26 21:08:22 PDT 2022; root:xnu-8020.121.3~4/RELEASE_X86_64\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n\r\n$Certs[-1].Certificate.PublicKey.Key\r\n\r\nshows\r\n\r\nLegalKeySizes                           KeySize KeyExchangeAlgorithm SignatureAlgorithm\r\n-------------                           ------- -------------------- ------------------\r\n{System.Security.Cryptography.KeySizes}    2048 RSA                  RSA\r\n\r\n\r\nKeysize is available and can be read\n```\n\n\n### Actual behavior\n\n```console\n# ----------------------------------------------------------------------------------------\r\n#  Results on Linux:\r\n# ----------------------------------------------------------------------------------------\r\n\r\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.6\r\nPSEdition                      Core\r\nGitCommitId                    7.1.6\r\nOS                             Linux 3.10.0-1160.62.1.el7.x86_64 #1 SMP Wed Mar 23 09:04:02 UTC 2022\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n$Certs[-1].Certificate.PublicKey.Key\r\n\r\nKeySize LegalKeySizes                           KeyExchangeAlgorithm SignatureAlgorithm\r\n------- -------------                           -------------------- ------------------\r\n        {System.Security.Cryptography.KeySizes} RSA                  RSA\r\n\r\nKeysize is available and cannot be read\n```\n\n\n### Error details\n\n```console\nKeysize {Get} method forgotten in Linux version ???\r\n\r\nWhen doing the get-method\r\n\r\nMac shows {Get;Set}\r\nLinux shows {;Set}\n```\n\n\n### Environment data\n\n```powershell\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.6\r\nPSEdition                      Core\r\nGitCommitId                    7.1.6\r\nOS                             Linux 3.10.0-1160.62.1.el7.x86_64 #1 SMP Wed Mar 23 09:04:02 UTC 2022\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [],
  "created_at": "2022-07-07T13:53:04Z",
  "labels": [
    "Issue-Bug",
    "WG-DevEx-Portability",
    "Needs-Triage"
  ],
  "number": 17643,
  "state": "open",
  "title": "Keysize not extracted from Certificate.PublicKey.Key.Keysize",
  "updated_at": "2022-07-11T16:52:05Z"
}