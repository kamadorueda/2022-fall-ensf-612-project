{
  "_url": "https://github.com/PowerShell/PowerShell/issues/9257",
  "author": "kwkam",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->\r\nReopen #7403\r\nFix #9541 \r\n\r\n# PR Summary\r\n\r\n<!-- Summarize your PR between here and the checklist. -->\r\nUnescape non-literal, non-glob path before existence checking.\r\n\r\n## PR Context\r\n\r\n<!-- Provide a little reasoning as to why this Pull Request helps and why you have opened it. -->\r\nThis solve the issue where Get-GhildItem does not behave correctly\r\nwhen -Path contains special characters. For example,\r\n```pwsh\r\nGet-ChildItem -Path './`[dir`]'\r\n```\r\nwill complain with error \"Cannot find path ...\" while\r\n```pwsh\r\nGet-ChildItem -Path './`[dir`]' -Depth 0\r\n```\r\nwill work fine.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [ ] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n",
  "closed_at": "2019-05-31T17:14:40Z",
  "comments": [
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2019-04-30T06:12:46Z",
      "updated_at": "2019-04-30T06:12:46Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@PoshChan please get failures",
      "created_at": "2019-05-14T18:37:45Z",
      "updated_at": "2019-05-14T18:37:45Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, test results were not published for PowerShell-CI-install-ps at vstfs:///Build/Build/23067",
      "created_at": "2019-05-14T18:38:11Z",
      "updated_at": "2019-05-14T18:38:11Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, your last commit had 5 failures in `PowerShell-CI-linux`\r\nGet-ChildItem.FileSystem provider.Should list files in sorted order\r\n```powershell\r\nExpected strings to be the same, but they were different.\r\nExpected length: 36\r\nActual length:   9\r\nStrings differ at index 0.\r\nExpected: 'a3fe710a-31af-4834-bc29-d0b584589838'\r\nBut was:  'Test[Dir]'\r\nat <ScriptBlock>, /home/vsts/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 105\r\n105:             $files[1].Name     | Should -Be $item_a\r\n```\r\nGet-ChildItem.FileSystem provider.Should list hidden files as well when 'Force' parameter is used\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, /home/vsts/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 114\r\n114:             $files.Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should list items in current directory only with depth set to 0\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, /home/vsts/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 132\r\n132:             (Get-ChildItem -Path $TestDrive -Depth 0).Count | Should -Be 5\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, /home/vsts/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 138\r\n138:             (Get-ChildItem -Path $TestDrive -Depth 1).Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters with -LiteralPath\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, /home/vsts/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 147\r\n147:             (Get-ChildItem -LiteralPath $TestDrive -Depth 1 -Exclude $item_a).Count | Should Be 5\r\n```\r\n",
      "created_at": "2019-05-14T18:38:13Z",
      "updated_at": "2019-05-14T18:38:13Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, your last commit had 5 failures in `PowerShell-CI-macos`\r\nGet-ChildItem.FileSystem provider.Should list files in sorted order\r\n```powershell\r\nExpected strings to be the same, but they were different.\r\nExpected length: 36\r\nActual length:   9\r\nStrings differ at index 0.\r\nExpected: 'a3fe710a-31af-4834-bc29-d0b584589838'\r\nBut was:  'Test[Dir]'\r\nat <ScriptBlock>, /Users/vsts/agent/2.150.3/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 105\r\n105:             $files[1].Name     | Should -Be $item_a\r\n```\r\nGet-ChildItem.FileSystem provider.Should list hidden files as well when 'Force' parameter is used\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, /Users/vsts/agent/2.150.3/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 114\r\n114:             $files.Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should list items in current directory only with depth set to 0\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, /Users/vsts/agent/2.150.3/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 132\r\n132:             (Get-ChildItem -Path $TestDrive -Depth 0).Count | Should -Be 5\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, /Users/vsts/agent/2.150.3/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 138\r\n138:             (Get-ChildItem -Path $TestDrive -Depth 1).Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters with -LiteralPath\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, /Users/vsts/agent/2.150.3/work/1/s/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1: line 147\r\n147:             (Get-ChildItem -LiteralPath $TestDrive -Depth 1 -Exclude $item_a).Count | Should Be 5\r\n```\r\n",
      "created_at": "2019-05-14T18:38:15Z",
      "updated_at": "2019-05-14T18:38:15Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, test results were not published for PowerShell-CI-static-analysis at vstfs:///Build/Build/23063",
      "created_at": "2019-05-14T18:38:17Z",
      "updated_at": "2019-05-14T18:38:17Z"
    },
    {
      "author": "PoshChan",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw, your last commit had 5 failures in `PowerShell-CI-windows`\r\nGet-ChildItem.FileSystem provider.Should list files in sorted order\r\n```powershell\r\nExpected strings to be the same, but they were different.\r\nExpected length: 36\r\nActual length:   9\r\nStrings differ at index 0.\r\nExpected: 'a3fe710a-31af-4834-bc29-d0b584589838'\r\nBut was:  'Test[Dir]'\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\Microsoft.PowerShell.Management\\Get-ChildItem.Tests.ps1: line 105\r\n105:             $files[1].Name     | Should -Be $item_a\r\n```\r\nGet-ChildItem.FileSystem provider.Should list hidden files as well when 'Force' parameter is used\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\Microsoft.PowerShell.Management\\Get-ChildItem.Tests.ps1: line 114\r\n114:             $files.Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should list items in current directory only with depth set to 0\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\Microsoft.PowerShell.Management\\Get-ChildItem.Tests.ps1: line 132\r\n132:             (Get-ChildItem -Path $TestDrive -Depth 0).Count | Should -Be 5\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters\r\n```powershell\r\nExpected 6, but got 7.\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\Microsoft.PowerShell.Management\\Get-ChildItem.Tests.ps1: line 138\r\n138:             (Get-ChildItem -Path $TestDrive -Depth 1).Count | Should -Be 6\r\n```\r\nGet-ChildItem.FileSystem provider.Should return items recursively when using 'Include' or 'Exclude' parameters with -LiteralPath\r\n```powershell\r\nExpected 5, but got 6.\r\nat <ScriptBlock>, D:\\a\\1\\s\\test\\powershell\\Modules\\Microsoft.PowerShell.Management\\Get-ChildItem.Tests.ps1: line 147\r\n147:             (Get-ChildItem -LiteralPath $TestDrive -Depth 1 -Exclude $item_a).Count | Should Be 5\r\n```\r\n",
      "created_at": "2019-05-14T18:38:19Z",
      "updated_at": "2019-05-14T18:38:19Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@kwkam Can you please take a look at the failures? Not sure why the last test change commit caused those failures",
      "created_at": "2019-05-14T18:41:03Z",
      "updated_at": "2019-05-14T18:41:03Z"
    },
    {
      "author": "kwkam",
      "author_association": "CONTRIBUTOR",
      "body": "@daxian-dbw Looks like we cannot create directory/file in $TestDrive at the BeforeAll phrase as other tests are using the $TestDrive as root, unless we also update the expected results for those tests.",
      "created_at": "2019-05-15T12:40:21Z",
      "updated_at": "2019-05-15T12:40:21Z"
    },
    {
      "author": "vexx32",
      "author_association": "COLLABORATOR",
      "body": "@kwkam can you create a subdirectory for the purposes of this test without affecting the other tests?",
      "created_at": "2019-05-15T12:55:08Z",
      "updated_at": "2019-05-15T12:55:08Z"
    },
    {
      "author": "kwkam",
      "author_association": "CONTRIBUTOR",
      "body": "@vexx32 I am already doing so, but that is not possible because those tests are using the root directory. For example, this test\r\nhttps://github.com/PowerShell/PowerShell/blob/755995b66f72086b54c451cb4af5f42c7d935c9d/test/powershell/Modules/Microsoft.PowerShell.Management/Get-ChildItem.Tests.ps1#L97-L104\r\nmay fail if anyone creates any file/directory in the $TestDrive before it is executed.",
      "created_at": "2019-05-15T15:57:21Z",
      "updated_at": "2019-05-15T15:57:21Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@kwkam If I remember right the test drive is re-created for every Describe block. So you could put your tests in new Describe block.",
      "created_at": "2019-05-16T05:15:12Z",
      "updated_at": "2019-05-16T05:15:12Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "@adityapatwardhan can you take another look when you get a chance?",
      "created_at": "2019-05-21T05:49:17Z",
      "updated_at": "2019-05-21T05:49:17Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": ":tada:`v7.0.0-preview.2` has been released which incorporates this pull request.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.0.0-preview.2)\n",
      "created_at": "2019-07-17T20:55:53Z",
      "updated_at": "2019-07-17T20:55:53Z"
    }
  ],
  "created_at": "2019-03-31T05:17:56Z",
  "number": 9257,
  "state": "closed",
  "title": "Fix Get-ChildItem -Path with wildcard char",
  "updated_at": "2019-07-17T20:55:53Z"
}