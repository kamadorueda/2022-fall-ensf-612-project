{
  "_url": "https://github.com/PowerShell/PowerShell/issues/9258",
  "author": "kwkam",
  "body": "<!-- Anything that looks like this is a comment and can't be seen after the Pull Request is created. -->\r\nReopen #7405\r\n\r\n# PR Summary\r\n\r\n<!-- Summarize your PR between here and the checklist. -->\r\nUnescape non-literal, non-glob path before calling\r\nGetUnresolvedProviderPathFromPSPath since it only accepts literal path.\r\n\r\n## PR Context\r\n\r\n<!-- Provide a little reasoning as to why this Pull Request helps and why you have opened it. -->\r\nThis solve the issue where some commands depending on that method\r\nwill treat -Path as literal unintentionally. For example,\r\n```pwsh\r\nOut-File -Path './`[out`].txt' -Append\r\n```\r\nwill create a new file named ```\"`[out`].txt\"``` instead of writing to ```\"[out].txt\"```.\r\n\r\n## PR Checklist\r\n\r\n- [x] [PR has a meaningful title](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n    - Use the present tense and imperative mood when describing your changes\r\n- [x] [Summarized changes](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] [Change is not breaking](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#making-breaking-changes)\r\n- [x] [Make sure all `.h`, `.cpp`, `.cs`, `.ps1` and `.psm1` files have the correct copyright header](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n- [x] This PR is ready to merge and is not [Work in Progress](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---work-in-progress).\r\n    - If the PR is work in progress, please add the prefix `WIP:` or `[ WIP ]` to the beginning of the title (the `WIP` bot will keep its status check at `Pending` while the prefix is present) and remove the prefix when the PR is ready.\r\n- **User-facing changes**\r\n    - [x] Not Applicable\r\n    - **OR**\r\n    - [ ] [Documentation needed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#pull-request---submission)\r\n        - [ ] Issue filed: <!-- Number/link of that issue here -->\r\n- **Testing - New and feature**\r\n    - [ ] N/A or can only be tested interactively\r\n    - **OR**\r\n    - [x] [Make sure you've added a new test if existing tests do not effectively test the code changed](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md#before-submitting)\r\n",
  "closed_at": "2021-11-02T17:50:37Z",
  "comments": [
    {
      "author": "stale[bot]",
      "author_association": "NONE",
      "body": "This PR has been automatically marked as stale because it has not had activity in the last 30 days. It will be closed if no further activity occurs within 10 days.\nThank you for your contributions.\nCommunity members are welcome to grab these works.\n",
      "created_at": "2019-04-30T17:12:46Z",
      "updated_at": "2019-04-30T17:12:46Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "I think we need to think about the current behavior again.\r\nToday, the escaped wildcard pattern is respected when it's used for searching an item with wildcard globbing. However, when creating a new item, the path is used as is (in fact, `New-Item` only accept literal path when `-Name` parameter is not used).\r\nFor example:\r\n```\r\nPS> New-Item [out].txt\r\n\r\n    Directory: F:\\tmp\\modules\\temp\r\n\r\nMode                LastWriteTime         Length Name\r\n----                -------------         ------ ----\r\n-a----         5/13/2019  9:07 AM              0 [out].txt\r\n\r\nPS> Get-Item '.\\`[out`].txt'\r\n\r\n    Directory: F:\\tmp\\modules\\temp\r\n\r\nMode                LastWriteTime         Length Name\r\n----                -------------         ------ ----\r\n-a----         5/13/2019  9:07 AM              0 [out].txt\r\n\r\nPS> New-Item '.\\`[out`].txt'\r\n\r\n    Directory: F:\\tmp\\modules\\temp\r\n\r\nMode                LastWriteTime         Length Name\r\n----                -------------         ------ ----\r\n-a----         5/13/2019  9:08 AM              0 `[out`].txt\r\n```\r\n\r\n`Out-File` follow this convention (well, partially) -- when searching for an existing file, the escaping of the wildcard pattern is respected (because it's used as a wildcard pattern), however, when no existing file is found and it's time to create a new file, `-Path` doesn't treat the provided path as a literal path like `New-Item` does.\r\n\r\n```\r\n# The provided path is resolved to \"[out].txt\" when searching for an existing file (\"[out].txt\" is an existing file)\r\nPS> \"abc\" | Out-File -Path '.\\`[out`].txt' -Append\r\nPS> Get-Content '.\\`[out`].txt'\r\nabc\r\n# Remove the existing file\r\nPS>rm *\r\n# When creating a new file, the path is used as is\r\nPS:78> \"abc\" | Out-File -Path '.\\`[out`].txt' -Append\r\nPS:79> dir\r\n\r\n    Directory: F:\\tmp\\modules\\temp\r\n\r\nMode                LastWriteTime         Length Name\r\n----                -------------         ------ ----\r\n-a----         5/13/2019  9:17 AM              5 `[out`].txt\r\n```\r\nThis does seem to be confusing -- `Out-File` would operate on files with different names depending on whether the file already exists or not ... But I think we need to think about the convention in general (e.g. should `New-Item` be changed too? what about `Set-Content` which only search for an existing file before creating a new file?) so that the behavior is not contradicting between different cmdlets.",
      "created_at": "2019-05-13T16:25:10Z",
      "updated_at": "2019-05-13T17:07:19Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "FYI, `Set-Content` and `Add-Content` don't work with paths that contains escaped wildcard characters. Issue opened: https://github.com/PowerShell/PowerShell/issues/9588",
      "created_at": "2019-05-13T16:38:22Z",
      "updated_at": "2019-05-13T16:38:22Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Reference my comment on the related issue: https://github.com/PowerShell/PowerShell/issues/9475#issuecomment-491911335\r\nI think this is a general issue that should be well thought and fixed in a wider scope.",
      "created_at": "2019-05-13T17:27:29Z",
      "updated_at": "2019-05-13T17:27:29Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This pull request has been automatically marked as Review Needed because it has been there has not been any activity for **7 days**.\nMainainer, Please provide feedback and/or mark it as `Waiting on Author`",
      "created_at": "2020-05-27T02:03:59Z",
      "updated_at": "2020-05-27T02:03:59Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "As is stated in my comments, the wildcard pattern issue is a general issue that should be well thought and fixed in a wider scope. So I will close this PR.",
      "created_at": "2021-11-02T17:50:37Z",
      "updated_at": "2021-11-02T17:50:37Z"
    }
  ],
  "created_at": "2019-03-31T05:21:19Z",
  "number": 9258,
  "state": "closed",
  "title": "PathUtils: handle escaped -Path correctly",
  "updated_at": "2021-11-02T17:50:39Z"
}