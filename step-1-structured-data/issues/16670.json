{
  "_url": "https://github.com/PowerShell/PowerShell/issues/16670",
  "author": "penalvch-zz",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nRunning $test.ps1 as part of a scheduled task via an administrative user intermittently shows the below error.\r\nI've never been able to reproduce the problem by executing the $test.ps1 script in Visual Studio Code, opening PWSH from Start > Run As Administrator, etc.\r\nIt seems correlated to when the computer is under heavy usage of memory and CPU, which may be part of the perceived non-deterministism.\r\nComputer has latest drivers, BIOS, firmware, and updates applied, with AV turned off.\r\n\r\n$test.ps1\r\n```\r\n. c:\\scripts\\check.ps1\r\n```\r\n\r\ncheck.ps1\r\n```\r\ntry{\r\n    $null=import-module -name PackageManagement,powershellget\r\n    if((get-installedmodule -name simplysql -ea 0).count -eq 0){\r\n        $null=(install-module -acceptlicense -name SimplySql -scope currentuser)\r\n    }\r\n}catch{\r\n    $ei_h=$_\r\n    $ge_h=get-error\r\n    $exception_h=$ei_h.Exception\r\n    $line_h=$ei_h.InvocationInfo.ScriptLineNumber\r\n    $msg_h=$ei_h.Message \r\n    $stringerr_h=-join('Error. Investigate.',\"`n\",'$line_h=',$line_h,\"`n\",'$exception_h=',\"`n\",$exception_h,\"`n\",'$msg_h=',\"`n\",$msg_h,\"`n\",'get-error=',\"`n\",$ge_h)\r\n    $mtoday_h=get-date -uformat '%Y%m%d%H%M'\r\n    $problem_h=\"$env:userprofile\\$mtoday_h-problem.txt\"\r\n    $streamp_h=[System.IO.StreamWriter]$problem_h\r\n    $streamp_h.write($stringerr_h)\r\n    $streamp_h.close()\r\n    exit 1\r\n}\r\n```\r\n\r\ntest.xml\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-16\"?>\r\n<Task version=\"1.4\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\">\r\n  <RegistrationInfo>\r\n    <Date>2021-12-22T16:06:10.889206</Date>\r\n    <Author>TEST\\admin</Author>\r\n    <URI>\\test\\test</URI>\r\n  </RegistrationInfo>\r\n  <Triggers>\r\n    <CalendarTrigger>\r\n      <StartBoundary>2021-12-23T04:01:00-05:00</StartBoundary>\r\n      <Enabled>true</Enabled>\r\n      <ScheduleByDay>\r\n        <DaysInterval>1</DaysInterval>\r\n      </ScheduleByDay>\r\n    </CalendarTrigger>\r\n  </Triggers>\r\n  <Principals>\r\n    <Principal id=\"Author\">\r\n      <UserId>S-1-5-21-4026033148-167229773-3407019803-1001</UserId>\r\n      <LogonType>Password</LogonType>\r\n      <RunLevel>HighestAvailable</RunLevel>\r\n    </Principal>\r\n  </Principals>\r\n  <Settings>\r\n    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>\r\n    <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries>\r\n    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>\r\n    <AllowHardTerminate>false</AllowHardTerminate>\r\n    <StartWhenAvailable>true</StartWhenAvailable>\r\n    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>\r\n    <IdleSettings>\r\n      <StopOnIdleEnd>true</StopOnIdleEnd>\r\n      <RestartOnIdle>false</RestartOnIdle>\r\n    </IdleSettings>\r\n    <AllowStartOnDemand>true</AllowStartOnDemand>\r\n    <Enabled>true</Enabled>\r\n    <Hidden>false</Hidden>\r\n    <RunOnlyIfIdle>false</RunOnlyIfIdle>\r\n    <DisallowStartOnRemoteAppSession>false</DisallowStartOnRemoteAppSession>\r\n    <UseUnifiedSchedulingEngine>true</UseUnifiedSchedulingEngine>\r\n    <WakeToRun>false</WakeToRun>\r\n    <ExecutionTimeLimit>PT0S</ExecutionTimeLimit>\r\n    <Priority>7</Priority>\r\n  </Settings>\r\n  <Actions Context=\"Author\">\r\n    <Exec>\r\n      <Command>pwsh.exe</Command>\r\n      <Arguments>-nologo -windowstyle hidden -ExecutionPolicy Bypass -command \". c:\\scripts\\test.ps1; exit $LASTEXITCODE\"</Arguments>\r\n      <WorkingDirectory>c:\\scripts</WorkingDirectory>\r\n    </Exec>\r\n  </Actions>\r\n</Task>\r\n```\n\n### Expected behavior\n\n```console\n$null=import-module -name PackageManagement,powershellget\r\n>> if((get-installedmodule -name simplysql -ea 0).count -eq 0){\r\n>>     $null=(install-module -acceptlicense -name SimplySql -scope currentuser)\r\n>> }\r\nPS C:\\Windows\\System32>\n```\n\n\n### Actual behavior\n\n```console\nSystem.Management.Automation.ParameterBindingException: A parameter cannot be found that matches parameter name 'Provider'.\r\n   at System.Management.Automation.ExceptionHandlingOps.CheckActionPreference(FunctionContext funcContext, Exception exception)\r\n   at Get-InstalledModule<Process>(Closure , FunctionContext )\r\n   at System.Management.Automation.PSScriptCmdlet.RunClause(Action`1 clause, Object dollarUnderbar, Object inputToProcess)\r\n   at System.Management.Automation.PSScriptCmdlet.DoProcessRecord()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()\n```\n\n\n### Error details\n\n```console\nA parameter cannot be found that matches parameter name 'Provider'.\n```\n\n\n### Environment data\n\n```powershell\n$psversiontable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.1\r\nPSEdition                      Core\r\nGitCommitId                    7.2.1\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2021-12-25T09:06:47Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@penalvch Get-InstalledModule cmdlet is in PowerShellGet repository. So please open new issue there to start investigations.",
      "created_at": "2021-12-25T09:03:05Z",
      "updated_at": "2021-12-25T09:03:05Z"
    },
    {
      "author": "penalvch-zz",
      "author_association": "NONE",
      "body": "@iSazonov, thanks for the info!",
      "created_at": "2021-12-25T09:06:47Z",
      "updated_at": "2021-12-25T09:06:47Z"
    }
  ],
  "created_at": "2021-12-25T01:56:10Z",
  "number": 16670,
  "state": "closed",
  "title": "PWSH 7.2.1: System.Management.Automation.ParameterBindingException: A parameter cannot be found that matches parameter name 'Provider'.",
  "updated_at": "2021-12-25T09:06:49Z"
}