{
  "_url": "https://github.com/PowerShell/PowerShell/issues/12478",
  "author": "SteveL-MSFT",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6?view=powershell-6).\r\n\r\n-->\r\n\r\nThe `Microsoft.PowerShell.LocalAccounts` module is marked as `Core` compatible.  If you import the dll directly, it does work.  But if you import the psd1, it complains that an assembly with the same name is already loaded.\r\n\r\n# Steps to reproduce\r\n\r\n```powershell\r\nGet-LocalUser\r\n```\r\n\r\n# Expected behavior\r\n\r\n```none\r\nGet-LocalUser should return user objects\r\n```\r\n\r\n# Actual behavior\r\n\r\n```none\r\nPS> Get-Localuser\r\nGet-Localuser: The 'Get-Localuser' command was found in the module 'Microsoft.PowerShell.LocalAccounts', but the module could not be loaded. For more information, run 'Import-Module Microsoft.PowerShell.LocalAccounts'.\r\n[316.11ms] C:\\Users\\slee\r\nPS> ipmo Microsoft.PowerShell.LocalAccounts\r\nImport-Module: Assembly with same name is already loaded\r\n[67.92ms] C:\\Users\\slee\r\nPS> get-error\r\n\r\nException             :\r\n    Type       : System.IO.FileLoadException\r\n    Message    : Assembly with same name is already loaded\r\n    TargetSite :\r\n        Name          : LoadBinaryModule\r\n        DeclaringType : Microsoft.PowerShell.Commands.ModuleCmdletBase\r\n        MemberType    : Method\r\n        Module        : System.Management.Automation.dll\r\n    StackTrace :\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadBinaryModule(PSModuleInfo parentModule, Boolean\r\ntrySnapInName, String moduleName, String fileName, Assembly assemblyToLoad, String moduleBase, SessionState ss,\r\nImportModuleOptions options, ManifestProcessingFlags manifestProcessingFlags, String prefix, Boolean loadTypes,\r\nBoolean loadFormats, Boolean& found, String shortModuleName, Boolean disableFormatUpdates)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadModule(PSModuleInfo parentModule, String fileName, String\r\nmoduleBase, String prefix, SessionState ss, Object privateData, ImportModuleOptions& options, ManifestProcessingFlags\r\nmanifestProcessingFlags, Boolean& found, Boolean& moduleFileFound)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadUsingExtensions(PSModuleInfo parentModule, String moduleName,\r\nString fileBaseName, String extension, String moduleBase, String prefix, SessionState ss, ImportModuleOptions options,\r\nManifestProcessingFlags manifestProcessingFlags, Boolean& found, Boolean& moduleFileFound)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadModuleNamedInManifest(PSModuleInfo parentModule,\r\nModuleSpecification moduleSpecification, String moduleBase, Boolean searchModulePath, String prefix, SessionState ss,\r\nImportModuleOptions options, ManifestProcessingFlags manifestProcessingFlags, Boolean loadTypesFiles, Boolean\r\nloadFormatFiles, Object privateData, Boolean& found, String shortModuleName, Nullable`1 manifestLanguageMode)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadModuleManifest(String moduleManifestPath, ExternalScriptInfo\r\nmanifestScriptInfo, Hashtable data, Hashtable localizedData, ManifestProcessingFlags manifestProcessingFlags, Version\r\nminimumVersion, Version maximumVersion, Version requiredVersion, Nullable`1 requiredModuleGuid, ImportModuleOptions&\r\noptions, Boolean& containedErrors)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadModule(PSModuleInfo parentModule, String fileName, String\r\nmoduleBase, String prefix, SessionState ss, Object privateData, ImportModuleOptions& options, ManifestProcessingFlags\r\nmanifestProcessingFlags, Boolean& found, Boolean& moduleFileFound)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadUsingExtensions(PSModuleInfo parentModule, String moduleName,\r\nString fileBaseName, String extension, String moduleBase, String prefix, SessionState ss, ImportModuleOptions options,\r\nManifestProcessingFlags manifestProcessingFlags, Boolean& found, Boolean& moduleFileFound)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadUsingMultiVersionModuleBase(String moduleBase,\r\nManifestProcessingFlags manifestProcessingFlags, ImportModuleOptions importModuleOptions, Boolean& found)\r\n   at Microsoft.PowerShell.Commands.ModuleCmdletBase.LoadUsingModulePath(PSModuleInfo parentModule, Boolean found,\r\nIEnumerable`1 modulePath, String name, SessionState ss, ImportModuleOptions options, ManifestProcessingFlags\r\nmanifestProcessingFlags, PSModuleInfo& module)\r\n   at Microsoft.PowerShell.Commands.ImportModuleCommand.ImportModule_LocallyViaName(ImportModuleOptions\r\nimportModuleOptions, String name)\r\n   at Microsoft.PowerShell.Commands.ImportModuleCommand.ImportModule_LocallyViaName_WithTelemetry(ImportModuleOptions\r\nimportModuleOptions, String name)\r\n   at Microsoft.PowerShell.Commands.ImportModuleCommand.ProcessRecord()\r\n   at System.Management.Automation.CommandProcessor.ProcessRecord()\r\n    Source     : System.Management.Automation\r\n    HResult    : -2146232799\r\nCategoryInfo          : NotSpecified: (:) [Import-Module], FileLoadException\r\nFullyQualifiedErrorId : System.IO.FileLoadException,Microsoft.PowerShell.Commands.ImportModuleCommand\r\n```\r\n\r\n# Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0-preview.2\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0-preview.2\r\nOS                             Microsoft Windows 10.0.19041\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": "2020-05-12T20:45:13Z",
  "comments": [
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "I can not repo on latest build:\r\n```\r\n Get-Localuser\r\n\r\nName               Enabled Description\r\n----               ------- -----------\r\n1                  True\r\nAdministrator      False   Built-in account for administering the computer/domain\r\nDefaultAccount     False   A user account managed by the system.\r\ndefaultuser0       False\r\nGuest              False   Built-in account for guest access to the computer/domain\r\ntest               False\r\ntest1              True\r\nTestUser1          True\r\nTestUserGet3       False   Describe\r\nTestUserRemove1    True\r\nTestUserRemove2    True\r\nTestUserSet2       True\r\nWDAGUtilityAccount False   A user account managed and used by the system for Windows Defender Application Guard scenar\u2026\r\n\r\nPS C:\\Users\\1\\Documents\\GitHub\\iSazonov\\PowerShell\\src\\powershell-win-core\\bin\\Debug\\netcoreapp5.0\\win7-x64\\publish> Get-Module\r\n\r\nModuleType Version    PreRelease Name                                ExportedCommands\r\n---------- -------    ---------- ----                                ----------------\r\nScript     1.0                   International                       {Get-WinAcceptLanguageFromLanguageListOptOut, Get\u2026\r\nManifest   7.0.0.0               Microsoft.PowerShell.Host           {Start-Transcript, Stop-Transcript}\r\nBinary     1.0.0.0               Microsoft.PowerShell.LocalAccounts  {Add-LocalGroupMember, Disable-LocalUser, Enable-\u2026\r\nManifest   7.0.0.0               Microsoft.PowerShell.Management     {Add-Content, Clear-Content, Clear-Item, Clear-It\u2026\r\nManifest   7.0.0.0               Microsoft.PowerShell.Security       {ConvertFrom-SecureString, ConvertTo-SecureString\u2026\r\nManifest   7.0.0.0               Microsoft.PowerShell.Utility        {Add-Member, Add-Type, Clear-Variable, Compare-Ob\u2026\r\nManifest   7.0.0.0               Microsoft.WSMan.Management          {Connect-WSMan, Disable-WSManCredSSP, Disconnect-\u2026\r\nScript     1.4.6                 PackageManagement                   {Find-Package, Find-PackageProvider, Get-Package,\u2026\r\nScript     1.0                   PKI                                 {Add-CertificateEnrollmentPolicyServer, Export-Ce\u2026\r\nScript     2.0.1                 PSReadLine                          {Get-PSReadLineKeyHandler, Get-PSReadLineOption, \u2026\r\n\r\nPS C:\\Users\\1\\Documents\\GitHub\\iSazonov\\PowerShell\\src\\powershell-win-core\\bin\\Debug\\netcoreapp5.0\\win7-x64\\publish> Get-Module Microsoft.PowerShell.LocalAccounts | fl\r\n\r\nName              : Microsoft.PowerShell.LocalAccounts\r\nPath              : C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\Modules\\Microsoft.PowerShell.LocalAccounts\\1.0.0.0\\Micro\r\n                    soft.Powershell.LocalAccounts.dll\r\nDescription       : Provides cmdlets to work with local users and local groups\r\nModuleType        : Binary\r\nVersion           : 1.0.0.0\r\nPreRelease        :\r\nNestedModules     : {}\r\nExportedFunctions :\r\nExportedCmdlets   : {Add-LocalGroupMember, Disable-LocalUser, Enable-LocalUser, Get-LocalGroup\u2026}\r\nExportedVariables :\r\nExportedAliases   : {algm, dlu, elu, glg\u2026}\r\n```",
      "created_at": "2020-04-24T18:09:41Z",
      "updated_at": "2020-04-24T18:09:41Z"
    },
    {
      "author": "doctordns",
      "author_association": "COLLABORATOR",
      "body": "Works here:\r\n```powershell\r\nPS C:\\foo> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0-preview.2\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0-preview.2\r\nOS                             Microsoft Windows 10.0.19608\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0, 5.0, 5.1.10032.0, 6.0.0, 6.1.0, 6.2.0, 7.0.0, 7.1.0-preview.2}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\nPS C:\\foo> get-localuser\r\n\r\nName               Enabled Description\r\n----               ------- -----------\r\nAdministrator      False   Built-in account for administering the computer/domain\r\nDefaultAccount     False   A user account managed by the system.\r\nGuest              False   Built-in account for guest access to the computer/domain\r\ntfl                True\r\nWDAGUtilityAccount False   A user account managed and used by the system for Windows Defender Application Guard scenar\u2026\r\n\r\n",
      "created_at": "2020-04-24T19:30:31Z",
      "updated_at": "2020-04-24T19:30:31Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "Interesting, need to figure out why it's not working on my system.",
      "created_at": "2020-04-24T19:59:50Z",
      "updated_at": "2020-04-24T19:59:50Z"
    },
    {
      "author": "MaximoTrinidad",
      "author_association": "NONE",
      "body": "@SteveL-MSFT \r\n\r\nIt's working on both of my Windows 10 April 2020 and Windows Insider edition too. Of course, last few days I did the service updates that were pending. And, I try them in both PowerShell 7 and Preview.2.\r\n\r\n![localGrp3_2020-04-27_15-28-01](https://user-images.githubusercontent.com/19892435/80416751-a6a2fb80-88a2-11ea-88c3-a15b0275f282.png)\r\n\r\n![localGrp_2020-04-27_15-28-01](https://user-images.githubusercontent.com/19892435/80416775-adca0980-88a2-11ea-99a7-87a3fa1563f1.png)\r\n\r\n![localGrp2_2020-04-27_15-28-01](https://user-images.githubusercontent.com/19892435/80417929-968c1b80-88a4-11ea-8cf9-911b00a553b8.png)\r\n\r\n\r\n\r\n\r\n\r\n",
      "created_at": "2020-04-27T20:32:47Z",
      "updated_at": "2020-04-27T20:32:47Z"
    }
  ],
  "created_at": "2020-04-24T17:24:44Z",
  "number": 12478,
  "state": "closed",
  "title": "LocalAccounts module not working with PS7",
  "updated_at": "2020-05-12T20:45:13Z"
}