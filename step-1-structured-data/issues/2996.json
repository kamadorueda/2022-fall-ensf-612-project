{
  "_url": "https://github.com/PowerShell/PowerShell/issues/2996",
  "author": "ephos",
  "body": "It appears that if you have domain groups added to a local group and then move the server to a workgroup before removing them Get-LocalGroupMember no longer works and instead throws an exception 'Failed to compare two elements in the array.'.  I am seeing this on Server 2016 Core, I have not tried on any other editions.  I found this while building a server in one domain that needed to move to a different one.  \r\n\r\nSteps to reproduce\r\n------------------\r\n\r\n- Join a Windows Server 2016 Core server to a domain.\r\n- Added 3 domain groups to the local administrators group.  \r\n- Moved the server back into a workgroup.  \r\n- Ran `Get-LocalGroupMember -Group Administrators`\r\n\r\nI've reproduced this on two servers.\r\n\r\nExpected behavior\r\n-----------------\r\nIt should return the group members as it would prior to moving to a workgroup and just display the unresolved SIDs for the old domain.  Then ideally allow you to reference those unresolved SIDS for Remove-LocalGroupMember.\r\n\r\nActual behavior\r\n---------------\r\nThrows an exception.\r\n![2017-01-11_17-32-25](https://cloud.githubusercontent.com/assets/14333618/21869108/ef2d15da-d823-11e6-94b1-7a12f2c3bb5a.png)\r\n\r\n\r\nEnvironment data\r\n----------------\r\n\r\n```powershell\r\n> $PSVersionTable\r\nPSVersion                      5.1.14393.206\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.14393.206\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n\r\n```\r\n",
  "closed_at": "2021-11-03T01:01:06Z",
  "comments": [
    {
      "author": "mirichmo",
      "author_association": "MEMBER",
      "body": "@ephos This is an interesting issue. Can you please provide \r\n``` powershell\r\n$Error[0] | fl * -force\r\n```\r\nas well?",
      "created_at": "2017-01-11T23:51:41Z",
      "updated_at": "2017-01-11T23:51:41Z"
    },
    {
      "author": "ephos",
      "author_association": "NONE",
      "body": "@mirichmo here you go!\r\n\r\n```powershell\r\n> $Error[0] | fl * -Force\r\n\r\n\r\nwriteErrorStream      : True\r\nPSMessageDetails      : \r\nException             : System.InvalidOperationException: Failed to compare two elements in the array. ---> \r\n                        System.NullReferenceException: Object reference not set to an instance of an object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b_\r\n                        _20_0(LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.SwapIfGreater(T[] keys, IComparer`1 \r\n                        comparer, Int32 a, Int32 b)\r\n                           at System.Collections.Generic.ArraySortHelper`1.DepthLimitedQuickSort(T[] keys, Int32 \r\n                        left, Int32 right, IComparer`1 comparer, Int32 depthLimit)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 \r\n                        length, IComparer`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 \r\n                        length, IComparer`1 comparer)\r\n                           at System.Array.Sort[T](T[] array, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumer\r\n                        able`1 membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          : \r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {0, 1}\r\n\r\n```",
      "created_at": "2017-01-12T00:08:37Z",
      "updated_at": "2017-01-12T00:08:37Z"
    },
    {
      "author": "mirichmo",
      "author_association": "MEMBER",
      "body": "Thanks for the info",
      "created_at": "2017-01-12T00:51:15Z",
      "updated_at": "2017-01-12T00:51:15Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "It's work well on Windows 10 :\r\n\r\n```powershell\r\nName                           Value\r\n----                           -----\r\nCLRVersion\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nGitCommitId                    v6.0.0-alpha.14-28-geef6ed0584ba62e232f95668ad25d277d2137efc-dirty\r\nSerializationVersion           1.1.0.1\r\nPSRemotingProtocolVersion      2.3\r\nPSEdition                      Core\r\nWSManStackVersion              3.0\r\nBuildVersion                   3.0.0.0\r\nPSVersion                      6.0.0-alpha\r\n\r\n```",
      "created_at": "2017-01-12T07:39:44Z",
      "updated_at": "2017-01-12T07:39:44Z"
    },
    {
      "author": "ssylvan",
      "author_association": "NONE",
      "body": "I am also hitting this issue, any workarounds?",
      "created_at": "2017-01-13T03:09:21Z",
      "updated_at": "2017-01-13T03:09:21Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@ssylvan Can you confirm that the problem is on Windows Server 2016 Core server only.",
      "created_at": "2017-01-13T06:46:46Z",
      "updated_at": "2017-01-13T06:46:46Z"
    },
    {
      "author": "ssylvan",
      "author_association": "NONE",
      "body": "I'm seeing it on windows 10 on a surface book.\n\nOn Thu, Jan 12, 2017 at 10:46 PM, Ilya <notifications@github.com> wrote:\n\n> @ssylvan <https://github.com/ssylvan> Can you confirm that the problem is\n> on Windows Server 2016 Core server only.\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/PowerShell/PowerShell/issues/2996#issuecomment-272373455>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABTVpweK9qalpKLeTK1yx5TwZ7csJI-Mks5rRx3ggaJpZM4LhJ0X>\n> .\n>\n\n\n\n-- \nSebastian Sylvan\n",
      "created_at": "2017-01-13T08:28:12Z",
      "updated_at": "2017-01-13T08:28:12Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@ssylvan Thanks for the clarification.",
      "created_at": "2017-01-13T08:46:32Z",
      "updated_at": "2017-01-13T08:46:32Z"
    },
    {
      "author": "itisbrendan",
      "author_association": "NONE",
      "body": "Hello, I'm seeing this error raised as well. Windows 10 Pro\r\n```\r\nPS C:\\> [System.Environment]::OSVersion.Version\r\n\r\nMajor  Minor  Build  Revision\r\n-----  -----  -----  --------\r\n10     0      14393  0\r\n```",
      "created_at": "2017-01-31T22:30:27Z",
      "updated_at": "2017-03-06T22:55:20Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@itisbrendan Thanks for confirmation!\r\n",
      "created_at": "2017-02-01T04:00:44Z",
      "updated_at": "2017-02-01T04:00:44Z"
    },
    {
      "author": "OraDotNetDev",
      "author_association": "NONE",
      "body": "Workaround [here](http://jdhitsolutions.com/blog/scripting/2342/query-local-administrators-with-cim/)\r\n\r\nSame experience in Windows 7 Enterprise and exactly the same Error details as @ephos \r\n\r\n    Major  Minor  Build  Revision\r\n    -----  -----  -----  --------\r\n    6      1      7601   65536\r\n\r\n\r\n    PS C:\\> $PSVersionTable\r\n    \r\n    Name                           Value\r\n    ----                           -----\r\n    PSVersion                      5.1.14409.1005\r\n    PSEdition                      Desktop\r\n    PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\n    BuildVersion                   10.0.14409.1005\r\n    CLRVersion                     4.0.30319.42000\r\n    WSManStackVersion              3.0\r\n    PSRemotingProtocolVersion      2.3\r\n    SerializationVersion           1.1.0.1\r\n",
      "created_at": "2017-02-02T13:11:08Z",
      "updated_at": "2017-02-03T12:58:51Z"
    },
    {
      "author": "PwshPally",
      "author_association": "NONE",
      "body": "I'm getting the same on Win10 joined to Azure AD.  This PC has never been part of a traditional Active Directory.\r\n```\r\nPS C:\\Users\\SteveMahoney> $PSVersionTable\r\n\r\nName                           Value                                                                                                                            \r\n----                           -----                                                                                                                            \r\nPSVersion                      5.1.14393.693                                                                                                                    \r\nPSEdition                      Desktop                                                                                                                          \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                                                                          \r\nBuildVersion                   10.0.14393.693                                                                                                                   \r\nCLRVersion                     4.0.30319.42000                                                                                                                  \r\nWSManStackVersion              3.0                                                                                                                              \r\nPSRemotingProtocolVersion      2.3                                                                                                                              \r\nSerializationVersion           1.1.0.1 \r\n\r\nPS C:\\Users\\SteveMahoney> Get-LocalGroupMember -Group \"Administrators\"\r\nGet-LocalGroupMember : Failed to compare two elements in the array.\r\nAt line:1 char:1\r\n+ Get-LocalGroupMember -Group \"Administrators\"\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\n    + FullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\n \r\n\r\nPS C:\\Users\\SteveMahoney> $Error[0] | fl * -force\r\n\r\n\r\nwriteErrorStream      : True\r\nPSMessageDetails      : \r\nException             : System.InvalidOperationException: Failed to compare two elements in the array. ---> System.NullReferenceException: Object reference not \r\n                        set to an instance of an object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b__20_0(LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.InsertionSort(T[] keys, Int32 lo, Int32 hi, IComparer`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.IntrospectiveSort(T[] keys, Int32 left, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Array.Sort[T](T[] array, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumerable`1 membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          : \r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {0, 1}\r\n```",
      "created_at": "2017-03-06T22:11:07Z",
      "updated_at": "2017-03-06T22:55:32Z"
    },
    {
      "author": "fullenw1",
      "author_association": "NONE",
      "body": "Same issue on Windows 2008 R2 and 2012 R2.",
      "created_at": "2017-05-04T13:11:20Z",
      "updated_at": "2017-05-04T13:51:58Z"
    },
    {
      "author": "indented-automation",
      "author_association": "CONTRIBUTOR",
      "body": "I've had a bit of a poke around and a chat and some help from faustonascimento on IRC. This code will reproduce the problem:\r\n```powershell\r\nImport-Module Microsoft.PowerShell.LocalAccounts\r\nAdd-Type -ReferencedAssemblies ([PowerShell].Assembly.Location), ([Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand].Assembly.Location) -TypeDefinition '\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing System.Security.Principal;\r\nusing Microsoft.PowerShell.Commands;\r\n\r\npublic class Test\r\n{\r\n    public static IEnumerable<LocalPrincipal> Get()\r\n    {\r\n        List<LocalPrincipal> rv = new List<LocalPrincipal>();\r\n\r\n        LocalPrincipal principal = new LocalPrincipal(Environment.UserName);\r\n        principal.SID = (SecurityIdentifier)(new NTAccount(Environment.UserName)).Translate(typeof(SecurityIdentifier));\r\n        rv.Add(principal);\r\n\r\n        // https://github.com/PowerShell/PowerShell/blob/1462ac300bc5e4a20f0360b428de1cb1de4eaba4/src/Microsoft.PowerShell.LocalAccounts/LocalAccounts/Sam.cs#L2813\r\n        rv.Add(null);\r\n\r\n        rv.Sort((p1, p2) => string.Compare(p1.Name, p2.Name, StringComparison.CurrentCultureIgnoreCase));\r\n        return rv;\r\n    }\r\n}\r\n'\r\n[Test]::Get()\r\n```\r\nThe problem appears to be caused by the null return from the MakeLocalPrincipalObject method:\r\n\r\nhttps://github.com/PowerShell/PowerShell/blob/1462ac300bc5e4a20f0360b428de1cb1de4eaba4/src/Microsoft.PowerShell.LocalAccounts/LocalAccounts/Sam.cs#L2810\r\n\r\nThe null value is being pushed to MakeLocalPrincipalObject because an invalid SID will cause a name lookup failure from Win32.LookupAccountSid. This method explicitly returns null when the error code ERROR_NONE_MAPPED (1332) is set.\r\n\r\nThis value is not filtered out and ends up being added to the rv collection which subsequently fails on Sort.\r\n\r\nIt can be argued that this value should be filtered out, as the null value is not useful. For example, by inserting:\r\n```csharp\r\nrv = rv.Where(x => x != null).ToList();\r\n```\r\nReturning the invalid entry is a deep(er) change to the GetGroupMembers method. This would potentially be useful as it may allow these commands to fix the problem (if it is such) rather than just ignoring the condition. Achievable by speculatively replacing the yield return with line with the following:\r\n```csharp\r\nvar sid = new SecurityIdentifier(idArray[i]);\r\nAccountInfo info = LookupAccountInfo(sid);\r\nif (info == null)\r\n{\r\n    info = new AccountInfo { Sid = sid };\r\n}\r\nyield return MakeLocalPrincipalObject(info);\r\n```\r\nThe LookupAccountInfo method is shared by most of the other commands, changing its behaviour would be intrusive. GetGroupMembers only appears to be used by Get-LocalGroupMember.\r\n\r\nChris",
      "created_at": "2017-10-17T14:01:20Z",
      "updated_at": "2017-10-17T14:26:24Z"
    },
    {
      "author": "jeffbi",
      "author_association": "CONTRIBUTOR",
      "body": "I think in general this makes sense. The only other method that calls `MakeLocalPrincipalObject` checks for a null return from `LookupAccountInfo` and throws an exception.\r\n\r\nI'm curious about why we would be getting an invalid SID in the first place. There are two overloads for the `GetGroupMembers` method---one takes a group name and the other takes a group SID. They do their queries for group membership in different ways (Net API _vs._ SAM API). Do we know whether the null comes from one of these or the other, or both?",
      "created_at": "2017-10-17T20:58:00Z",
      "updated_at": "2017-10-17T20:58:00Z"
    },
    {
      "author": "indented-automation",
      "author_association": "CONTRIBUTOR",
      "body": "I only see one overload for GetGroupMembers in the source code? There are two overloads for GetLocalGroupMembers, both call GetGroupMembers with a SID.\r\n\r\nIt seems the only way to recreate this is described in the first post. A machine must be added to the domain, a member added, then the machine removed from the domain. Using a local user is not sufficient to recreate the problem. I'm not at liberty to test such things at the moment although it will need to be tested after the code has been changed.",
      "created_at": "2017-10-18T14:17:59Z",
      "updated_at": "2017-10-18T14:17:59Z"
    },
    {
      "author": "jeffbi",
      "author_association": "CONTRIBUTOR",
      "body": "Oops. Sorry, you're right. I was looking at an experimental version I'd forgotten about.\r\n\r\nAfter re-reading the original description and looking at things again, the whole thing makes more sense to me and I think your solution is the correct one. There would need to be an additional minor change elsewhere to get the SID to be displayed in the output in place of the name, and there would be no way (I think) to correctly determine the ObjectClass.\r\n\r\nSorry for the noise.\r\n\r\nOf course, all this kinda depends on the LocalAccounts cmdlets getting back into the build once they no longer use the SAM API.",
      "created_at": "2017-10-18T20:42:02Z",
      "updated_at": "2017-10-18T20:42:02Z"
    },
    {
      "author": "Hicsy",
      "author_association": "NONE",
      "body": "Any update?\r\n ALL PC's at work can't use get-localgroupmembers due to being Azure-AD connected.\r\n\r\n1. Create an O365/AzureAD tenant, and add a user. Can be just intune, but most commonly EMS pack... and soon EVERY customer who buys Microsoft 365 business/enterprise suite (Windows 10 Enterprise, EMS, Office 365) will be affected.\r\n2. Start a NEW computer. Anything Windows 10. Otherwise just spool up a new VM with a fresh Windows 10 installation. During normal OOBE setup it will ask the user to sign into Microsoft.\r\n3. Sign into the work account created in step 1.\r\n4. Windows will add this user account to \"Administrators\" localgroup automatically due to there not being an active local administrator account set up.\r\n\r\nLikely due to there being an AzureAD account - this powershell cmdlet always crashes\r\n\r\n```\r\nPS C:\\WINDOWS\\system32> net localgroup administrators\r\nAlias name     administrators\r\nComment        Administrators have complete and unrestricted access to the computer/domain\r\n\r\nMembers\r\n\r\n-------------------------------------------------------------------------------\r\nAdministrator\r\nAzureAD\\TestO365Account\r\nThe command completed successfully.\r\n```\r\n\r\n```\r\nPS C:\\WINDOWS\\system32> Get-LocalGroupMember administrators\r\nGet-LocalGroupMember : Failed to compare two elements in the array.\r\nAt line:1 char:1\r\n+ Get-LocalGroupMember administrators\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\n    + FullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\n```\r\n\r\nDiagnostics:\r\n```\r\nPS C:\\WINDOWS\\system32> $Error[0] | fl * -force\r\n\r\n\r\nwriteErrorStream      : True\r\nPSMessageDetails      :\r\nException             : System.InvalidOperationException: Failed to compare two elements in the array. ---> System.NullReferenceException: Object reference not set to an instance of an\r\n                        object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b__20_0(LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.SwapIfGreater(T[] keys, IComparer`1 comparer, Int32 a, Int32 b)\r\n                           at System.Collections.Generic.ArraySortHelper`1.DepthLimitedQuickSort(T[] keys, Int32 left, Int32 right, IComparer`1 comparer, Int32 depthLimit)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Array.Sort[T](T[] array, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumerable`1 membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          :\r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          :\r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {0, 1}\r\n\r\n\r\nPS C:\\WINDOWS\\system32> $PSVersionTable\r\n\r\nName                           Value\r\n----                           -----\r\nPSVersion                      5.1.17046.1000\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.17046.1000\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n```",
      "created_at": "2017-11-28T07:01:03Z",
      "updated_at": "2017-11-28T07:07:22Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "/cc @SteveL-MSFT Azure-AD scenario failed.",
      "created_at": "2017-11-28T14:38:43Z",
      "updated_at": "2017-11-28T14:38:43Z"
    },
    {
      "author": "indented-automation",
      "author_association": "CONTRIBUTOR",
      "body": "I haven't been rushing to make a PR as this will only affect PowerShell 6 builds where it's currently not operational (and I'm rather busy at the moment).\r\n\r\nIt would be rather nice to stream this out as a standalone module, but even if it is, that won't make it immediately available to anyone.",
      "created_at": "2017-11-28T18:45:13Z",
      "updated_at": "2017-11-28T18:45:13Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@Hicsy after we have a fix in PSCore6, we can consider backporting it to Windows PowerShell 5.1.  ",
      "created_at": "2017-11-28T22:29:54Z",
      "updated_at": "2017-11-28T22:29:54Z"
    },
    {
      "author": "JohnBons",
      "author_association": "NONE",
      "body": "@SteveL-MSFT I also would like to see that fix in 5.1 since im running into the same issue. \r\n\r\nRunning windows 2012 R2\r\n\r\n```\r\n\r\nPS C:\\> [System.Environment]::OSVersion.Version\r\n\r\nMajor  Minor  Build  Revision\r\n-----  -----  -----  --------\r\n6      3      9600   0\r\n\r\nName                           Value                                                                                   \r\n----                           -----                                                                                   \r\nPSVersion                      5.1.14409.1012                                                                          \r\nPSEdition                      Desktop                                                                                 \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                                 \r\nBuildVersion                   10.0.14409.1012                                                                         \r\nCLRVersion                     4.0.30319.42000                                                                         \r\nWSManStackVersion              3.0                                                                                     \r\nPSRemotingProtocolVersion      2.3                                                                                     \r\nSerializationVersion           1.1.0.1                                                                                 \r\n\r\n\r\n\r\n\r\nwriteErrorStream      : True\r\nPSMessageDetails      : \r\nException             : System.InvalidOperationException: Failed to compare two elements in the array. ---> \r\n                        System.NullReferenceException: Object reference not set to an instance of an object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b__20_0\r\n                        (LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.SwapIfGreater(T[] keys, IComparer`1 \r\n                        comparer, Int32 a, Int32 b)\r\n                           at System.Collections.Generic.ArraySortHelper`1.DepthLimitedQuickSort(T[] keys, Int32 left, \r\n                        Int32 right, IComparer`1 comparer, Int32 depthLimit)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, \r\n                        IComparer`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, \r\n                        IComparer`1 comparer)\r\n                           at System.Array.Sort[T](T[] array, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at \r\n                        Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumerable`1 \r\n                        membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          : \r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {0, 1}\r\n\r\n```\r\n\r\n\r\n",
      "created_at": "2017-12-08T08:38:18Z",
      "updated_at": "2017-12-08T08:47:02Z"
    },
    {
      "author": "sfishy",
      "author_association": "NONE",
      "body": "FFS.",
      "created_at": "2018-05-04T16:50:42Z",
      "updated_at": "2018-05-04T16:50:42Z"
    },
    {
      "author": "neomancipator",
      "author_association": "NONE",
      "body": "Are there any updates on this?",
      "created_at": "2018-05-09T17:50:03Z",
      "updated_at": "2018-05-09T17:50:03Z"
    },
    {
      "author": "itisbrendan",
      "author_association": "NONE",
      "body": "Yes, please fix this if you can.\n\nOn Wed, May 9, 2018, 1:50 PM neomancipator <notifications@github.com> wrote:\n\n> Are there any updates on this?\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/PowerShell/PowerShell/issues/2996#issuecomment-387820740>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AYSeDTlJbiLHL2YvQ5f0k4W_4pNtYqfsks5twyxhgaJpZM4LhJ0X>\n> .\n>\n",
      "created_at": "2018-05-09T23:09:24Z",
      "updated_at": "2018-05-09T23:09:24Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@SteveL-MSFT \r\n>after we have a fix in PSCore6, we can consider backporting it to Windows PowerShell 5.1.\r\n\r\nShould we enable the module on Windows?",
      "created_at": "2018-05-10T06:27:01Z",
      "updated_at": "2018-05-10T06:27:01Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov we can't enable the module until we have a solution that uses public apis.  Since PSCore6 ships outside of Windows, we must only use public apis.\r\n\r\nSince this is impacting people, I'll see about making a change in WPS5.1, but it'll only be available on newest releases of Windows.",
      "created_at": "2018-05-10T16:02:22Z",
      "updated_at": "2018-05-10T16:04:12Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Can we migrate to [System.DirectoryServices.AccountManagement](https://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement%28v=vs.110%29.aspx)?",
      "created_at": "2018-05-11T11:08:36Z",
      "updated_at": "2018-05-11T11:08:36Z"
    },
    {
      "author": "SunnyOswal",
      "author_association": "NONE",
      "body": "still seeing this issue",
      "created_at": "2018-09-29T05:47:27Z",
      "updated_at": "2018-09-29T05:47:27Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> Can we migrate to System.DirectoryServices.AccountManagement?\r\n\r\n@SteveL-MSFT Is this right way? We have the API in Windows Compatibility Pack.",
      "created_at": "2018-10-01T05:43:58Z",
      "updated_at": "2018-10-01T05:43:58Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@iSazonov I'm not knowledgeable enough about that namespace to say whether that's the right direction.  It seems that if there's leftover data from the domain which is no longer relevant to the local system, it may be ok to add the synthetic account to inform user there are accounts that cannot be resolved.",
      "created_at": "2018-10-04T20:56:40Z",
      "updated_at": "2018-10-04T20:56:40Z"
    },
    {
      "author": "jeffbi",
      "author_association": "CONTRIBUTOR",
      "body": "Just FYI, I had been looking into using the Net* functions from the Windows API to implement this. Presumably that would remain Windows only, right?",
      "created_at": "2018-10-04T21:15:38Z",
      "updated_at": "2018-10-04T21:15:38Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@jeffbi yes, this would remain Windows only",
      "created_at": "2018-10-04T21:25:52Z",
      "updated_at": "2018-10-04T21:25:52Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@PowerShell/powershell-committee discussed this, this module is not part of PSCore6 at this time.  Porting it to use the new DirectoryServices APIs may be ok, but outside the scope of what we reviewed.",
      "created_at": "2018-10-10T22:26:44Z",
      "updated_at": "2018-10-10T22:26:44Z"
    },
    {
      "author": "nuttingd",
      "author_association": "NONE",
      "body": "I was able to work around the PowerShell bug issue by fixing the root of the problem. I found that this error was raised because I had a few corrupt/unknown users in the Group I was querying. I deleted the old entries in the Local Users and Groups (lusrmgr.msc) and the command completed with success.\r\n\r\n![image](https://user-images.githubusercontent.com/1181562/48872300-62eabf00-ed9d-11e8-9c73-41df2ec50080.png)\r\n",
      "created_at": "2018-11-21T22:56:01Z",
      "updated_at": "2018-11-21T22:56:01Z"
    },
    {
      "author": "raymondandreassen",
      "author_association": "NONE",
      "body": "Confirming nuttingd discoveries. Tested on 7 serveres, version 2012, 2012R2 and 2016. \r\nGood job!",
      "created_at": "2018-12-11T16:13:43Z",
      "updated_at": "2018-12-11T16:13:43Z"
    },
    {
      "author": "gdoct",
      "author_association": "NONE",
      "body": "Can confirm nuttingd's procedure resolves the issue.",
      "created_at": "2018-12-19T09:16:46Z",
      "updated_at": "2018-12-19T09:16:46Z"
    },
    {
      "author": "fullenw1",
      "author_association": "NONE",
      "body": "Ok than this is a workaround and the cmdlet still needs to be able to handle this situation.",
      "created_at": "2018-12-20T20:56:01Z",
      "updated_at": "2018-12-20T20:56:01Z"
    },
    {
      "author": "gpduck",
      "author_association": "CONTRIBUTOR",
      "body": "This will also be a problem if you have a deleted domain user or group and if you have a foreign SID from a 1-way trust.  We definitely need the cmdlet to be able to output the SID so that old principals can be cleaned up and foreign principals can be reported accurately.",
      "created_at": "2019-01-04T21:59:15Z",
      "updated_at": "2019-01-04T21:59:15Z"
    },
    {
      "author": "n3snah",
      "author_association": "NONE",
      "body": "This is also a big issue for the organisation that I am in and whats worse is that I am getting errors through DSC and puppet due to this cmdlet not being able to handle deleted and/or disabled users from AD.\r\n\r\nare there any further updates on fixing this issue?",
      "created_at": "2019-05-29T09:17:53Z",
      "updated_at": "2019-05-29T09:17:53Z"
    },
    {
      "author": "dgrittma",
      "author_association": "NONE",
      "body": "Can confirm this is definitely still an issue. No-one has posted a workaround that didn't involve 'fixing' the underlying issue, directly here though, so here's mine.\r\n\r\nI was zipping the results so I wanted the content basically the same whether it worked the 'easy way' or with the workaround. It's sort of nice because now there's a warning when an invalid SID is on a server.\r\n\r\n```$zipfilepath = $ZipPath\r\nNew-Item -ItemType Directory $zipfilepath -ErrorAction SilentlyContinue -Verbose | Out-Null\r\n\r\n$machinename = $env:COMPUTERNAME\r\ntry{\r\n\t$Admins = Get-LocalGroupMember \"Administrators\"\r\n }\r\ncatch{\r\n    Write-Warning \"Invalid SID or other issue detected. Remove it!!\"\r\n    $query=\"Associators of {Win32_Group.Domain='$machinename',Name='Administrators'} where Role=GroupComponent\"\r\n    $Admins = get-wmiobject -query $query -ComputerName $machinename | `\r\nSelect @{L='Name';E={$_.Caption}},Caption,@{L='ObjectClass';E={$_.__CLASS}}\r\n}\r\n$Admins | `\r\n    Select Name,@{L='Type';E={$_.ObjectClass}} | `\r\n    Export-Csv -Path \"$zipfilepath\\localadmin-$machinename.csv\" -NoTypeInformation `\r\n    -Verbose -Force\r\n```",
      "created_at": "2019-08-08T16:19:44Z",
      "updated_at": "2019-08-08T16:21:31Z"
    },
    {
      "author": "sckissel",
      "author_association": "NONE",
      "body": "This may not be a foreign SID. If the machine is AAD joined, the AAD Global Administrators role SID and the AAD Device (company) Administrators role SIDs will appear in the local admin group.\r\n\r\nIf necessary, you can use this as a psuedo-workaround: \r\n`$adminGroup.psbase.Invoke(\"Members\")|ForEach-Object -Process {$_.GetType().InvokeMember(\"Name\", 'GetProperty',$null, $_, $null)}`",
      "created_at": "2019-08-16T01:34:45Z",
      "updated_at": "2019-08-16T01:34:45Z"
    },
    {
      "author": "itisbrendan",
      "author_association": "NONE",
      "body": "Two years later..... Ugh.\n\nOn Thu, Aug 15, 2019, 9:35 PM Scott Kissel <notifications@github.com> wrote:\n\n> This may not be a foreign SID. If the machine is AAD joined, the AAD\n> Global Administrators role SID and the AAD Device (company) Administrators\n> role SIDs will appear in the local admin group.\n>\n> If necessary, you can use this as a psuedo-workaround:\n> $adminGroup.psbase.Invoke(\"Members\")|ForEach-Object -Process\n> {$_.GetType().InvokeMember(\"Name\", 'GetProperty',$null, $_, $null)}\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/PowerShell/PowerShell/issues/2996?email_source=notifications&email_token=AGCJ4DKQEP4UCSAZLJEES3TQEX76JA5CNFSM4C4ETUL2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD4NNPGY#issuecomment-521852827>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AGCJ4DN45UCPH34O6XOIXBDQEX76JANCNFSM4C4ETULQ>\n> .\n>\n",
      "created_at": "2019-08-24T03:25:45Z",
      "updated_at": "2019-08-24T03:25:45Z"
    },
    {
      "author": "Skatterbrainz",
      "author_association": "NONE",
      "body": "Yep.  On Insider Preview 18936 and PS 5.1.18936.1000 no AD or AzureAD, just workgroup.  Still getting this error. :(",
      "created_at": "2019-08-27T18:03:16Z",
      "updated_at": "2019-08-27T18:03:16Z"
    },
    {
      "author": "Keybonesabi",
      "author_association": "NONE",
      "body": "I get this error anytime the orphaned SID is referred to in the Security Group. ",
      "created_at": "2019-08-30T18:34:28Z",
      "updated_at": "2019-08-30T18:48:42Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Looking at this many feedback I hope to continue #9926 (and create RFC)\r\n/cc @SteveL-MSFT for information",
      "created_at": "2019-08-30T19:02:07Z",
      "updated_at": "2019-08-30T19:02:07Z"
    },
    {
      "author": "Skatterbrainz",
      "author_association": "NONE",
      "body": "None of the machines I have encountered this on were ever joined to a domain, and do not have any orphaned SIDs in local groups. The latest was a VM I built from scratch using a Win10 1903 iso. ",
      "created_at": "2019-09-02T03:30:51Z",
      "updated_at": "2019-09-02T03:30:51Z"
    },
    {
      "author": "MantisTree",
      "author_association": "NONE",
      "body": "Happening for me as well.  Group 'Users' has an unassociated SID. Attempting Get-LocalGroupMember on this group returns:\r\n\r\n```\r\nGet-LocalGroupMember : Failed to compare two elements in the array.\r\nAt line:4 char:5\r\n+     Get-LocalGroupMember -Group $LocalGroup\r\n+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~`~~~~~~~~~~~\r\n+ CategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\n+ FullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\n```\r\n\r\nBlocking an urgent audit. WMI workaround has its own quirks but is apparently the best we can do until this is fixed.\r\n\r\n$Error[0] | fl * -force` returns:\r\n\r\n```\r\nwriteErrorStream      : True\r\nPSMessageDetails      : \r\nException             : System.InvalidOperationException: Failed to compare two elements in the array. ---> System.NullReferenceException: Object reference not set to an instance of \r\n                        an object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b__20_0(LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.InsertionSort(T[] keys, Int32 lo, Int32 hi, IComparer`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.IntrospectiveSort(T[] keys, Int32 left, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(T[] keys, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Array.Sort[T](T[] array, Int32 index, Int32 length, IComparer`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumerable`1 membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          : \r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          : \r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 4\r\nPipelineIterationInfo : {0, 1}\r\n```\r\n\r\n[System.Environment]::OSVersion.Version returns:\r\n```\r\nMajor  Minor  Build  Revision\r\n-----  -----  -----  --------\r\n10     0      16299  0       \r\n```\r\n\r\n$PSVersionTable returns:\r\n```\r\nName                           Value                                                                                                                                                    \r\n----                           -----                                                                                                                                                    \r\nPSVersion                      5.1.16299.1146                                                                                                                                           \r\nPSEdition                      Desktop                                                                                                                                                  \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                                                                                                  \r\nBuildVersion                   10.0.16299.1146                                                                                                                                          \r\nCLRVersion                     4.0.30319.42000                                                                                                                                          \r\nWSManStackVersion              3.0                                                                                                                                                      \r\nPSRemotingProtocolVersion      2.3                                                                                                                                                      \r\nSerializationVersion           1.1.0.1       \r\n```",
      "created_at": "2019-09-04T13:00:53Z",
      "updated_at": "2019-09-04T13:00:53Z"
    },
    {
      "author": "ffalor",
      "author_association": "NONE",
      "body": "> This is also a big issue for the organisation that I am in and whats worse is that I am getting errors through DSC and puppet due to this cmdlet not being able to handle deleted and/or disabled users from AD.\r\n> \r\n> are there any further updates on fixing this issue?\r\n\r\nI created a Puppet Task to remove the unresolvable sid issue I was having. \r\n\r\nhttps://github.com/ffalor/ffalor-resolve_sid\r\n\r\nWill be putting it on the forge in a little bit once I go through and make it a little cleaner. We had hundreds of servers failing in Puppet due to the SID issue, and I was able to fix them all in a few seconds with this task.\r\n\r\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/35144141?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/ffalor/ffalor-resolve_sid\">ffalor/ffalor-resolve_sid</a></strong></div><div>Puppet Task to remove unresolvable SIDs from Windows - ffalor/ffalor-resolve_sid</div></blockquote>\r\n\r\nUploaded to forge\r\nhttps://forge.puppet.com/ffalor/resolve_sid",
      "created_at": "2019-09-26T13:55:31Z",
      "updated_at": "2019-10-08T20:57:03Z"
    },
    {
      "author": "razgrim",
      "author_association": "NONE",
      "body": "I know it's not quite the same, but you can parse text out of the following command to get local group membership in place of this command.\r\n\"net localgroup [localgroupname]\"\r\nex:\r\n`net localgroup administrators`\r\nWindows just can't seem to kill their old console =/",
      "created_at": "2020-01-13T16:08:43Z",
      "updated_at": "2020-01-13T16:09:17Z"
    },
    {
      "author": "jodel64",
      "author_association": "NONE",
      "body": "Found a script which fixes the problematic SAM-Entry here\r\nhttps://administrator.de/content/detail.php?id=538099\r\nIt removes non resolvable SIDs from the hex binary for the administrators group membership. After running the script the PS command works again. So it's not a Powershell problem, it's a Windows bug which leaves old sid entries in the SAM. First script is to manually remove specific SIDs, the second automatically removes all non resolvable SIDs from the entry.\r\n\r\n<blockquote><img src=\"https://administrator.de/images/categories/userverwaltung_windows-240x130.jpg\" width=\"48\" align=\"right\"><div><img src=\"https://administrator.de/icons/ios/AppIcon.appiconset/Icon-60@3x.png\" height=\"14\"> Administrator.de</div><div><strong><a href=\"https://administrator.de/forum/abfrage-lokaler-gruppenmitgliedschaften-windows-bug-umschiffen-538099.html\">Abfrage lokaler Gruppenmitgliedschaften in Windows - Bug umschiffen</a></strong></div><div>Moin Kollegen. Wer schon auf Betriebstemperatur ist und ein forderndes Problem sucht - Mit dem Powershell-Kommando bekommt man normalerweise die Mitglieder der lokalen Admingruppe angezeigt. Hat man d.</div></blockquote>",
      "created_at": "2020-01-27T16:24:28Z",
      "updated_at": "2020-01-27T17:16:10Z"
    },
    {
      "author": "passbt",
      "author_association": "NONE",
      "body": "I'd just like to confirm that I'm running into this problem when I try to use Get-LocalGroupMember and my target group has unresolved SIDs in them. Most likely the AD objects no longer exist.",
      "created_at": "2020-03-25T21:42:21Z",
      "updated_at": "2020-03-25T21:42:21Z"
    },
    {
      "author": "passbt",
      "author_association": "NONE",
      "body": "I think this is the best workaround to being able to enumerate all members of a group even if there are unresolved SIDs.\r\nforeach ($group in Get-LocalGroup ) {\r\n    $group = [ADSI]\"WinNT://$env:COMPUTERNAME/$group\"\r\n    $group_members = @($group.Invoke('Members') | % {([adsi]$_).path})\r\n    $group_members\r\n}",
      "created_at": "2020-03-25T23:42:44Z",
      "updated_at": "2020-03-25T23:42:44Z"
    },
    {
      "author": "o-l-a-v",
      "author_association": "NONE",
      "body": "Issue from january 2017, still not resolved in Windows 10, not even 20H1 (19041.172).\r\nGG Microsoft.\r\n\r\nThanks for the code @passbt ",
      "created_at": "2020-03-31T13:58:42Z",
      "updated_at": "2020-03-31T13:59:07Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@o-l-a-v The code is not in the repo. It is Windows component. But Windows PowerShell is frozen - only PowerShell Core can progress. So it is zugzwang :-(\r\nWe could migrate to new module but it is a breaking change.",
      "created_at": "2020-03-31T15:41:43Z",
      "updated_at": "2020-03-31T15:41:43Z"
    },
    {
      "author": "o-l-a-v",
      "author_association": "NONE",
      "body": "> @o-l-a-v The code is not in the repo. It is Windows component. But Windows PowerShell is frozen - only PowerShell Core can progress. So it is zugzwang :-(\n> We could migrate to new module but it is a breaking change.\n\nRoger that, makes sense. But unless PS Core becomes default for Windows very soon, this is a very basic PS management ability that really should work out of the box on any Windows edition and version IMHO. How Ms fixes or mitigates that functionality is not important. The only important thing is that it should work out of the box, or removed as it can cause serious issues.",
      "created_at": "2020-03-31T15:47:39Z",
      "updated_at": "2020-03-31T15:47:39Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "Please use Windows feedback tool to vote for the fix.",
      "created_at": "2020-03-31T15:57:21Z",
      "updated_at": "2020-03-31T15:57:21Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Mark this issue to be re-reviewed by the committee.\r\n`Get-LocalGroupMember` is not part of the PowerShell repo, but given that the `Microsoft.PowerShell.LocalAccount` module is marked as `CompatiblePSEdition = @('Desktop', 'Core')` , people will use it in PowerShell 7 and run into the same issue. So we probably should push for a fix in Windows.",
      "created_at": "2020-03-31T20:55:33Z",
      "updated_at": "2020-03-31T20:55:33Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "My first plan was to rewrite the module from scratch but today I look the code and found that we can port it to public API (AccountManagement) with minimal breaking changes (I don't know how many breaking changes will be, while I only see exception handling).\r\nI hope to pull a draft in hours.",
      "created_at": "2020-04-01T15:04:36Z",
      "updated_at": "2020-04-01T15:04:36Z"
    },
    {
      "author": "doctordns",
      "author_association": "COLLABORATOR",
      "body": "That is great news Ilya!  I look forward to seeing this and will for sure test it when it hits a daily build.",
      "created_at": "2020-04-01T15:18:20Z",
      "updated_at": "2020-04-01T15:18:20Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "For Windows PowerShell 5.1, we've started a conversation with the team that owns servicing it to see if they are willing to make the fix.  ",
      "created_at": "2020-04-01T17:21:06Z",
      "updated_at": "2020-04-01T17:21:06Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@doctordns You can test. Specially in domain environment. That would be great if you made a new test file for domain scenario.\r\n",
      "created_at": "2020-04-06T15:47:12Z",
      "updated_at": "2020-04-06T15:47:12Z"
    },
    {
      "author": "LostLogic",
      "author_association": "NONE",
      "body": "For those who run into this problem, and just need a workaround, here is a snippet that should give you what you need:\r\n`$localAdminGroupWmi = Get-WMIObject Win32_Group -Filter \"Name='Administrators'\"\r\n$localAdminGroupWmi.GetRelated(\"Win32_UserAccount\")`\r\n\r\nThis will subsequently list all User Accounts that are members of the Administrators group. Please note that \"Administrators\" is not language agnostic. For a Windows PC with Norwegian language, it would be \"Administratorer\" for instance.\r\n\r\nIf you need to check if a specific account is member of the admin group, you could then do something like this:\r\n\r\n`if($null -eq ($localAdminGroupWmi.GetRelated(\"Win32_UserAccount\") | Where-Object -Property Caption -Like -Value \"*\\AdminAccount\"))\r\n{\r\nWrite-Host \"No account with name \"AdminAccount\" found in the Administators group\"\r\n}`",
      "created_at": "2020-06-09T11:19:47Z",
      "updated_at": "2020-06-09T11:20:18Z"
    },
    {
      "author": "Rusty-Shackleford",
      "author_association": "NONE",
      "body": "@SteveL-MSFT - any updates on this?  Our organization is seeing this same behavior after migrating to a hybrid-joined model.  PS 5.1 is still the lowest common denominator for infrastructure and InfoSec operations in many corporations.  \ud83d\ude04 ",
      "created_at": "2020-10-27T00:12:42Z",
      "updated_at": "2020-10-27T00:13:59Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@Rusty-Shackleford The module is not in the repo, it is Windows component. So please use Windows Feedback tool and other channels to retort the issue to Windows team.",
      "created_at": "2020-10-27T03:34:17Z",
      "updated_at": "2020-10-27T03:34:17Z"
    },
    {
      "author": "Nejimban-fr",
      "author_association": "NONE",
      "body": "Hi,\r\nFor me, the problem was solved when deleting orphaned SID in the local group of the remote computer.\r\nJust need to find a way to automatically do it on all machines...",
      "created_at": "2021-10-29T15:01:43Z",
      "updated_at": "2021-10-29T15:01:43Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as external and has not had any activity for **1 day**. It has been be closed for housekeeping purposes.",
      "created_at": "2021-11-03T01:01:05Z",
      "updated_at": "2021-11-03T01:01:05Z"
    },
    {
      "author": "francisco-lafe",
      "author_association": "NONE",
      "body": "> \r\n\r\nStupid bot",
      "created_at": "2021-11-19T17:27:26Z",
      "updated_at": "2021-11-19T17:47:49Z"
    },
    {
      "author": "neozoen",
      "author_association": "NONE",
      "body": "good old batch, works for me to clean up all local admins, international:\r\n\r\nFind BuildIn-Admin-Name and gruop:\r\nFOR /F \"tokens=2 delims==\" %%g IN ('WMIC Group WHERE \"LocalAccount='TRUE' AND SID='S-1-5-32-544'\" GET Name /VALUE') DO @SET LAG=%%g\r\nFOR /F \"delims= \" %%a IN ('WMIC USERACCOUNT WHERE \"LocalAccount='TRUE'\" GET Name^,SID^|FIND /i \"-500\"') DO @SET LAD=%%a\r\n\r\nMove all users from BuildIn-Admin-group, except Build-in-Admin:\r\nFOR /F \"delims= skip=5\" %%s in ('NET LOCALGROUP \"%LAG%\" ^|find /v \".\" ^|FINDSTR /x /i /v /c:\"%LAD%\"') DO NET LOCALGROUP \"%LAG%\" /DELETE \"%%s\"\r\n\r\ndeactivate all local users\r\nFOR /F \"tokens=1 skip=1\" %%i IN ('WMIC USERACCOUNT WHERE \"LocalAccount='TRUE' AND Disabled='FALSE'\" GET NAME') DO NET USER \"%%i\" /ACTIVE:NO\r\n\r\ndue the FOR Loop, the last loop gives an error - i ignore that",
      "created_at": "2021-12-03T09:08:34Z",
      "updated_at": "2021-12-03T09:08:34Z"
    },
    {
      "author": "RafaelRuales",
      "author_association": "NONE",
      "body": "> I think this is the best workaround to being able to enumerate all members of a group even if there are unresolved SIDs. foreach ($group in Get-LocalGroup ) { $group = [ADSI]\"WinNT://$env:COMPUTERNAME/$group\" $group_members = @($group.Invoke('Members') | % {([adsi]$_).path}) $group_members }\r\n\r\nBest answer. works like a charm to display members from AAD who are showing as SIDS",
      "created_at": "2022-01-18T21:25:14Z",
      "updated_at": "2022-01-18T21:25:14Z"
    },
    {
      "author": "mjr4077au",
      "author_association": "NONE",
      "body": "This really needs to be re-opened. The issue may be caused by orphaned SIDs, but the orphaned SIDs on my device are AzureAD SIDs. I don't want to resort to the ADSI interface because while I understand it, my colleagues probably wouldn't. We use Powershell to use its native modules and cmdlets...",
      "created_at": "2022-02-03T21:19:20Z",
      "updated_at": "2022-02-03T21:19:30Z"
    },
    {
      "author": "AndrewSav",
      "author_association": "NONE",
      "body": "It also still does not seem to be resolved on the lastest as of the time of writing Powershell Core 7.2.2.",
      "created_at": "2022-04-21T11:05:59Z",
      "updated_at": "2022-04-21T11:05:59Z"
    },
    {
      "author": "mmcmd",
      "author_association": "NONE",
      "body": "Can confirm, also facing this error\r\n\r\nThanks for the workaround",
      "created_at": "2022-04-27T17:46:04Z",
      "updated_at": "2022-04-27T17:46:04Z"
    },
    {
      "author": "mike-loux-planview",
      "author_association": "NONE",
      "body": "Yup. PowerShell 7.2.3 also exhibits the same behavior:\r\n```PowerShell\r\nPS \u276f Get-LocalGroupMember -Group \"Administrators\"\r\nGet-LocalGroupMember: Failed to compare two elements in the array.\r\n\r\nPS \u276f $Error[0] | Format-List * -Force\r\n\r\nPSMessageDetails      :\r\nException             : System.InvalidOperationException: Failed to compare two elements in the array.\r\n                         ---> System.NullReferenceException: Object reference not set to an instance of an object.\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.<>c.<ProcessesMembership>b__20_0(LocalPrincipal p1, LocalPrincipal p2)\r\n                           at System.Collections.Generic.ArraySortHelper`1.InsertionSort(Span`1 keys, Comparison`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.IntroSort(Span`1 keys, Int32 depthLimit, Comparison`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.IntrospectiveSort(Span`1 keys, Comparison`1 comparer)\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(Span`1 keys, Comparison`1 comparer)\r\n                           --- End of inner exception stack trace ---\r\n                           at System.Collections.Generic.ArraySortHelper`1.Sort(Span`1 keys, Comparison`1 comparer)\r\n                           at System.Collections.Generic.List`1.Sort(Comparison`1 comparison)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessesMembership(IEnumerable`1 membership)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessGroup(LocalGroup group)\r\n                           at Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand.ProcessRecord()\r\nTargetObject          :\r\nCategoryInfo          : NotSpecified: (:) [Get-LocalGroupMember], InvalidOperationException\r\nFullyQualifiedErrorId : An unspecified error occurred.,Microsoft.PowerShell.Commands.GetLocalGroupMemberCommand\r\nErrorDetails          :\r\nInvocationInfo        : System.Management.Automation.InvocationInfo\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo : {0, 1}\r\n```",
      "created_at": "2022-05-03T19:45:57Z",
      "updated_at": "2022-05-03T19:45:57Z"
    },
    {
      "author": "lassadz",
      "author_association": "NONE",
      "body": "> Hi, For me, the problem was solved when deleting orphaned SID in the local group of the remote computer. Just need to find a way to automatically do it on all machines...\r\n\r\nThank's",
      "created_at": "2022-05-11T08:51:54Z",
      "updated_at": "2022-05-11T08:51:54Z"
    },
    {
      "author": "weyCC81",
      "author_association": "NONE",
      "body": "This is still happening, also on Windows 11 ... #please-reopen #reopen",
      "created_at": "2022-05-25T08:31:51Z",
      "updated_at": "2022-05-25T08:32:22Z"
    },
    {
      "author": "Dellroc",
      "author_association": "NONE",
      "body": "Bag i back again",
      "created_at": "2022-05-26T09:35:53Z",
      "updated_at": "2022-05-26T09:35:53Z"
    },
    {
      "author": "lukeypap",
      "author_association": "NONE",
      "body": "yep experiencing the same issue",
      "created_at": "2022-05-31T14:13:00Z",
      "updated_at": "2022-05-31T14:13:00Z"
    },
    {
      "author": "djlause",
      "author_association": "NONE",
      "body": "- Definitely broken with AzureAD machines so pretty much a worthless command with AAD in the mix and that is fairly common now.   Can we get this fixed or should we bark up another tree? ",
      "created_at": "2022-05-31T15:39:12Z",
      "updated_at": "2022-05-31T15:39:12Z"
    },
    {
      "author": "mwtrigg",
      "author_association": "NONE",
      "body": "I would say you\u2019re barking up the wrong tree.  It was made clear a while ago that the pride is not in this repo, and that it would have to be addressed by the Windows team.\r\n\r\nhttps://github.com/PowerShell/PowerShell/issues/2996#issuecomment-716957100",
      "created_at": "2022-05-31T15:47:30Z",
      "updated_at": "2022-05-31T15:47:30Z"
    },
    {
      "author": "Jangab-water",
      "author_association": "NONE",
      "body": "I have same problems in `21H2(OS build 19044.1706) in Powershell 7.2.4`. `Get-LocalGroupMember -Group \"Guests\"` works fine, but `Get-LocalGroupMember -Group \"Administrators\"` raise Error: `Get-LocalGroupMember: Failed to compare two elements in the array`.\r\n\r\nWho has some information about this in newest?",
      "created_at": "2022-06-09T03:00:41Z",
      "updated_at": "2022-06-09T03:00:41Z"
    },
    {
      "author": "o-l-a-v",
      "author_association": "NONE",
      "body": "@Jangab-water and others waiting for a fix: I'd just consider this issue as not going to be fixed any time soon. PowerShell team says this is an Windows issue. So vote on this issue on Feedback Hub i guess:\r\n\r\n* https://aka.ms/AAh5egg\r\n\r\nBut workarounds exists, like:\r\n\r\n* https://github.com/PowerShell/PowerShell/issues/2996#issuecomment-604146661\r\n\r\nExample of use:\r\n\r\n<details><summary>Click to expand</summary>\r\n\r\n```powershell\r\n#Requires -RunAsAdministrator\r\n<#\r\n    .SYNOPSIS\r\n        Example of how to get group members without using Get-LocalGroupMember, which breaks with unresolvable SIDs.\r\n\r\n    .NOTES\r\n        # Script info\r\n        Author:   Olav R\u00f8nnestad Birkeland | github.com/o-l-a-v\r\n        Created:  220609\r\n        Modified: 220609\r\n\r\n        # Resources        \r\n        ## Relevant GitHub issue\r\n        * https://github.com/PowerShell/PowerShell/issues/2996\r\n          * https://github.com/PowerShell/PowerShell/issues/2996#issuecomment-604146661\r\n        ## Known SIDs\r\n        * https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers#well-known-sids\r\n        ## Feedback Hub\r\n        * https://aka.ms/AAh5egg\r\n#>\r\n\r\n\r\n# Get all groups with all members\r\n## Get\r\n$LocalGroups = [PSCustomObject[]](\r\n    $([array](Get-LocalGroup)).ForEach{\r\n        $null = Add-Member -InputObject $_ -MemberType 'NoteProperty' -Force -Name 'Members' -Value (\r\n            [string[]](\r\n                $(\r\n                    [adsi](\r\n                        'WinNT://{0}/{1}' -f $env:COMPUTERNAME, $_.'Name'\r\n                    )\r\n                ).Invoke(\r\n                    'Members'\r\n                ).ForEach{\r\n                    $([adsi]($_)).'path'.Split('/')[-1]\r\n                }\r\n            )\r\n        )\r\n        $_\r\n    } | Sort-Object -Property 'Name'\r\n)\r\n\r\n## View some info\r\n$LocalGroups | Format-Table -AutoSize -Property 'Name','SID',@{'Name'='Members';'Expression'={[uint16]$_.'Members'.'Count'}}\r\n\r\n\r\n# Get members of specific group\r\n## Get Administrators group\r\n$Administrators = Get-LocalGroup -SID 'S-1-5-32-544'\r\n\r\n## Get group members\r\n$null = Add-Member -InputObject $Administrators -MemberType 'NoteProperty' -Force -Name 'Members' -Value (\r\n    [string[]](\r\n        $(\r\n            [adsi](\r\n                'WinNT://{0}/{1}' -f $env:COMPUTERNAME, $Administrators.'Name'\r\n            )\r\n        ).Invoke(\r\n            'Members'\r\n        ).ForEach{\r\n            $([adsi]($_)).'path'.Split('/')[-1]\r\n        }\r\n    )\r\n)\r\n\r\n## Output members\r\n$Administrators.'Members'\r\n\r\n```\r\n\r\n</details>\r\n\r\nResources\r\n\r\n* https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers#well-known-sids\r\n* https://administrator.de/content/detail.php?id=538099",
      "created_at": "2022-06-09T07:44:38Z",
      "updated_at": "2022-06-09T07:57:57Z"
    },
    {
      "author": "GoodThings2Life",
      "author_association": "NONE",
      "body": "Yeah, we certainly wouldn't want two teams in the same company to like, you know, have to TALK and collaborate with one another to solve a problem. That would just be CRAZY.\r\n\r\nFix your ****, Microsoft.",
      "created_at": "2022-06-09T20:44:21Z",
      "updated_at": "2022-06-09T20:44:21Z"
    },
    {
      "author": "weyCC81",
      "author_association": "NONE",
      "body": "So key is just ask them weekly on every channel available so they don\u2018t have time to collaborate\u2026 or was it the other way around?\r\n\r\n@mirichmo: What are this \u201eother channels\u201c where we public and transparent can open a bug/ticket/report in the right place?",
      "created_at": "2022-06-09T22:23:29Z",
      "updated_at": "2022-06-09T22:23:29Z"
    },
    {
      "author": "BrendanHere",
      "author_association": "NONE",
      "body": "Yes, please let us know. This bug has been an issue since 2017 - some traction would be greatly appreciated. It's a useful commodity via PowerShell, if it worked. ",
      "created_at": "2022-06-10T02:49:16Z",
      "updated_at": "2022-06-10T02:49:16Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "> What are this \u201eother channels\u201c where we public\r\n\r\nPlease use Windows Feedback tool.",
      "created_at": "2022-06-10T03:06:19Z",
      "updated_at": "2022-06-10T03:06:19Z"
    },
    {
      "author": "francisco-lafe",
      "author_association": "NONE",
      "body": "> \r\n\r\n\r\n\r\n> > What are this \u201eother channels\u201c where we public\r\n> \r\n> Please use Windows Feedback tool.\r\n\r\nlol",
      "created_at": "2022-07-11T23:38:54Z",
      "updated_at": "2022-07-11T23:38:54Z"
    },
    {
      "author": "passbt",
      "author_association": "NONE",
      "body": "Without providing a link to instructions on how to use the \"feedback tool\",\nI think I'd be easier if MS just told everyone on this thread to take a\nhike it's not going to be fixed.\n",
      "created_at": "2022-07-12T21:49:01Z",
      "updated_at": "2022-07-12T21:49:07Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Information about the \"feedback hub app\" can be found at https://github.com/PowerShell/PowerShell#windows-powershell-vs-powershell-core.\r\n\r\nWe opened a bug about this to the internal team that owns the `Microsoft.PowerShell.LocalAccounts` module on 6/9/2022. The last time I checked, there was no progress on the fix yet. However, the bug is still active, and that means it's likely to be fixed at some point depending on the priorities of that team.\n\n<blockquote><img src=\"https://repository-images.githubusercontent.com/49609581/aad0ad80-cdec-11ea-8248-a37bc0571bfd\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/PowerShell\">GitHub - PowerShell/PowerShell: PowerShell for every system!</a></strong></div><div>PowerShell for every system! Contribute to PowerShell/PowerShell development by creating an account on GitHub.</div></blockquote>",
      "created_at": "2022-07-12T21:59:59Z",
      "updated_at": "2022-07-12T22:00:01Z"
    },
    {
      "author": "francisco-lafe",
      "author_association": "NONE",
      "body": "> \r\n\r\n\r\n\r\n> Information about the \"feedback hub app\" can be found at https://github.com/PowerShell/PowerShell#windows-powershell-vs-powershell-core.\r\n> \r\n> We opened a bug about this to the internal team that owns the `Microsoft.PowerShell.LocalAccounts` module on 6/9/2022. The last time I checked, there was no progress on the fix yet. However, the bug is still active, and that means it's likely to be fixed at some point depending on the priorities of that team.\r\n> \r\n> > <img alt=\"\" width=\"48\" src=\"https://repository-images.githubusercontent.com/49609581/aad0ad80-cdec-11ea-8248-a37bc0571bfd\"><img alt=\"\" height=\"14\" src=\"https://camo.githubusercontent.com/b6a12909f1e31185a69a73d59208c507a992236d3230f9fc18e85058ae3d19e7/68747470733a2f2f6769746875622e6769746875626173736574732e636f6d2f66617669636f6e732f66617669636f6e2e737667\"> GitHub**[GitHub - PowerShell/PowerShell: PowerShell for every system!](https://github.com/PowerShell/PowerShell)**PowerShell for every system! Contribute to PowerShell/PowerShell development by creating an account on GitHub.\r\n\r\nThat's a way better answer, thanks.\n\n<blockquote><img src=\"https://repository-images.githubusercontent.com/49609581/aad0ad80-cdec-11ea-8248-a37bc0571bfd\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/PowerShell\">GitHub - PowerShell/PowerShell: PowerShell for every system!</a></strong></div><div>PowerShell for every system! Contribute to PowerShell/PowerShell development by creating an account on GitHub.</div></blockquote>",
      "created_at": "2022-07-12T22:02:10Z",
      "updated_at": "2022-07-12T22:02:12Z"
    },
    {
      "author": "itisbrendan",
      "author_association": "NONE",
      "body": "Totally appreciate the answer. Truly appreciate it. Please do remember that\nI opened this case back in 2017 though. 5+ YEARS for a \"bug fix\"... Really?\nJust saying...\n\nWe could really use this functionality.\n",
      "created_at": "2022-07-12T22:57:51Z",
      "updated_at": "2022-07-12T22:57:55Z"
    },
    {
      "author": "1nFlight",
      "author_association": "NONE",
      "body": "So... ran into this when deploying a custom policy to add Localusers in Azure Joined devices. \r\nThe policy failed on some devices with error 65000. \r\nRunning this Get-LocalGroupMembers for administrator failed with this same results from the OP.  \r\n\r\nGetting the members of the Administrators Group from the GUID, you will most likely find a couple of SIDs that may either be obsolete or possibly the GUID no longer match with the azure object ID. \r\n\r\n**Resolution:**\r\nDelete the two GUIDs\r\nThe powershell command should work. \r\nMy policies started also coming down. \r\n\r\nI suspect the GUIDs are created in the Azure Active Directory portal under \r\nhttps://portal.azure.com/#view/Microsoft_AAD_Devices/DevicesMenuBlade/~/DeviceSettings/menuId~/null\r\n Select \"Manage Additional local administrators on all Azure AD joined devices\"\r\n \r\n You can also access the Group role under AD role management:\r\n https://portal.azure.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles/defaultId/roles\r\n\r\nLook for Azure AD Joined Device Local Administrator. \r\nDelete the members since they can be added via MDM policy anyway. (only if managed via MDM of course). \r\n\r\nHope that helps. \r\n\r\n<blockquote><div><strong><a href=\"https://portal.azure.com/#view/Microsoft_AAD_Devices/DevicesMenuBlade/~/DeviceSettings/menuId~/null\">Microsoft Azure</a></strong></div></blockquote>\r\n<blockquote><div><strong><a href=\"https://portal.azure.com/#view/Microsoft_Azure_PIMCommon/ResourceMenuBlade/~/roles/resourceId//resourceType/tenant/provider/aadroles/defaultId/roles\">Microsoft Azure</a></strong></div></blockquote>",
      "created_at": "2022-07-23T02:35:57Z",
      "updated_at": "2022-07-23T02:39:41Z"
    },
    {
      "author": "ganlbarone",
      "author_association": "NONE",
      "body": "This is absolutely INSANE this has taken this long to fix. This is still impacting ps 5.1 after 5 years? We cant properly extract local admin users via this cmdlet if the machine is Azure bound? And we see no problem with that? \r\n\r\nIll also add that CMPivot in SCCM also fails (see below), presumably for the exact same reason the cmdlet is failing. This really needs to be fixed, cannot gather proper data on this, and to have this disparity between legacy on prem machines and azure joined machines is just pure silliness. \r\n\r\n![image](https://user-images.githubusercontent.com/31355460/187456731-0a13771d-9633-4f58-bb04-337eae635c41.png)\r\n",
      "created_at": "2022-08-30T13:59:38Z",
      "updated_at": "2022-08-30T13:59:38Z"
    },
    {
      "author": "mwtrigg",
      "author_association": "NONE",
      "body": "I couldn't find any exsiting feedback in the Feedback Hub.  I've created an issue - perhaps if everybody adds their comments to this feedback item (I understand - the feedback hub is ridiculously painful -- the fact that I can't access it from anything other than an app on a windows box is insane).  Here's a link to the feedback, please upvote it and comment on it.\r\n\r\nhttps://aka.ms/AAhw50v\n\n<blockquote><img src=\"https://compass-ssl.microsoft.com/assets/4c/51/4c51de82-ae73-4037-8fec-388dbddf4953.png?n=windows11.png\" width=\"48\" align=\"right\"><div>Windows Insider</div><div><strong><a href=\"https://aka.ms/AAhw50v\">Windows Insider Program</a></strong></div><div>Become an Insider: be one of the first to explore new Windows features for you and your business or use the latest Windows SDK to build great apps.</div></blockquote>",
      "created_at": "2022-09-01T18:04:30Z",
      "updated_at": "2022-09-01T18:04:33Z"
    },
    {
      "author": "ganlbarone",
      "author_association": "NONE",
      "body": "> I couldn't find any exsiting feedback in the Feedback Hub. I've created an issue - perhaps if everybody adds their comments to this feedback item (I understand - the feedback hub is ridiculously painful -- the fact that I can't access it from anything other than an app on a windows box is insane). Here's a link to the feedback, please upvote it and comment on it.\r\n> \r\n> https://aka.ms/AAhw50v\r\n> \r\n> > <img alt=\"\" width=\"48\" src=\"https://camo.githubusercontent.com/2ec8dfb29014a03c54ca53792c82b418cf2dab6ea40066959e6183d7fb1f19a3/68747470733a2f2f636f6d706173732d73736c2e6d6963726f736f66742e636f6d2f6173736574732f34632f35312f34633531646538322d616537332d343033372d386665632d3338386462646466343935332e706e673f6e3d77696e646f777331312e706e67\">Windows Insider**[Windows Insider Program](https://aka.ms/AAhw50v)**Become an Insider: be one of the first to explore new Windows features for you and your business or use the latest Windows SDK to build great apps.\r\n\r\nI provided the below feedback, others should be able to access via this link https://aka.ms/AAhwjw8. \r\n\r\nWould be good for everyone posting here to also post on that thread so we can get eyes on this from Windows team. I understand there are work arounds, but this is breaking things beyond just running PS commands on a singular client. \r\n\r\n![image](https://user-images.githubusercontent.com/31355460/188180158-50063227-991a-40a0-b7f3-a523991c7441.png)\r\n\r\n\r\n<blockquote><img src=\"https://compass-ssl.microsoft.com/assets/4c/51/4c51de82-ae73-4037-8fec-388dbddf4953.png?n=windows11.png\" width=\"48\" align=\"right\"><div>Windows Insider</div><div><strong><a href=\"https://aka.ms/AAhw50v\">Windows Insider Program</a></strong></div><div>Become an Insider: be one of the first to explore new Windows features for you and your business or use the latest Windows SDK to build great apps.</div></blockquote>",
      "created_at": "2022-09-02T15:13:44Z",
      "updated_at": "2022-09-02T15:14:28Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Just a quick update, we worked with the owner team of Windows PowerShell on a fix to this bug. The fix was checked in the Windows branch, and will be available to Win11 and win10 gradually with the new update releases.\r\n\r\nWith the fix, the cmdlet `Get-LocalGroupMember` will behave as shown below in the currently failing scenario:\r\n\r\n![MicrosoftTeams-image](https://user-images.githubusercontent.com/127450/188221474-458643ec-462e-4e13-bf51-4b0b270faed0.png)\r\n\r\nAs for those 2 SIDs, they are added by Azure AD:\r\n> Every Azure AD joined device contains two SIDs (the Global administrator role and the Device administrator role) that are by default part of the local administrators group.\r\n\r\nThey don't have account name and other information stored locally (hence the error because the Win32 API `LookupAccountSid` cannot find them locally), and you have to query Azure AD to get corresponding display name and description for them. Here is an article for how to do that FYI: https://oliverkieselbach.com/2020/05/13/powershell-helpers-to-convert-azure-ad-object-ids-and-sids/\r\n",
      "created_at": "2022-09-02T19:17:17Z",
      "updated_at": "2022-09-02T19:17:30Z"
    },
    {
      "author": "ganlbarone",
      "author_association": "NONE",
      "body": "> Just a quick update, we worked with the owner team of Windows PowerShell on a fix to this bug. The fix was checked in the Windows branch, and will be available to Win11 and win10 gradually with the new update releases.\r\n> \r\n> With the fix, the cmdlet `Get-LocalGroupMember` will behave as shown below in the currently failing scenario:\r\n> \r\n> ![MicrosoftTeams-image](https://user-images.githubusercontent.com/127450/188221474-458643ec-462e-4e13-bf51-4b0b270faed0.png)\r\n> \r\n> As for those 2 SIDs, they are added by Azure AD:\r\n> \r\n> > Every Azure AD joined device contains two SIDs (the Global administrator role and the Device administrator role) that are by default part of the local administrators group.\r\n> \r\n> They don't have account name and other information stored locally (hence the error because the Win32 API `LookupAccountSid` cannot find them locally), and you have to query Azure AD to get corresponding display name and description for them. Here is an article for how to do that FYI: https://oliverkieselbach.com/2020/05/13/powershell-helpers-to-convert-azure-ad-object-ids-and-sids/\r\n\r\nThis is good news, thanks for the work.\r\n\r\nAnd we would expect this to work on ps 5.1 and sccm, etc etc. Imagine it will fine, since this is a windows issue, not PS. \r\n\r\nAlso, sidebar... The account sids there on azure machines arent really very user friendly. Neither is having to add admin accounts via 'net localgroup administrators AzureAD\\upn /add'. I understand the technical reasons and how the guid is converted to sid, but its no where near as simple as adding accounts\\groups as it is on an on prem bound machine.\r\n\r\nHopefully admin groups\\users on azure bound machines will be something thats made a bit more robust down the line. \r\n",
      "created_at": "2022-09-02T19:27:33Z",
      "updated_at": "2022-09-02T19:33:53Z"
    },
    {
      "author": "weyCC81",
      "author_association": "NONE",
      "body": "Hi @daxian-dbw \r\n\r\nThanks for the effort, do I see that right you give out the unknown SID as a String instead of an Object in the list?\r\nWould it not be better to give out the SID as an Object in the List, even if the display-name is not there.\r\nIt would be simpler to build a workaround later on and request the display-name if needed, not?",
      "created_at": "2022-09-02T23:48:16Z",
      "updated_at": "2022-09-02T23:48:16Z"
    },
    {
      "author": "alanjmcf",
      "author_association": "NONE",
      "body": "Great news. Looking forward to this hitting Windows 10 boxes in my fleet.",
      "created_at": "2022-09-05T20:25:38Z",
      "updated_at": "2022-09-05T20:25:38Z"
    },
    {
      "author": "djlause",
      "author_association": "NONE",
      "body": "Wonderful news!!!!  T**hanks to all that got this pushed through and working** without barfing all over the place.  Personally think this will make a lot of sys admins happy since we will be able to audit and dump contents of the local groups of machines that are Azure joined now.",
      "created_at": "2022-09-05T20:47:11Z",
      "updated_at": "2022-09-05T20:47:11Z"
    }
  ],
  "created_at": "2017-01-11T22:33:40Z",
  "labels": [
    "Issue-Bug",
    "WG-Cmdlets",
    "Resolution-External"
  ],
  "number": 2996,
  "state": "closed",
  "title": "Get-LocalGroupMember - Failed to compare two elements in the array.",
  "updated_at": "2022-09-05T20:47:12Z"
}