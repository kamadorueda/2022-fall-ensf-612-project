{
  "_url": "https://github.com/PowerShell/PowerShell/issues/4965",
  "author": "SteveL-MSFT",
  "body": "When we create the arg string, an arg of `.\\test 1\\` ends up being `\".\\test 1\\\"` which is stored in StartInfo.Arguments which then corefx [passes as-is](https://github.com/dotnet/corefx/blob/93c5f5d795a464c18d96da47bcb5b2f7f571d26a/src/System.Diagnostics.Process/src/System/Diagnostics/Process.Win32.cs#L48) to SHELLEXECUTEINFO.\r\n\r\nThe native command receives the arg as `.\\test 1\"` as the last `\\\"` is treated as escaping the quotes.  Fix is to add an extra backslash to escape the last enclosing quote.\r\n\r\nFix https://github.com/PowerShell/PowerShell/issues/4358\r\n\r\n<!--\r\n\r\nIf you are a PowerShell Team member, please make sure you choose the Reviewer(s) and Assignee for your PR.\r\nIf you are not from the PowerShell Team, you can leave the fields blank and the Maintainers will choose them for you. If you are familiar with the team, feel free to mention some Reviewers yourself.\r\n\r\nFor more information about the roles of Reviewer and Assignee, refer to [CONTRIBUTING.md](https://github.com/PowerShell/PowerShell/blob/master/.github/CONTRIBUTING.md).\r\n\r\n-->\r\n",
  "closed_at": "2017-10-11T14:01:10Z",
  "comments": [
    {
      "author": "PetSerAl",
      "author_association": "CONTRIBUTOR",
      "body": "Since not every application use `\\` as escapement it will also affect behavior of that programs. For example:\r\n```powershell\r\ncmd /c 'echo \\'\r\n```\r\nwill print `\\\\` instead of `\\`.\r\n\r\nAlso you should not only double one `\\` at the end, but whole sequence of `\\` in the end. For example:\r\n```powershell\r\ncmd /c 'echo \\\\\\'\r\n```\r\nwill print `\\\\\\\\`, while it should be `\\\\\\\\\\\\` to be properly recognized as three literal `\\`.",
      "created_at": "2017-10-01T08:41:11Z",
      "updated_at": "2017-10-01T08:41:36Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@PetSerAl for `cmd echo`, perhaps the only thing we can do is suggest using `cmd --% /c echo \\`\r\n",
      "created_at": "2017-10-01T15:02:13Z",
      "updated_at": "2017-10-01T15:02:13Z"
    },
    {
      "author": "PetSerAl",
      "author_association": "CONTRIBUTOR",
      "body": "How about multiple trailing `\\`?:\r\n```powershell\r\ntestexe -echoargs '.\\test 1\\\\' \".\\test 2\\\\\"\r\n```",
      "created_at": "2017-10-01T15:25:17Z",
      "updated_at": "2017-10-01T15:25:17Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@PetSerAl I'll work on that and add a test",
      "created_at": "2017-10-01T17:54:20Z",
      "updated_at": "2017-10-01T17:54:20Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "Apparently these strange trailing backslash and double quotes rules are [documented](http://www.daviddeley.com/autohotkey/parameters/parameters.htm#WINCRULESDOC)",
      "created_at": "2017-10-02T06:08:05Z",
      "updated_at": "2017-10-02T06:08:05Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw @lzybkr Could you please review?",
      "created_at": "2017-10-06T03:32:23Z",
      "updated_at": "2017-10-06T03:32:23Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "@daxian-dbw @lzybkr Could you please review?",
      "created_at": "2017-10-10T06:33:29Z",
      "updated_at": "2017-10-10T06:33:29Z"
    },
    {
      "author": "SteveL-MSFT",
      "author_association": "MEMBER",
      "body": "@daxian-dbw is in training today, @anmenaga can you review?",
      "created_at": "2017-10-10T16:09:33Z",
      "updated_at": "2017-10-10T16:09:33Z"
    },
    {
      "author": "daxian-dbw",
      "author_association": "MEMBER",
      "body": "Sorry that I missed the the first \"@mention\" notification. I will take a look later today.\r\nI wish @mklement0 can review this if possible, as he has a better understanding of the native argument parsing user experience in PowerShell.",
      "created_at": "2017-10-10T16:22:57Z",
      "updated_at": "2017-10-10T16:22:57Z"
    }
  ],
  "created_at": "2017-10-01T05:50:50Z",
  "number": 4965,
  "state": "closed",
  "title": "properly escape trailing backslash so that it doesn't end up escaping the quotes",
  "updated_at": "2018-10-26T21:34:05Z"
}