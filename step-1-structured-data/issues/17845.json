{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17845",
  "author": "JPEscher",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nIssue: Unexpected result on linux from command: New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credential $creds -Scope Global\r\n\r\nI originally suspected that this was user error. I did try variations such as inverting the \\ to / and using \"smb:\" as a prepend. They did not work. In searching I found the following that make me wonder if this is user error or a restrictions I did not see in the documentation. I did see this in the documentation which leads me to believe there is a minimum of a documentation deficiency. Example/Reasoning:\r\n\r\n-Persist\r\nIndicates that this cmdlet creates a Windows mapped network drive. The Persist parameter is only available on Windows.\r\n\r\nThe above suggests that all other aspects of the command are transportable. The following show this has been a known issue for a while.\r\nhttps://github.com/PowerShell/PowerShell/issues/1409 (opened 2016-07-18) - No examples and several signs it is not fixed even after:  joeyaiello added the Resolution-Fixed label on May 23, 2017\r\nhttps://github.com/PowerShell/PowerShell/issues/6629 (opened 2018-04-11) - Still open. Please note as per others in this thread, the CIFS Mount pre-requisite is not an option for me due to Docker restrictions\r\nhttps://github.com/PowerShell/PowerShell/issues/6759 (opened 2018-04-27) - Still open. Please note as per others in this thread, the CIFS Mount pre-requisite is not an option for me due to Docker restrictions\r\n\r\nIf an SMB Mount point turns out to be a pre-requisite, I suggest an update to the documentation. A notice that this is required on Linux due to restrictions. I would prefer finding a way to not require SMB Mounts.\r\n\r\nThank you in advance for your time. Please feel free to reach out to me if there are actions I may try to assist. Please\r\n\r\nCommand: New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credential $creds -Scope Global\r\n\r\nLinux Tested Variants:\r\nCommand Variant: New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"//UNCServerName/FolderPath\" -Credential $creds -Scope Global\r\nCommand Variant: New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"smb:\\\\UNCServerName\\FolderPath\" -Credential $creds -Scope Global\r\nCommand Variant: New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"smb://UNCServerName/FolderPath\" -Credential $creds -Scope Global\r\n\r\n\n\n### Expected behavior\n\n```console\nExpected Result (obtained on Windows): New PS Drive is available and usable for scripting\r\nUnexpected Result (obtained on Linux): Obtain Errors\n```\n\n\n### Actual behavior\n\n```console\nWindows Environment/Outcome:\r\nPS C:\\Users\\[myuser]> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\nPS C:\\Users\\[myuser]> $creds = Get-Credential\r\nPowerShell credential request\r\nEnter your credentials.\r\nUser: [user]@[company]\r\nPassword for user [user]@[company]: ********************\r\n\r\nPS C:\\Users\\[myuser]> New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credential $creds -Scope Global\r\nName           Used (GB)     Free (GB) Provider      Root                                                                                                     CurrentLocation\r\n----           ---------     --------- --------      ----                                                                                                     ---------------\r\nshareName                              FileSystem    \\\\UNCServerName\\FolderPath\r\n\r\nPS C:\\Users\\[myuser]>\r\n\r\n\r\nLinux Environment/Outcome:\r\nPS /home/[myuser]/development> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Linux 5.10.102.1-microsoft-standard-WSL2 #1 SMP Wed Mar 2 00:30:59 UTC 2022\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\nPS /home/[myuser]/development> $creds = Get-Credential\r\nPowerShell credential request\r\nEnter your credentials.\r\nUser: [user]@[company]\r\nPassword for user [user]@[company]: ********************\r\n\r\nPS /home/[myuser]/development> New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credential $creds -Scope Global\r\nNew-PSDrive: The specified drive root \"\\\\UNCServerName\\FolderPath\" either does not exist, or it is not a folder.\r\n\r\nPS /home/[myuser]/development> Get-Error\r\n\r\nException             :\r\n    Type    : System.IO.IOException\r\n    Message : The specified drive root \"\\\\UNCServerName\\FolderPath\" either does not exist, or it is not a folder.\r\n    HResult : -2146232800\r\nTargetObject          : shareName\r\nCategoryInfo          : ReadError: (shareName:PSDriveInfo) [New-PSDrive], IOException\r\nFullyQualifiedErrorId : DriveRootError,Microsoft.PowerShell.Commands.NewPSDriveCommand\r\nInvocationInfo        :\r\n    MyCommand        : New-PSDrive\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 2\r\n    Line             : New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credentia\r\nl $creds -Scope Global\r\n    PositionMessage  : At line:1 char:1\r\n                       + New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath \u2026\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : New-PSDrive\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo :\r\n\r\n\r\nPS /home/[myuser]/development> ping [UNCServerName]\r\nPING [UNCServerName] ([ip address]) 56(84) bytes of data.\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=1 ttl=64 time=0.889 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=2 ttl=64 time=1.23 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=3 ttl=64 time=0.778 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=4 ttl=64 time=1.48 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=5 ttl=64 time=0.923 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=6 ttl=64 time=1.42 ms\r\n64 bytes from [UNCServerName] ([ip address]): icmp_seq=7 ttl=64 time=5.89 ms\r\n^C\r\n--- [UNCServerName] ping statistics ---\r\n7 packets transmitted, 7 received, 0% packet loss, time 6084ms\r\nrtt min/avg/max/mdev = 0.778/1.800/5.889/1.687 ms\r\n\r\nPS /home/[myuser]/development>\n```\n\n\n### Error details\n\n```console\nPS /home/[myuser]/development> Get-Error\r\n\r\nException             :\r\n    Type    : System.IO.IOException\r\n    Message : The specified drive root \"\\\\UNCServerName\\FolderPath\" either does not exist, or it is not a folder.\r\n    HResult : -2146232800\r\nTargetObject          : shareName\r\nCategoryInfo          : ReadError: (shareName:PSDriveInfo) [New-PSDrive], IOException\r\nFullyQualifiedErrorId : DriveRootError,Microsoft.PowerShell.Commands.NewPSDriveCommand\r\nInvocationInfo        :\r\n    MyCommand        : New-PSDrive\r\n    ScriptLineNumber : 1\r\n    OffsetInLine     : 1\r\n    HistoryId        : 2\r\n    Line             : New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath\" -Credentia\r\nl $creds -Scope Global\r\n    PositionMessage  : At line:1 char:1\r\n                       + New-PSDrive -Name \"shareName\" -PSProvider \"FileSystem\" -Root \"\\\\UNCServerName\\FolderPath \u2026\r\n                       + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    InvocationName   : New-PSDrive\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 1\r\nPipelineIterationInfo :\n```\n\n\n### Environment data\n\n```powershell\nWindows Environment:\r\nPS C:\\Users\\[myuser]> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n\r\n\r\nLinux Environment:\r\nPS /home/[myuser]/development> $PSVersionTable\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.5\r\nPSEdition                      Core\r\nGitCommitId                    7.2.5\r\nOS                             Linux 5.10.102.1-microsoft-standard-WSL2 #1 SMP Wed Mar 2 00:30:59 UTC 2022\r\nPlatform                       Unix\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [
    {
      "author": "jborean93",
      "author_association": "COLLABORATOR",
      "body": "Filesystem paths go through the native OS' filesystem APIs to access and Linux does not have the ability to understand UNC paths or access SMB shares natively like you can on Windows. What you are meant to do is use a tool to mount the UNC path to a local folder and access it that way. Unfortunately this is a limitation of the OS in question and unless the FileSystem provider can support SMB shares itself (not a trivial thing to do) there is nothing that can be done here.",
      "created_at": "2022-08-04T18:59:48Z",
      "updated_at": "2022-08-04T18:59:48Z"
    },
    {
      "author": "iSazonov",
      "author_association": "COLLABORATOR",
      "body": "You could use automount.",
      "created_at": "2022-08-05T03:00:40Z",
      "updated_at": "2022-08-05T03:00:40Z"
    },
    {
      "author": "JPEscher",
      "author_association": "NONE",
      "body": "> You could use automount.\r\n\r\ndocker security disables mount. this is the issue i am trying to get around. docker suggests using volumes, but then the underlying system allows ALL images attached to access the volume, which is also a security issue. \r\n\r\nsimilar restraints on windows, yet the new-psdrive command is reported to get around it according to posts i've seen.\r\n\r\nas my company doesn't use docker on windows i cannot personally confirm this. \r\n\r\nmore details: https://docs.docker.com/engine/security/seccomp/\r\n\r\nnote: my company doesn't allow the use of seccomp profiles, something my boss had me look into while waiting a decision on, so i do have a profile that would work, I'm just not allowed to use it, nor would efforts to refine it be worth while. \n\n<blockquote><img src=\"/favicons/docs@2x.ico\" width=\"48\" align=\"right\"><div><img src=\"/favicons/docs@2x.ico\" height=\"14\"> Docker Documentation</div><div><strong><a href=\"https://docs.docker.com/engine/security/seccomp/\">Seccomp security profiles for Docker</a></strong></div><div>Enabling seccomp in Docker</div></blockquote>",
      "created_at": "2022-08-05T03:56:35Z",
      "updated_at": "2022-08-05T03:56:37Z"
    },
    {
      "author": "JPEscher",
      "author_association": "NONE",
      "body": "> Filesystem paths go through the native OS' filesystem APIs to access and Linux does not have the ability to understand UNC paths or access SMB shares natively like you can on Windows. What you are meant to do is use a tool to mount the UNC path to a local folder and access it that way. Unfortunately this is a limitation of the OS in question and unless the FileSystem provider can support SMB shares itself (not a trivial thing to do) there is nothing that can be done here.\r\n\r\nthis would suggest the documentation on new-psdrive be updated to note this. at this time there is no way to tell this from the documentation. as per this thread, there are three other threads started, likely due to the lack of this notation in the documents. ",
      "created_at": "2022-08-05T03:59:01Z",
      "updated_at": "2022-08-05T03:59:01Z"
    }
  ],
  "created_at": "2022-08-04T10:02:21Z",
  "labels": [
    "Needs-Triage",
    "Area-FileSystem-Provider"
  ],
  "number": 17845,
  "state": "open",
  "title": "New-PSDrive does not give expected results with UNC Paths on Linux",
  "updated_at": "2022-08-05T03:59:02Z"
}