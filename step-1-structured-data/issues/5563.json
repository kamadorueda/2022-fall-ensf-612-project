{
  "_url": "https://github.com/PowerShell/PowerShell/issues/5563",
  "author": "Ricordel",
  "body": "Steps to reproduce\r\n------------------\r\nI have a VM running, and I'm trying to execute a command remotely with the following command (from a bash shell). It sometimes crashes (see #5562), and when it does not, nothing is executed on the remote host.\r\n\r\n```bash\r\n    pwsh -Command - <<EOF\r\n\\$Username = '$VM_USER'\r\n\\$Password = '$VM_PASSWORD'\r\n\\$SecurePassword = ConvertTo-SecureString -AsPlainText \\$Password -Force\r\n\\$Cred = New-Object System.Management.Automation.PSCredential -ArgumentList \\$Username,\\$SecurePassword\r\nInvoke-Command -ComputerName $VM_IP -Credential \\$Cred -Authentication Basic -Command { $VM_COMMAND }\r\nEOF\r\n```\r\n\r\nExpected behavior\r\n-----------------\r\n\r\nThe command executes on the remote host\r\n\r\nActual behavior\r\n---------------\r\n\r\nThe execution fails, and by running tcpdump at the same time on the interface that connects the host and the virtual machine, I can tell that absolutely no network communication is attempted, not even opening a TCP connection. Here is the run with strace monitoring the `socket` and `connect` calls. As an attachement you'll find a run with `strace` monitoring everything.\r\n\r\n[strace.log](https://github.com/PowerShell/PowerShell/files/1509252/strace.log)\r\n\r\n```none\r\nsocket(PF_LOCAL, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 40\r\nconnect(40, {sa_family=AF_LOCAL, sun_path=\"/dev/log\"}, 110) = -1 ENOENT (No such file or directory)\r\nsocket(PF_LOCAL, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 56\r\nconnect(56, {sa_family=AF_LOCAL, sun_path=\"/dev/log\"}, 110) = -1 ENOENT (No such file or directory)\r\nsocket(PF_LOCAL, SOCK_DGRAM|SOCK_CLOEXEC, 0) = 95\r\nconnect(95, {sa_family=AF_LOCAL, sun_path=\"/dev/log\"}, 110) = -1 ENOENT (No such file or directory)\r\nInvoke-Command -ComputerName 192.168.60.2 -Credential System.Management.Automation.PSCredential -Authentication Basic -Command { Date }\r\n[192.168.60.2] Connecting to remote server 192.168.60.2 failed with the following error message : MI_RESULT_ACCESS_DENIED For more information, see the about_Remote_Troubleshooting Help topic.\r\n+ CategoryInfo          : OpenError: (192.168.60.2:String) [], PSRemotingTransportException\r\n+ FullyQualifiedErrorId : 2,PSSessionStateBroken\r\n+++ exited with 1 +++\r\n```\r\n\r\nBy running tcpdump at the same time on the interface connecting the VM, I can tell that no \r\n\r\nEnvironment data\r\n----------------\r\n\r\n```powershell\r\n> $PSVersionTable\r\nName                           Value                                                                  \r\n----                           -----                                                                  \r\nPSVersion                      6.0.0-rc                                                               \r\nPSEdition                      Core                                                                   \r\nGitCommitId                    v6.0.0-rc                                                              \r\nOS                             Linux 4.9.0-0.bpo.4-amd64 #1 SMP Debian 4.9.51-1~bpo8+1 (2017-10-17)   \r\nPlatform                       Unix                                                                   \r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}                                                \r\nPSRemotingProtocolVersion      2.3                                                                    \r\nSerializationVersion           1.1.0.1                                                                \r\nWSManStackVersion              3.0\r\n```\r\n\r\nPlease note that this works fine with at least `6.0.0-beta.9` and `6.0.0-beta.8-1`.\r\n\r\nIf there is any additional steps I can do to help you find the problem, please let me know and i'll try to do them.",
  "closed_at": null,
  "comments": [
    {
      "author": "trgrassijr55",
      "author_association": "NONE",
      "body": "I have the same problem.\r\nUsing powershell 6.0.0.-rc \r\n\r\nI have it working from my Cent OS to Windows 2012 R2 but only with OpenSSH and PowerShell 6.0.0.rc on my Windows 2012 R2 server.\r\n\r\nInvoke-command -Computername does not work on powershell 6.0.0-rc\r\nSame as Enter-PSSession -Computername\r\n\r\nOnly way I could get it to work is with \r\n\r\ninvoke-command -hostname\r\nenter-PSSEssion -hostname\r\nbut those methods have limited paramaters.   no -Credential no -Configurationname  etc\r\n\r\nWhen can we have WINRM working?\r\n\r\n\r\n",
      "created_at": "2017-12-28T17:01:39Z",
      "updated_at": "2017-12-28T17:01:39Z"
    }
  ],
  "created_at": "2017-11-28T09:38:44Z",
  "number": 5563,
  "state": "open",
  "title": "v6.0.0-rc: unable to execute a command on a remote host",
  "updated_at": "2017-12-28T17:01:39Z"
}