{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13475",
  "author": "SeeminglyScience",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\ngci ([void]$null)\r\n```\r\n\r\n## Expected behavior\r\n\r\nConvert to `$null` like it does outside of commands (e.g. `$a = [void]$null`).  Basically command argument expressions whose `Expression.Type` is `void` should be wrapped in a `Block` that returns `$null` like is done in other areas.\r\n\r\n## Actual behavior\r\n\r\n```none\r\nParentContainsErrorRecordException: An error occurred while creating the pipeline.\r\n```\r\n\r\n```powershell\r\nPS> Get-Error\r\n\r\nType           : System.Management.Automation.RuntimeException\r\nErrorRecord    :\r\n    Exception             :\r\n        Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n        Message : An error occurred while creating the pipeline.\r\n        HResult : -2146233087\r\n    CategoryInfo          : NotSpecified: (:) [], ParentContainsErrorRecordException\r\n    FullyQualifiedErrorId : RuntimeException\r\nTargetSite     :\r\n    Name          : Invoke\r\n    DeclaringType : System.Management.Automation.Runspaces.PipelineBase, System.Management.Automation, Version=7.1.0.0, Culture=neutral,\r\nPublicKeyToken=31bf3856ad364e35\r\n    MemberType    : Method\r\n    Module        : System.Management.Automation.dll\r\nStackTrace     :\r\n   at System.Management.Automation.Runspaces.PipelineBase.Invoke(IEnumerable input)\r\n   at System.Management.Automation.Runspaces.Pipeline.Invoke()\r\n   at Microsoft.PowerShell.Executor.ExecuteCommandHelper(Pipeline tempPipeline, Exception& exceptionThrown, ExecutionOptions options)\r\nMessage        : An error occurred while creating the pipeline.\r\nInnerException :\r\n    Type       : System.InvalidOperationException\r\n    TargetSite :\r\n        Name          : GetUserDefinedCoercionOrThrow\r\n        DeclaringType : System.Linq.Expressions.Expression\r\n        MemberType    : Method\r\n        Module        : System.Linq.Expressions.dll\r\n    StackTrace :\r\n   at System.Linq.Expressions.Expression.GetUserDefinedCoercionOrThrow(ExpressionType coercionType, Expression expression, Type\r\nconvertToType)\r\n   at System.Management.Automation.Language.Compiler.VisitCommand(CommandAst commandAst)\r\n   at System.Management.Automation.Language.Compiler.VisitPipeline(PipelineAst pipelineAst)\r\n   at System.Management.Automation.Language.Compiler.CompileTrappableExpression(List`1 exprList, StatementAst stmt)\r\n   at System.Management.Automation.Language.Compiler.CompileStatementListWithTraps(ReadOnlyCollection`1 statements, ReadOnlyCollection`1\r\ntraps, List`1 exprs, List`1 temps)\r\n   at System.Management.Automation.Language.Compiler.CompileSingleLambda(ReadOnlyCollection`1 statements, ReadOnlyCollection`1 traps,\r\nString funcName, IScriptExtent entryExtent, IScriptExtent exitExtent, ScriptBlockAst rootForDefiningTypesAndUsings)\r\n   at System.Management.Automation.Language.Compiler.CompileNamedBlock(NamedBlockAst namedBlockAst, String funcName, ScriptBlockAst\r\nrootForDefiningTypes)\r\n   at System.Management.Automation.Language.Compiler.VisitScriptBlock(ScriptBlockAst scriptBlockAst)\r\n   at System.Management.Automation.Language.Compiler.Compile(CompiledScriptBlockData scriptBlock, Boolean optimize)\r\n   at System.Management.Automation.CompiledScriptBlockData.ReallyCompile(Boolean optimize)\r\n   at System.Management.Automation.CompiledScriptBlockData.CompileUnoptimized()\r\n   at System.Management.Automation.CompiledScriptBlockData.Compile(Boolean optimized)\r\n   at System.Management.Automation.DlrScriptCommandProcessor.Init()\r\n   at System.Management.Automation.DlrScriptCommandProcessor..ctor(ScriptBlock scriptBlock, ExecutionContext context, Boolean useNewScope,\r\nCommandOrigin origin, SessionStateInternal sessionState, Object dollarUnderbar)\r\n   at System.Management.Automation.Runspaces.Command.CreateCommandProcessor(ExecutionContext executionContext, Boolean addToHistory,\r\nCommandOrigin origin)\r\n   at System.Management.Automation.Runspaces.LocalPipeline.CreatePipelineProcessor()\r\n    Message    : No coercion operator is defined between types 'System.Void' and 'System.Object'.\r\n    Source     : System.Linq.Expressions\r\n    HResult    : -2146233079\r\nSource         : System.Management.Automation\r\nHResult        : -2146233087\r\n```\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0-preview.6\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0-preview.6\r\nOS                             Microsoft Windows 10.0.18362\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n",
  "closed_at": null,
  "comments": [],
  "created_at": "2020-08-18T19:15:46Z",
  "number": 13475,
  "state": "open",
  "title": "Casting command argument to `void` throws during compilation",
  "updated_at": "2020-08-20T10:09:17Z"
}