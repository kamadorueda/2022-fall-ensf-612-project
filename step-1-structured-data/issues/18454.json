{
  "_url": "https://github.com/PowerShell/PowerShell/issues/18454",
  "author": "callumlinning",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nI've got an Azure Function App that is executing some PNP PowerShell as part of automated translation between SharePoint Online multi-lingual pages on news posts. Creating a Function App with PowerShell Core 7.0 and the script is executed without any errors observed. I then re-created the app using the latest available in Azure Function Apps (7.2) and produced a \"Microsoft.Extensions.Logging.Abstractions.Internal.NullScope\" error when the exact same script is run on the newer version.\r\n\r\nScript is here:\r\nhttps://github.com/spjeff/spo-page-translation/blob/main/SPJEFF-Translation-Azure-Function-PowerShell-HttpTrigger1.ps1\n\n### Expected behavior\n\n```console\n2022-11-03T11:51:05Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: InstanceId                           Type        Title       Section Column Position PropertiesJson\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: ----------                           ----        -----       ------- ------ -------- --------------\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: 1212fc8d-dd6b-408a-8d5d-9f1cc787efbb PageText                1       1      1        \r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: 22e0a4a8-13a1-4ed7-89ee-622d71980aae PageWebPart Quick links 1       1      2        {\"items\":[{\"sourceItem\":{\"guids\":{\u2026\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: Type\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: ----\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: PnP.Core.Model.SharePoint.PageText\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: PnP.Core.Model.SharePoint.PageWebPart\r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:05Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:05Z   [Information]   INFORMATION: Translating content...\r\n2022-11-03T11:51:05Z   [Warning]   WARNING: Please use 'Set-PnPPageTextPart'. The alias 'Set-PnPClientSideText' will be removed in the 1.5.0 release\r\n2022-11-03T11:51:06Z   [Information]   INFORMATION: Translation Complete\r\n2022-11-03T11:51:06Z   [Information]   OUTPUT: InstanceId                           Type     Title Section Column Position PropertiesJson\r\n2022-11-03T11:51:06Z   [Information]   OUTPUT: ----------                           ----     ----- ------- ------ -------- --------------\r\n2022-11-03T11:51:06Z   [Information]   OUTPUT: 1212fc8d-dd6b-408a-8d5d-9f1cc787efbb PageText       1       1      1        \r\n2022-11-03T11:51:06Z   [Information]   OUTPUT: **Translated Content**.<br>\r\n2022-11-03T11:51:06Z   [Information]   OUTPUT: \r\n2022-11-03T11:51:06Z   [Information]   Executed 'Functions.HttpTrigger1' (Succeeded, Id=aceff8e0-146b-49dc-81fa-c2b4055837d0, Duration=20073ms)\n```\n\n\n### Actual behavior\n\n```console\n[Error]   ERROR: Could not load type 'Microsoft.Extensions.Logging.Abstractions.Internal.NullScope' from assembly 'Microsoft.Extensions.Logging.Abstractions, Version=3.0.3.0, Culture=neutral,\n```\n\n\n### Error details\n\n```console\n[Error]   ERROR: Could not load type 'Microsoft.Extensions.Logging.Abstractions.Internal.NullScope' from assembly 'Microsoft.Extensions.Logging.Abstractions, Version=3.0.3.0, Culture=neutral, PublicKeyToken='.\r\n\r\nException             : \r\n    Type       : System.TypeLoadException\r\n    Message    : Could not load type 'Microsoft.Extensions.Logging.Abstractions.Internal.NullScope' from assembly 'Microsoft.Extensions.Logging.Abstractions, Version=3.0.3.0, Culture=neutral, PublicKeyToken=adb9793829ddae60'.\r\n    TypeName   : Microsoft.Extensions.Logging.Abstractions.Internal.NullScope\r\n    TargetSite : \r\n        Name          : BeginScope\r\n        DeclaringType : Microsoft.Extensions.Logging.Logger, Microsoft.Extensions.Logging, Version=2.2.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60\r\n        MemberType    : Method\r\n        Module        : Microsoft.Extensions.Logging.dll\r\n    Data       : System.Collections.ListDictionaryInternal\r\n    Source     : Microsoft.Extensions.Logging\r\n    HResult    : -2146233054\r\n    StackTrace : \r\n   at Microsoft.Extensions.Logging.Logger.BeginScope[TState](TState state)\r\n   at Microsoft.Extensions.Logging.LoggerMessage.<>c__DisplayClass2_0`2.<DefineScope>b__0(ILogger logger, T1 arg1, T2 arg2)\r\n   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.Log.BeginRequestPipelineScope(ILogger logger, HttpRequestMessage request)\r\n   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)\r\n   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)\r\n   at PnP.Core.Services.BatchClient.ExecuteSharePointRestInteractiveAsync(Batch batch)\r\n   at PnP.Core.Services.BatchClient.ExecuteBatch(Batch batch)\r\n   at PnP.Core.Model.BaseDataModel`1.RequestAsync(ApiCall apiCall, HttpMethod method, String operationName)\r\n   at PnP.Core.Services.PnPContextFactory.InitializeContextAsync(PnPContext context, PnPContextOptions options)\r\n   at PnP.Core.Services.PnPContextFactory.CreateAsync(Uri url, IAuthenticationProvider authenticationProvider, CancellationToken cancellationToken, PnPContextOptions options)\r\n   at PnP.Core.Services.PnPContextFactory.CreateAsync(Uri url, IAuthenticationProvider authenticationProvider, PnPContextOptions options)\r\n   at PnP.Framework.PnPCoreSdk.GetPnPContextAsync(ClientContext context)\r\n   at PnP.Framework.PnPCoreSdk.GetPnPContext(ClientContext context)\r\n   at PnP.PowerShell.Commands.Base.PnPConnection.get_PnPContext() in c:\\build\\src\\Commands\\Base\\PnPConnection.cs:line 51\r\n   at PnP.PowerShell.Commands.Base.PipeBinds.PagePipeBind.GetPage(PnPConnection connection) in c:\\build\\src\\Commands\\Base\\PipeBinds\\PagePipeBind.cs:line 33\r\n   at PnP.PowerShell.Commands.Pages.GetPage.ExecuteCmdlet() in c:\\build\\src\\Commands\\Pages\\GetPage.cs:line 17\r\n   at PnP.PowerShell.Commands.PnPSharePointCmdlet.ProcessRecord() in c:\\build\\src\\Commands\\Base\\PnPSharePointCmdlet.cs:line 114\r\nCategoryInfo          : WriteError: (:) [Get-PnPPage], TypeLoadException\r\nFullyQualifiedErrorId : EXCEPTION,PnP.PowerShell.Commands.Pages.GetPage\r\nErrorDetails          : Could not load type 'Microsoft.Extensions.Logging.Abstractions.Internal.NullScope' from assembly 'Microsoft.Extensions.Logging.Abstractions, Version=3.0.3.0, Culture=neutral, PublicKeyToken='.\n```\n\n\n### Environment data\n\n```powershell\nVariables are posted to the Function App in a JSON format for the following from the SharePoint page.\r\n\r\n\"siteURL\",\r\n\"language\":,\r\n\"pageTitle\":\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": null,
  "comments": [
    {
      "author": "kilasuit",
      "author_association": "COLLABORATOR",
      "body": "As this is related to Azure Functions you would be better placed rasing this issue in the [Azure Functions PowerShell Worker repo](https://github.com/Azure/azure-functions-powershell-worker) as it's likely something to do with how PowerShell is running in Azure Functions than it being PowerShell itself.\r\nTo confirm you should test your script locally in PowerShell 7.2.0 though I don't think you'd get this error locally",
      "created_at": "2022-11-10T21:46:43Z",
      "updated_at": "2022-11-10T21:46:43Z"
    }
  ],
  "created_at": "2022-11-03T12:17:30Z",
  "labels": [
    "Needs-Triage"
  ],
  "number": 18454,
  "state": "open",
  "title": "Azure Function App executing PNP.PowerShell script produces logging error between PowerShell Core versions 7.0 & 7.2",
  "updated_at": "2022-11-10T21:46:44Z"
}