{
  "_url": "https://github.com/PowerShell/PowerShell/issues/13525",
  "author": "SeeminglyScience",
  "body": "<!--\r\n\r\nFor Windows PowerShell 5.1 issues, suggestions, or feature requests please use the following link instead:\r\nWindows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell)\r\n\r\nThis repository is **ONLY** for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\n- Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\r\n- Search the existing issues.\r\n- Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\r\n- Refer to the [known issues](https://docs.microsoft.com/powershell/scripting/whats-new/known-issues-ps6).\r\n\r\n-->\r\n\r\n## Steps to reproduce\r\n\r\n```powershell\r\nusing namespace System.Text\r\nusing namespace System.Text\r\n\r\n[StringBuilder]\r\n```\r\n\r\n## Expected behavior\r\n\r\nEither ignore the second `using namespace` or throw parse error\r\n\r\n## Actual behavior\r\n\r\n```none\r\nInvalidArgument:\r\nLine |\r\n   5 |  [StringBuilder]\r\n     |  ~~~~~~~~~~~~~~~\r\n     | Type name 'StringBuilder' is ambiguous, it could be 'System.Text.StringBuilder' or 'System.Text.StringBuilder'.\r\n```\r\n\r\n^ is thrown at runtime.\r\n\r\n## Environment data\r\n\r\n<!-- provide the output of $PSVersionTable -->\r\n\r\n```none\r\nName                           Value\r\n----                           -----\r\nPSVersion                      7.1.0-preview.6\r\nPSEdition                      Core\r\nGitCommitId                    7.1.0-preview.6\r\nOS                             Microsoft Windows 10.0.18362\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\r\n```\r\n\r\n## Notes\r\n\r\n<details>\r\n\r\n<summary>Full Get-Error output (click to expand)</summary>\r\n\r\n```raw\r\nException             :\r\n    Type           : System.Management.Automation.RuntimeException\r\n    ErrorRecord    :\r\n        Exception             :\r\n            Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n            Message : Type name 'StringBuilder' is ambiguous, it could be 'System.Text.StringBuilder' or 'System.Text.StringBuilder'.\r\n            HResult : -2146233087\r\n        CategoryInfo          : InvalidArgument: (:) [], ParentContainsErrorRecordException\r\n        FullyQualifiedErrorId : AmbiguousTypeReference\r\n        InvocationInfo        :\r\n            ScriptLineNumber : 5\r\n            OffsetInLine     : 1\r\n            HistoryId        : -1\r\n            Line             : [StringBuilder]\r\n            PositionMessage  : At line:5 char:1\r\n                               + [StringBuilder]\r\n                               + ~~~~~~~~~~~~~~~\r\n            CommandOrigin    : Internal\r\n        ScriptStackTrace      : at <ScriptBlock>, <No file>: line 5\r\n    Message        : Type name 'StringBuilder' is ambiguous, it could be 'System.Text.StringBuilder' or 'System.Text.StringBuilder'.\r\n    InnerException :\r\n        Type           : System.Management.Automation.PSInvalidCastException\r\n        ErrorRecord    :\r\n            Exception             :\r\n                Type    : System.Management.Automation.ParentContainsErrorRecordException\r\n                Message : Type name 'StringBuilder' is ambiguous, it could be 'System.Text.StringBuilder' or 'System.Text.StringBuilder'.\r\n                HResult : -2146233087\r\n            CategoryInfo          : InvalidArgument: (:) [], ParentContainsErrorRecordException\r\n            FullyQualifiedErrorId : AmbiguousTypeReference\r\n            InvocationInfo        :\r\n                ScriptLineNumber : 5\r\n                OffsetInLine     : 1\r\n                HistoryId        : -1\r\n                Line             : [StringBuilder]\r\n                PositionMessage  : At line:5 char:1\r\n                                   + [StringBuilder]\r\n                                   + ~~~~~~~~~~~~~~~\r\n                CommandOrigin    : Internal\r\n            ScriptStackTrace      : at <ScriptBlock>, <No file>: line 5\r\n        TargetSite     :\r\n            Name          : ResolveTypeName\r\n            DeclaringType : System.Management.Automation.TypeOps, System.Management.Automation, Version=7.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n            MemberType    : Method\r\n            Module        : System.Management.Automation.dll\r\n        StackTrace     :\r\n   at System.Management.Automation.TypeOps.ResolveTypeName(ITypeName typeName, IScriptExtent errorPos)\r\n   at System.Management.Automation.Interpreter.FuncCallInstruction`3.Run(InterpretedFrame frame)\r\n   at System.Management.Automation.Interpreter.EnterTryCatchFinallyInstruction.Run(InterpretedFrame frame)\r\n        Message        : Type name 'StringBuilder' is ambiguous, it could be 'System.Text.StringBuilder' or 'System.Text.StringBuilder'.\r\n        Data           : System.Collections.ListDictionaryInternal\r\n        InnerException :\r\n            Type       : System.Management.Automation.Language.TypeResolver+AmbiguousTypeException\r\n            Candidates :\r\n                Length : 25\r\n\r\n                Length : 25\r\n            TypeName   : StringBuilder\r\n            Message    : Specified cast is not valid.\r\n            HResult    : -2147467262\r\n        Source         : System.Management.Automation\r\n        HResult        : -2147467262\r\n    HResult        : -2146233087\r\nCategoryInfo          : InvalidArgument: (:) [], RuntimeException\r\nFullyQualifiedErrorId : AmbiguousTypeReference\r\nInvocationInfo        :\r\n    ScriptLineNumber : 5\r\n    OffsetInLine     : 1\r\n    HistoryId        : -1\r\n    Line             : [StringBuilder]\r\n    PositionMessage  : At line:5 char:1\r\n                       + [StringBuilder]\r\n                       + ~~~~~~~~~~~~~~~\r\n    CommandOrigin    : Internal\r\nScriptStackTrace      : at <ScriptBlock>, <No file>: line 5\r\n```\r\n\r\n</details>\r\n\r\nSide note, I found this because I had duplicated `using namespace System` in a script I dot sourced.  `System` is a real bad one to do that with since it breaks concise view *for the rest of the session*.  Took me awhile to figure out what was happening, thought I broke `Out-Default` somehow.  Might be a good idea to use the fully qualified name for `Environment` in concise view (/cc @SteveL-MSFT).",
  "closed_at": null,
  "comments": [
    {
      "author": "echalone",
      "author_association": "NONE",
      "body": "I found this behaviour to be consistent with Powershell 5.1, but would still argue for fixing it",
      "created_at": "2020-08-31T08:58:47Z",
      "updated_at": "2020-08-31T08:58:47Z"
    },
    {
      "author": "JustinGrote",
      "author_association": "CONTRIBUTOR",
      "body": "+1 to fix, took me a bit to figure out what was happening for me today.",
      "created_at": "2021-01-23T01:35:56Z",
      "updated_at": "2021-01-23T01:35:56Z"
    }
  ],
  "created_at": "2020-08-26T18:34:03Z",
  "number": 13525,
  "state": "open",
  "title": "Duplicate using namespace statements cause all type refs to throw AmbigiousTypeReference",
  "updated_at": "2022-01-31T18:04:07Z"
}