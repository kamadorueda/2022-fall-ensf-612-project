{
  "_url": "https://github.com/PowerShell/PowerShell/issues/17445",
  "author": "aleferri",
  "body": "### Prerequisites\n\n- [X] Write a descriptive title.\n- [X] Make sure you are able to repro it on the [latest released version](https://github.com/PowerShell/PowerShell/releases)\n- [X] Search the existing issues.\n- [X] Refer to the [FAQ](https://github.com/PowerShell/PowerShell/blob/master/docs/FAQ.md).\n- [X] Refer to [Differences between Windows PowerShell 5.1 and PowerShell](https://docs.microsoft.com/powershell/scripting/whats-new/differences-from-windows-powershell).\n\n### Steps to reproduce\n\nInstall previous powershell core, set \"add open here powershell core\" to the context menu for the folders, also check \"keep updated with microsoft update\"\r\nRun microsoft update, let it update powershell core 7.\n\n### Expected behavior\n\n```console\nThe same settings you selected during installation have been kept. The update is seamless\n```\n\n\n### Actual behavior\n\n```console\nThe settings have been dropped\n```\n\n\n### Environment data\n\n```powershell\nName                           Value\r\n----                           -----\r\nPSVersion                      7.2.4\r\nPSEdition                      Core\r\nGitCommitId                    7.2.4\r\nOS                             Microsoft Windows 10.0.19044\r\nPlatform                       Win32NT\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0\u2026}\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\nWSManStackVersion              3.0\n```\n\n\n### OS Data\n\n```powershell\nVersion    Caption\r\n-------    -------\r\n10.0.19044 Microsoft Windows 10 Pro\n```\n\n\n### Windows update log\n\n```markdown\n2022/05/26 13:28:58.6583082 12788 11516 Shared          InitializeSus\r\n2022/05/26 13:28:58.6586340 12788 11516 IdleTimer       Non-AoAc machine.  Aoac operations will be ignored.\r\n2022/05/26 13:28:58.6587034 12788 11516 Agent           WU client version 10.0.19041.1682\r\n2022/05/26 13:28:58.6588972 12788 11516 Agent           SleepStudyTracker: Machine is non-AOAC. Sleep study tracker disabled.\r\n2022/05/26 13:28:58.6589494 12788 11516 Agent           Base directory: C:\\WINDOWS\\SoftwareDistribution\r\n2022/05/26 13:28:58.6592783 12788 11516 Agent           Datastore directory: C:\\WINDOWS\\SoftwareDistribution\\DataStore\\DataStore.edb\r\n2022/05/26 13:28:58.6597836 12788 11516 DataStore       JetEnableMultiInstance succeeded - applicable param count: 5, applied param count: 5\r\n2022/05/26 13:28:58.6817924 12788 11516 Shared          UpdateNetworkState Ipv6, cNetworkInterfaces = 2.\r\n2022/05/26 13:28:58.6819903 12788 11516 Shared          UpdateNetworkState Ipv4, cNetworkInterfaces = 1.\r\n2022/05/26 13:28:58.6830219 12788 11516 Shared          Network state: Connected\r\n2022/05/26 13:29:08.7483340 12788 11516 Shared          UpdateNetworkState Ipv6, cNetworkInterfaces = 2.\r\n2022/05/26 13:29:08.7483401 12788 11516 Shared          UpdateNetworkState Ipv4, cNetworkInterfaces = 1.\r\n2022/05/26 13:29:08.7483464 12788 11516 Shared          Power status changed\r\n2022/05/26 13:29:08.7501887 12788 11516 Agent           Initializing global settings cache\r\n2022/05/26 13:29:08.7501901 12788 11516 Agent           WSUS server: (null)\r\n2022/05/26 13:29:08.7501908 12788 11516 Agent           WSUS status server: (null)\r\n2022/05/26 13:29:08.7501914 12788 11516 Agent           Alternate Download Server: (null)\r\n2022/05/26 13:29:08.7501960 12788 11516 Agent           Fill Empty Content Urls: No\r\n2022/05/26 13:29:08.7501970 12788 11516 Agent           Target group: (Unassigned Computers)\r\n2022/05/26 13:29:08.7501976 12788 11516 Agent           Windows Update access disabled: No\r\n2022/05/26 13:29:08.7501984 12788 11516 Agent           Do not connect to Windows Update Internet locations: No\r\n2022/05/26 13:29:08.7510536 12788 11516 Agent               Timer: 7971F918-A847-4430-9279-4A52D1EFE18D, Expires 2022-05-26 12:02:15, not idle-only, network-only\r\n2022/05/26 13:29:08.7510569 12788 11516 Agent               Timer: 29A863E7-8609-4D1E-B7CD-5668F857F1DB, Expires 2022-05-26 19:34:26, not idle-only, not network-only\r\n2022/05/26 13:29:08.7542710 12788 11516 Agent           Initializing Windows Update Agent\r\n2022/05/26 13:29:08.7543107 12788 11516 DownloadManager Download manager restoring 0 downloads\r\n2022/05/26 13:29:08.7543379 12788 11516 Agent           CPersistentTimeoutScheduler | GetTimer, returned hr = 0x00000000\r\n2022/05/26 13:29:08.7546074 12788 11516 IdleTimer       IdleTimer::NetworkStateChanged. Network connected? Yes\r\n2022/05/26 13:29:08.7561750 9324  1700  ComApi          Reloading CUpdate D196881B-92D7-420F-9016-2B58A0655A93.200 from datastore...\r\n2022/05/26 13:29:08.7585561 9324  1700  ComApi          Deserializing update from serialized BSTR.\r\n2022/05/26 13:29:08.7587831 9324  1700  ComApi          Byte length of the input buffer for deserialization: 34482\r\n2022/05/26 13:29:08.7601452 9324  1700  ComApi          Deserializing update from serialized BSTR.\r\n2022/05/26 13:29:08.7601842 9324  1700  ComApi          Deserialized installable update PowerShell v7.2.4 (x64), UpdateID = {D196881B-92D7-420F-9016-2B58A0655A93.200}, CallbackInfo cookie length = 0\r\n2022/05/26 13:29:08.7602053 9324  1700  ComApi          Reload successful, UpdateID =  D196881B-92D7-420F-9016-2B58A0655A93.200, CallbackInfo cookie length = 0, Current deployment action = 1, New deployment action = 1\r\n2022/05/26 13:29:08.7701731 12788 6328  DownloadManager Received power state change notification: Old: <unknown>; New: AC.\r\n2022/05/26 13:29:08.7701748 12788 6328  DownloadManager Power state changed from <unknown> to AC.\r\n2022/05/26 13:29:09.1091778 9324  5928  ComApi          Serializing CUpdate D196881B-92D7-420F-9016-2B58A0655A93.200\r\n2022/05/26 13:29:09.1097386 9324  5928  ComApi          Update serialization complete. BSTR byte length = 34482, CallbackInfo cookie length = 0\r\n2022/05/26 13:39:08.7756496 12788 2980  Agent           Earliest future timer found: \r\n2022/05/26 13:39:08.7756593 12788 2980  Agent               Timer: 29A863E7-8609-4D1E-B7CD-5668F857F1DB, Expires 2022-05-26 19:34:26, not idle-only, not network-only\r\n2022/05/26 13:39:09.7822724 12788 11516 Shared          UninitializeSUS\r\n2022/05/26 13:39:09.7822775 12788 11516 Misc            CSusClientGlobal::DoServicePreShutdown\r\n2022/05/26 13:39:09.7823003 12788 11516 IdleTimer       Idle timer disabled in preparation for service shutdown\r\n2022/05/26 13:39:09.7823063 12788 11516 Misc            WUTaskManager uninit\r\n2022/05/26 13:39:09.7823136 12788 11516 Agent           Earliest future timer found: \r\n2022/05/26 13:39:09.7823198 12788 11516 Agent               Timer: 7971F918-A847-4430-9279-4A52D1EFE18D, Expires 2022-05-26 12:02:15, not idle-only, network-only\r\n2022/05/26 13:39:09.7859027 12788 11516 Misc            CreateSessionStateChangeTrigger, TYPE:2, Enable:No\r\n2022/05/26 13:39:09.7859057 12788 11516 Misc            CreateSessionStateChangeTrigger, TYPE:4, Enable:No\r\n2022/05/26 13:39:09.7883582 12788 11516 Misc            Agent uninit\r\n2022/05/26 13:39:09.7888735 12788 11516 Misc            Reporter uninit\r\n2022/05/26 13:39:09.7889365 12788 11516 Misc            network cost manager uninit\r\n2022/05/26 13:39:09.7889564 12788 11516 Misc            Eventer uninit\r\n2022/05/26 13:39:10.8033568 12788 11516 Misc            ServiceManager uninit\r\n2022/05/26 13:39:10.8034284 12788 11516 Misc            PersistentTimeoutScheduler uninit\r\n2022/05/26 13:39:10.8034320 12788 11516 Misc            datastore uninit\r\n2022/05/26 13:39:10.8402021 12788 11516 Misc            setting cache uninit\r\n2022/05/26 13:39:10.8402039 12788 11516 Misc            security checker uninit\r\n2022/05/26 13:39:10.8402063 12788 11516 Misc            Test Hook uninit\r\n2022/05/26 13:39:10.8402070 12788 11516 Misc            IdleTimer uninit\r\n2022/05/26 13:39:10.8404645 12788 11516 Shared          * END * Service exit Exit code = 0x240001\n```\n\n\n### Visuals\n\n_No response_",
  "closed_at": "2022-06-07T20:00:51Z",
  "comments": [
    {
      "author": "aleferri",
      "author_association": "NONE",
      "body": "News?",
      "created_at": "2022-05-31T12:11:17Z",
      "updated_at": "2022-05-31T12:11:17Z"
    },
    {
      "author": "TravisEz13",
      "author_association": "MEMBER",
      "body": "Duplicate of #16886 ",
      "created_at": "2022-06-06T19:54:48Z",
      "updated_at": "2022-06-06T19:54:48Z"
    },
    {
      "author": "msftbot[bot]",
      "author_association": "NONE",
      "body": "This issue has been marked as duplicate and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
      "created_at": "2022-06-07T20:00:50Z",
      "updated_at": "2022-06-07T20:00:50Z"
    }
  ],
  "created_at": "2022-05-26T20:12:46Z",
  "labels": [
    "Resolution-Duplicate",
    "Area-Maintainers-Build"
  ],
  "number": 17445,
  "state": "closed",
  "title": "After automatic update, context menu entry \"open Powershell Core 7 here\" is gone",
  "updated_at": "2022-06-07T20:00:51Z"
}