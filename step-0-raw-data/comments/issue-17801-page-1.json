[
  {
    "author_association": "CONTRIBUTOR",
    "body": "Faulty code:\r\n```pwsh\r\n# build.psm1:863, function New-PSOptions\r\nif (-not $Runtime) {\r\n    if ($environment.IsLinux) {     \r\n        $Runtime = \"linux-x64\"\r\n    } ...\r\n}\r\n```\r\n\r\nOn debian-family, we can run `dpkg --print-architecture` which returns `arm64` on my system, so we can do:\r\n\r\n```pwsh\r\n$defaultRuntime = 'linux-x64'\r\nif ($environment.IsDebianFamily) {\r\n    $Runtime = switch (dpkg --print-architecture) {\r\n        'arm64' { 'linux-arm64' }\r\n        'x64' { 'linux-x64' }\r\n        ...\r\n        default { Write-Warning \"Unknown architecture: '${_}', default to '${defaultRuntime}'; $defaultRuntime }\r\n    }\r\n} else {\r\n    # Add other options for detection\r\n    Write-Warning 'Cannot detect architecture on given system, default to '${defaultRuntime}'\r\n    $Runtime = $defaultRuntime\r\n}\r\n```\r\n\r\nEven better idea would be to just remove all of this from the script and use `dotnet publish --current-runtime` instead, but it is used couple times to set `$Runtime`, `$Executable` and `$Output`, so it may be difficult. But if `dotnet` can detect precise architecture, then surely we can just use it? Maybe add a field in `--info` so that `dotnet --runtime (dotnet --info | Select-String $runtimePattern)` is equivalent to `dotnet --current-runtime`. ",
    "created_at": "2022-07-29T14:19:50Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17801#issuecomment-1199372355",
    "id": 1199372355,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17801",
    "node_id": "IC_kwDOAvT7bc5HfPhD",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1199372355/reactions"
    },
    "updated_at": "2022-07-30T07:40:11Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1199372355",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/26599495?v=4",
      "events_url": "https://api.github.com/users/dkaszews/events{/privacy}",
      "followers_url": "https://api.github.com/users/dkaszews/followers",
      "following_url": "https://api.github.com/users/dkaszews/following{/other_user}",
      "gists_url": "https://api.github.com/users/dkaszews/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dkaszews",
      "id": 26599495,
      "login": "dkaszews",
      "node_id": "MDQ6VXNlcjI2NTk5NDk1",
      "organizations_url": "https://api.github.com/users/dkaszews/orgs",
      "received_events_url": "https://api.github.com/users/dkaszews/received_events",
      "repos_url": "https://api.github.com/users/dkaszews/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dkaszews/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dkaszews/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dkaszews"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Actually, dotnet 7 provides all the info we need in `--info`:\r\n\r\n```\r\nRuntime Environment:\r\n OS Name:     ubuntu\r\n OS Version:  22.04\r\n OS Platform: Linux\r\n RID:         ubuntu.22.04-arm64\r\n Base Path:   /home/dkaszews/.dotnet/sdk/7.0.100-preview.6.22352.1/\r\n\r\nHost:\r\n  Version:      7.0.0-preview.6.22324.4\r\n  Architecture: arm64\r\n  Commit:       d3fa592f6d\r\n```\r\n\r\nI have tested the following to both work on my personal Ubuntu ARM64 and work Windows x64, so can replace the entire default, similarly to how Windows is detected from RID:\r\n\r\n```powershell\r\n$info = dotnet --info\r\n$platform = ($info | Select-String '^\\s*OS Platform:\\s+(\\w+)$')[0].Matches.Groups[1].Value -replace 'windows', 'win'\r\n$architecture = ($info | Select-String '^\\s*Architecture:\\s+(\\w+)$')[0].Matches.Groups[1].Value                          \r\n$runtime = \"${platform}-${architecture}\".ToLower()\r\n```\r\n\r\nCan someone please verify this on other platforms?",
    "created_at": "2022-08-02T18:47:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17801#issuecomment-1203089854",
    "id": 1203089854,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17801",
    "node_id": "IC_kwDOAvT7bc5HtbG-",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1203089854/reactions"
    },
    "updated_at": "2022-08-02T18:50:55Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1203089854",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/26599495?v=4",
      "events_url": "https://api.github.com/users/dkaszews/events{/privacy}",
      "followers_url": "https://api.github.com/users/dkaszews/followers",
      "following_url": "https://api.github.com/users/dkaszews/following{/other_user}",
      "gists_url": "https://api.github.com/users/dkaszews/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dkaszews",
      "id": 26599495,
      "login": "dkaszews",
      "node_id": "MDQ6VXNlcjI2NTk5NDk1",
      "organizations_url": "https://api.github.com/users/dkaszews/orgs",
      "received_events_url": "https://api.github.com/users/dkaszews/received_events",
      "repos_url": "https://api.github.com/users/dkaszews/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dkaszews/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dkaszews/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dkaszews"
    }
  },
  {
    "author_association": "NONE",
    "body": ":tada:This issue was addressed in #17818, which has now been successfully released as `v7.3.0-preview.7`.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.3.0-preview.7)\n",
    "created_at": "2022-08-11T23:57:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17801#issuecomment-1212602019",
    "id": 1212602019,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17801",
    "node_id": "IC_kwDOAvT7bc5IRtaj",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1212602019/reactions"
    },
    "updated_at": "2022-08-11T23:57:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1212602019",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  }
]
