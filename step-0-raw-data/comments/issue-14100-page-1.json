[
  {
    "author_association": "COLLABORATOR",
    "body": "That _is_ pretty odd! I don't think there's much, if anything, that PS 7 can do to rectify the behaviour you're seeing in Windows PowerShell.\r\n\r\n WinPS is not being developed any further, so I don't think it's likely that whatever is causing this in Windows PowerShell will be fixed.",
    "created_at": "2020-11-15T22:54:07Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-727651729",
    "id": 727651729,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzY1MTcyOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727651729/reactions"
    },
    "updated_at": "2020-11-15T22:54:07Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727651729",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "It's a moot point, as @vexx32 states, but the bug is related to `New-TemporaryFile` being implemented as a _function_ in Windows PowerShell.\r\n\r\nIn other words: it seems that all commands returned by `Get-Command -Module Microsoft.PowerShell.Utility -Type function` are affected in Windows PowerShell, and potentially all other commands implemented as _functions_.\r\n\r\nIn PowerShell Core, all former `Microsoft.PowerShell.Utility` _functions_ have been re-implemented as _cmdlets_, so the problem by definition doesn't arise there.\r\n\r\nThat said, in PowerShell Core there still are _functions_ among the in-box modules, as \r\n`Get-Command -Type function | where Source -like 'Microsoft.*'` indicates.\r\n\r\nCalling such a function via the PowerShell _Core_  CLI seems to work fine, fortunately:\r\n\r\n```\r\npwsh -noprofile -c 'Compress-Archive -?'\r\n```\r\n",
    "created_at": "2020-11-15T23:42:02Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-727658593",
    "id": 727658593,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzY1ODU5Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727658593/reactions"
    },
    "updated_at": "2020-11-16T14:09:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727658593",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I guess it is again PSModulePath issue. If we run _directly_ Windows PowerShell we modify PSModulePath as needed, otherwise we don't.",
    "created_at": "2020-11-16T10:47:44Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-727898924",
    "id": 727898924,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzg5ODkyNA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727898924/reactions"
    },
    "updated_at": "2020-11-16T10:47:44Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/727898924",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "I got myself confused earlier: I actually only see the problem in `7.1.0-rc.2`, and no longer in `7.1.0`, in combination with Windows PowerShell `v5.1.19041.610`.\r\n\r\nAlso, unless the following test is flawed, the problem does _not_ appear to be related to `$env:PSModulePath`, because I get equivalent results in both versions:\r\n\r\n```\r\nPSCore> cmd /c powershell.exe -nop -command `$env:PSModulePath -split \"';'\"\r\n```\r\n",
    "created_at": "2020-11-16T17:44:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-728219110",
    "id": 728219110,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODIxOTExMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728219110/reactions"
    },
    "updated_at": "2020-11-16T17:45:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728219110",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "@mklement0 I think you were on the right track before. When I run your `PSModulePath` query command on `7.1.0` with the `cmd.exe` proxy I get `%ProgramFiles%\\PowerShell\\Modules` and `%ProgramFiles%\\PowerShell\\7\\Modules` on top of the paths returned _without_ going through the `cmd.exe` proxy.\r\n\r\nLooks like they have precedence over the others, when loading  `Microsoft.PowerShell.Utility`.\r\n\r\nWhen running your variant, with manually setting `PSModulePath`, I get no errors, `New-TemporaryFile` is called successfully.",
    "created_at": "2020-11-16T21:43:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-728346669",
    "id": 728346669,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODM0NjY2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728346669/reactions"
    },
    "updated_at": "2020-11-16T21:46:50Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728346669",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/644505?v=4",
      "events_url": "https://api.github.com/users/hero101111/events{/privacy}",
      "followers_url": "https://api.github.com/users/hero101111/followers",
      "following_url": "https://api.github.com/users/hero101111/following{/other_user}",
      "gists_url": "https://api.github.com/users/hero101111/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/hero101111",
      "id": 644505,
      "login": "hero101111",
      "node_id": "MDQ6VXNlcjY0NDUwNQ==",
      "organizations_url": "https://api.github.com/users/hero101111/orgs",
      "received_events_url": "https://api.github.com/users/hero101111/received_events",
      "repos_url": "https://api.github.com/users/hero101111/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/hero101111/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hero101111/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/hero101111"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Interesting, @hero101111; your experience is consistent with @iSazonov's explanation, but the strange thing is that the despite the presence of these extra, PS Core-only folders, the command succeeds for me in `7.1.0` - the only notable difference is that my installation is in a custom location inside my `$env:USERPROFILE` folder.",
    "created_at": "2020-11-16T22:42:30Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-728374316",
    "id": 728374316,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODM3NDMxNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728374316/reactions"
    },
    "updated_at": "2020-11-16T22:44:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728374316",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "I just tried installing PowerShell 7.1.0 in `$env:USERPROFILE` and it still fails to locate `New-TemporaryFile`. Tried it also on a second Windows 10 version 2004 (Windows PowerShell 5.1.19041) machine as well. Seems like there's a different factor at play here.",
    "created_at": "2020-11-17T00:37:58Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-728532455",
    "id": 728532455,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODUzMjQ1NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728532455/reactions"
    },
    "updated_at": "2020-11-17T00:37:58Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/728532455",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/644505?v=4",
      "events_url": "https://api.github.com/users/hero101111/events{/privacy}",
      "followers_url": "https://api.github.com/users/hero101111/followers",
      "following_url": "https://api.github.com/users/hero101111/following{/other_user}",
      "gists_url": "https://api.github.com/users/hero101111/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/hero101111",
      "id": 644505,
      "login": "hero101111",
      "node_id": "MDQ6VXNlcjY0NDUwNQ==",
      "organizations_url": "https://api.github.com/users/hero101111/orgs",
      "received_events_url": "https://api.github.com/users/hero101111/received_events",
      "repos_url": "https://api.github.com/users/hero101111/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/hero101111/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hero101111/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/hero101111"
    }
  },
  {
    "author_association": "NONE",
    "body": "Workaround : \r\n`cmd.exe /c \"powershell.exe -command \"\"Import-Module Microsoft.PowerShell.Utility; New-TemporaryFile\"\"\"`\r\n",
    "created_at": "2021-10-18T18:32:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-946050129",
    "id": 946050129,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "IC_kwDOAvT7bc44Y5RR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/946050129/reactions"
    },
    "updated_at": "2021-10-18T18:33:46Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/946050129",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8860490?v=4",
      "events_url": "https://api.github.com/users/GaetanCambier/events{/privacy}",
      "followers_url": "https://api.github.com/users/GaetanCambier/followers",
      "following_url": "https://api.github.com/users/GaetanCambier/following{/other_user}",
      "gists_url": "https://api.github.com/users/GaetanCambier/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/GaetanCambier",
      "id": 8860490,
      "login": "GaetanCambier",
      "node_id": "MDQ6VXNlcjg4NjA0OTA=",
      "organizations_url": "https://api.github.com/users/GaetanCambier/orgs",
      "received_events_url": "https://api.github.com/users/GaetanCambier/received_events",
      "repos_url": "https://api.github.com/users/GaetanCambier/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/GaetanCambier/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GaetanCambier/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/GaetanCambier"
    }
  },
  {
    "author_association": "NONE",
    "body": "another workaround, unset PSModulePath to restore default for powershell\r\n\r\n```powershell\r\ncmd /c \"set PSModulePath=&&powershell -command \"\"New-TemporaryFile\"\"\"\r\n```",
    "created_at": "2022-03-28T02:33:34Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-1080118289",
    "id": 1080118289,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "IC_kwDOAvT7bc5AYUwR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1080118289/reactions"
    },
    "updated_at": "2022-03-28T02:34:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1080118289",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/4059089?v=4",
      "events_url": "https://api.github.com/users/gzm55/events{/privacy}",
      "followers_url": "https://api.github.com/users/gzm55/followers",
      "following_url": "https://api.github.com/users/gzm55/following{/other_user}",
      "gists_url": "https://api.github.com/users/gzm55/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/gzm55",
      "id": 4059089,
      "login": "gzm55",
      "node_id": "MDQ6VXNlcjQwNTkwODk=",
      "organizations_url": "https://api.github.com/users/gzm55/orgs",
      "received_events_url": "https://api.github.com/users/gzm55/received_events",
      "repos_url": "https://api.github.com/users/gzm55/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/gzm55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gzm55/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/gzm55"
    }
  },
  {
    "author_association": "NONE",
    "body": "Just to add to the discussion, i personally resorted to calling the internal .NET function in case of error. Importing `Microsoft.PowerShell.Utility` or setting `PSModulePath=` didn't work for me.\r\n\r\n```powershell\r\n    try {\r\n        $TempFile = New-TemporaryFile\r\n    }\r\n    catch {\r\n        $TempFile = Get-Item ([System.IO.Path]::GetTempFilename())\r\n    }\r\n```",
    "created_at": "2022-09-04T22:39:06Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14100#issuecomment-1236428024",
    "id": 1236428024,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14100",
    "node_id": "IC_kwDOAvT7bc5JsmT4",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1236428024/reactions"
    },
    "updated_at": "2022-09-04T22:39:06Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1236428024",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/18366087?v=4",
      "events_url": "https://api.github.com/users/aetonsi/events{/privacy}",
      "followers_url": "https://api.github.com/users/aetonsi/followers",
      "following_url": "https://api.github.com/users/aetonsi/following{/other_user}",
      "gists_url": "https://api.github.com/users/aetonsi/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/aetonsi",
      "id": 18366087,
      "login": "aetonsi",
      "node_id": "MDQ6VXNlcjE4MzY2MDg3",
      "organizations_url": "https://api.github.com/users/aetonsi/orgs",
      "received_events_url": "https://api.github.com/users/aetonsi/received_events",
      "repos_url": "https://api.github.com/users/aetonsi/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/aetonsi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aetonsi/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/aetonsi"
    }
  }
]
