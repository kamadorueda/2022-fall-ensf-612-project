[
  {
    "author_association": "COLLABORATOR",
    "body": "I see in debugger that second is processed in the [line](https://github.com/PowerShell/PowerShell/blob/5d54f1aa3871a826409496437e25856dc263ccc4/src/System.Management.Automation/engine/runtime/Operations/MiscOps.cs#L2308)",
    "created_at": "2019-02-25T17:20:01Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467098254",
    "id": 467098254,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzA5ODI1NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467098254/reactions"
    },
    "updated_at": "2019-02-25T17:20:01Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467098254",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Perhaps it should be:\r\n```powershell\r\n[GC]::Collect(); [GC]::WaitForPendingFinalizers()\r\n$re = [Regex]::new('f?(o)', 'Compiled, IgnoreCase, CultureInvariant')\r\n(Measure-Command { \r\n  switch -regex (, 'foo' * 1e6) { $re { $true } } }\r\n).TotalSeconds\r\n```",
    "created_at": "2019-02-25T17:23:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467099366",
    "id": 467099366,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzA5OTM2Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467099366/reactions"
    },
    "updated_at": "2019-02-25T17:23:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467099366",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "If compilation of regex is slow it is .Net Core 2 problem and we need measure against .Net Core 3.0.",
    "created_at": "2019-02-25T17:24:59Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467100026",
    "id": 467100026,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzEwMDAyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467100026/reactions"
    },
    "updated_at": "2019-02-25T17:24:59Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467100026",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@iSazonov: The problem isn't the compilation time of the regex - the variant command you suggest roughly shows the same as the original test. (In fact, moving the `$re = ...` line out of the `Measure-Command` slows things down even further, perhaps because the variable must then be located in a different scope?)\r\n\r\n~~The source-code line you link to (which is also in the OP) shows the real problem: instead of using the predefined `[regex]` instance directly, the static `[Regex]::Match()` method is called with the _stringified value_ of the `[regex]` instance.~~\r\n\r\n\r\n\r\n",
    "created_at": "2019-02-25T17:40:54Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467105994",
    "id": 467105994,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzEwNTk5NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467105994/reactions"
    },
    "updated_at": "2019-02-25T19:22:02Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467105994",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@iSazonov, @IISResetMe pointed out that I had misread the source code: with the case-sensitivity option matching, a predefined `[regex]` instance _is_ used - yet it doesn't result in improved performance; I've already asked @IISResetMe in #8946 if he happens to have an explanation, but perhaps you have a sense too.",
    "created_at": "2019-02-25T19:28:21Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467148315",
    "id": 467148315,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE0ODMxNQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467148315/reactions"
    },
    "updated_at": "2019-02-25T19:29:21Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467148315",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Best way is to measure .Net Core 3.0 implementation. You could create simple test in C#. I expect that result will be better.",
    "created_at": "2019-02-25T19:32:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467150101",
    "id": 467150101,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE1MDEwMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467150101/reactions"
    },
    "updated_at": "2019-02-25T19:32:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467150101",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@mklement0 I'm not sure it's actually slower, I think [dot-source variable lookup](https://github.com/PowerShell/PowerShell/issues/8911#issuecomment-464954324) (`Measure-Command` doesn't create a new scope) could be affecting those results.\r\n\r\n```powershell\r\n# switch -regex with string literal\r\n[GC]::Collect(); [GC]::WaitForPendingFinalizers()\r\n(Measure-Command { \r\n  switch -regex (, 'foo' * 1e6) { 'f?(o)' { $true } } \r\n}).TotalSeconds\r\n\r\n# switch -regex with precompiled [regex] instance\r\n[GC]::Collect(); [GC]::WaitForPendingFinalizers()\r\n(Measure-Command { \r\n  $re = [Regex]::new('f?(o)', 'Compiled, IgnoreCase, CultureInvariant')\r\n  switch -regex (, 'foo' * 1e6) { $re { $true } } }\r\n).TotalSeconds\r\n\r\n# switch -regex with precompiled [regex] instance within a new scope\r\n[GC]::Collect(); [GC]::WaitForPendingFinalizers()\r\n(Measure-Command { \r\n  & {\r\n    $re = [Regex]::new('f?(o)', 'Compiled, IgnoreCase, CultureInvariant')\r\n    switch -regex (, 'foo' * 1e6) { $re { $true } } }\r\n  }\r\n).TotalSeconds\r\n```\r\n\r\n```text\r\n4.6255024\r\n5.1760229\r\n3.4601631\r\n```\r\n\r\nIt's possible that the caching done by `Regex.Match` could have received some performance updates, making the two methods comparable speeds.",
    "created_at": "2019-02-25T20:09:46Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467164041",
    "id": 467164041,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE2NDA0MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467164041/reactions"
    },
    "updated_at": "2019-02-25T20:09:46Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467164041",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Why & is used only in last test?",
    "created_at": "2019-02-25T20:23:48Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467168822",
    "id": 467168822,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE2ODgyMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467168822/reactions"
    },
    "updated_at": "2019-02-25T20:23:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467168822",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Good find, thanks, @SeeminglyScience - so it does improve performance (though not drastically; indeed, in general I've found that in .NET _Core_ (unlike with the .NET Framework) repeated `Regex.Match()` use with strings incurs  relatively little overhead thanks to automatic caching of compiled regexes).\r\n\r\n@iSazonov: By using `& { ... }` (a child scope), @SeeminglyScience is demonstrating that the slow-down comes from the variable lookups that are performed in dot-sourced code, as discussed in #8911.\r\n\r\nI'll close this.",
    "created_at": "2019-02-25T20:42:43Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467175082",
    "id": 467175082,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE3NTA4Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467175082/reactions"
    },
    "updated_at": "2019-02-25T20:57:41Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467175082",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "P.S., @SeeminglyScience  and @iSazonov: I'd love to hear your thoughts on the (updated) #8977",
    "created_at": "2019-02-25T23:58:01Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8976#issuecomment-467234091",
    "id": 467234091,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8976",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzIzNDA5MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467234091/reactions"
    },
    "updated_at": "2019-02-25T23:58:01Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467234091",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  }
]
