[
  {
    "author_association": "COLLABORATOR",
    "body": "PowerShell doesn't do the work of resolving the 8.3 path as far as I know, we just delegate to the operating system / .NET APIs to resolve the path. If the TEMP var contains a non usable path there's not much we can do.\r\n\r\nI'm not sure how you got an 8.3 path like that into your TEMP variable or what caused it (generally as far as I'm aware 8.3 paths aren't used if the name is sufficiently short, so it's odd that the path was recorded in that way), but I don't think there's much PowerShell can do here. ðŸ˜• ",
    "created_at": "2022-05-17T12:52:50Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17359#issuecomment-1128831378",
    "id": 1128831378,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17359",
    "node_id": "IC_kwDOAvT7bc5DSJmS",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1128831378/reactions"
    },
    "updated_at": "2022-05-17T12:53:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1128831378",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "NONE",
    "body": "> we just delegate to the operating system / .NET APIs to resolve the path\r\n\r\nThat does not seem to be true. Having a look at `FileSystemProvider.cs` there is a lot going on before a path reaches the operating system or .NET APIs.\r\nThe culprit should be here:\r\nhttps://github.com/PowerShell/PowerShell/blob/65d8f11aebbdb49b7e28af026d84bf1d38705d37/src/System.Management.Automation/namespaces/FileSystemProvider.cs#L5642\r\n\r\nI don't know how to activate tracing for PowerShell. But the tracing output should show that the culprit is there.\r\n\r\n> If the TEMP var contains a non usable path there's not much we can do.\r\n\r\nThe path is totally valid and doing a `cd %temp%` in a batch is not an issue.\r\nUsing .NET APIs with that path is not an issue.\r\nSo it's clearly a PowerShell issue.\r\n\r\n> I'm not sure how you got an 8.3 path like that into your TEMP variable or what caused it (generally as far as I'm aware 8.3 paths aren't used if the name is sufficiently short, so it's odd that the path was recorded in that way)\r\n\r\nThat's done by windows itself. Try it yourself. Create a new local user account on your machine with the username \"b.schmidt\" and viola, your user directory is `C:\\Users\\B536F~1.SCH`.",
    "created_at": "2022-05-17T17:07:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17359#issuecomment-1129112041",
    "id": 1129112041,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17359",
    "node_id": "IC_kwDOAvT7bc5DTOHp",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129112041/reactions"
    },
    "updated_at": "2022-05-17T17:07:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129112041",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1971030?v=4",
      "events_url": "https://api.github.com/users/batzen/events{/privacy}",
      "followers_url": "https://api.github.com/users/batzen/followers",
      "following_url": "https://api.github.com/users/batzen/following{/other_user}",
      "gists_url": "https://api.github.com/users/batzen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/batzen",
      "id": 1971030,
      "login": "batzen",
      "node_id": "MDQ6VXNlcjE5NzEwMzA=",
      "organizations_url": "https://api.github.com/users/batzen/orgs",
      "received_events_url": "https://api.github.com/users/batzen/received_events",
      "repos_url": "https://api.github.com/users/batzen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/batzen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/batzen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/batzen"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "So calling this code in PowerShell works?\r\n\r\n```powershell\r\n[System.IO.Directory]::GetFiles($env:temp)\r\n```\r\n\r\nI'm rather surprised we do additional processing on the 8.3 path representation in PowerShell, but if so that definitely sounds like something we need to fix.",
    "created_at": "2022-05-17T17:37:06Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17359#issuecomment-1129140007",
    "id": 1129140007,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17359",
    "node_id": "IC_kwDOAvT7bc5DTU8n",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129140007/reactions"
    },
    "updated_at": "2022-05-17T17:37:28Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129140007",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "NONE",
    "body": "Calling `[System.IO.Directory]::GetFiles($env:temp)` works fine as the path exists.\r\n\r\n> I'm rather surprised we do additional processing on the 8.3 path representation in PowerShell, but if so that definitely sounds like something we need to fix.\r\n\r\nThere isn't ~really~ much processing, but the check asserts that `FullName.Length >= current.Length` and that's not the case for that path. As FullName would be `C:\\Users\\b.schmidt` and current would be `C:\\Users\\B536F~1.SCH` (as far as i can tell from just reading the code).",
    "created_at": "2022-05-17T17:55:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17359#issuecomment-1129156198",
    "id": 1129156198,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17359",
    "node_id": "IC_kwDOAvT7bc5DTY5m",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129156198/reactions"
    },
    "updated_at": "2022-05-18T05:26:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1129156198",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1971030?v=4",
      "events_url": "https://api.github.com/users/batzen/events{/privacy}",
      "followers_url": "https://api.github.com/users/batzen/followers",
      "following_url": "https://api.github.com/users/batzen/following{/other_user}",
      "gists_url": "https://api.github.com/users/batzen/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/batzen",
      "id": 1971030,
      "login": "batzen",
      "node_id": "MDQ6VXNlcjE5NzEwMzA=",
      "organizations_url": "https://api.github.com/users/batzen/orgs",
      "received_events_url": "https://api.github.com/users/batzen/received_events",
      "repos_url": "https://api.github.com/users/batzen/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/batzen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/batzen/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/batzen"
    }
  }
]
