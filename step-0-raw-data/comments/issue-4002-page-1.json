[
  {
    "author_association": "COLLABORATOR",
    "body": "I am able to repro this.  This does look like inconsistent behavior.  If the default out-putter is configured then the error message is just displayed.  But if error is redirected to a pipe then it goes through MshCommandRuntime processing and ErrorActionPreference is effective, and the stop exception is thrown.\r\n\r\nThis is done here:\r\nhttps://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/engine/NativeCommandProcessor.cs#L634\r\n",
    "created_at": "2017-06-13T23:42:18Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-308279134",
    "id": 308279134,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI3OTEzNA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308279134/reactions"
    },
    "updated_at": "2017-06-13T23:42:18Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308279134",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": "I disagree w/ expected behavior.   I don't think the expected behavior of `2>$null` is documented anywhere.   It was an intentional edge-case while I was searching for potential extensions to redirection syntax.   You can find other similar cases, e.g. \r\n\r\n    try {cmd /c whamo! 2>$()} catch { \"Dang!\" }\r\n",
    "created_at": "2017-06-14T01:32:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-308294138",
    "id": 308294138,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI5NDEzOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308294138/reactions"
    },
    "updated_at": "2017-06-14T01:32:40Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308294138",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2715647?v=4",
      "events_url": "https://api.github.com/users/BurtHarris/events{/privacy}",
      "followers_url": "https://api.github.com/users/BurtHarris/followers",
      "following_url": "https://api.github.com/users/BurtHarris/following{/other_user}",
      "gists_url": "https://api.github.com/users/BurtHarris/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BurtHarris",
      "id": 2715647,
      "login": "BurtHarris",
      "node_id": "MDQ6VXNlcjI3MTU2NDc=",
      "organizations_url": "https://api.github.com/users/BurtHarris/orgs",
      "received_events_url": "https://api.github.com/users/BurtHarris/received_events",
      "repos_url": "https://api.github.com/users/BurtHarris/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BurtHarris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BurtHarris/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BurtHarris"
    }
  },
  {
    "author_association": "NONE",
    "body": "P.S.   What @mklement0 is referring to as \"the 2nd half of the message\" is not \"missing\", or if so then I found it...   It's not coming from the native command, it's a PowerShell ErrorRecord that get's it's own slot.\r\n\r\n    PS> $error.Clear()\r\n    PS> cmd /c whamo! 2>$()\r\n    PS> $error.Count\r\n    2\r\n    PS> $error[0]\r\n    operable program or batch file.\r\n    PS> $error[1]\r\n    cmd : 'whamo!' is not recognized as an internal or external command,\r\n    At line:1 char:1\r\n    + cmd /c whamo! 2>$()\r\n    + ~~~~~~~~~~~~~~~~~~~\r\n        + CategoryInfo          : NotSpecified: ('whamo!' is not...ternal command,:String) [], RemoteException\r\n        + FullyQualifiedErrorId : NativeCommandError\r\n    \r\n",
    "created_at": "2017-06-14T01:46:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-308296047",
    "id": 308296047,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI5NjA0Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308296047/reactions"
    },
    "updated_at": "2017-06-14T01:46:53Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308296047",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2715647?v=4",
      "events_url": "https://api.github.com/users/BurtHarris/events{/privacy}",
      "followers_url": "https://api.github.com/users/BurtHarris/followers",
      "following_url": "https://api.github.com/users/BurtHarris/following{/other_user}",
      "gists_url": "https://api.github.com/users/BurtHarris/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BurtHarris",
      "id": 2715647,
      "login": "BurtHarris",
      "node_id": "MDQ6VXNlcjI3MTU2NDc=",
      "organizations_url": "https://api.github.com/users/BurtHarris/orgs",
      "received_events_url": "https://api.github.com/users/BurtHarris/received_events",
      "repos_url": "https://api.github.com/users/BurtHarris/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BurtHarris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BurtHarris/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BurtHarris"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@BurtHarris  I've revised the expected-behavior description in the original post in light of the discussion in the linked issue: if the consensus is that stderr output should never generate an error, then the expected behavior is as _now_ described in the initial post.\r\n\r\nYes, _any_ `2>` redirection triggers the symptom, presumably for the reasons @PaulHigin states.\r\n\r\nWithout `$ErrorActionPreference = 'Stop'` in the mix, you do indeed get _all_ stderr lines recorded in `$Error`, as an _error record each_, but _with_ `$ErrorActionPreference = 'Stop'`, the _1st_ line triggers termination of the pipeline, so the 2nd line never gets recorded in `$Error`.\r\n\r\n> I don't think the expected behavior of 2>$null is documented anywhere.\r\n\r\nIndeed, [about_Redirection](https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/about/about_redirection) doesn't mention redirecting to `$null`, but if it does anything other than _silently discarding the stream_ (as it does with the _success stream_, for instance), we have a problem - as evidenced by this issue.\r\n\r\nThe unfortunate interaction with `$ErrorActionPreference = 'Stop'` is one thing, but the fact that output that you're asking to have _suppressed_ is _still getting recorded_ somewhere - in `$Error` - is absolutely counter-intuitive.",
    "created_at": "2017-06-14T02:09:58Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-308299281",
    "id": 308299281,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODI5OTI4MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 4,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 4,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308299281/reactions"
    },
    "updated_at": "2017-06-14T02:12:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/308299281",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "Where is this issue?  I've been able to repro it across an upgrade of a build version and wonder if I'm missing something since this is such an old thread.\r\n\r\nrepro: powershell v5.1.17763.316, OS 10.0.17763\r\nno-repro: powershell v5.1.16299.967, OS 10.0.16299\r\n\r\nIs the upgrade from 16299 to 17763 going to pull this in, and any projection of a fix?  We've seen unreliability in our CI builds bailing out at odd times when they hit a machine with this newer powershell installed.",
    "created_at": "2019-03-11T15:49:17Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-471598284",
    "id": 471598284,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTU5ODI4NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/471598284/reactions"
    },
    "updated_at": "2019-03-11T15:49:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/471598284",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1724619?v=4",
      "events_url": "https://api.github.com/users/zjrunner/events{/privacy}",
      "followers_url": "https://api.github.com/users/zjrunner/followers",
      "following_url": "https://api.github.com/users/zjrunner/following{/other_user}",
      "gists_url": "https://api.github.com/users/zjrunner/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/zjrunner",
      "id": 1724619,
      "login": "zjrunner",
      "node_id": "MDQ6VXNlcjE3MjQ2MTk=",
      "organizations_url": "https://api.github.com/users/zjrunner/orgs",
      "received_events_url": "https://api.github.com/users/zjrunner/received_events",
      "repos_url": "https://api.github.com/users/zjrunner/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/zjrunner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zjrunner/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/zjrunner"
    }
  },
  {
    "author_association": "NONE",
    "body": "Hi.\r\nLet me chime in.\r\n\r\nI have a script which cheks if a python module is installed\r\n```\r\npython -c \"import blah\" 2>$null\r\nif ($?) {\r\n  # Run expensive installations\r\n}\r\n```\r\nthen I enabled strict error handling `$ErrorActionPreference = \"stop\"` and whenever that line runs (and the module is not setup), the whole script aborts instead of running the following steps.\r\nI tried also with `python -c ... 2>&1 | out-null` and the `NativeCommandError` is always there.\r\nThis seems like a clear bug to me. If the error stream is being redirected to `$null`, that means that the user is explicitly ignoring any errors.\r\nSo far, the only work around is to use `try{} catch{}`.\r\n\r\nTestcase\r\n```\r\nWrite-Host You should not see an error\r\n$ErrorActionPreference = \"stop\"\r\npython -c \"import notfound_foobar\" 2>$null\r\nWrite-Host PASS\r\n```\r\n",
    "created_at": "2019-11-27T14:53:25Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-559120102",
    "id": 559120102,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1OTEyMDEwMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/559120102/reactions"
    },
    "updated_at": "2019-11-27T14:53:25Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/559120102",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/461983?v=4",
      "events_url": "https://api.github.com/users/joaoe/events{/privacy}",
      "followers_url": "https://api.github.com/users/joaoe/followers",
      "following_url": "https://api.github.com/users/joaoe/following{/other_user}",
      "gists_url": "https://api.github.com/users/joaoe/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/joaoe",
      "id": 461983,
      "login": "joaoe",
      "node_id": "MDQ6VXNlcjQ2MTk4Mw==",
      "organizations_url": "https://api.github.com/users/joaoe/orgs",
      "received_events_url": "https://api.github.com/users/joaoe/received_events",
      "repos_url": "https://api.github.com/users/joaoe/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/joaoe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joaoe/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/joaoe"
    }
  },
  {
    "author_association": "NONE",
    "body": "Have just hit this myself.  Calling an exe and redirecting the errorstream to a file (it doesn't actually contain an error, just additional info), and had been happily using it for a year or two.  I turned ErrorActionPreference to \"Stop\" globally, and suddenly it fails, despite there not being any actual errors.",
    "created_at": "2020-01-23T15:42:28Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-577737894",
    "id": 577737894,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzczNzg5NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 3,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 3,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/577737894/reactions"
    },
    "updated_at": "2020-01-23T15:42:28Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/577737894",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/91378?v=4",
      "events_url": "https://api.github.com/users/andrewducker/events{/privacy}",
      "followers_url": "https://api.github.com/users/andrewducker/followers",
      "following_url": "https://api.github.com/users/andrewducker/following{/other_user}",
      "gists_url": "https://api.github.com/users/andrewducker/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/andrewducker",
      "id": 91378,
      "login": "andrewducker",
      "node_id": "MDQ6VXNlcjkxMzc4",
      "organizations_url": "https://api.github.com/users/andrewducker/orgs",
      "received_events_url": "https://api.github.com/users/andrewducker/received_events",
      "repos_url": "https://api.github.com/users/andrewducker/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/andrewducker/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andrewducker/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/andrewducker"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Related to #3996, want to address similarly",
    "created_at": "2020-07-13T22:17:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-657821137",
    "id": 657821137,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzgyMTEzNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/657821137/reactions"
    },
    "updated_at": "2020-07-13T22:17:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/657821137",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1255187?v=4",
      "events_url": "https://api.github.com/users/joeyaiello/events{/privacy}",
      "followers_url": "https://api.github.com/users/joeyaiello/followers",
      "following_url": "https://api.github.com/users/joeyaiello/following{/other_user}",
      "gists_url": "https://api.github.com/users/joeyaiello/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/joeyaiello",
      "id": 1255187,
      "login": "joeyaiello",
      "node_id": "MDQ6VXNlcjEyNTUxODc=",
      "organizations_url": "https://api.github.com/users/joeyaiello/orgs",
      "received_events_url": "https://api.github.com/users/joeyaiello/received_events",
      "repos_url": "https://api.github.com/users/joeyaiello/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/joeyaiello/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joeyaiello/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/joeyaiello"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "We discussed this in the @PowerShell/powershell-committee and agreed this is a dupe of #3996 ",
    "created_at": "2020-07-29T22:47:28Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4002#issuecomment-665969315",
    "id": 665969315,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4002",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTk2OTMxNQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/665969315/reactions"
    },
    "updated_at": "2020-07-29T22:47:28Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/665969315",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  }
]
