[
  {
    "author_association": "COLLABORATOR",
    "body": "This only occurs when there's a mismatch between the case-sensitivity of the `switch` and the `[regex]` instance. \r\n\r\nTo illustrate what this means in practice, see this example:\r\n\r\n```powershell\r\n# [regex] case-sensitive, ignores whitespace in pattern\r\n$TwoLLNoSpace = [regex]::new('\\p{Ll} \\p{Ll}', 'IgnorePatternWhitespace') #case\r\n\r\n# Case-sensitivity is the same, will work as expected\r\nswitch -Regex -CaseSensitive ('a b', 'ab') {\r\n  $TwoLLNoSpace {\r\n    $_\r\n  }\r\n}\r\n\r\n# Case-sensitivity mismatch, regex recreated with IgnoreCase as only option, matches on wrong input\r\nswitch -Regex ('a b', 'ab') {\r\n  $TwoLLNoSpace {\r\n    $_\r\n  }\r\n}\r\n```\r\n\r\nAt the very least we should copy the existing `Options` value and only add/subtract the `IgnoreCase` flag as dictated by `-CaseSensitive`, [something like this](https://github.com/IISResetMe/PowerShell/commit/cc252613b189ed3925761f5638562ef75c71b3a0) perhaps... but I'm not sure I agree that individual cases should be allowed to override the behavior of the parameter.",
    "created_at": "2019-02-23T16:28:02Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-466666483",
    "id": 466666483,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NjY2NjQ4Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/466666483/reactions"
    },
    "updated_at": "2019-02-23T16:28:02Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/466666483",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7413755?v=4",
      "events_url": "https://api.github.com/users/IISResetMe/events{/privacy}",
      "followers_url": "https://api.github.com/users/IISResetMe/followers",
      "following_url": "https://api.github.com/users/IISResetMe/following{/other_user}",
      "gists_url": "https://api.github.com/users/IISResetMe/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/IISResetMe",
      "id": 7413755,
      "login": "IISResetMe",
      "node_id": "MDQ6VXNlcjc0MTM3NTU=",
      "organizations_url": "https://api.github.com/users/IISResetMe/orgs",
      "received_events_url": "https://api.github.com/users/IISResetMe/received_events",
      "repos_url": "https://api.github.com/users/IISResetMe/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/IISResetMe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/IISResetMe/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/IISResetMe"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the sleuthing, @IISResetMe - you've found [the crux of the inconsistency](https://github.com/PowerShell/PowerShell/blob/5d54f1aa3871a826409496437e25856dc263ccc4/src/System.Management.Automation/engine/runtime/Operations/MiscOps.cs#L2304-L2309):\r\n\r\n* `switch -regex [-casesensitive]` makes its own (implied) case-sensitivity override the options of the predefined `[regex]` instance.\r\n\r\n* whereas `-match` == `-imatch` / `-cmatch` and `-replace` = `-ireplace` / `-creplace` do not - they respect whatever options are built into the `[regex]`\r\n\r\nTo wit (applies to `-replace` too):\r\n\r\n```powershell\r\nPS> 'a' -cmatch ([regex]::new('A', 'IgnoreCase'))\r\nTrue # The 'c' in -cmatch was ignored in favor of the options built into the [regex]\r\n```\r\n\r\nI created this issue based on this expectation, given that I'd always seen `-match` and `-replace` operate that way (also in Windows PowerShell).\r\n\r\nWhile you could argue that the inconsistency should be resolved the way that `switch -regex` works, doing so would be a breaking change. [_Update_: of course, as would changing the behavior of `switch -regex` be].\r\n\r\nWhile there is undoubtedly a contradiction, I think it is defensible - though requires documentation - to give precedence to the options baked into a predefined `[regex]` instance.\r\n\r\nPredefining a `[regex]` is an advanced technique anyway, whose primary purpose to me is as a _performance optimization_ with _high iteration counts_, so as to use the given instance _as-is_, without incurring the cost of regex construction.\r\n\r\nHowever, note that even with matching options ~~[the precompiled / predefined `[regex]` instance is _not_ used as-is](https://github.com/PowerShell/PowerShell/blob/5d54f1aa3871a826409496437e25856dc263ccc4/src/System.Management.Automation/engine/runtime/Operations/MiscOps.cs#L2312)~~ the code doesn't run any faster, at least in PowerShell _Core_ - see #8976.\r\n\r\n\r\n\r\n\r\n",
    "created_at": "2019-02-25T16:50:25Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467086821",
    "id": 467086821,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzA4NjgyMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467086821/reactions"
    },
    "updated_at": "2019-02-25T19:51:37Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467086821",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> However, note that even with matching options [the precompiled / predefined `[regex]` instance is _not_ used as-is](https://github.com/PowerShell/PowerShell/blob/5d54f1aa3871a826409496437e25856dc263ccc4/src/System.Management.Automation/engine/runtime/Operations/MiscOps.cs#L2312), at least in PowerShell _Core_ - see #8976.\r\n\r\nI think that's inaccurate - when case-sensitivity is aligned, the passed-in `[regex]` instance is indeed used https://github.com/PowerShell/PowerShell/blob/5d54f1aa3871a826409496437e25856dc263ccc4/src/System.Management.Automation/engine/runtime/Operations/MiscOps.cs#L2306-L2309",
    "created_at": "2019-02-25T19:14:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467142392",
    "id": 467142392,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE0MjM5Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467142392/reactions"
    },
    "updated_at": "2019-02-25T19:14:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467142392",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7413755?v=4",
      "events_url": "https://api.github.com/users/IISResetMe/events{/privacy}",
      "followers_url": "https://api.github.com/users/IISResetMe/followers",
      "following_url": "https://api.github.com/users/IISResetMe/following{/other_user}",
      "gists_url": "https://api.github.com/users/IISResetMe/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/IISResetMe",
      "id": 7413755,
      "login": "IISResetMe",
      "node_id": "MDQ6VXNlcjc0MTM3NTU=",
      "organizations_url": "https://api.github.com/users/IISResetMe/orgs",
      "received_events_url": "https://api.github.com/users/IISResetMe/received_events",
      "repos_url": "https://api.github.com/users/IISResetMe/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/IISResetMe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/IISResetMe/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/IISResetMe"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, @IISResetMe - I had misread the source code; I've updated my previous comment accordingly; that said, the problem of the optimization _not being effective_ remains - any idea why?\r\n",
    "created_at": "2019-02-25T19:20:58Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467145360",
    "id": 467145360,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE0NTM2MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467145360/reactions"
    },
    "updated_at": "2019-02-25T19:20:58Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467145360",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Please discuss the problem in #8976.",
    "created_at": "2019-02-25T19:41:20Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467153553",
    "id": 467153553,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE1MzU1Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467153553/reactions"
    },
    "updated_at": "2019-02-25T19:41:20Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467153553",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@iSazonov: No, this should remain a separate issue, because its focus is (now) on the _inconsistent behavior_ between `-match` / `-replace` on the one hand, and `switch -regex` on the other.\r\n\r\nTo resolve this, we need to decide on:\r\n\r\n* whether to change existing behavior - which would be a breaking change either way (changing `switch -regex`'s behavior to that of `-match` / `-replace` or vice versa).\r\n\r\n   * Sticking with `switch -regex`'s current behavior would still require _fixing_ it, though, given that, as @IISResetMe demonstrated above, options _other_ than case-sensitivity aren't being honored (copied over when recreating the regex); @IISResetMe has prototyped that fix [here](https://github.com/IISResetMe/PowerShell/commit/cc252613b189ed3925761f5638562ef75c71b3a0).\r\n\r\n* whether to simply _document_ the inconsistency.\r\n\r\n",
    "created_at": "2019-02-25T19:45:58Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467155403",
    "id": 467155403,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE1NTQwMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467155403/reactions"
    },
    "updated_at": "2019-02-25T20:33:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467155403",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@mklement0 My comment was about \"any idea why?\".",
    "created_at": "2019-02-25T19:57:06Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467159674",
    "id": 467159674,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE1OTY3NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467159674/reactions"
    },
    "updated_at": "2019-02-25T19:57:06Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467159674",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Got it, @iSazonov, thanks; on the bright side, my misinterpretation of your comment got me to summarize _this_ issue...",
    "created_at": "2019-02-25T19:59:52Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467160673",
    "id": 467160673,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE2MDY3Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467160673/reactions"
    },
    "updated_at": "2019-02-25T19:59:52Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467160673",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> my misinterpretation of your comment got me to summarize this issue...\r\n\r\n:-) I am ready add more comments for you.",
    "created_at": "2019-02-25T20:09:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8946#issuecomment-467163873",
    "id": 467163873,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8946",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzE2Mzg3Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 1,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467163873/reactions"
    },
    "updated_at": "2019-02-25T20:09:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/467163873",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
