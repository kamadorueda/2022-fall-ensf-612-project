[
  {
    "author_association": "NONE",
    "body": "Set-StrictMode -Version Latest;\r\n\r\nDescribe 'Internal Rounding Consistency' {\r\n\r\nContext 'Internal Rounding Consistency' {\r\n\r\nIt 'Internal Default: Number: <Number>: Digits: <Digits>: Expected: <Expected>' `\r\n\t-TestCases @(\r\n\t\t@{  Number = ([decimal]12.5)             ; Digits = 0; Expected = ([int]13); } # FAIL\r\n\t\t,@{ Number = ([decimal]12.50000000000001); Digits = 0; Expected = ([int]13); } # FAIL\r\n\t\t,@{ Number = ([decimal]12.5000000000001) ; Digits = 0; Expected = ([int]13); } # PASS\r\n\t\t,@{ Number = ([decimal]13.5)             ; Digits = 0; Expected = ([int]14); } # PASS\r\n\t\t,@{ Number = ([decimal]14.5)             ; Digits = 0; Expected = ([int]15); } # FAIL\r\n\t) {\r\n\t[math]::round($Number,$Digits) | Should -BeExactly $Expected;\r\n\t}\r\n\r\nIt 'Internal ToEven: Number: <Number>: Digits: <Digits>: Expected: <Expected>' `\r\n\t-TestCases @(\r\n\t\t@{  Number = ([decimal]12.5)             ; Digits = 0; Expected = ([int]13); } # FAIL\r\n\t\t,@{ Number = ([decimal]12.50000000000001); Digits = 0; Expected = ([int]13); } # FAIL\r\n\t\t,@{ Number = ([decimal]12.5000000000001) ; Digits = 0; Expected = ([int]13); } # PASS\r\n\t\t,@{ Number = ([decimal]13.5)             ; Digits = 0; Expected = ([int]14); } # PASS\r\n\t\t,@{ Number = ([decimal]14.5)             ; Digits = 0; Expected = ([int]15); } # FAIL\r\n\t) {\r\n\t[math]::round($Number,$Digits,[System.MidpointRounding]::ToEven) | Should -BeExactly $Expected;\r\n\t}\r\n\r\nIt 'Internal AwayFromZero: Number: <Number>: Digits: <Digits>: Expected: <Expected>' `\r\n\t-TestCases @(\r\n\t\t@{  Number = ([decimal]12.5)             ; Digits = 0; Expected = ([int]13); } # PASS\r\n\t\t,@{ Number = ([decimal]12.50000000000001); Digits = 0; Expected = ([int]13); } # PASS\r\n\t\t,@{ Number = ([decimal]12.5000000000001) ; Digits = 0; Expected = ([int]13); } # PASS\r\n\t\t,@{ Number = ([decimal]13.5)             ; Digits = 0; Expected = ([int]14); } # PASS\r\n\t\t,@{ Number = ([decimal]14.5)             ; Digits = 0; Expected = ([int]15); } # PASS\r\n\t) {\r\n\t[math]::round($Number,$Digits,[System.MidpointRounding]::AwayFromZero) | Should -BeExactly $Expected;\r\n\t}\r\n}\r\n\r\n}\r\n",
    "created_at": "2020-12-10T14:54:12Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14375#issuecomment-742570556",
    "id": 742570556,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14375",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjU3MDU1Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742570556/reactions"
    },
    "updated_at": "2020-12-10T14:54:12Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742570556",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/20606068?v=4",
      "events_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/events{/privacy}",
      "followers_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/followers",
      "following_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/following{/other_user}",
      "gists_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/5uhnjyiwat0ae8ns",
      "id": 20606068,
      "login": "5uhnjyiwat0ae8ns",
      "node_id": "MDQ6VXNlcjIwNjA2MDY4",
      "organizations_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/orgs",
      "received_events_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/received_events",
      "repos_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/5uhnjyiwat0ae8ns"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Re `It 'Internal Default: Number: : Digits: : Expected:` tests.\r\n\r\n.NET uses half-to-_even_ rounding by default, which in PowerShell manifests via _casts_ as well.\r\n\r\nThus, `[int] 12.5` getting rounded _down_ to `12` (the closest _even_ number) and `[int] 13.5` getting _up_ to `14` (again, the closest _even_ number)  is expected.\r\n\r\n---\r\n\r\nRe `It 'Internal ToEven: Number: : Digits: : Expected:` tests:\r\n\r\nWith `[System.MidpointRounding]::ToEven` rounding, the closest _even_ number is _always_ chosen for `.5` values; your tests seem to confuse an _even_ number with a _whole_ (integer) number.\r\n\r\n---\r\n\r\n_Separately_, there is a precision-loss issue relating to `12.50000000000001`. If you take that into account, the rounding again works as designed:\r\n\r\nIf you examine the result of `[decimal] 12.50000000000001`, you'll see that it resulted in _exactly_ `12.5`, which is then again subject to the implied / requested midpoint rounding.\r\n\r\nPowerShell parses number literal `12.50000000000001` as a `[double]`, which cannot _exactly_ represent this value.\r\nEven though `[decimal]` can, the accuracy is already lost by the time the `[decimal]` instance is constructed.\r\n\r\nThe solution is to not use a cast and instead to use suffix `d` to directly construct a `[decimal]` instance: `12.50000000000001d`\r\n\r\nThis results in a number whose fractional part  is _above_ `.5` and therefore correctly rounds _up_ by default:\r\n\r\n```powershell\r\nPS> [int] 12.50000000000001d  \r\n13   # compare to: [int] 12.5\r\n```",
    "created_at": "2020-12-10T17:32:46Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14375#issuecomment-742673690",
    "id": 742673690,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14375",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjY3MzY5MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742673690/reactions"
    },
    "updated_at": "2020-12-10T17:38:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742673690",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "As an aside, @5uhnjyiwat0ae8ns: Please use fenced code blocks in the future (` ```powershell<newline>...<newline>``` `), which make code much more readable.",
    "created_at": "2020-12-10T17:35:55Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14375#issuecomment-742675749",
    "id": 742675749,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14375",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjY3NTc0OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742675749/reactions"
    },
    "updated_at": "2020-12-10T17:35:55Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742675749",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "Understood. Thanks.",
    "created_at": "2020-12-10T17:44:01Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14375#issuecomment-742680753",
    "id": 742680753,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14375",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjY4MDc1Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742680753/reactions"
    },
    "updated_at": "2020-12-10T17:44:01Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/742680753",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/20606068?v=4",
      "events_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/events{/privacy}",
      "followers_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/followers",
      "following_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/following{/other_user}",
      "gists_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/5uhnjyiwat0ae8ns",
      "id": 20606068,
      "login": "5uhnjyiwat0ae8ns",
      "node_id": "MDQ6VXNlcjIwNjA2MDY4",
      "organizations_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/orgs",
      "received_events_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/received_events",
      "repos_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/5uhnjyiwat0ae8ns/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/5uhnjyiwat0ae8ns"
    }
  }
]
