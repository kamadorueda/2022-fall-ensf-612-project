[
  {
    "author_association": "COLLABORATOR",
    "body": "Duplicate of #12801\r\n",
    "created_at": "2022-10-10T19:36:38Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1273731724",
    "id": 1273731724,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L65qM",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273731724/reactions"
    },
    "updated_at": "2022-10-10T19:36:38Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273731724",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "\r\nThis is a known issue (and somewhat by design) for static methods. Very recently a PR was merged [adding a way to strip runspace affinity for a class](https://github.com/PowerShell/PowerShell/pull/18138). Once that makes it to a preview, that will be the recommended way of handling it.\r\n\r\nIn earlier versions you can move to instance methods and use the work around described in https://github.com/PowerShell/PowerShell/issues/3651#issuecomment-306968528",
    "created_at": "2022-10-10T19:36:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1273731765",
    "id": 1273731765,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L65q1",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273731765/reactions"
    },
    "updated_at": "2022-10-10T19:36:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273731765",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "NONE",
    "body": "Thanks! I don't think I ever would have found that existing issue. :) Looks like I hit the bug just in time for the NoRunspaceAffinity fix too. In my real code I just worked around this for now by copying in the body of the method I'm interested in. I'll stick to that for now as it's a tiny method and the workaround you linked doesn't looks like it's worth it for my case.\r\n\r\nI'll double check my real code is fixed by NoRunspaceAffinity once it's available.",
    "created_at": "2022-10-10T19:42:44Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1273736793",
    "id": 1273736793,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L665Z",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273736793/reactions"
    },
    "updated_at": "2022-10-10T19:42:44Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273736793",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/115483370?v=4",
      "events_url": "https://api.github.com/users/User1785604260/events{/privacy}",
      "followers_url": "https://api.github.com/users/User1785604260/followers",
      "following_url": "https://api.github.com/users/User1785604260/following{/other_user}",
      "gists_url": "https://api.github.com/users/User1785604260/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/User1785604260",
      "id": 115483370,
      "login": "User1785604260",
      "node_id": "U_kgDOBuIi6g",
      "organizations_url": "https://api.github.com/users/User1785604260/orgs",
      "received_events_url": "https://api.github.com/users/User1785604260/received_events",
      "repos_url": "https://api.github.com/users/User1785604260/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/User1785604260/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/User1785604260/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/User1785604260"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> Thanks! I don't think I ever would have found that existing issue. :)\r\n\r\nOh yeah, you're good, we just mark it for tracking purposes :) We would always much prefer duplicates over issues going unreported ‚ù§Ô∏è\r\n\r\nEspecially with issues as impossible to search for as this üòÅ ",
    "created_at": "2022-10-10T19:55:20Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1273747943",
    "id": 1273747943,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L69nn",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 1,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273747943/reactions"
    },
    "updated_at": "2022-10-10T19:55:20Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1273747943",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "NONE",
    "body": "~Do you happen to know if ```Start-ThreadJob``` would exhibit this issue? I can't seem to reproduce the issue when using that. Thread jobs actually match what I'm really trying to do better anyway, the only reason I'm not using them currently is because with ```For-EachObject -Parallel``` I have a single job that I can ```.Finished.WaitOne``` on. But that's just a convenience thing. :) If ```Start-ThreadJob``` won't ever do this then I'll just refactor to use that.~\r\n\r\nNevermind. üòä While I couldn't get ```Start-ThreadJob``` to repro the issue with my stripped down code, it definitely still hangs everything in the real deal.",
    "created_at": "2022-10-11T03:10:44Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1274030328",
    "id": 1274030328,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L8Cj4",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274030328/reactions"
    },
    "updated_at": "2022-10-11T03:41:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274030328",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/115483370?v=4",
      "events_url": "https://api.github.com/users/User1785604260/events{/privacy}",
      "followers_url": "https://api.github.com/users/User1785604260/followers",
      "following_url": "https://api.github.com/users/User1785604260/following{/other_user}",
      "gists_url": "https://api.github.com/users/User1785604260/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/User1785604260",
      "id": 115483370,
      "login": "User1785604260",
      "node_id": "U_kgDOBuIi6g",
      "organizations_url": "https://api.github.com/users/User1785604260/orgs",
      "received_events_url": "https://api.github.com/users/User1785604260/received_events",
      "repos_url": "https://api.github.com/users/User1785604260/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/User1785604260/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/User1785604260/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/User1785604260"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "You can avoid the thread-safe issue with `Start-ThreadJob`. This is because `Start-ThreadJob` doesn't directly run a script block, but first convert the script block to a string, and then start a new Runspace to execute the string script, so the class will be redefined in the new Runspace, but it will be a different class per every Runspace created by `Start-ThreadJob` -- that may not be what you expect, and possibly the reason for the hang.",
    "created_at": "2022-10-11T03:43:50Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1274046723",
    "id": 1274046723,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L8GkD",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274046723/reactions"
    },
    "updated_at": "2022-10-11T03:43:50Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274046723",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "NONE",
    "body": "Oh, that's weird that it was still hanging for me, I'll have to take another crack at it in the morning. I wonder if it's because in my real code I'm not directly defining the class, but bringing it in via ```. $using:Profile```?\r\n\r\nHaving a separate instance of the class is totally fine for my case, I'm just trying to call a static utility method.\r\n````Powershell\r\nstatic [string] GetFileHash([string]$Path) {\r\ntry {\r\n    $stream = [System.IO.File]::Open($Path, [System.IO.FileMode]::Open, [System.IO.FileAccess]::Read, [System.IO.FileShare]::ReadWrite)\r\n    try {\r\n        return [System.Convert]::ToHexString([System.Security.Cryptography.SHA256]::Create().ComputeHash($stream))\r\n    } finally {\r\n        $stream.Dispose()\r\n    }\r\n} catch { throw }\r\n}\r\n````\r\n\r\nThe only reason I'm not using ```Get-FileHash``` here is because the cmdlet overhead piles up and slows things down when you're looking at tens of thousands of files.",
    "created_at": "2022-10-11T03:47:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1274048710",
    "id": 1274048710,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L8HDG",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274048710/reactions"
    },
    "updated_at": "2022-10-11T03:48:36Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274048710",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/115483370?v=4",
      "events_url": "https://api.github.com/users/User1785604260/events{/privacy}",
      "followers_url": "https://api.github.com/users/User1785604260/followers",
      "following_url": "https://api.github.com/users/User1785604260/following{/other_user}",
      "gists_url": "https://api.github.com/users/User1785604260/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/User1785604260",
      "id": 115483370,
      "login": "User1785604260",
      "node_id": "U_kgDOBuIi6g",
      "organizations_url": "https://api.github.com/users/User1785604260/orgs",
      "received_events_url": "https://api.github.com/users/User1785604260/received_events",
      "repos_url": "https://api.github.com/users/User1785604260/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/User1785604260/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/User1785604260/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/User1785604260"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Oh, referencing via `$using` will get you the same race condition. It's again running the not-thread-safe method in multiple Runspace's.",
    "created_at": "2022-10-11T03:57:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1274053393",
    "id": 1274053393,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L8IMR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274053393/reactions"
    },
    "updated_at": "2022-10-11T03:57:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274053393",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "NONE",
    "body": "Ahh, kk. Well it was worth a shot anyway. üòä At least in this case the method I want to use is tiny and just pasting a copy in is perfectly fine.\r\n\r\nI only have one script file left with ```. $using:Profile``` inside of a ```Start-ThreadJob```, but it's calling utility methods that would be way too large to duplicate in place. I seem to be getting away with it there for now though, so I just left a comment and I'll revisit once that new NoRunspaceAffinity attribute is available.",
    "created_at": "2022-10-11T04:03:48Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18248#issuecomment-1274056794",
    "id": 1274056794,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18248",
    "node_id": "IC_kwDOAvT7bc5L8JBa",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274056794/reactions"
    },
    "updated_at": "2022-10-12T19:41:47Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1274056794",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/115483370?v=4",
      "events_url": "https://api.github.com/users/User1785604260/events{/privacy}",
      "followers_url": "https://api.github.com/users/User1785604260/followers",
      "following_url": "https://api.github.com/users/User1785604260/following{/other_user}",
      "gists_url": "https://api.github.com/users/User1785604260/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/User1785604260",
      "id": 115483370,
      "login": "User1785604260",
      "node_id": "U_kgDOBuIi6g",
      "organizations_url": "https://api.github.com/users/User1785604260/orgs",
      "received_events_url": "https://api.github.com/users/User1785604260/received_events",
      "repos_url": "https://api.github.com/users/User1785604260/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/User1785604260/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/User1785604260/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/User1785604260"
    }
  }
]
