[
  {
    "author_association": "NONE",
    "body": "I also would like to note that this issue is not only occuring in PowerShell core. I've also observed the same behavior in Windows PowerShell 5.1. This would tell me that it's not an issue with any abstraction layer (such as [WindowsCompatibility](https://github.com/PowerShell/WindowsCompatibility) making the ActiveDirectory module work within PowerShell Core.\r\n\r\n```\r\nName                           Value\r\n----                           -----\r\nPSVersion                      5.1.19041.546\r\nPSEdition                      Desktop\r\nPSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}\r\nBuildVersion                   10.0.19041.546\r\nCLRVersion                     4.0.30319.42000\r\nWSManStackVersion              3.0\r\nPSRemotingProtocolVersion      2.3\r\nSerializationVersion           1.1.0.1\r\n```",
    "created_at": "2021-01-13T03:37:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759183356",
    "id": 759183356,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTE4MzM1Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759183356/reactions"
    },
    "updated_at": "2021-01-13T03:37:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759183356",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11574185?v=4",
      "events_url": "https://api.github.com/users/MaxAnderson95/events{/privacy}",
      "followers_url": "https://api.github.com/users/MaxAnderson95/followers",
      "following_url": "https://api.github.com/users/MaxAnderson95/following{/other_user}",
      "gists_url": "https://api.github.com/users/MaxAnderson95/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/MaxAnderson95",
      "id": 11574185,
      "login": "MaxAnderson95",
      "node_id": "MDQ6VXNlcjExNTc0MTg1",
      "organizations_url": "https://api.github.com/users/MaxAnderson95/orgs",
      "received_events_url": "https://api.github.com/users/MaxAnderson95/received_events",
      "repos_url": "https://api.github.com/users/MaxAnderson95/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/MaxAnderson95/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MaxAnderson95/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/MaxAnderson95"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Since AD module is not source open only MSFT team can investigate the issue. I guess the problem can be related with how PowerShell clones variables. If so we could try to fix this in the repo. Otherwise the issue should be reported by Windows support channels, UserVoice site and MSFT forums.\r\n\r\n/cc @PaulHigin Could you please make an conclusion?",
    "created_at": "2021-01-13T07:02:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759250467",
    "id": 759250467,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTI1MDQ2Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759250467/reactions"
    },
    "updated_at": "2021-01-13T07:02:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759250467",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "This is definitely a weird one. When testing against a remote Runspace I can see the CLIXML returned contains the property and accessing `$obj.City` works just fine\r\n\r\n```xml\r\n<Obj RefId=\"0\">\r\n  <TN RefId=\"0\">\r\n    <T>Microsoft.ActiveDirectory.Management.ADUser</T>\r\n    <T>Microsoft.ActiveDirectory.Management.ADAccount</T>\r\n    <T>Microsoft.ActiveDirectory.Management.ADPrincipal</T>\r\n    <T>Microsoft.ActiveDirectory.Management.ADObject</T>\r\n    <T>Microsoft.ActiveDirectory.Management.ADEntity</T>\r\n    <T>Microsoft.ActiveDirectory.Management.ADPropertyCollection</T>\r\n    <T>System.Object</T>\r\n  </TN>\r\n  <ToString>CN=vagrant-domain,CN=Users,DC=domain,DC=test</ToString>\r\n  <Props>\r\n    <S N=\"City\">My City</S>\r\n    <S N=\"DistinguishedName\">CN=vagrant-domain,CN=Users,DC=domain,DC=test</S>\r\n    <B N=\"Enabled\">true</B>\r\n    <Nil N=\"GivenName\" />\r\n    <S N=\"Name\">vagrant-domain</S>\r\n    <S N=\"ObjectClass\">user</S>\r\n    <G N=\"ObjectGUID\">bdfa699e-dfb9-41ba-864d-6a2f162f579d</G>\r\n    <S N=\"SamAccountName\">vagrant-domain</S>\r\n    <S N=\"SID\">S-1-5-21-3849754078-2265128455-4044759769-1104</S>\r\n    <Nil N=\"Surname\" />\r\n    <S N=\"UserPrincipalName\">vagrant-domain@domain.test</S>\r\n  </Props>\r\n</Obj>\r\n```\r\n\r\nWhen using a PowerShell pipeline that is targeted against the current runspace (no serialization occurs) I can replicate this problem. What's even more interesting is that the property itself still exists when checking `$obj.PSObject.Properties` and it has the value\r\n\r\n```powershell\r\n$ps = [PowerShell]::Create()\r\n\r\n$null = $ps.AddScript(@'\r\nGet-ADUser -Identity vagrant-domain -Property City\r\n'@)\r\n\r\n$user = $ps.Invoke()\r\n\r\n\"Direct: '$($user[0].City)'\"\r\n\"By Prop: '$(($user[0].PSObject.Properties | Where-Object Name -eq City).Value)'\"\r\n```\r\n\r\n```\r\nDirect: ''\r\nBy Prop: 'My City'\r\n```\r\n\r\nThe same thing applies when running it other ways like through `Invoke-Command` but interestingly not `ForEach-Object -Parallel` even though no serialization occurs through that method. I believe remote runspaces are fine because when the ADUser object is serialized the type isn't preserved so the object that is returned is just a generic property bag.\r\n\r\nI'm honestly not sure why this is happening so interested to hear what others may have to say.",
    "created_at": "2021-01-13T07:20:46Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759258057",
    "id": 759258057,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTI1ODA1Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759258057/reactions"
    },
    "updated_at": "2021-01-13T07:20:46Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759258057",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Does this only occur for an AD object?  I cannot run the repro, and it would be interesting to know if there is a general type of object/property that causes this problem.  For example a script property on an object may not run correctly when passed to a different runspace, due to script block runspace affinity.",
    "created_at": "2021-01-13T18:21:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759631443",
    "id": 759631443,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTYzMTQ0Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759631443/reactions"
    },
    "updated_at": "2021-01-13T18:21:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759631443",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": "@PaulHigin I have not run into another type of object that this issue occurs on. I've tested your theory using a file object and it does NOT occur. \r\n\r\n```powershell\r\n$File = Get-Item C:\\windows\\system32\\drivers\\etc\\hosts | Select-Object Mode, LastWriteTime, Length, Name, @{N=\"LengthInKB\";E={$_.Length/1KB}}\r\n\r\nWrite-Output \"Before Runspace - The value of name is: $($File.Name)\"\r\nWrite-Output \"Before Runspace - The value of lengthInKB is: $($File.LengthInKB)\"\r\n\r\n$Runspace = [runspacefactory]::CreateRunspace()\r\n$PowerShell = [powershell]::Create()\r\n$PowerShell.runspace = $Runspace\r\n$Runspace.Open()\r\n\r\n[void]$PowerShell.AddScript({\r\n    Param ($File)\r\n    $a = \"Inside Runspace - The value of name is: $($File.Name)\"\r\n    $b = \"Inside Runspace - The value of lengthInKB is: $($File.LengthInKB)\"\r\n    $c = $File\r\n\r\n    return @($a,$b,$c)\r\n})\r\n[void]$PowerShell.AddArgument($File)\r\n\r\n$a, $b, $c = $PowerShell.Invoke()\r\n\r\n$a\r\n$b\r\n\r\nWrite-Output \"After Runspace  - The value of name is: $($c.Name)\"\r\nWrite-Output \"After Runspace  - The value of lengthInKB is: $($c.LengthInKB)\"\r\n```",
    "created_at": "2021-01-13T19:31:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759674696",
    "id": 759674696,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTY3NDY5Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759674696/reactions"
    },
    "updated_at": "2021-01-13T19:31:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759674696",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11574185?v=4",
      "events_url": "https://api.github.com/users/MaxAnderson95/events{/privacy}",
      "followers_url": "https://api.github.com/users/MaxAnderson95/followers",
      "following_url": "https://api.github.com/users/MaxAnderson95/following{/other_user}",
      "gists_url": "https://api.github.com/users/MaxAnderson95/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/MaxAnderson95",
      "id": 11574185,
      "login": "MaxAnderson95",
      "node_id": "MDQ6VXNlcjExNTc0MTg1",
      "organizations_url": "https://api.github.com/users/MaxAnderson95/orgs",
      "received_events_url": "https://api.github.com/users/MaxAnderson95/received_events",
      "repos_url": "https://api.github.com/users/MaxAnderson95/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/MaxAnderson95/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MaxAnderson95/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/MaxAnderson95"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I can't speak for @MaxAnderson95 but I've only just tested this with `Get-ADUser` and the `ADUser` type. Here are the details:\r\n\r\n```powershell\r\n> $user.PSObject.Properties | Where-Object Name -eq City\r\n\r\n\r\nBaseObject      : CN=vagrant-domain,CN=Users,DC=domain,DC=test\r\nTag             :\r\nMemberType      : Property\r\nValue           : My City\r\nIsSettable      : True\r\nIsGettable      : True\r\nTypeNameOfValue : System.String\r\nName            : City\r\nIsInstance      : True\r\n\r\n\r\n> $user.GetType()\r\n\r\n\r\nIsPublic IsSerial Name                                     BaseType\r\n-------- -------- ----                                     --------\r\nTrue     False    ADUser                                   Microsoft.ActiveDirectory.Management.ADAccount\r\n```\r\n\r\nI haven't really checked other types but in this case it's definitely the ADUser type. What's interesting is that the `City` property is an actual Property and not a `NoteProperty` or any other PowerShell ETS one AFAIK. Maybe PowerShell sees the type as [ADUser](https://docs.microsoft.com/en-us/dotnet/api/microsoft.activedirectory.management.aduser?view=activedirectory-management-10.0) and only accesses the properties on the type itself which `City` is not usually present?\r\n\r\n```powershell\r\n> [Microsoft.ActiveDirectory.Management.ADUser].GetProperties().Name\r\n\r\nGivenName\r\nSurname\r\nUserPrincipalName\r\nEnabled\r\nSamAccountName\r\nSID\r\nDistinguishedName\r\nName\r\nObjectClass\r\nObjectGuid\r\nPropertyNames\r\nAddedProperties\r\nRemovedProperties\r\nModifiedProperties\r\nPropertyCount\r\nItem\r\n```\r\n\r\nIt's hard to replicate this as `Add-Member` only allows you to add a `NoteProperty` which works just fine and trying to add a [PSAdaptedProperty](https://docs.microsoft.com/en-us/dotnet/api/system.management.automation.psadaptedproperty?view=powershellsdk-7.0.0) manually through `$user.PSObject.Properties.Add($adaptedProp)` fails.",
    "created_at": "2021-01-13T19:43:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759693033",
    "id": 759693033,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTY5MzAzMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759693033/reactions"
    },
    "updated_at": "2021-01-13T19:43:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759693033",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Just as an FYI you can workaround this issue by adding `| Select-Object *` to your cmdlet calls as that will convert the AD object to a PSObject with NoteProperties instead.",
    "created_at": "2021-01-13T20:58:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759735462",
    "id": 759735462,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTczNTQ2Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759735462/reactions"
    },
    "updated_at": "2021-01-13T20:58:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759735462",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "A script property was just an example of something that **may** not run on different runspaces.  Simple scripts may run but others may not because of affinity issues (such as accessing a variable only defined in the original runspace).\r\n\r\nThere may be other reasons why an object property might not evaluate correctly in a different runspace.\r\n\r\nOr, it may have nothing to do with the property at all.  But the fact that it seems to only repro on AD objects makes it suspect.",
    "created_at": "2021-01-13T21:00:06Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759736558",
    "id": 759736558,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTczNjU1OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759736558/reactions"
    },
    "updated_at": "2021-01-13T21:00:06Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759736558",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Definitely something up with the AD cmdlets, I cannot seem to replicate it when adding a custom adapted property to an object\r\n\r\n```powershell\r\n$ps = [PowerShell]::Create()\r\n\r\n$null = $ps.AddScript(@'\r\n$obj = Get-Service -Name WinRM\r\n$obj.PSObject.Properties.Add(($pwd.PSObject.Properties | Where Name -eq Path), $true)\r\n\r\n$obj\r\n'@)\r\n\r\n$obj = $ps.Invoke()[0]\r\n\r\n\"Direct: '$($obj.Path)'\"\r\n\"By Prop: '$(($obj.PSObject.Properties | Where-Object Name -eq Path).Value)'\"\r\n\r\n# Direct: 'C:\\temp'\r\n# By Prop: 'C:\\temp'\r\n```\r\n\r\nI tried building my own adapted property but to get/set a value I need to supply an adapter which is hidden behind internal classes so I didn't bother to go any deeper.\r\n\r\nOne thing to note is the adapter used in AD is a ThirdPartyAdapter compared to my test which is a DotNetAdapter, might be another thing to look into.\r\n\r\n```powershell\r\n$adProp = (Get-ADUser -Identity user -Property City).PSObject.Properties | Where Name -eq City\r\n$pwdProp = $pwd.PSObject.Properties | Where Name -eq Path\r\n\r\n$adProp.GetType().GetField('adapter', 60).GetValue($adProp)\r\n$adProp.GetType().GetField('adapter', 60).GetValue($pwdProp)\r\n\r\n# System.Management.Automation.ThirdPartyAdapter\r\n# System.Management.Automation.DotNetAdapter\r\n```\r\n",
    "created_at": "2021-01-13T21:19:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759746218",
    "id": 759746218,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTc0NjIxOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759746218/reactions"
    },
    "updated_at": "2021-01-13T21:24:49Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759746218",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "NONE",
    "body": "Ronald Leslie Ritchie  75 jasper ave smiths falls Ontario Canada k7a 4c8 613 206 7320\n-------- Original message --------From: Jordan Borean <notifications@github.com> Date: 2021-01-13  2:44 p.m.  (GMT-05:00) To: PowerShell/PowerShell <PowerShell@noreply.github.com> Cc: Subscribed <subscribed@noreply.github.com> Subject: Re: [PowerShell/PowerShell] Passing Active Directory Objects into a\n  Runspace Stripts All Non-Default Properties (#14604) \nI can't speak for @MaxAnderson95 but I've only just tested this with Get-ADUser and the ADUser type. Here are the details:\n> $user.PSObject.Properties | Where-Object Name -eq City\n\n\nBaseObject      : CN=vagrant-domain,CN=Users,DC=domain,DC=test\nTag             :\nMemberType      : Property\nValue           : My City\nIsSettable      : True\nIsGettable      : True\nTypeNameOfValue : System.String\nName            : City\nIsInstance      : True\n\n\n> $user.GetType()\n\n\nIsPublic IsSerial Name                                     BaseType\n-------- -------- ----                                     --------\nTrue     False    ADUser                                   Microsoft.ActiveDirectory.Management.ADAccount\nI haven't really checked other types but in this case it's definitely the ADUser type. What's interesting is that the City property is an actual Property and not a NoteProperty or any other PowerShell ETS one AFAIK. Maybe PowerShell sees the type as ADUser and only accesses the properties on the type itself which City is not usually present?\n> [Microsoft.ActiveDirectory.Management.ADUser].GetProperties().Name\n\nGivenName\nSurname\nUserPrincipalName\nEnabled\nSamAccountName\nSID\nDistinguishedName\nName\nObjectClass\nObjectGuid\nPropertyNames\nAddedProperties\nRemovedProperties\nModifiedProperties\nPropertyCount\nItem\nIt's hard to replicate this as Add-Member only allows you to add a NoteProperty which works just fine and trying to add a PSAdaptedProperty manually through $user.PSObject.Properties.Add($adaptedProp) fails.\n\n—You are receiving this because you are subscribed to this thread.Reply to this email directly, view it on GitHub, or unsubscribe.\n",
    "created_at": "2021-01-14T00:06:16Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759836486",
    "id": 759836486,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTgzNjQ4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759836486/reactions"
    },
    "updated_at": "2021-01-14T00:06:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759836486",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/60276611?v=4",
      "events_url": "https://api.github.com/users/RipTornMist/events{/privacy}",
      "followers_url": "https://api.github.com/users/RipTornMist/followers",
      "following_url": "https://api.github.com/users/RipTornMist/following{/other_user}",
      "gists_url": "https://api.github.com/users/RipTornMist/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/RipTornMist",
      "id": 60276611,
      "login": "RipTornMist",
      "node_id": "MDQ6VXNlcjYwMjc2NjEx",
      "organizations_url": "https://api.github.com/users/RipTornMist/orgs",
      "received_events_url": "https://api.github.com/users/RipTornMist/received_events",
      "repos_url": "https://api.github.com/users/RipTornMist/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/RipTornMist/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RipTornMist/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/RipTornMist"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Is Microsoft.ActiveDirectory.Management.ADAccount an COM object? I see:\r\n```\r\nItem                   ParameterizedProperty Microsoft.ActiveDirectory.Management.ADPropertyValueCollection Item(str...\r\n```\r\nMaybe it is COM interaction issue? /cc @SeeminglyScience \r\n\r\nIs an object cloned when passed to runspace? Maybe the issue related the cloning (in Engine or in the object)?",
    "created_at": "2021-01-14T04:10:07Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-759912822",
    "id": 759912822,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1OTkxMjgyMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759912822/reactions"
    },
    "updated_at": "2021-01-14T04:10:07Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/759912822",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> Is Microsoft.ActiveDirectory.Management.ADAccount an COM object? I see:\r\n> \r\n> ```\r\n> Item                   ParameterizedProperty Microsoft.ActiveDirectory.Management.ADPropertyValueCollection Item(str...\r\n> ```\r\n> \r\n> Maybe it is COM interaction issue? /cc @SeeminglyScience\r\n> \r\n> Is an object cloned when passed to runspace? Maybe the issue related the cloning (in Engine or in the object)?\r\n\r\nThe AD module uses a custom adapter that just isn't registered in the new runspace.  Issue is fixed if you add `Import-Module ActiveDirectory` in the `AddScript` block.",
    "created_at": "2021-01-28T17:48:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-769260863",
    "id": 769260863,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTI2MDg2Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769260863/reactions"
    },
    "updated_at": "2021-01-28T17:48:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769260863",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> One thing to note is the adapter used in AD is a ThirdPartyAdapter compared to my test which is a DotNetAdapter, might be another thing to look into.\r\n\r\n@jborean93 FYI `ThirdPartyAdapter` is sort of a bridge to the public `PSPropertyAdapter` class.  You can pass the `Type` of an implementation of that class to `Update-TypeData`'s `TypeAdapter` property.",
    "created_at": "2021-01-28T20:31:13Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-769367253",
    "id": 769367253,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTM2NzI1Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769367253/reactions"
    },
    "updated_at": "2021-01-28T20:31:13Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769367253",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@SeeminglyScience thanks for the explanation, it still seems weird that the property is present through `$obj.PSObject.Properties` yet you can't access it through the dot notation.",
    "created_at": "2021-01-28T20:34:35Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-769369788",
    "id": 769369788,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTM2OTc4OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769369788/reactions"
    },
    "updated_at": "2021-01-28T20:34:35Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769369788",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> @SeeminglyScience thanks for the explanation, it still seems weird that the property is present through `$obj.PSObject.Properties` yet you can't access it through the dot notation.\r\n\r\nIt's just sorta how it's stored. The binder looks in `PSObject._instanceMembers` which only contains explicitly added members.  You can see the adapted property in `_members` if it's already been retrieved due to caching, but that's just not where the binder is looking.",
    "created_at": "2021-01-29T17:46:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14604#issuecomment-769950982",
    "id": 769950982,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14604",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTk1MDk4Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769950982/reactions"
    },
    "updated_at": "2021-01-29T17:46:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/769950982",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  }
]
