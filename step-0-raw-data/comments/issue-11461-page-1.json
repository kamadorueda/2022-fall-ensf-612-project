[
  {
    "author_association": "COLLABORATOR",
    "body": "In case you don't know this workaround, using the `-File` parameter will return the actual exit code:\r\n```\r\n$ cat exit2.sh\r\n#!/bin/sh\r\n\r\nexit 2\r\n\r\n$ pwsh -nop -noni -f exit2.sh || echo $?\r\n2\r\n```",
    "created_at": "2019-12-31T21:02:18Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-569990506",
    "id": 569990506,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTk5MDUwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 2,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 3,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/569990506/reactions"
    },
    "updated_at": "2019-12-31T21:02:18Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/569990506",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5177512?v=4",
      "events_url": "https://api.github.com/users/rkeithhill/events{/privacy}",
      "followers_url": "https://api.github.com/users/rkeithhill/followers",
      "following_url": "https://api.github.com/users/rkeithhill/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkeithhill/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rkeithhill",
      "id": 5177512,
      "login": "rkeithhill",
      "node_id": "MDQ6VXNlcjUxNzc1MTI=",
      "organizations_url": "https://api.github.com/users/rkeithhill/orgs",
      "received_events_url": "https://api.github.com/users/rkeithhill/received_events",
      "repos_url": "https://api.github.com/users/rkeithhill/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rkeithhill/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkeithhill/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rkeithhill"
    }
  },
  {
    "author_association": "NONE",
    "body": "Thank you for that; that's definitely a useful workaround, which I'll add to my repertoire. I must say, though, that having to generate and execute a temporary script just to get the expected exit code from the shell is... less than ideal. Honestly, if I tried to put that in a PR for ALE I expect it would be rejected immediately.\r\n\r\nOne code smell that I see very regularly is the amount of calls to `cmd /c` out there in build scripts and \"cross-platform\" tools which have special cases for running on Windows. When I see an issue like this, however, I'm stuck having to agree that `cmd` is actually the better option, which is sad given that it hasn't been touched for what... 20 years now?\r\n\r\nIt also makes it harder to break out of cases like https://github.com/dense-analysis/ale/blob/5e69aaf4c2b4ffbfd4fbe0af820e23bf559b8e14/autoload/ale.vim#L223 where functionality is based on the OS rather than the shell, which is becoming more important now that PowerShell runs on Linux and macOS (my current OS at work).\n\n<blockquote><img src=\"https://avatars0.githubusercontent.com/u/53278269?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/dense-analysis/ale\">dense-analysis/ale</a></strong></div><div>Check syntax in Vim asynchronously and fix files, with Language Server Protocol (LSP) support - dense-analysis/ale</div></blockquote>",
    "created_at": "2020-01-13T14:01:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-573676536",
    "id": 573676536,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzY3NjUzNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/573676536/reactions"
    },
    "updated_at": "2020-01-13T14:01:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/573676536",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/583359?v=4",
      "events_url": "https://api.github.com/users/bgshacklett/events{/privacy}",
      "followers_url": "https://api.github.com/users/bgshacklett/followers",
      "following_url": "https://api.github.com/users/bgshacklett/following{/other_user}",
      "gists_url": "https://api.github.com/users/bgshacklett/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/bgshacklett",
      "id": 583359,
      "login": "bgshacklett",
      "node_id": "MDQ6VXNlcjU4MzM1OQ==",
      "organizations_url": "https://api.github.com/users/bgshacklett/orgs",
      "received_events_url": "https://api.github.com/users/bgshacklett/received_events",
      "repos_url": "https://api.github.com/users/bgshacklett/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/bgshacklett/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bgshacklett/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/bgshacklett"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "I agree that the behavior is problematic.\r\n\r\nA more direct workaround is to append `; exit $LASTEXITCODE` to the `-Command` argument:\r\n\r\n```powershell\r\npwsh -c \"bash -c 'exit 2'; exit `$LASTEXITCODE\"; echo $LASTEXITCODE\r\n```\r\n\r\nNote that executing _PowerShell_ scripts (`*.ps1`) with  `-File` behaves differently from POSIX-like shell scripts:\r\n\r\nIn the _absence_ of an explicit `exit` statement, POSIX-like shells report the \r\n _last statement_'s exit code as the script's, whereas `*.ps1` scripts _default to `0`_.\r\n  * Calling a `*.ps1` script from _inside_ PowerShell behaves differently again: `$LASTEXITCODE` after a script invocation reflects whatever _external program_ was last called in the absence of `exit <n>`, not implicitly `0`  - see #11712 \r\n\r\n---\r\n\r\nSummarizing the behavior of _PowerShell code_ with the CLI:\r\n\r\n`-Command` / `-c`  behaves _almost_ like a POSIX-like shell in that it automatically uses the _last_ statement's success status, but discards the specific exit code in favor of mapping the abstract Boolean `$?` to `0` or `1` (the behavior that prompted creation of this issue).\r\n\r\n`-File` with a `*.ps1` files behaves differently from `-Command` / `-c` and POSIX-like shells in that only _explicit_ `exit` calls matter, whereas calling `*.ps1` files PowerShell-internally behaves differently yet again.\r\n",
    "created_at": "2020-01-29T03:02:30Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-579570962",
    "id": 579570962,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTU3MDk2Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/579570962/reactions"
    },
    "updated_at": "2020-01-29T03:03:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/579570962",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "This is expected and changing it would break existing scripts\r\n\r\nThis should get the expected behavior\r\n\r\npowershell\r\n```\r\npwsh -c \"bash -c 'exit 2'; exit `$LASTEXITCODE\"; echo $LASTEXITCODE\r\n```",
    "created_at": "2020-08-20T19:19:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-677851898",
    "id": 677851898,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzg1MTg5OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 2,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/677851898/reactions"
    },
    "updated_at": "2020-08-20T19:19:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/677851898",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/10873629?v=4",
      "events_url": "https://api.github.com/users/TravisEz13/events{/privacy}",
      "followers_url": "https://api.github.com/users/TravisEz13/followers",
      "following_url": "https://api.github.com/users/TravisEz13/following{/other_user}",
      "gists_url": "https://api.github.com/users/TravisEz13/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/TravisEz13",
      "id": 10873629,
      "login": "TravisEz13",
      "node_id": "MDQ6VXNlcjEwODczNjI5",
      "organizations_url": "https://api.github.com/users/TravisEz13/orgs",
      "received_events_url": "https://api.github.com/users/TravisEz13/received_events",
      "repos_url": "https://api.github.com/users/TravisEz13/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/TravisEz13/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TravisEz13/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/TravisEz13"
    }
  },
  {
    "author_association": "NONE",
    "body": "This issue has been marked as answered and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
    "created_at": "2020-08-22T00:00:16Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-678561038",
    "id": 678561038,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODU2MTAzOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/678561038/reactions"
    },
    "updated_at": "2020-08-22T00:00:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/678561038",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@TravisEz13 \r\n\r\nI find reiterating an already-mentioned _workaround_ for the problematic behavior as the solution and dismissing a request to _fix it_ with a curt \"this is expected\" and \"would break existing scripts\"  disappointing, and I suspect I'm not the only one.\r\n\r\nI invite you to provide a more nuanced response at #13501\r\n\r\n",
    "created_at": "2020-08-22T02:31:20Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11461#issuecomment-678581981",
    "id": 678581981,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11461",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODU4MTk4MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 4,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 4,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/678581981/reactions"
    },
    "updated_at": "2020-08-22T02:31:47Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/678581981",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  }
]
