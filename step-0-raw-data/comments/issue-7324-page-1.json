[
  {
    "author_association": "COLLABORATOR",
    "body": "To document some offline discussions further:\r\n\r\nThis is a consequence of adding the Windows PowerShell System32 module directory to the pwsh module path:\r\n\r\n* Start WindowsPowerShell\r\n* It sees the System32 module path already on the PSModulePath\r\n* The System32 module path is not prepended (even secretly) to the Windows PowerShell PSModulePath\r\n* Modules attempt to be (auto)loaded from (e.g.) Microsoft.PowerShell.Utility\r\n* The first module seen is a PowerShell Core 6 Microsoft.PowerShell.Utility\r\n* The version check fails\r\n* Loading fails and `gci` doesn't work\r\n\r\nPossible long-term workarounds are:\r\n\r\n1. Check native executions for `powershell.exe` and if so, remove System32 from the module path, or\r\n2. Treat the System32 module path as a \"hidden\" PSModulePath component in PowerShell Core, so that it doesn't actually get added to the PSModulePath, but is just treated as such, so it isn't inherited.\r\n",
    "created_at": "2018-07-20T22:06:59Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-406738886",
    "id": 406738886,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjczODg4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/406738886/reactions"
    },
    "updated_at": "2018-07-20T22:06:59Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/406738886",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Worth noting that (2) would also solve #7327.\r\n\r\nAlso, any solution to this would need to work with any flags `powershell.exe` might be started with, like `-noprofile`",
    "created_at": "2018-07-20T22:10:41Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-406739505",
    "id": 406739505,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjczOTUwNQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/406739505/reactions"
    },
    "updated_at": "2018-07-20T22:10:41Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/406739505",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  },
  {
    "author_association": "NONE",
    "body": "I hit this too. Was using pwsh as my main shell on windows, but some of our build scripts are hardcoded to powershell. \r\n\r\nWith preview 4, they fail with messages like:\r\n`Get-Date : The 'Get-Date' command was found in the module 'Microsoft.PowerShell.Utility', but the module could not be loaded. For more information, run 'Import-Module Microsoft.PowerShell.Utility'.`",
    "created_at": "2018-07-24T16:41:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407472596",
    "id": 407472596,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzQ3MjU5Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407472596/reactions"
    },
    "updated_at": "2018-07-24T16:41:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407472596",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1286709?v=4",
      "events_url": "https://api.github.com/users/BradBarnich/events{/privacy}",
      "followers_url": "https://api.github.com/users/BradBarnich/followers",
      "following_url": "https://api.github.com/users/BradBarnich/following{/other_user}",
      "gists_url": "https://api.github.com/users/BradBarnich/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BradBarnich",
      "id": 1286709,
      "login": "BradBarnich",
      "node_id": "MDQ6VXNlcjEyODY3MDk=",
      "organizations_url": "https://api.github.com/users/BradBarnich/orgs",
      "received_events_url": "https://api.github.com/users/BradBarnich/received_events",
      "repos_url": "https://api.github.com/users/BradBarnich/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BradBarnich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BradBarnich/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BradBarnich"
    }
  },
  {
    "author_association": "NONE",
    "body": "Another scenario, running VS code from pwsh ,`code .`, then opening the integrated terminal. Same issue",
    "created_at": "2018-07-24T16:44:53Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407473698",
    "id": 407473698,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzQ3MzY5OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407473698/reactions"
    },
    "updated_at": "2018-07-24T16:44:53Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407473698",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1286709?v=4",
      "events_url": "https://api.github.com/users/BradBarnich/events{/privacy}",
      "followers_url": "https://api.github.com/users/BradBarnich/followers",
      "following_url": "https://api.github.com/users/BradBarnich/following{/other_user}",
      "gists_url": "https://api.github.com/users/BradBarnich/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BradBarnich",
      "id": 1286709,
      "login": "BradBarnich",
      "node_id": "MDQ6VXNlcjEyODY3MDk=",
      "organizations_url": "https://api.github.com/users/BradBarnich/orgs",
      "received_events_url": "https://api.github.com/users/BradBarnich/received_events",
      "repos_url": "https://api.github.com/users/BradBarnich/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BradBarnich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BradBarnich/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BradBarnich"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@rjmholt I'm afraid adding the `System32` module path to the end of `env:PSModulePath` is not the root cause. If your run `import-module Microsoft.PowerShell.Management`, you will see the following error:\r\n\r\n```\r\nPS C:\\Users\\dongbow\\Downloads\\PowerShell-6.1.0-preview.4-win-x64> import-module Microsoft.PowerShell.Management\r\nimport-module : The version of Windows PowerShell on this computer is '5.1.17134.165'. The module 'C:\\users\\dongbow\\dow\r\nnloads\\powershell-6.1.0-preview.4-win-x64\\Modules\\Microsoft.PowerShell.Management\\Microsoft.PowerShell.Management.psd1'\r\n requires a minimum Windows PowerShell version of '6.1' to run. Verify that you have the minimum required version of\r\nWindows PowerShell installed, and then try again.\r\nAt line:1 char:1\r\n+ import-module Microsoft.PowerShell.Management\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : ResourceUnavailable: (C:\\users\\dongbo...Management.psd1:String) [Import-Module], Invalid\r\n   OperationException\r\n    + FullyQualifiedErrorId : Modules_InsufficientPowerShellVersion,Microsoft.PowerShell.Commands.ImportModuleCommand\r\n```\r\n\r\nThe error indicates that the modules are failing because we changed `PowerShellVersion=\"3.0\"` to `PowerShellVersion=\"6.1\"`.\r\n\r\nThe root problem is that PSCore and Windows PowerShell use the same `PSModulePath` environment variable. We have the RFC https://github.com/PowerShell/PowerShell-RFC/pull/133 submitted to address this issue by introducing a new environment variable representing `PSModulePath` for PSCore. Once we implement that RFC, this problem will go away.\r\n\r\nBut for now, we will change the built-in modules' manifest files back to `PowerShellVersion=\"3.0\"` to work around the root problem. This is a temporary workaround, and will be reverted when the RFC is implemented.",
    "created_at": "2018-07-25T22:29:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407917010",
    "id": 407917010,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzkxNzAxMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407917010/reactions"
    },
    "updated_at": "2018-07-25T23:28:53Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407917010",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I wonder why do we even look for standart/core modules by `env:PSModulePath`? If we hard-code the path to <pwsh.exe dir>\\Modules internally and remove it from  `env:PSModulePath`  the problem will go away.\r\nSeems it helps for side-by-side scenarios too.",
    "created_at": "2018-07-26T03:57:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407968909",
    "id": 407968909,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzk2ODkwOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407968909/reactions"
    },
    "updated_at": "2018-07-26T03:58:33Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407968909",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@iSazonov I think you should put that feedback in https://github.com/PowerShell/PowerShell-RFC/pull/133",
    "created_at": "2018-07-26T04:49:04Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407975231",
    "id": 407975231,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzk3NTIzMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407975231/reactions"
    },
    "updated_at": "2018-07-26T04:49:04Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407975231",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@SteveL-MSFT Will do. \r\nHere my comment is for #7365 ",
    "created_at": "2018-07-26T05:15:07Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-407978691",
    "id": 407978691,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzk3ODY5MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407978691/reactions"
    },
    "updated_at": "2018-07-26T05:15:07Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/407978691",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Fix in #7365 is temporary and it will be replaced later.",
    "created_at": "2018-07-27T03:45:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7324#issuecomment-408302879",
    "id": 408302879,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7324",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODMwMjg3OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/408302879/reactions"
    },
    "updated_at": "2018-07-27T03:45:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/408302879",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
