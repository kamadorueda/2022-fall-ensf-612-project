[
  {
    "author_association": "MEMBER",
    "body": "> Before the fix in ToStringEnumerable() we did extra cast every string from $w2 to PSObject which caused unnecessary memory allocations and slow down the scenario because of skipping fast code path for value types.\r\n\r\nYou will need to update this PR description since casting to `PSObject` is intentional. Also, please list the execution time before/after your changes.\r\nIt would be great if you can add a test to cover the case where a `ToString` method is defined in a type `.ps1xml` file for a type, and see if `-join` honors that method.",
    "created_at": "2019-08-21T19:27:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-523613972",
    "id": 523613972,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzYxMzk3Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/523613972/reactions"
    },
    "updated_at": "2019-08-21T19:27:22Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/523613972",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I will add perf results after we get a consensus about that the fix should be.",
    "created_at": "2019-08-22T06:50:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-523773824",
    "id": 523773824,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzc3MzgyNA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/523773824/reactions"
    },
    "updated_at": "2019-08-22T06:50:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/523773824",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Tests should be added to verify that both `ToStringEnumerator` and `ToStringEnumerable` honor the custom definition of `ToString` in ETS except for primitive types and the `string` type.",
    "created_at": "2019-08-23T18:15:02Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-524412478",
    "id": 524412478,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDQxMjQ3OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/524412478/reactions"
    },
    "updated_at": "2019-08-23T18:15:02Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/524412478",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I did not find how make a test for ToStringEnumerator().",
    "created_at": "2019-08-28T17:02:57Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-525834045",
    "id": 525834045,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTgzNDA0NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525834045/reactions"
    },
    "updated_at": "2019-08-28T17:02:57Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525834045",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "The thing I'm most concerned about is the breaking nature of this change (and not being labeled initially as such). I think that we need to be very careful about addressing performance issues which result in behavioral change. And in this case, I'm not sure it's needed. I hope that we can query for type extensions (and specifically a `ToString`), without wrapping something in a psobject. If there's no extension for the type, then I totally agree we shouldn't wrap. But if there is, we need to use it.\r\n\r\nI think there's far too much utility in ETS to turn our back on them. It doesn't matter if I can't see why anyone would do that, I'm sure our customers would be able to provide a number of reasons. That's the nature of a platform - it will be used in ways we can't imagine.",
    "created_at": "2019-08-30T21:41:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-526758826",
    "id": 526758826,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjc1ODgyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526758826/reactions"
    },
    "updated_at": "2019-08-30T21:41:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526758826",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/10214008?v=4",
      "events_url": "https://api.github.com/users/JamesWTruher/events{/privacy}",
      "followers_url": "https://api.github.com/users/JamesWTruher/followers",
      "following_url": "https://api.github.com/users/JamesWTruher/following{/other_user}",
      "gists_url": "https://api.github.com/users/JamesWTruher/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/JamesWTruher",
      "id": 10214008,
      "login": "JamesWTruher",
      "node_id": "MDQ6VXNlcjEwMjE0MDA4",
      "organizations_url": "https://api.github.com/users/JamesWTruher/orgs",
      "received_events_url": "https://api.github.com/users/JamesWTruher/received_events",
      "repos_url": "https://api.github.com/users/JamesWTruher/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/JamesWTruher/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JamesWTruher/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/JamesWTruher"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@JamesWTruher Thanks! I see your point about ETS and a breaking change.\r\nIt looks very general for the PR - we only bypass ETS  for primitive types and strings. The repo docs classifiers this as \"unlikely breaking change\". (Notice that there already is TryFastTrackPrimitiveTypes() for some code paths.)\r\n\r\nPlease see the follow example:\r\n```powershell\r\nAdd-Type -TypeDefinition @\"\r\nnamespace TestNS\r\n{\r\n   public class TestClass\r\n   {\r\n       public override string ToString()\r\n       {\r\n           return \"1\";\r\n       }\r\n   }\r\n}\r\n\"@\r\n\r\n$a1=[TestNS.TestClass]::new()\r\n\r\n$a1\r\n# Output is \"1\"\r\n\r\n$a1 -join \";\"\r\n# Output is \"1\"\r\n\r\nUpdate-TypeData -TypeName \"TestNS.TestClass\" -MemberType ScriptMethod -MemberName \"ToString\" -Value { return \"test\"}\r\n\r\n$a1\r\n# Output is \"test\"\r\n\r\n$a1 -join \";\"\r\n# Output is \"1\" - unexpected?\r\n\r\n$a1 -like \"1\"\r\n# Output is \"True\" - unexpected?\r\n\r\n$a1,$a1 -like \"1\"\r\n# Output is - unexpected?\r\n# \"1\"\r\n# \"1\"\r\n```\r\nThe example demonstrates two inconsistency (possible fix will be a breaking change):\r\n- `-join` with one argument works another - it calls PSObject.ToStringParser() without wrapping to psobject and ignores ETS\r\n- `-like` (and other string operators) also uses PSObject.ToStringParser() and ignores ETS\r\n\r\nNow question is - should we have a consistency here and accept a breaking change, \r\nin other words, must `-join` work as other operators and ignore ETS too? Or do we should review and fix all string operators (-join, -like, -match,...) to honor ETS?",
    "created_at": "2019-09-02T14:46:32Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-527172983",
    "id": 527172983,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNzE3Mjk4Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/527172983/reactions"
    },
    "updated_at": "2019-09-02T14:46:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/527172983",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@daxian-dbw It seems we have gathered the opinions of all who wanted to speak out. Common conclusion is a concern about ETS and that only string type could be fixed. Based on my previous comment I thing the string type case is also subject to the concern and I think close the PR and related issue as \"By-design\" with workaround to use `[string]::join()` (Also we could consider a switch to bypass ETS in `-join`). \r\n",
    "created_at": "2019-10-28T09:02:49Z",
    "html_url": "https://github.com/PowerShell/PowerShell/pull/10389#issuecomment-546853543",
    "id": 546853543,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10389",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0Njg1MzU0Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/546853543/reactions"
    },
    "updated_at": "2019-10-28T09:04:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/546853543",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
