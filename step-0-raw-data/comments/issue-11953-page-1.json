[
  {
    "author_association": "CONTRIBUTOR",
    "body": "@phatmandrake, based on our conversation at https://stackoverflow.com/a/60406968/45375 I think you can close this issue now.\r\n\r\nTo summarize:\r\n\r\nThe `Auto` in `PtrToStringAuto()` means that the _unmanaged_ input string is assumed to use a *platform-appropriate* character encoding, whereas `BSTR` is \r\na \"Unicode\" (UTF-16) string on _all_ platforms. **On Windows, an unmanaged string is assumed to have UTF-16 encoding (which is why the code works), whereas on Unix-like platforms it is UTF-8 since .NET Core 3.0 (PowerShell [Core] 7.0 is based on .NET Core 3.1)**, which explains your symptoms: the `NUL` chars. in the `BSTR` instance's UTF-16 code units are interpreted as characters in their own right when (mis)interpreted as UTF-8. Note that **.NET Core 2.x (which is what PowerShell [Core] 6.x is based on) (inappropriately) defaulted to UTF-16**, which [this PR fixed](https://github.com/dotnet/coreclr/pull/23664), amounting to a breaking change.\r\n\r\nWhile using `PtrToStringBSTR()` instead of `PtrToStringAuto()` is therefore the immediate fix, it's worth nothing that `[securestring]` is generally not recommended for new code anymore and that it is especially problematic on Unix-like platforms, because _no encryption_ is used there.\r\n\r\nMore specifically, creating a `[string]` instance with a plain-text representation from a secure string defeats the purpose of using `[securestring]` to begin with.\r\n\n\n<blockquote><img src=\"https://cdn.sstatic.net/Sites/stackoverflow/img/apple-touch-icon@2.png?v=73d79a89bded\" width=\"48\" align=\"right\"><div>Stack Overflow</div><div><strong><a href=\"https://stackoverflow.com/questions/60404847/are-you-able-to-use-ptrtostringauto-to-decrypt-a-secure-string-in-powershell-7-o\">Are you able to use PtrToStringAuto to decrypt a secure string in Powershell 7 on macOS?</a></strong></div><div>I have had no success in getting the following code snippet to output \"Hello World!\" in PS7\n\n$(\"Hello World!\" | ConvertTo-SecureString -AsPlainText -Force)\n[System.Runtime.InteropServices.Marshal]::</div></blockquote>",
    "created_at": "2020-02-26T18:26:54Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11953#issuecomment-591572070",
    "id": 591572070,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11953",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTU3MjA3MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 2,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/591572070/reactions"
    },
    "updated_at": "2020-02-26T18:26:57Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/591572070",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "The loop has been made. ",
    "created_at": "2020-02-26T21:39:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/11953#issuecomment-591658018",
    "id": 591658018,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/11953",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTY1ODAxOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 1,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/591658018/reactions"
    },
    "updated_at": "2020-02-26T21:39:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/591658018",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24230425?v=4",
      "events_url": "https://api.github.com/users/phatmandrake/events{/privacy}",
      "followers_url": "https://api.github.com/users/phatmandrake/followers",
      "following_url": "https://api.github.com/users/phatmandrake/following{/other_user}",
      "gists_url": "https://api.github.com/users/phatmandrake/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/phatmandrake",
      "id": 24230425,
      "login": "phatmandrake",
      "node_id": "MDQ6VXNlcjI0MjMwNDI1",
      "organizations_url": "https://api.github.com/users/phatmandrake/orgs",
      "received_events_url": "https://api.github.com/users/phatmandrake/received_events",
      "repos_url": "https://api.github.com/users/phatmandrake/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/phatmandrake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/phatmandrake/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/phatmandrake"
    }
  }
]
