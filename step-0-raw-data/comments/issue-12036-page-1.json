[
  {
    "author_association": "COLLABORATOR",
    "body": "It is expected behavior that latest module exports names in global and overloads previously defined names.",
    "created_at": "2020-03-05T18:18:30Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-595373750",
    "id": 595373750,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTM3Mzc1MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 1,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595373750/reactions"
    },
    "updated_at": "2020-03-05T18:18:30Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595373750",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": ">It is expected behavior that latest module exports names in global and overloads previously defined names.\r\n\r\n@iSazonov Got it.  Do you think I can rely on the shadowing that occurs when `Import-Module` is invoked within a module?  This is the example:\r\n\r\n```PowerShell\r\nNew-Module m {\r\n    Import-Module q\r\n    function m1 {\r\n        [pscustomobject]@{\r\n            Call        = $MyInvocation.MyCommand.Name\r\n            CommandType = Get-Command Get-FileHash | % CommandType\r\n            Module      = Get-Command Get-FileHash | % Module | % {[System.IO.FileInfo]::new($_.Path).Name}\r\n        }\r\n    }\r\n    function m2 {q1}\r\n} | Import-Module\r\nNew-Module p {\r\n    Import-Module Microsoft.PowerShell.Utility\r\n    function p1 {\r\n        [pscustomobject]@{\r\n            Call        = $MyInvocation.MyCommand.Name\r\n            CommandType = Get-Command Get-FileHash | % CommandType\r\n            Module      = Get-Command Get-FileHash | % Module | % {[System.IO.FileInfo]::new($_.Path).Name}\r\n        }\r\n    }\r\n} | Import-Module\r\n\r\nm1\r\np1\r\nm2\r\nm1\r\np1\r\nm1\r\np1\r\n```\r\n\r\nwhich outputs\r\n\r\n```\r\nCall CommandType Module\r\n---- ----------- ------\r\nm1      Function q.psm1\r\np1      Function Microsoft.PowerShell.Utility.psd1\r\nm1      Function q.psm1\r\np1      Function Microsoft.PowerShell.Utility.psd1\r\nm1      Function q.psm1\r\np1      Function Microsoft.PowerShell.Utility.psd1\r\n```\r\n\r\nNote that in this example the command to which each call site is resolved is the same for each call at that site.\r\n",
    "created_at": "2020-03-05T18:59:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-595391659",
    "id": 595391659,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTM5MTY1OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595391659/reactions"
    },
    "updated_at": "2020-03-05T19:00:30Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595391659",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11237922?v=4",
      "events_url": "https://api.github.com/users/alx9r/events{/privacy}",
      "followers_url": "https://api.github.com/users/alx9r/followers",
      "following_url": "https://api.github.com/users/alx9r/following{/other_user}",
      "gists_url": "https://api.github.com/users/alx9r/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alx9r",
      "id": 11237922,
      "login": "alx9r",
      "node_id": "MDQ6VXNlcjExMjM3OTIy",
      "organizations_url": "https://api.github.com/users/alx9r/orgs",
      "received_events_url": "https://api.github.com/users/alx9r/received_events",
      "repos_url": "https://api.github.com/users/alx9r/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alx9r/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alx9r/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alx9r"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "If you ask about workaround, yes, this is good because you use a module context to avoid name collisions. ",
    "created_at": "2020-03-05T19:05:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-595394260",
    "id": 595394260,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTM5NDI2MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595394260/reactions"
    },
    "updated_at": "2020-03-05T19:05:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595394260",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": ">[Can you give an example where this new behaviour is causing an issue? It would help us pin down the change and the issue](https://github.com/PowerShell/PowerShell/issues/12014#issuecomment-595400081)\r\n\r\n@rjmholt This repro is an abstraction of how this caused an issue.  I've got a repo of 50 or so modules that I'm transitioning from Windows PowerShell.  I'm relying on the 20k or so unit and integration tests from those modules to hopefully get this to happen smoothly.   Under PowerShell 5.1 none of the modules had `Import-Module` calls that corresponded to the modules required.  Instead they seemed to have relied only on the automatic loading resulting from `RequiredModules` in the manifest.  Per my OP here that results in consistent results under PowerShell 5.1 because, it seems, under 5.1 no matter what the order that other code is invoked, from the perspective of each module, command resolution remained the same.  Under PowerShell 7, though, that doesn't hold, and the order that modules auto-load their requirements matters (or matters more?).  \r\n\r\nIn my case I had an inadvertent name collision on `Add-SqlLogin` (between [this implementation](https://docs.microsoft.com/en-us/powershell/module/sqlserver/add-sqllogin?view=sqlserver-ps) and in one of our internal modules.  A third module that called `Add-SqlLogin` either successfully called the internal implementation or failed trying to call the one from [the public SqlServer module](https://docs.microsoft.com/en-us/powershell/module/sqlserver/?view=sqlserver-ps).  The failure depended on whether a command from a fourth module that auto-imports the public SqlServer module was invoked before or after the third module.  That's no fun.\r\n\r\nThe reliance for name resolution by modules on the global scope is, I think, a mistake that happened to not manifest in 5.1.  My task currently is to determine how to ensure name resolution occurs reliably within each module without ever reaching the global scope.  Hopefully I can find such a solution.\r\n\r\nMy intuition is that this will probably be a one-time cleanup with some internal policy changes around importing of required modules.  I think I prefer the new command resolution behavior, but I've still got a bit of work to do to determine whether I can get that to stabilize with our modules.",
    "created_at": "2020-03-05T20:14:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-595425489",
    "id": 595425489,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NTQyNTQ4OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595425489/reactions"
    },
    "updated_at": "2020-03-05T20:14:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/595425489",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11237922?v=4",
      "events_url": "https://api.github.com/users/alx9r/events{/privacy}",
      "followers_url": "https://api.github.com/users/alx9r/followers",
      "following_url": "https://api.github.com/users/alx9r/following{/other_user}",
      "gists_url": "https://api.github.com/users/alx9r/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alx9r",
      "id": 11237922,
      "login": "alx9r",
      "node_id": "MDQ6VXNlcjExMjM3OTIy",
      "organizations_url": "https://api.github.com/users/alx9r/orgs",
      "received_events_url": "https://api.github.com/users/alx9r/received_events",
      "repos_url": "https://api.github.com/users/alx9r/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alx9r/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alx9r/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alx9r"
    }
  },
  {
    "author_association": "NONE",
    "body": ">...this will probably be a one-time cleanup with some internal policy changes around importing of required modules.\r\n\r\nHere is a summary of the policy I implemented to mitigate this issue.\r\n\r\n### Policy\r\n\r\n1. Each module shall invoke `Import-Module` for each of the modules specified by the `RequiredModules` entry in the module manifest.\r\n2. `Import-Module` in (1) shall be invoked at the top scope of the module's session state.\r\n3. `$PSModuleAutoloadingPreference` shall be `None` during `Import-Module` in (1).\r\n4. During the invokation of automated tests `$PSModuleAutoloadingPreference` shall be `None`.\r\n\r\n### Reasoning\r\n\r\n(1) and (2) [adequately shadow command names](https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-595391659) to ensure name resolution occurs within the module.  (3) and (4) ensure that automated tests will fail for nearly all commands if they are not imported per (1).  \r\n\r\n### Limitations\r\nIf a command that is already imported when PowerShell launches is not imported per (1), then that command is still vulnerable to this issue.",
    "created_at": "2020-04-07T22:45:21Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-610656706",
    "id": 610656706,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDY1NjcwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/610656706/reactions"
    },
    "updated_at": "2020-04-07T22:45:21Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/610656706",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11237922?v=4",
      "events_url": "https://api.github.com/users/alx9r/events{/privacy}",
      "followers_url": "https://api.github.com/users/alx9r/followers",
      "following_url": "https://api.github.com/users/alx9r/following{/other_user}",
      "gists_url": "https://api.github.com/users/alx9r/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alx9r",
      "id": 11237922,
      "login": "alx9r",
      "node_id": "MDQ6VXNlcjExMjM3OTIy",
      "organizations_url": "https://api.github.com/users/alx9r/orgs",
      "received_events_url": "https://api.github.com/users/alx9r/received_events",
      "repos_url": "https://api.github.com/users/alx9r/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alx9r/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alx9r/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alx9r"
    }
  },
  {
    "author_association": "NONE",
    "body": "@iSazonov I just reviewed this issue.  I think the key point is this statement you made:\r\n\r\n>It is expected behavior that latest module exports names in global and overloads previously defined names.\r\n\r\nI think then, that the behavior I described in my OP is by design.  If you agree, I'd like to close this issue.  I think #12014 sufficiently covers the outstanding issue with surprising command name resolution.",
    "created_at": "2020-04-08T23:08:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-611239273",
    "id": 611239273,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTIzOTI3Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/611239273/reactions"
    },
    "updated_at": "2020-04-08T23:08:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/611239273",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11237922?v=4",
      "events_url": "https://api.github.com/users/alx9r/events{/privacy}",
      "followers_url": "https://api.github.com/users/alx9r/followers",
      "following_url": "https://api.github.com/users/alx9r/following{/other_user}",
      "gists_url": "https://api.github.com/users/alx9r/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alx9r",
      "id": 11237922,
      "login": "alx9r",
      "node_id": "MDQ6VXNlcjExMjM3OTIy",
      "organizations_url": "https://api.github.com/users/alx9r/orgs",
      "received_events_url": "https://api.github.com/users/alx9r/received_events",
      "repos_url": "https://api.github.com/users/alx9r/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alx9r/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alx9r/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alx9r"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Ok, we can reopen in any time if needed.",
    "created_at": "2020-04-09T06:33:57Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/12036#issuecomment-611355723",
    "id": 611355723,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/12036",
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTM1NTcyMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/611355723/reactions"
    },
    "updated_at": "2020-04-09T06:33:57Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/611355723",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
