[
  {
    "author_association": "CONTRIBUTOR",
    "body": "That is indeed an interesting omission (which I personally cannot explain): `$PSHOME\\Modules` isn't there when using the Core SDK.\r\n\r\n#6850 may be distantly related; the code that sets `$env:PSModulePath` in PS Core is in [ModuleIntrinsics.cs](https://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/engine/Modules/ModuleIntrinsics.cs)",
    "created_at": "2019-01-14T15:32:41Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-454046456",
    "id": 454046456,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDA0NjQ1Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/454046456/reactions"
    },
    "updated_at": "2019-01-14T15:32:41Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/454046456",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "@mklement0  There are some weird responses on some PS commands if you run PS in CMD and run PS in .net core app.\r\n\r\nAnother example with this code\r\n```\r\nusing (var ps = PowerShell.Create())\r\n{\r\n\tps.AddScript(\"Get-PSRepository\");\r\n\tvar results = ps.Invoke();\r\n\tforeach (var result in results)\r\n\t{\r\n\t\tvar itemPath = result.ToString();\r\n\t}\r\n}\r\n```\r\n\r\nIt returns nothing in C# but if I run \"Get-PSRepository\" in CMD, I get 1 record with PSGallery row. That makes my scripts work fine in CMD but failed when running with c#.\r\n\r\nAnd I am not sure because of ModulePath issues?\r\n\r\n",
    "created_at": "2019-01-15T10:58:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-454352150",
    "id": 454352150,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDM1MjE1MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/454352150/reactions"
    },
    "updated_at": "2019-01-15T11:02:52Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/454352150",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5907220?v=4",
      "events_url": "https://api.github.com/users/sonphnt/events{/privacy}",
      "followers_url": "https://api.github.com/users/sonphnt/followers",
      "following_url": "https://api.github.com/users/sonphnt/following{/other_user}",
      "gists_url": "https://api.github.com/users/sonphnt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/sonphnt",
      "id": 5907220,
      "login": "sonphnt",
      "node_id": "MDQ6VXNlcjU5MDcyMjA=",
      "organizations_url": "https://api.github.com/users/sonphnt/orgs",
      "received_events_url": "https://api.github.com/users/sonphnt/received_events",
      "repos_url": "https://api.github.com/users/sonphnt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/sonphnt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sonphnt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/sonphnt"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Taking a step back, it seems that the SDK is designed to be _self-contained_ and independent of a regular PowerShell installation, if any.\r\n\r\nYet, that is at odds with SDK-invoked commands still seeing and respecting `$env:PSModulePath` with directory entries from a regular PowerShell installation.\r\n\r\nConversely, the SDK packages appear to lack modules such as `PowerShellGet` (which contains `Get-PSRepository`) and `microsoft.powershell.archive`.\r\n\r\n\r\nThe Core SDK _does_ dynamically add `$PSHome/Modules`  to `$env:PSModulePath`, yet it does so based on what _it_ considers `$PSHOME`, which is the (virtually useless) location of the platform-specific `System.Management.Automation.dll` file inside the locally cached relevant NuGet package.\r\n\r\nThe official docs (the ones I could find) offer little to clear up the confusion, and there appear to be multiple SDK-related NuGet packages, whose relationship is unclear:\r\n\r\n* Windows PowerShell: `Microsoft.PowerShell.5.ReferenceAssemblies` vs. `PowerShellStandard.Library`\r\n\r\n* PowerShell Core: `Microsoft.PowerShell.SDK ` vs. `System.Management.Automation`\r\n\r\n@SteveL-MSFT, can you shed some light on what the _expected_ behavior is?",
    "created_at": "2019-01-21T23:14:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-456222225",
    "id": 456222225,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjIyMjIyNQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456222225/reactions"
    },
    "updated_at": "2019-01-21T23:14:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456222225",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "I know this has come up before and directly related to SMA.dll being in a different folder being a nupkg.  I believe expectation is that the app needs to set appropriate `$env:PSModulePath` for itself since SMA.dll cannot determine which other modules are there in what paths (if being brought into the project as nupkgs themselves).  cc @adityapatwardhan ",
    "created_at": "2019-01-22T18:05:04Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-456501140",
    "id": 456501140,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjUwMTE0MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456501140/reactions"
    },
    "updated_at": "2019-01-22T18:05:04Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456501140",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Yes, that is correct. Since we are using the SDK, the SMA.dll is being placed in nuget cache or in the publish folder, we cannot guess where `$PSHome` will be on the system even as a relative path. As @SteveL-MSFT recommended, the module path must be updated by the application to resolve this.\r\n\r\n@mklement0 - Short description about the various packages.\r\n\r\n`Microsoft.PowerShell.5.ReferenceAssemblies` - Used for building Windows PowerShell application.\r\n`PowerShellStandard.Library` - Used for building PowerShell Core application compatible with Windows PowerShell.\r\n`Microsoft.PowerShell.SDK` - Used for building PowerShell Core application.\r\n`System.Management.Automation` - Not recommended to use directly.\r\n",
    "created_at": "2019-01-22T18:43:39Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-456515037",
    "id": 456515037,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjUxNTAzNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456515037/reactions"
    },
    "updated_at": "2019-01-22T18:43:39Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456515037",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12820925?v=4",
      "events_url": "https://api.github.com/users/adityapatwardhan/events{/privacy}",
      "followers_url": "https://api.github.com/users/adityapatwardhan/followers",
      "following_url": "https://api.github.com/users/adityapatwardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/adityapatwardhan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/adityapatwardhan",
      "id": 12820925,
      "login": "adityapatwardhan",
      "node_id": "MDQ6VXNlcjEyODIwOTI1",
      "organizations_url": "https://api.github.com/users/adityapatwardhan/orgs",
      "received_events_url": "https://api.github.com/users/adityapatwardhan/received_events",
      "repos_url": "https://api.github.com/users/adityapatwardhan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/adityapatwardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adityapatwardhan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/adityapatwardhan"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, @SteveL-MSFT  and @adityapatwardhan.\r\n\r\n---\r\n\r\nRe documentation:\r\n\r\nCan I suggest:\r\n\r\n* first, amending the descriptions of the NuGet packages to contain this information? E.g., package `PowerShellStandard.Library` just states `Contains the reference assemblies for PowerShell Standard 5` and `System.Management.Automation` does not indicate that it shouldn't be used directly.\r\n\r\n* second, compiling this information in documentation that covers all editions and platforms? All I could find was - outdated - WinPS information ([Installing the Windows PowerShell SDK](https://docs.microsoft.com/en-us/powershell/developer/windows-powershell)) and nothing re Core; though https://github.com/PowerShell/PowerShell-Docs suggests that may already be underway.\r\n\r\n---\r\n\r\nRe behavior:\r\n\r\n* As for `$env:PSModulePath`: it almost sounds like the SDK should disregard this variable altogether, given that it only has meaning for a _regular_ PS installation (which is related to the discussions in https://github.com/PowerShell/PowerShell/issues/6850 and https://github.com/PowerShell/PowerShell/issues/8635, where it is cross-_edition_ use of `$env:PSModulePath` that causes problems, and a distinct variable for Core is being considered in a yet-to-be-written-RFC).\r\n\r\n* If the SDK is to be self-contained (no dependency on a regular installation), things like the package management modules, the compression (archive) module, and the thread-job module:\r\n   * appear to be missing from the `Microsoft.PowerShell.SDK` package['s dependencies]\r\n   * even if present, the SDK doesn't find them.\r\n       * It seems that `Start-PSBootstrap` when you build the PS Core repo from source installs these packages (`packagemanagement`, `powershellget`, `microsoft.powershell.archive`, `threadjob`), which, incidentally, aren't directly available as NuGet packages themselves; what these packages have in common is that they're PowerShell _modules_.\r\n\r\nAs a result, calling commands such as `Install-Module` from the SDK doesn't work.\r\n\r\n\r\n",
    "created_at": "2019-01-22T22:32:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-456589272",
    "id": 456589272,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjU4OTI3Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 2,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456589272/reactions"
    },
    "updated_at": "2019-01-22T22:32:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456589272",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@mklement0 submitted [PR](https://github.com/PowerShell/PowerShellStandard/pull/57) to fix PowerShell Standard description",
    "created_at": "2019-01-22T22:48:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8625#issuecomment-456593575",
    "id": 456593575,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8625",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjU5MzU3NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 1,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456593575/reactions"
    },
    "updated_at": "2019-01-22T22:48:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/456593575",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  }
]
