[
  {
    "author_association": "CONTRIBUTOR",
    "body": "You are not correct in first case. You should replace `$a+='a'` to `$a+='b'`. Then you will see, that child-scope variable is created, but parent-scope variable is not read by compound assignment.\r\n\r\nAlso, I do not see any easy fix for third case, unless you gave up on optimization entirely. It does not matter of detecting custom aliases, but deep problem with dynamic nature of PowerShell language:\r\n```powershell\r\n&{ $a='asd'; &(Read-Host) a; $a }\r\n```\r\nAnd I type `rv` at runtime.",
    "created_at": "2017-07-21T00:09:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316865009",
    "id": 316865009,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg2NTAwOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316865009/reactions"
    },
    "updated_at": "2017-07-21T00:09:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316865009",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/17184058?v=4",
      "events_url": "https://api.github.com/users/PetSerAl/events{/privacy}",
      "followers_url": "https://api.github.com/users/PetSerAl/followers",
      "following_url": "https://api.github.com/users/PetSerAl/following{/other_user}",
      "gists_url": "https://api.github.com/users/PetSerAl/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PetSerAl",
      "id": 17184058,
      "login": "PetSerAl",
      "node_id": "MDQ6VXNlcjE3MTg0MDU4",
      "organizations_url": "https://api.github.com/users/PetSerAl/orgs",
      "received_events_url": "https://api.github.com/users/PetSerAl/received_events",
      "repos_url": "https://api.github.com/users/PetSerAl/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PetSerAl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PetSerAl/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PetSerAl"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the correction, @PetSerAl; I've updated the initial post - see if it's accurate now.\r\n\r\nBased on what you say, the *title* of this issue may be mistaken too - what do you suggest instead?\r\n\r\nRe 3rd case:\r\n\r\nThat's an intriguing edge case.\r\n\r\nPragmatically speaking, asking innocently : how important are these optimizations?",
    "created_at": "2017-07-21T01:04:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316872444",
    "id": 316872444,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg3MjQ0NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316872444/reactions"
    },
    "updated_at": "2017-07-21T01:04:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316872444",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Something like this: \"Compound assignment do not read parent-scope variable\".",
    "created_at": "2017-07-21T01:10:33Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316873378",
    "id": 316873378,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg3MzM3OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316873378/reactions"
    },
    "updated_at": "2017-07-21T01:10:33Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316873378",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/17184058?v=4",
      "events_url": "https://api.github.com/users/PetSerAl/events{/privacy}",
      "followers_url": "https://api.github.com/users/PetSerAl/followers",
      "following_url": "https://api.github.com/users/PetSerAl/following{/other_user}",
      "gists_url": "https://api.github.com/users/PetSerAl/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PetSerAl",
      "id": 17184058,
      "login": "PetSerAl",
      "node_id": "MDQ6VXNlcjE3MTg0MDU4",
      "organizations_url": "https://api.github.com/users/PetSerAl/orgs",
      "received_events_url": "https://api.github.com/users/PetSerAl/received_events",
      "repos_url": "https://api.github.com/users/PetSerAl/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PetSerAl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PetSerAl/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PetSerAl"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "P.S.\r\nActual behavior, second case: `aa` -> `ab`.",
    "created_at": "2017-07-21T01:26:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316875629",
    "id": 316875629,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg3NTYyOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316875629/reactions"
    },
    "updated_at": "2017-07-21T01:26:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316875629",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/17184058?v=4",
      "events_url": "https://api.github.com/users/PetSerAl/events{/privacy}",
      "followers_url": "https://api.github.com/users/PetSerAl/followers",
      "following_url": "https://api.github.com/users/PetSerAl/following{/other_user}",
      "gists_url": "https://api.github.com/users/PetSerAl/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PetSerAl",
      "id": 17184058,
      "login": "PetSerAl",
      "node_id": "MDQ6VXNlcjE3MTg0MDU4",
      "organizations_url": "https://api.github.com/users/PetSerAl/orgs",
      "received_events_url": "https://api.github.com/users/PetSerAl/received_events",
      "repos_url": "https://api.github.com/users/PetSerAl/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PetSerAl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PetSerAl/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PetSerAl"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@PetSerAl: Thanks, fixed.",
    "created_at": "2017-07-21T01:33:19Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316876623",
    "id": 316876623,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg3NjYyMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316876623/reactions"
    },
    "updated_at": "2017-07-21T01:33:19Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316876623",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "```powershell\r\n$a='a'\r\n& {$a; $a+='b'; $a; (Get-Variable a).GetType().FullName }\r\n\r\na\r\nab\r\n```\r\nI see the suggested fix is that `$a` is Global.\r\nWhat about `$a` is Local? (Is it the optimization goal?) And the output:\r\n```powershell\r\n<null>\r\nb\r\n```\r\n",
    "created_at": "2017-07-21T05:11:57Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316904751",
    "id": 316904751,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjkwNDc1MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316904751/reactions"
    },
    "updated_at": "2017-07-21T05:13:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316904751",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@iSazonov If there are no variable `$a` in parent scope, then you still have different behavior:\r\n```powershell\r\nSet-StrictMode -Version Latest\r\n& { $a; $a+='a'; $a; if(0){rv} }\r\n& { $a; $a+='a'; $a }\r\n```",
    "created_at": "2017-07-21T11:15:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-316975244",
    "id": 316975244,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjk3NTI0NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316975244/reactions"
    },
    "updated_at": "2017-07-21T11:15:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/316975244",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/17184058?v=4",
      "events_url": "https://api.github.com/users/PetSerAl/events{/privacy}",
      "followers_url": "https://api.github.com/users/PetSerAl/followers",
      "following_url": "https://api.github.com/users/PetSerAl/following{/other_user}",
      "gists_url": "https://api.github.com/users/PetSerAl/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PetSerAl",
      "id": 17184058,
      "login": "PetSerAl",
      "node_id": "MDQ6VXNlcjE3MTg0MDU4",
      "organizations_url": "https://api.github.com/users/PetSerAl/orgs",
      "received_events_url": "https://api.github.com/users/PetSerAl/received_events",
      "repos_url": "https://api.github.com/users/PetSerAl/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PetSerAl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PetSerAl/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PetSerAl"
    }
  },
  {
    "author_association": "NONE",
    "body": "I just closed a dup of this. But just to note that, $private:var seems to have same effect as remove-variable. :var can be any variable, even a non-existent one.\r\n\r\n```powershell\r\n$a='a'\r\n& { $a += 'b'; $a; if(0){$private:c} }       # ab\r\n& { $a += 'b'; $a }                                    # b",
    "created_at": "2017-10-08T12:37:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-335003854",
    "id": 335003854,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNTAwMzg1NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/335003854/reactions"
    },
    "updated_at": "2017-10-08T12:37:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/335003854",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2817326?v=4",
      "events_url": "https://api.github.com/users/cfinnberg/events{/privacy}",
      "followers_url": "https://api.github.com/users/cfinnberg/followers",
      "following_url": "https://api.github.com/users/cfinnberg/following{/other_user}",
      "gists_url": "https://api.github.com/users/cfinnberg/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/cfinnberg",
      "id": 2817326,
      "login": "cfinnberg",
      "node_id": "MDQ6VXNlcjI4MTczMjY=",
      "organizations_url": "https://api.github.com/users/cfinnberg/orgs",
      "received_events_url": "https://api.github.com/users/cfinnberg/received_events",
      "repos_url": "https://api.github.com/users/cfinnberg/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/cfinnberg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cfinnberg/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/cfinnberg"
    }
  },
  {
    "author_association": "NONE",
    "body": "Real world example just found on Stack Overflow here:\r\n\r\nhttps://stackoverflow.com/questions/56452820/handling-array-in-powershell-script/56457580#56457580\r\n\r\nwhich basically boils down to:\r\n\r\n```powershell\r\n$myArray = @( \"xxx\" );\r\n\r\nfunction Invoke-MyFunction\r\n{\r\n    write-host \"before function = '$($myArray | ConvertTo-Json)'\";\r\n    $myArray += \"aaa\";\r\n    $myArray += \"bbb\";\r\n    write-host \"after function = '$($myArray | ConvertTo-Json)'\";\r\n}\r\n\r\nwrite-host \"before script = '$($myArray | ConvertTo-Json)'\";\r\nInvoke-MyFunction;\r\nwrite-host \"after script = '$($myArray | ConvertTo-Json)'\";\r\n```\r\n\r\ngives output\r\n\r\n```powershell\r\nbefore script = '\"xxx\"'\r\nbefore function = '\"xxx\"'\r\nafter function = '\"aaabbb\"'\r\nafter script = '\"xxx\"'\r\n```\r\n\r\ni.e. in the context of a child scope, if ```$myArray += \"aaa\"``` is the first assignment to a parent scope variable, doesn't add an item to an array like ```$myArray = $myArray + \"aaa\"``` - it does string concatenation instead ```$myArray = $null + \"aaa\"```\r\n\r\nsome workarounds that bypass the problematic optimisations are:\r\n\r\n**don't use \"assignment by addition operator\" in first assignment**\r\n```powershell\r\nfunction Invoke-MyFunction\r\n{\r\n    write-host \"before function = '$($myArray | ConvertTo-Json)'\";\r\n    # don't use \"assignment by addition operator\" in first assignment\r\n    $myArray = $myArray + \"aaa\";\r\n    $myArray += \"bbb\";\r\n    write-host \"after function = '$($myArray | ConvertTo-Json)'\";\r\n}\r\n```\r\n\r\n**do an assignment first to intialise the local variable***\r\n```powershell\r\nfunction Invoke-MyFunction\r\n{\r\n    # do an assignment first to intialise the local variable\r\n    $myArray = $myArray ;\r\n    $myArray += \"aaa\";\r\n    $myArray += \"bbb\";\r\n}\r\n```\r\n\r\nboth of these then give this output:\r\n\r\n```text\r\nbefore script = '\"xxx\"'\r\nbefore function = '\"xxx\"'\r\nafter function = '[\r\n    \"xxx\",\r\n    \"aaa\",\r\n    \"bbb\"\r\n]'\r\nafter script = '\"xxx\"'\r\n```",
    "created_at": "2019-06-05T09:45:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/4312#issuecomment-499015207",
    "id": 499015207,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/4312",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTAxNTIwNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/499015207/reactions"
    },
    "updated_at": "2019-06-05T09:47:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/499015207",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1193763?v=4",
      "events_url": "https://api.github.com/users/mikeclayton/events{/privacy}",
      "followers_url": "https://api.github.com/users/mikeclayton/followers",
      "following_url": "https://api.github.com/users/mikeclayton/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikeclayton/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mikeclayton",
      "id": 1193763,
      "login": "mikeclayton",
      "node_id": "MDQ6VXNlcjExOTM3NjM=",
      "organizations_url": "https://api.github.com/users/mikeclayton/orgs",
      "received_events_url": "https://api.github.com/users/mikeclayton/received_events",
      "repos_url": "https://api.github.com/users/mikeclayton/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mikeclayton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikeclayton/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mikeclayton"
    }
  }
]
