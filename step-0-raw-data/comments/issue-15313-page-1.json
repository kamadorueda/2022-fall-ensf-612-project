[
  {
    "author_association": "MEMBER",
    "body": "@JamesWTruher - knows whats going on here. `Stop` stops the current command not the whole execution.",
    "created_at": "2021-05-19T21:42:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15313#issuecomment-844494986",
    "id": 844494986,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15313",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDQ5NDk4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/844494986/reactions"
    },
    "updated_at": "2021-05-19T21:42:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/844494986",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12820925?v=4",
      "events_url": "https://api.github.com/users/adityapatwardhan/events{/privacy}",
      "followers_url": "https://api.github.com/users/adityapatwardhan/followers",
      "following_url": "https://api.github.com/users/adityapatwardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/adityapatwardhan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/adityapatwardhan",
      "id": 12820925,
      "login": "adityapatwardhan",
      "node_id": "MDQ6VXNlcjEyODIwOTI1",
      "organizations_url": "https://api.github.com/users/adityapatwardhan/orgs",
      "received_events_url": "https://api.github.com/users/adityapatwardhan/received_events",
      "repos_url": "https://api.github.com/users/adityapatwardhan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/adityapatwardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adityapatwardhan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/adityapatwardhan"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "The expectation of the app developer is to stop all pipelines that are invoked asynchronously. The `Stop` API as documented stops the current command. So when there are more commands in the pipeline and `Dispose` is called, we get a `PSInvalidOperationException`. \r\n\r\n**Feature enhancement** is to add new API for overloading `Stop` which will take a enum parameter for either stopping the current command or the whole pipeline.\r\n\r\nWorkaround is to add `Dispose()` after the `Task.WaitAll()` instead of in the Task, this will make sure that after cancelling the current command, the next command completes.\r\n\r\nIf the intention is to stop all the commands, then they need to be in a single statement. So instead of `AddCommand().AddStatement().AddCommand()`, it should be changed to `AddScript(<command1>; <command2>; <command3>)`",
    "created_at": "2021-05-19T22:49:21Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15313#issuecomment-844548669",
    "id": 844548669,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15313",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDU0ODY2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/844548669/reactions"
    },
    "updated_at": "2021-05-19T22:49:21Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/844548669",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12820925?v=4",
      "events_url": "https://api.github.com/users/adityapatwardhan/events{/privacy}",
      "followers_url": "https://api.github.com/users/adityapatwardhan/followers",
      "following_url": "https://api.github.com/users/adityapatwardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/adityapatwardhan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/adityapatwardhan",
      "id": 12820925,
      "login": "adityapatwardhan",
      "node_id": "MDQ6VXNlcjEyODIwOTI1",
      "organizations_url": "https://api.github.com/users/adityapatwardhan/orgs",
      "received_events_url": "https://api.github.com/users/adityapatwardhan/received_events",
      "repos_url": "https://api.github.com/users/adityapatwardhan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/adityapatwardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adityapatwardhan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/adityapatwardhan"
    }
  },
  {
    "author_association": "NONE",
    "body": "A curious aspect is that it doesn't matter where in the queue the current command is. Even if it's the last command `Stop` will still crash. This can be seen with this little example:\r\n\r\n```csharp\r\n        public static int Main () {\r\n            var ps = PowerShell.Create();\r\n            ps.AddCommand(\"Import-Module\").AddArgument(\"PackageManagement\")\r\n              .AddStatement()\r\n              .AddScript(\"Get-ChildItem -Path '~' -Recurse\");\r\n            var t = Task.Run(() => { Thread.Sleep(4_000); ps.Commands.Clear(); ps.Stop(); ps.Dispose(); } );\r\n            try {\r\n                ps.InvokeAsync().Wait();\r\n            } catch {}\r\n            return 0;\r\n        }\r\n```\r\nAdjust the timeout any way you like, the process will still crash. As you can see I also tried clearing the commands before calling `Stop` and `Dispose` - predictably, it does not help.\r\n",
    "created_at": "2021-05-21T13:21:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15313#issuecomment-845945698",
    "id": 845945698,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15313",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTk0NTY5OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/845945698/reactions"
    },
    "updated_at": "2021-05-21T13:21:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/845945698",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/623703?v=4",
      "events_url": "https://api.github.com/users/et1975/events{/privacy}",
      "followers_url": "https://api.github.com/users/et1975/followers",
      "following_url": "https://api.github.com/users/et1975/following{/other_user}",
      "gists_url": "https://api.github.com/users/et1975/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/et1975",
      "id": 623703,
      "login": "et1975",
      "node_id": "MDQ6VXNlcjYyMzcwMw==",
      "organizations_url": "https://api.github.com/users/et1975/orgs",
      "received_events_url": "https://api.github.com/users/et1975/received_events",
      "repos_url": "https://api.github.com/users/et1975/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/et1975/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/et1975/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/et1975"
    }
  },
  {
    "author_association": "NONE",
    "body": "Also, would be good to adhere to [ca1065](https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca1065). I.e. `Dispose` should not throw, let alone crash regardless of what the pipelines are doing.",
    "created_at": "2021-06-01T12:21:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15313#issuecomment-852079952",
    "id": 852079952,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15313",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MjA3OTk1Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/852079952/reactions"
    },
    "updated_at": "2021-06-01T12:21:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/852079952",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/623703?v=4",
      "events_url": "https://api.github.com/users/et1975/events{/privacy}",
      "followers_url": "https://api.github.com/users/et1975/followers",
      "following_url": "https://api.github.com/users/et1975/following{/other_user}",
      "gists_url": "https://api.github.com/users/et1975/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/et1975",
      "id": 623703,
      "login": "et1975",
      "node_id": "MDQ6VXNlcjYyMzcwMw==",
      "organizations_url": "https://api.github.com/users/et1975/orgs",
      "received_events_url": "https://api.github.com/users/et1975/received_events",
      "repos_url": "https://api.github.com/users/et1975/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/et1975/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/et1975/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/et1975"
    }
  }
]
