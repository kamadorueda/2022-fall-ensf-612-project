[
  {
    "author_association": "CONTRIBUTOR",
    "body": "Huh, this is interesting.  When using the `-Session` parameter rather than `-ComputerName`, `Invoke-Command {$using:env:foo}` _does_ return the expected value.\r\n\r\nEdit: same for `$using:function:foo`, `$using:global:foo`, and `$using:variable:foo`.",
    "created_at": "2021-09-10T17:55:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16019#issuecomment-917098501",
    "id": 917098501,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16019",
    "node_id": "IC_kwDOAvT7bc42qdAF",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/917098501/reactions"
    },
    "updated_at": "2021-09-10T18:20:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/917098501",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/38249738?v=4",
      "events_url": "https://api.github.com/users/dwtaber/events{/privacy}",
      "followers_url": "https://api.github.com/users/dwtaber/followers",
      "following_url": "https://api.github.com/users/dwtaber/following{/other_user}",
      "gists_url": "https://api.github.com/users/dwtaber/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dwtaber",
      "id": 38249738,
      "login": "dwtaber",
      "node_id": "MDQ6VXNlcjM4MjQ5NzM4",
      "organizations_url": "https://api.github.com/users/dwtaber/orgs",
      "received_events_url": "https://api.github.com/users/dwtaber/received_events",
      "repos_url": "https://api.github.com/users/dwtaber/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dwtaber/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dwtaber/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dwtaber"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "I've identified the proximate cause of this issue, but not yet the root cause.  If you're using the `-ComputerName` parameter, because the remote runspace isn't opened yet, the PowerShell version on the remote computer is assumed to be PowerShell v2:\r\n\r\nhttps://github.com/PowerShell/PowerShell/blob/dad7a34ee743c81dd96e742ed5516ac782388972/src/System.Management.Automation/engine/remoting/commands/PSRemotingCmdlet.cs#L1900-L1945\r\n\r\nBecause PowerShell v2 doesn't understand `$Using:` expressions, [`GetPowerShellForPSv2()`](https://github.com/PowerShell/PowerShell/blob/dad7a34ee743c81dd96e742ed5516ac782388972/src/System.Management.Automation/engine/remoting/commands/PSRemotingCmdlet.cs#L2167-L2229) is supposed to alter the script before sending to the remote computer.  I'd guess that whatever parsing happens in [`GetConvertedScript`](https://github.com/PowerShell/PowerShell/blob/dad7a34ee743c81dd96e742ed5516ac782388972/src/System.Management.Automation/engine/remoting/commands/PSRemotingCmdlet.cs#L2343-L2401) doesn't properly account for cases like `$using:env:foo`, but I haven't had a chance to dig in yet.\r\n\r\nTo test whether I was on the right track, I modified [`CreatePipeline`](https://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/engine/remoting/commands/PSRemotingCmdlet.cs#L1870-L1898), replacing the conditional expression on lines 1882â€“1884 with `GetPowerShellForPSv3OrLater(PSv5OrLater)` to ignore version checking and assume the remote computer would use PowerShell v5 or later.  Sure enough, `Invoke-Command` started returning values for `$using:env:foo`, `$env:variable:foo`, etc.  Obviously it's not acceptable for production to just do away with version checking, but it at least helps pin down the cause.  I'll keep digging.",
    "created_at": "2021-09-13T18:17:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16019#issuecomment-918454577",
    "id": 918454577,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16019",
    "node_id": "IC_kwDOAvT7bc42voEx",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/918454577/reactions"
    },
    "updated_at": "2021-09-13T18:17:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/918454577",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/38249738?v=4",
      "events_url": "https://api.github.com/users/dwtaber/events{/privacy}",
      "followers_url": "https://api.github.com/users/dwtaber/followers",
      "following_url": "https://api.github.com/users/dwtaber/following{/other_user}",
      "gists_url": "https://api.github.com/users/dwtaber/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dwtaber",
      "id": 38249738,
      "login": "dwtaber",
      "node_id": "MDQ6VXNlcjM4MjQ5NzM4",
      "organizations_url": "https://api.github.com/users/dwtaber/orgs",
      "received_events_url": "https://api.github.com/users/dwtaber/received_events",
      "repos_url": "https://api.github.com/users/dwtaber/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dwtaber/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dwtaber/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dwtaber"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Looks like it's not just an issue with namespace variable notation.  The following also returns null:\r\n```powershell\r\n$Foo = [datetime]\r\nInvoke-Command -ComputerName $ComputerName {$using:Foo::Now}\r\n```",
    "created_at": "2021-09-13T23:33:12Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16019#issuecomment-918661800",
    "id": 918661800,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16019",
    "node_id": "IC_kwDOAvT7bc42waqo",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/918661800/reactions"
    },
    "updated_at": "2021-09-13T23:33:12Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/918661800",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/38249738?v=4",
      "events_url": "https://api.github.com/users/dwtaber/events{/privacy}",
      "followers_url": "https://api.github.com/users/dwtaber/followers",
      "following_url": "https://api.github.com/users/dwtaber/following{/other_user}",
      "gists_url": "https://api.github.com/users/dwtaber/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dwtaber",
      "id": 38249738,
      "login": "dwtaber",
      "node_id": "MDQ6VXNlcjM4MjQ5NzM4",
      "organizations_url": "https://api.github.com/users/dwtaber/orgs",
      "received_events_url": "https://api.github.com/users/dwtaber/received_events",
      "repos_url": "https://api.github.com/users/dwtaber/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dwtaber/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dwtaber/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dwtaber"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "WG-Remoting\r\n",
    "created_at": "2021-09-17T18:31:46Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16019#issuecomment-921999296",
    "id": 921999296,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16019",
    "node_id": "IC_kwDOAvT7bc429JfA",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/921999296/reactions"
    },
    "updated_at": "2021-09-17T18:31:46Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/921999296",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": ":tada:This issue was addressed in #16113, which has now been successfully released as `v7.3.0-preview.1`.:tada:\n\nHandy links:\n* [Release Notes](https://github.com/PowerShell/PowerShell/releases/tag/v7.3.0-preview.1)\n",
    "created_at": "2021-12-16T19:58:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16019#issuecomment-996151505",
    "id": 996151505,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16019",
    "node_id": "IC_kwDOAvT7bc47YBDR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/996151505/reactions"
    },
    "updated_at": "2021-12-16T19:58:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/996151505",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  }
]
