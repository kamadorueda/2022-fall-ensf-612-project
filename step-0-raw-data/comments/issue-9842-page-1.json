[
  {
    "author_association": "NONE",
    "body": "The easiest workaround was to set bash as my default shell then launch powershell from `~/.bashrc`:\r\n\r\n```\r\n/snap/bin/pwsh -i\r\n```\r\n\r\nBut it would still be nice if I could skip bash and use pwsh as my default shell.  Now I've got to exit out of two levels of shells and it's just a bit clunky.\r\n\r\nTo add to the initial report, SSHing with pwsh as the default shell fails, so does trying to log in from one of the other consoles (`ctrl+alt+f1` etc...) when pwsh is the default shell, but launching one of the gui terminal apps works fine.\r\n\r\nI don't know a lot of the internals of Linux but I know that ssh and logging in at a console result in a login shell but the gui terminal wouldn't be a login shell.  Is it possible that one of the files that gets run during a login like `/etc/profile` or `~/.profile` is causing an error and causing pwsh to crash/exit?",
    "created_at": "2019-06-15T19:07:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-502391792",
    "id": 502391792,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMjM5MTc5Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/502391792/reactions"
    },
    "updated_at": "2019-06-17T14:36:55Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/502391792",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "I also ran into this today, so I investigated it a bit, and figured that maybe it was a parsing error that it printed the snap output, but as it turn out `/snap/bin/pwsh` is symlinked to `/snap/bin/powershell` which is symlinked to `/usr/bin/snap`.\r\n\r\nSo my conclusion is that it is somehow related to how symlinks are processed either by the process calling `/snap/bin/powershell` or snap itself. But I don't know enough about Linux or snap to comment on that.\r\n\r\nKnowing the above it was fairly easy to work around it myself by finding the proper path to the executable, which happens to be `/snap/powershell/current/opt/powershell/pwsh\r\n`. I am not sure if that's really a stable option to run it with all of snap's redirection trickery, but it worked when I tested it out just now.",
    "created_at": "2019-08-02T14:52:33Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-517730581",
    "id": 517730581,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNzczMDU4MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517730581/reactions"
    },
    "updated_at": "2019-08-02T14:52:33Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517730581",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2789725?v=4",
      "events_url": "https://api.github.com/users/thlac/events{/privacy}",
      "followers_url": "https://api.github.com/users/thlac/followers",
      "following_url": "https://api.github.com/users/thlac/following{/other_user}",
      "gists_url": "https://api.github.com/users/thlac/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/thlac",
      "id": 2789725,
      "login": "thlac",
      "node_id": "MDQ6VXNlcjI3ODk3MjU=",
      "organizations_url": "https://api.github.com/users/thlac/orgs",
      "received_events_url": "https://api.github.com/users/thlac/received_events",
      "repos_url": "https://api.github.com/users/thlac/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/thlac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thlac/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/thlac"
    }
  },
  {
    "author_association": "NONE",
    "body": "Good find and that makes sense.  I've changed my setup once more to run tmux which then launches powershell.  It feels a bit 'wrong' having my default shell as `/bin/bash` which fires up tmux (if it's not already running) which fires up powershell, but it works reliably, even across SSHing to another host (with the same config).\r\n\r\nIf I get some time I may look at using your solution, but one of the drawbacks of having pwsh as the default shell is that the ~/.bashrc stuff doesn't get run, so things like the `grep --color=auto` alias wouldn't get set up.\r\n\r\nHere's my new config in case anyone wants a similar setup with tmux and pwsh:\r\n\r\n~/.bashrc (at the end)\r\n```bash\r\nif command -v tmux &> /dev/null && [ -n \"$PS1\" ] && [[ ! \"$TERM\" =~ screen ]] && [[ ! \"$TERM\" =~ tmux ]] && [ -z \"$TMUX\" ]; then\r\n  exec tmux\r\nelse\r\n  pwsh -i\r\n  exit\r\nfi\r\n```\r\n\r\n~/.tmux.conf\r\n```conf\r\nset-option -g default-command /snap/bin/pwsh\r\n```\r\n",
    "created_at": "2019-08-02T15:09:24Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-517736879",
    "id": 517736879,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNzczNjg3OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517736879/reactions"
    },
    "updated_at": "2019-08-02T15:09:24Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517736879",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Seems like it might be snap specific, would be good to know if PS7 (non-Snap) has the same issue.  cc @TravisEz13 ",
    "created_at": "2019-12-10T02:20:34Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-563598569",
    "id": 563598569,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2MzU5ODU2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/563598569/reactions"
    },
    "updated_at": "2019-12-10T02:20:34Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/563598569",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "NONE",
    "body": "I just spun up a new dev machine and have the same issue with Ubuntu 21.10 in WSL and powershell 7.2 installed via https://docs.microsoft.com/en-us/powershell/scripting/install/install-ubuntu?view=powershell-7.2\r\n\r\nThis is not using snap and the error is slightly different but there's a similar WSL issue [#5000](https://github.com/microsoft/WSL/issues/5000)\r\n\r\n`chsh -s /usr/bin/pwsh jon`\r\nstart a new shell:\r\n\r\n```\r\nAn error occurred mounting one of your file systems. Please run 'dmesg' for more details.\r\n: 6: export: (x86)/NVIDIA: bad variable name\r\n\r\n[process exited with code 2]\r\n```\r\n\r\nThe .bashrc and tmux workarounds I listed above both create different problems so I'd really prefer to just set pwsh as my default shell and not have to hack it.\r\n\r\n<blockquote><img src=\"https://docs.microsoft.com/media/logos/logo-powershell-social.png\" width=\"48\" align=\"right\"><div><strong><a href=\"https://docs.microsoft.com/en-us/powershell/scripting/install/install-ubuntu\">Installing PowerShell on Ubuntu - PowerShell</a></strong></div><div>Information about installing PowerShell on Ubuntu</div></blockquote>",
    "created_at": "2021-11-22T19:41:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-975858702",
    "id": 975858702,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46KmwO",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/975858702/reactions"
    },
    "updated_at": "2021-11-25T10:26:11Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/975858702",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@jonstelly Could you grab and share env variables for both (bash and pwsh) cases? Instead of pwsh you could use a simple custom application (C/C#/Rust)",
    "created_at": "2021-11-23T03:13:33Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-976125065",
    "id": 976125065,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46LnyJ",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/976125065/reactions"
    },
    "updated_at": "2021-11-25T10:26:02Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/976125065",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "Quick C# Console app I put together to dump incoming args and environment.  After launching environment/args it launches pwsh which works as expected.  It's only when pwsh is the direct shell that I get the error.\r\n\r\nOne interesting note, this only happens if I install powershell using dpkg/apt.  If I use dotnet to install powershell as a global tool then use that global tool as my shell, I do not have this issue.  `dotnet tool install -g powershell`.  I've also included below how I've installed powershell and dotnet in WSL...\r\n\r\nI'm going to try and compile powershell to see if I can debug a bit more.  \r\n\r\nC# Console App/Shell\r\n```c#\r\nvar rawArgs = Environment.GetCommandLineArgs();\r\n\r\nConsole.WriteLine(\"ARGS: {0}\\r\\nRAW ARGS: {1}\", \r\n    String.Join(\", \", args.Select(a => $\"'{a}'\")),\r\n    String.Join(\", \", rawArgs.Select(ra => $\"'{ra}'\")));\r\n\r\nvar rawEnvironmentVariables = Environment.GetEnvironmentVariables();\r\nvar environmentVariables = rawEnvironmentVariables.Keys.Cast<string>()\r\n    .ToDictionary(k => k, \r\n                  k => (string)rawEnvironmentVariables[k]);\r\nvar environmentText = String.Join(\"\\r\\n\", environmentVariables.OrderBy(ev => ev.Key)\r\n    .Select(ev => $\"\\t{ev.Key}={ev.Value}\"));\r\n\r\nConsole.WriteLine(\"ENVIRONMENT:\\r\\n{0}\", environmentText);\r\nThread.Sleep(3000);\r\ntry\r\n{\r\n    Console.WriteLine(\"LAUNCHING POWERSHELL\");\r\n    var process = Process.Start(\"pwsh\");\r\n    process.WaitForExit();\r\n    Console.WriteLine(\"FINISHED\");\r\n}\r\ncatch(Exception ex)\r\n{\r\n    Console.WriteLine(\"ERROR:\\r\\n{0}\", ex);\r\n    Thread.Sleep(3000);\r\n}\r\nfinally\r\n{\r\n    Thread.Sleep(10000);\r\n}\r\n```\r\n\r\nOutput from above:\r\n```log\r\nARGS:\r\nRAW ARGS: '/usr/local/bin/shelldump'\r\nENVIRONMENT:\r\n        DISPLAY=:0\r\n        HOME=/home/jon\r\n        HOSTTYPE=x86_64\r\n        LANG=C.UTF-8\r\n        LOGNAME=jon\r\n        NAME=Codor\r\n        PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Windows/system32:/mnt/c/Windows:/mnt/c/Windows/System32/Wbem:/mnt/c/Windows/System32/WindowsPowerShell/v1.0/:/mnt/c/Windows/System32/OpenSSH/:/mnt/c/Program Files (x86)/NVIDIA Corporation/PhysX/Common:/mnt/c/Program Files/NVIDIA Corporation/NVIDIA NvDLISR:/mnt/c/Program Files/Git/cmd:/mnt/c/Program Files/PowerShell/7/:/mnt/c/Program Files/Docker/Docker/resources/bin:/mnt/c/ProgramData/DockerDesktop/version-bin:/mnt/c/Program Files (x86)/Microsoft SQL Server/150/DTS/Binn/:/mnt/c/Program Files/Azure Data Studio/bin:/mnt/c/Users/jon/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/jon/AppData/Local/Programs/Microsoft VS Code/bin\r\n        PULSE_SERVER=/mnt/wslg/PulseServer\r\n        SHELL=/usr/local/bin/shelldump\r\n        TERM=xterm-256color\r\n        USER=jon\r\n        WAYLAND_DISPLAY=wayland-0\r\n        WSL_DISTRO_NAME=shelltests\r\n        WSL_INTEROP=/run/WSL/9203_interop\r\n        WSLENV=WT_SESSION::WT_PROFILE_ID\r\n        WT_PROFILE_ID={a20c7769-29c6-5d99-87b2-3e62578047b9}\r\n        WT_SESSION=c1d7c800-e915-433f-954c-a1f6149db7d5\r\n        XDG_RUNTIME_DIR=/mnt/wslg/runtime-dir\r\nLAUNCHING POWERSHELL\r\nPowerShell 7.2.0\r\nCopyright (c) Microsoft Corporation.\r\n\r\nhttps://aka.ms/powershell\r\nType 'help' to get help.\r\n\r\nPS /mnt/c/Users/jon> exit\r\nFINISHED\r\n```\r\n\r\nFresh Ubuntu install from Microsoft Store then:\r\n\r\n```pwsh\r\nwget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb;\r\nsudo dpkg -i ./packages-microsoft-prod.deb;\r\nsudo apt-get update; sudo apt-get install -y apt-transport-https curl;\r\nsudo apt-get install -y dotnet-sdk-6.0 aspnetcore-runtime-5.0 git git-lfs vim make gcc g++ powershell;\r\n```\r\n\r\nThen edit `/etc/shells` to add `/usr/bin/pwsh.`  I've tested setting my shell to both `/usr/bin/pwsh` and `/opt/microsoft/powershell/7/pwsh` but both throw the error mentioned above.",
    "created_at": "2021-11-24T23:20:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-978440566",
    "id": 978440566,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46UdF2",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978440566/reactions"
    },
    "updated_at": "2021-11-25T10:25:51Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978440566",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@jonstelly Thanks for your investigations! Please run `dir env:` after run pwsh from you application - key here is to compare env variables before and after. (The test application should be assigned as login shell.)",
    "created_at": "2021-11-25T03:39:32Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-978796849",
    "id": 978796849,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46V0Ex",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978796849/reactions"
    },
    "updated_at": "2021-11-25T10:25:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978796849",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "This is the output from using my c# fake shell.  I tried adding `gci env:` to my profile and tried to set pwsh as the shell again, It seems like I get the error about export before my profile executes.\r\n\r\nIt's somewhat interesting to me that the dotnet global tool works (though I can't use Start-Job with the dotnet tool) while the ubuntu package doesn't.  I just looked at the ubuntu package and I don't see anything special going on there.\r\n\r\nI've got powershell building locally and I see the same behavior when I use the local build as my shell so I'm going to try and debug further.\r\n\r\n```\r\nARGS:\r\nRAW ARGS: '/usr/local/bin/shelldump'\r\nENVIRONMENT:\r\n        DISPLAY=:0\r\n        HOME=/home/jon\r\n        HOSTTYPE=x86_64\r\n        LANG=C.UTF-8\r\n        LOGNAME=jon\r\n        NAME=Codor\r\n        PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Windows/system32:/mnt/c/Windows:/mnt/c/Windows/System32/Wbem:/mnt/c/Windows/System32/WindowsPowerShell/v1.0/:/mnt/c/Windows/System32/OpenSSH/:/mnt/c/Program Files (x86)/NVIDIA Corporation/PhysX/Common:/mnt/c/Program Files/NVIDIA Corporation/NVIDIA NvDLISR:/mnt/c/Program Files/Git/cmd:/mnt/c/Program Files/PowerShell/7/:/mnt/c/Program Files/Docker/Docker/resources/bin:/mnt/c/ProgramData/DockerDesktop/version-bin:/mnt/c/Program Files (x86)/Microsoft SQL Server/150/DTS/Binn/:/mnt/c/Program Files/Azure Data Studio/bin:/mnt/c/Users/jon/AppData/Local/Microsoft/WindowsApps:/mnt/c/Users/jon/AppData/Local/Programs/Microsoft VS Code/bin\r\n        PULSE_SERVER=/mnt/wslg/PulseServer\r\n        SHELL=/usr/local/bin/shelldump\r\n        TERM=xterm-256color\r\n        USER=jon\r\n        WAYLAND_DISPLAY=wayland-0\r\n        WSL_DISTRO_NAME=shelltests\r\n        WSL_INTEROP=/run/WSL/9362_interop\r\n        WSLENV=WT_SESSION::WT_PROFILE_ID\r\n        WT_PROFILE_ID={a20c7769-29c6-5d99-87b2-3e62578047b9}\r\n        WT_SESSION=c12862c6-898d-4ad3-9192-97acc11876d3\r\n        XDG_RUNTIME_DIR=/mnt/wslg/runtime-dir\r\nLAUNCHING POWERSHELL\r\nPowerShell 7.2.0\r\nCopyright (c) Microsoft Corporation.\r\n\r\nhttps://aka.ms/powershell\r\nType 'help' to get help.\r\n\r\nPS /mnt/c/Users/jon> gci env:\r\n\r\nName                           Value\r\n----                           -----\r\nDISPLAY                        :0\r\nHOME                           /home/jon\r\nHOSTTYPE                       x86_64\r\nLANG                           C.UTF-8\r\nLOGNAME                        jon\r\nNAME                           Codor\r\nPATH                           /opt/microsoft/powershell/7:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/wsl/lib:/mnt/c/Windows/system32:/mnt/c/Windows:/mnt/c/Windows/System32/Wbem:/mnt/c/Windows/System32/WindowsPowerShell/v1.0/:/mnt/c/Windows/System32/OpenSSH/:/mnt/c/Program Files (x86)/NVIDIA Corporation/PhysX/Common:/mnâ€¦\r\nPSModulePath                   /home/jon/.local/share/powershell/Modules:/usr/local/share/powershell/Modules:/opt/microsoft/powershell/7/Modules\r\nPULSE_SERVER                   /mnt/wslg/PulseServer\r\nSHELL                          /usr/local/bin/shelldump\r\nTERM                           xterm-256color\r\nUSER                           jon\r\nWAYLAND_DISPLAY                wayland-0\r\nWSL_DISTRO_NAME                shelltests\r\nWSL_INTEROP                    /run/WSL/9362_interop\r\nWSLENV                         WT_SESSION::WT_PROFILE_ID\r\nWT_PROFILE_ID                  {a20c7769-29c6-5d99-87b2-3e62578047b9}\r\nWT_SESSION                     c12862c6-898d-4ad3-9192-97acc11876d3\r\nXDG_RUNTIME_DIR                /mnt/wslg/runtime-dir\r\n```",
    "created_at": "2021-11-25T06:07:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-978867517",
    "id": 978867517,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46WFU9",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978867517/reactions"
    },
    "updated_at": "2021-11-25T10:25:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/978867517",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@jonstelly Really your issue is another than that and dup #12020. See https://github.com/PowerShell/PowerShell/issues/12020#issuecomment-599774853\r\n",
    "created_at": "2021-11-25T10:25:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-979068568",
    "id": 979068568,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46W2aY",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/979068568/reactions"
    },
    "updated_at": "2021-11-25T10:25:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/979068568",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "Ahhh, you got it.  Changing line 6 of `/etc/profile.d/apps-bin-path.sh` from\r\n\r\n```\r\n    export PATH=$PATH:${snap_bin_path}\r\n```\r\n\r\nto\r\n\r\n```\r\n    export PATH=\"$PATH:${snap_bin_path}\"\r\n```\r\n\r\nfixed my issue.  Thanks a lot for the help.\r\n\r\nEDIT: sed to fix apps-bin-path.sh: `sudo sed -i 's/export PATH=$PATH:${snap_bin_path}/export PATH=\\\"$PATH:${snap_bin_path}\\\"/g' /etc/profile.d/apps-bin-path.sh`",
    "created_at": "2021-11-25T16:01:10Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9842#issuecomment-979325295",
    "id": 979325295,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9842",
    "node_id": "IC_kwDOAvT7bc46X1Fv",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/979325295/reactions"
    },
    "updated_at": "2021-11-26T20:33:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/979325295",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/967068?v=4",
      "events_url": "https://api.github.com/users/jonstelly/events{/privacy}",
      "followers_url": "https://api.github.com/users/jonstelly/followers",
      "following_url": "https://api.github.com/users/jonstelly/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonstelly/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jonstelly",
      "id": 967068,
      "login": "jonstelly",
      "node_id": "MDQ6VXNlcjk2NzA2OA==",
      "organizations_url": "https://api.github.com/users/jonstelly/orgs",
      "received_events_url": "https://api.github.com/users/jonstelly/received_events",
      "repos_url": "https://api.github.com/users/jonstelly/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jonstelly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonstelly/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jonstelly"
    }
  }
]
