[
  {
    "author_association": "NONE",
    "body": "How does powershell behave on Windows? Is there any tool like strace for Windows?",
    "created_at": "2019-04-25T08:05:31Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-486563391",
    "id": 486563391,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NjU2MzM5MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486563391/reactions"
    },
    "updated_at": "2019-04-25T08:05:31Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486563391",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  },
  {
    "author_association": "NONE",
    "body": "@krystian-wojtas PowerShell Core is a C# project that use DotNet Core VM.",
    "created_at": "2019-04-25T18:44:16Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-486792506",
    "id": 486792506,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njc5MjUwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486792506/reactions"
    },
    "updated_at": "2019-04-25T18:44:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486792506",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6187529?v=4",
      "events_url": "https://api.github.com/users/fMichaleczek/events{/privacy}",
      "followers_url": "https://api.github.com/users/fMichaleczek/followers",
      "following_url": "https://api.github.com/users/fMichaleczek/following{/other_user}",
      "gists_url": "https://api.github.com/users/fMichaleczek/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/fMichaleczek",
      "id": 6187529,
      "login": "fMichaleczek",
      "node_id": "MDQ6VXNlcjYxODc1Mjk=",
      "organizations_url": "https://api.github.com/users/fMichaleczek/orgs",
      "received_events_url": "https://api.github.com/users/fMichaleczek/received_events",
      "repos_url": "https://api.github.com/users/fMichaleczek/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/fMichaleczek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fMichaleczek/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/fMichaleczek"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "PowerShell is based on managed code that requires more resources to initialize than native code.\r\nPowerShell works with _objects_ that requires more resources.\r\nYou could use `-NoInteractive` and -`NoProfile` switches in your tests.\r\n\r\n> How does powershell behave on Windows?\r\n\r\nIt is the same code on 99%.\r\n\r\n> Is there any tool like strace for Windows?\r\n\r\nWe use portable PerfView.\r\n\r\nOf course, we are all interested in having the best performance. We are constantly improving something. \r\nThe best way is to improve specific scenarios and not \"all at once\". ",
    "created_at": "2019-04-26T07:01:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-486949471",
    "id": 486949471,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njk0OTQ3MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486949471/reactions"
    },
    "updated_at": "2019-04-26T07:01:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486949471",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "@iSazonov  thank you for your answer.\r\n\r\nWith both these flags there is NOT any improvement.\r\n```\r\n% strace -yyf pwsh -NonInteractive -NoProfile -Command \"echo hello world\" 2>&1 | wc -l\r\n118766\r\n% strace -yyf pwsh -NonInteractive -NoProfile -Command \"echo hello world\" 2>&1 | wc -l\r\n118670\r\n% strace -yyf pwsh -NonInteractive -NoProfile -Command \"echo hello world\" 2>&1 | wc -l\r\n118524\r\n```\r\n\r\nStill number of system calls varies, still it is huge amount of them. And there are still 16 extra threads\r\n```\r\n% strace -yyf pwsh -NonInteractive -NoProfile -Command \"echo hello world\" 2>&1 | grep '^\\[pid' powershell-hello-strace.log | tr -s ' ' | cut -d' ' -f 2 | sort -u | wc -l\r\n16\r\n```\r\n\r\nI see there is not any possible option to configure how many threads powershell creates and even for \"hello world\" example program it needs around 16. Then strace output is not reproducible. Amount of system calls it makes is huge which makes it much harder to debug on this level.",
    "created_at": "2019-04-26T07:43:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-486960944",
    "id": 486960944,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njk2MDk0NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486960944/reactions"
    },
    "updated_at": "2019-04-26T07:43:22Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486960944",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> makes it much harder to debug on this level\r\n\r\nAs I mentioned above - The best way is to improve _specific_ scenarios and not \"all at once\".\r\nIt is possible that there are problems, but they can only be identified in the measurements of specific scenarios.\r\n\r\nPowerShell is thread-based application vs bash is process-based.\r\nPowerShell does all script processing in threads - \"runspaces\" and has some temporary treads (ex. for cmdlet name cache).",
    "created_at": "2019-04-26T07:58:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-486965171",
    "id": 486965171,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njk2NTE3MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486965171/reactions"
    },
    "updated_at": "2019-04-26T07:58:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/486965171",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "## Java\r\n\r\n@iSazonov thank you for your reply.\r\n\r\n> PowerShell is thread-based application vs bash is process-based.\r\n\r\nI made one more check how java looks like in this comparison. Java is also thread based, so it is much more similar virtual machine. There are dedicated threads about garbage collector, just in time compilation and some others.\r\n\r\nIt is run on the same system as before. Java which I'm using is\r\n```\r\n% java --version\r\nopenjdk 11.0.2 2019-01-15\r\nOpenJDK Runtime Environment (build 11.0.2+9-Ubuntu-3ubuntu118.04.3)\r\nOpenJDK 64-Bit Server VM (build 11.0.2+9-Ubuntu-3ubuntu118.04.3, mixed mode, sharing)\r\n```\r\n\r\nSource code for hello world is this one\r\nhttps://introcs.cs.princeton.edu/java/11hello/HelloWorld.java.html\r\n\r\nAmount of system calls is also big and it varies. But still it is 35-50 times less then powershell.\r\n```\r\n% strace -yyf java HelloWorld |& wc -l\r\n2904\r\n% strace -yyf java HelloWorld |& wc -l\r\n2931\r\n% strace -yyf java HelloWorld |& wc -l\r\n2934\r\n```\r\n\r\nLog from strace session\r\n```\r\n% strace -yyf java HelloWorld |& cat > java-hello-strace.log\r\n```\r\n[java-hello-strace.log](https://github.com/PowerShell/PowerShell/files/3147271/java-hello-strace.log)\r\n\r\nThere is also lots of threads\r\n```\r\n% cat java-hello-strace.log | grep '^\\[pid' | tr -s ' ' | cut -d' ' -f 2 | sort -u | wc -l\r\n12\r\n```\r\n\r\nThere is also some sched_yield system call invocations\r\n```\r\n% cat java-hello-strace.log | grep sched_yield | wc -l\r\n281\r\n```\r\n\r\nBut there is less of them and it is only 9% of all of them.\r\n```\r\n% echo $(( 100 * 281 / 2878 ))\r\n9\r\n```\r\n",
    "created_at": "2019-05-06T09:17:41Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-489557996",
    "id": 489557996,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTU1Nzk5Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489557996/reactions"
    },
    "updated_at": "2019-05-06T09:57:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489557996",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  },
  {
    "author_association": "NONE",
    "body": "# Native linux\r\nIt is run also under another computer with native linux.\r\n```\r\n% lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 18.04.2 LTS\r\nRelease:        18.04\r\nCodename:       bionic\r\n```\r\n\r\n```\r\n% uname -a\r\nLinux k-HP-Z620 4.15.0-48-generic #51-Ubuntu SMP Wed Apr 3 08:28:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n```\r\n% pwsh --version\r\nPowerShell 6.2.0\r\n```\r\n\r\n```\r\n% java --version\r\nopenjdk 11.0.2 2019-01-15\r\nOpenJDK Runtime Environment (build 11.0.2+9-Ubuntu-3ubuntu118.04.3)\r\nOpenJDK 64-Bit Server VM (build 11.0.2+9-Ubuntu-3ubuntu118.04.3, mixed mode, sharing)\r\n```\r\n\r\n```\r\n% lscpu | grep -i 'model name'\r\nModel name:          Intel(R) Xeon(R) CPU E5-2630 v2 @ 2.60GHz\r\n```\r\n\r\n```\r\n% nproc\r\n12\r\n```\r\n\r\n## Strace\r\n\r\n### Java\r\n\r\nCollect strace log\r\n```\r\n% strace -yyf java HelloWorld |& > java-hello-strace-native.log\r\n```\r\n[java-hello-strace-native.log](https://github.com/PowerShell/PowerShell/files/3147486/java-hello-strace-native.log)\r\n\r\nHow many threads?\r\n```\r\n% cat java-hello-strace-native.log | grep '^\\[pid' | tr -s ' ' | cut -d' ' -f 2 | sort -u | wc -l\r\n17\r\n```\r\n\r\nHow many sched_yield invocations?\r\n```\r\n% cat java-hello-strace-native.log | grep sched_yield | wc -l\r\n6\r\n```\r\n\r\nHow many system calls in total?\r\n```\r\n% cat java-hello-strace-native.log | wc -l\r\n3904\r\n```\r\n\r\n### Powershell\r\n\r\nCollect strace log\r\n```\r\n% strace -yyf pwsh -Command \"echo 'hello world'\" |& > pwsh-hello-strace-native.log\r\n```\r\n[pwsh-hello-strace-native.log](https://github.com/PowerShell/PowerShell/files/3147501/pwsh-hello-strace-native.log)\r\n\r\nHow many threads?\r\n```\r\n% cat pwsh-hello-strace-native.log | grep '^\\[pid' | tr -s ' ' | cut -d' ' -f 2 | sort -u | wc -l\r\n26\r\n```\r\n\r\nHow many sched_yield invocations?\r\n```\r\n% cat pwsh-hello-strace-native.log | grep sched_yield | wc -l\r\n5301\r\n```\r\n\r\nHow many system calls in total?\r\n```\r\n% cat pwsh-hello-strace-native.log | wc -l\r\n33924\r\n```\r\n\r\n## Performance\r\n\r\n### Java\r\n\r\nJava first run\r\n```\r\n% sudo perf stat java HelloWorld\r\nHello, World\r\n\r\n Performance counter stats for 'java HelloWorld':\r\n\r\n        218,575135      task-clock (msec)         #    0,163 CPUs utilized\r\n             1 860      context-switches          #    0,009 M/sec\r\n                25      cpu-migrations            #    0,114 K/sec\r\n             3 414      page-faults               #    0,016 M/sec\r\n       311 361 354      cycles                    #    1,425 GHz\r\n       220 172 909      stalled-cycles-frontend   #   70,71% frontend cycles idle\r\n       191 641 901      instructions              #    0,62  insn per cycle\r\n                                                  #    1,15  stalled cycles per insn\r\n        35 991 275      branches                  #  164,663 M/sec\r\n         2 547 576      branch-misses             #    7,08% of all branches\r\n\r\n       1,341223409 seconds time elapsed\r\n```\r\n\r\nFew next runs when files are in system cache\r\n```\r\n% sudo perf stat java HelloWorld\r\nHello, World\r\n\r\n Performance counter stats for 'java HelloWorld':\r\n\r\n        109,256992      task-clock (msec)         #    1,527 CPUs utilized\r\n               317      context-switches          #    0,003 M/sec\r\n                 7      cpu-migrations            #    0,064 K/sec\r\n             3 283      page-faults               #    0,030 M/sec\r\n       266 656 743      cycles                    #    2,441 GHz\r\n       190 988 605      stalled-cycles-frontend   #   71,62% frontend cycles idle\r\n       166 592 657      instructions              #    0,62  insn per cycle\r\n                                                  #    1,15  stalled cycles per insn\r\n        31 431 579      branches                  #  287,685 M/sec\r\n         1 725 313      branch-misses             #    5,49% of all branches\r\n\r\n       0,071549034 seconds time elapsed\r\n```\r\n\r\n```\r\n% sudo perf stat java HelloWorld\r\nHello, World\r\n\r\n Performance counter stats for 'java HelloWorld':\r\n\r\n         82,728425      task-clock (msec)         #    1,494 CPUs utilized\r\n               281      context-switches          #    0,003 M/sec\r\n                 6      cpu-migrations            #    0,073 K/sec\r\n             3 274      page-faults               #    0,040 M/sec\r\n       209 482 850      cycles                    #    2,532 GHz\r\n       131 410 418      stalled-cycles-frontend   #   62,73% frontend cycles idle\r\n       163 661 668      instructions              #    0,78  insn per cycle\r\n                                                  #    0,80  stalled cycles per insn\r\n        31 014 649      branches                  #  374,897 M/sec\r\n         1 608 323      branch-misses             #    5,19% of all branches\r\n\r\n       0,055380206 seconds time elapsed\r\n```\r\n\r\n### Powershell\r\n\r\nPowershell first run\r\n```\r\n% sudo perf stat pwsh -Command \"echo 'hello world'\"\r\nhello world\r\n\r\n Performance counter stats for 'pwsh -Command echo 'hello world'':\r\n\r\n       1293,223998      task-clock (msec)         #    0,247 CPUs utilized\r\n             1 591      context-switches          #    0,001 M/sec\r\n                23      cpu-migrations            #    0,018 K/sec\r\n            20 793      page-faults               #    0,016 M/sec\r\n     2 440 703 392      cycles                    #    1,887 GHz\r\n     1 451 945 321      stalled-cycles-frontend   #   59,49% frontend cycles idle\r\n     2 340 749 195      instructions              #    0,96  insn per cycle\r\n                                                  #    0,62  stalled cycles per insn\r\n       474 724 523      branches                  #  367,086 M/sec\r\n        17 476 292      branch-misses             #    3,68% of all branches\r\n\r\n       5,242548280 seconds time elapsed\r\n```\r\n\r\nFew next runs when files are in system cache\r\n```\r\n% sudo perf stat pwsh -Command \"echo 'hello world'\"\r\nhello world\r\n\r\n Performance counter stats for 'pwsh -Command echo 'hello world'':\r\n\r\n        742,991858      task-clock (msec)         #    1,183 CPUs utilized\r\n             1 273      context-switches          #    0,002 M/sec\r\n                42      cpu-migrations            #    0,057 K/sec\r\n            14 976      page-faults               #    0,020 M/sec\r\n     1 866 315 732      cycles                    #    2,512 GHz\r\n     1 096 937 268      stalled-cycles-frontend   #   58,78% frontend cycles idle\r\n     1 851 600 765      instructions              #    0,99  insn per cycle\r\n                                                  #    0,59  stalled cycles per insn\r\n       378 474 349      branches                  #  509,392 M/sec\r\n        11 117 425      branch-misses             #    2,94% of all branches\r\n\r\n       0,628091604 seconds time elapsed\r\n```\r\n\r\n```\r\n% sudo perf stat pwsh -Command \"echo 'hello world'\"\r\nhello world\r\n\r\n Performance counter stats for 'pwsh -Command echo 'hello world'':\r\n\r\n        692,912917      task-clock (msec)         #    1,133 CPUs utilized\r\n             1 228      context-switches          #    0,002 M/sec\r\n                21      cpu-migrations            #    0,030 K/sec\r\n            14 229      page-faults               #    0,021 M/sec\r\n     1 751 912 695      cycles                    #    2,528 GHz\r\n     1 012 754 466      stalled-cycles-frontend   #   57,81% frontend cycles idle\r\n     1 784 514 675      instructions              #    1,02  insn per cycle\r\n                                                  #    0,57  stalled cycles per insn\r\n       365 886 615      branches                  #  528,041 M/sec\r\n        10 458 089      branch-misses             #    2,86% of all branches\r\n\r\n       0,611509978 seconds time elapsed\r\n```\r\n\r\n```\r\n% sudo perf stat pwsh -Command \"echo 'hello world'\"\r\nhello world\r\n\r\n Performance counter stats for 'pwsh -Command echo 'hello world'':\r\n\r\n        677,662891      task-clock (msec)         #    1,107 CPUs utilized\r\n             1 019      context-switches          #    0,002 M/sec\r\n                29      cpu-migrations            #    0,043 K/sec\r\n            13 454      page-faults               #    0,020 M/sec\r\n     1 704 233 733      cycles                    #    2,515 GHz\r\n       968 482 404      stalled-cycles-frontend   #   56,83% frontend cycles idle\r\n     1 777 828 115      instructions              #    1,04  insn per cycle\r\n                                                  #    0,54  stalled cycles per insn\r\n       364 512 040      branches                  #  537,896 M/sec\r\n        10 355 171      branch-misses             #    2,84% of all branches\r\n\r\n       0,612216334 seconds time elapsed\r\n```\r\n\r\n### Results\r\nThere is some performance penalty using so many sched_yield invocations.\r\n\r\nPowershell needs about 10 times more instructions and 5 times more context switches. Then it is about 10 times slower then java.\r\n\r\nI believe that this is quite important issue in powershell virtual machine. Could it be somehow fixed?",
    "created_at": "2019-05-06T10:33:47Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-489576066",
    "id": 489576066,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTU3NjA2Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489576066/reactions"
    },
    "updated_at": "2019-05-06T10:33:47Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489576066",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  },
  {
    "author_association": "NONE",
    "body": "Previously I ommited compilation time of java program. Sorry for that.\r\n\r\n# Performance\r\n\r\n## Java with compilation\r\n\r\nFirst run\r\n```\r\n% sudo perf stat sh -c 'javac HelloWorld.java && java HelloWorld'\r\nHello, World\r\n\r\n Performance counter stats for 'sh -c javac HelloWorld.java && java HelloWorld':\r\n\r\n       1934,083252      task-clock (msec)         #    0,720 CPUs utilized\r\n             3 754      context-switches          #    0,002 M/sec\r\n                40      cpu-migrations            #    0,021 K/sec\r\n            15 421      page-faults               #    0,008 M/sec\r\n     4 295 935 619      cycles                    #    2,221 GHz\r\n     2 340 140 912      stalled-cycles-frontend   #   54,47% frontend cycles idle\r\n     4 371 066 081      instructions              #    1,02  insn per cycle\r\n                                                  #    0,54  stalled cycles per insn\r\n       831 213 214      branches                  #  429,771 M/sec\r\n        41 530 640      branch-misses             #    5,00% of all branches\r\n\r\n       2,686253163 seconds time elapsed\r\n```\r\n\r\nFew next runs when files are in system cache\r\n```\r\n% sudo perf stat sh -c 'javac HelloWorld.java && java HelloWorld'\r\nHello, World\r\n\r\n Performance counter stats for 'sh -c javac HelloWorld.java && java HelloWorld':\r\n\r\n       1662,112922      task-clock (msec)         #    2,328 CPUs utilized\r\n             1 825      context-switches          #    0,001 M/sec\r\n                23      cpu-migrations            #    0,014 K/sec\r\n            16 382      page-faults               #    0,010 M/sec\r\n     4 222 391 572      cycles                    #    2,540 GHz\r\n     2 257 009 042      stalled-cycles-frontend   #   53,45% frontend cycles idle\r\n     4 371 405 238      instructions              #    1,04  insn per cycle\r\n                                                  #    0,52  stalled cycles per insn\r\n       830 870 728      branches                  #  499,888 M/sec\r\n        41 293 497      branch-misses             #    4,97% of all branches\r\n\r\n       0,713925635 seconds time elapsed\r\n```\r\n\r\n```\r\n% sudo perf stat sh -c 'javac HelloWorld.java && java HelloWorld'\r\nHello, World\r\n\r\n Performance counter stats for 'sh -c javac HelloWorld.java && java HelloWorld':\r\n\r\n       1697,702963      task-clock (msec)         #    2,263 CPUs utilized\r\n             2 096      context-switches          #    0,001 M/sec\r\n                31      cpu-migrations            #    0,018 K/sec\r\n            16 087      page-faults               #    0,009 M/sec\r\n     4 314 269 417      cycles                    #    2,541 GHz\r\n     2 456 668 682      stalled-cycles-frontend   #   56,94% frontend cycles idle\r\n     4 149 860 073      instructions              #    0,96  insn per cycle\r\n                                                  #    0,59  stalled cycles per insn\r\n       792 818 277      branches                  #  466,995 M/sec\r\n        39 967 113      branch-misses             #    5,04% of all branches\r\n\r\n       0,750193753 seconds time elapsed\r\n```\r\n\r\nNow java executes much more instructions. Around 2 times more. And it is slower.\r\n\r\n# Strace\r\n\r\nCollect strace log\r\n```\r\n% strace -yyf sh -c 'javac HelloWorld.java && java HelloWorld' |& > java-hello-strace-native-full.log\r\n```\r\n[java-hello-strace-native-full.log](https://github.com/PowerShell/PowerShell/files/3147841/java-hello-strace-native-full.log)\r\n\r\nThere are much more threads. But there are collected system call logs from 3 processes in total: javac, java and sh.\r\n```\r\n% cat java-hello-strace-native-full.log | grep '^\\[pid' | tr -s ' ' | cut -d' ' -f 2 | sort -u | wc -l\r\n40\r\n```\r\n\r\nHow many sched_yield invocations?\r\n```\r\n% cat java-hello-strace-native-full.log | grep sched_yield | wc -l\r\n84\r\n```\r\n\r\nPoint is still valid that powershell uses so many sched_yield system calls and java proved that there are not needed so many of them.",
    "created_at": "2019-05-06T12:28:17Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-489602609",
    "id": 489602609,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTYwMjYwOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489602609/reactions"
    },
    "updated_at": "2019-05-06T12:28:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489602609",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@krystian-wojtas PowerShell is an application based on .Net Core and C#. Your comparison is incorrect. You should compare C# and Java (\"Hello World\") or PowerShell and an similar application on Java.",
    "created_at": "2019-05-06T13:53:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-489628720",
    "id": 489628720,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTYyODcyMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489628720/reactions"
    },
    "updated_at": "2019-05-06T13:53:40Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489628720",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "@iSazonov my investigation is finished in this point :) Thank you for your answers.",
    "created_at": "2019-05-06T14:16:50Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9462#issuecomment-489637069",
    "id": 489637069,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9462",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTYzNzA2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489637069/reactions"
    },
    "updated_at": "2019-05-06T14:16:50Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/489637069",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1277710?v=4",
      "events_url": "https://api.github.com/users/krystian-wojtas/events{/privacy}",
      "followers_url": "https://api.github.com/users/krystian-wojtas/followers",
      "following_url": "https://api.github.com/users/krystian-wojtas/following{/other_user}",
      "gists_url": "https://api.github.com/users/krystian-wojtas/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/krystian-wojtas",
      "id": 1277710,
      "login": "krystian-wojtas",
      "node_id": "MDQ6VXNlcjEyNzc3MTA=",
      "organizations_url": "https://api.github.com/users/krystian-wojtas/orgs",
      "received_events_url": "https://api.github.com/users/krystian-wojtas/received_events",
      "repos_url": "https://api.github.com/users/krystian-wojtas/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/krystian-wojtas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krystian-wojtas/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/krystian-wojtas"
    }
  }
]
