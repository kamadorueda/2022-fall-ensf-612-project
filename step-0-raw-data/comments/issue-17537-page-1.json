[
  {
    "author_association": "NONE",
    "body": "There is a difference in the filter behaviour\r\n\r\nOn **PS 5** using a simplified version of your code\r\n``` \r\nPS > $pfPaths = 'C:\\Program Files*\\', 'C:\\Windows\\'\r\nPS > $result2 = Get-ChildItem -Path $PFPaths -Recurse -Filter '*.dll' -ErrorAction SilentlyContinue\r\nPS > $result2.Count\r\n40471\r\nPS > $result2.where({$_.Extension -eq \".dll\"}).count\r\n40061\r\n```\r\nYou can see files where the 8.3 name ends .DLL but the normal extension doesn't using    ~\r\n`$result2.where({$_.Extension -ne\".dll\"})`\r\n\r\non **ps 7**\r\n```\r\nPS> $result2 = Get-ChildItem -Path $PFPaths -Recurse -Filter '*.dll' -ErrorAction SilentlyContinue\r\nPS> $result2.count\r\n40061\r\n```\r\n`C:\\Program Files*\\`  will not always process they way you want to  The extra step below is needed to work round that \r\n```\r\n $result3 = (get-item $pfpaths | Get-ChildItem -Recurse -ErrorAction SilentlyContinue -file).where({$_.Extension -eq \".dll\"})\r\n```\r\nreturns 40061 items in 25 seconds on PowerShell 5 and \r\nand 40061 items in 16 seconds on PowerShell 7  (obviously there are some machine specifics and variation from run to run) \r\n\r\nThat I thought the version information was slowing things down but \r\n```\r\nPS> $result3 | Where {$_.VersionInfo.ProductVersion -or $_.VersionInfo.FileVersion}   | measure\r\n```\r\n\r\nGot  28548  items in 12 seconds on both PowerShell 7 and 5 \r\n\r\n\r\n\r\n\r\n\r\n",
    "created_at": "2022-06-18T14:57:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17537#issuecomment-1159478743",
    "id": 1159478743,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17537",
    "node_id": "IC_kwDOAvT7bc5FHD3X",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1159478743/reactions"
    },
    "updated_at": "2022-06-18T14:57:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1159478743",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/16209593?v=4",
      "events_url": "https://api.github.com/users/jhoneill/events{/privacy}",
      "followers_url": "https://api.github.com/users/jhoneill/followers",
      "following_url": "https://api.github.com/users/jhoneill/following{/other_user}",
      "gists_url": "https://api.github.com/users/jhoneill/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jhoneill",
      "id": 16209593,
      "login": "jhoneill",
      "node_id": "MDQ6VXNlcjE2MjA5NTkz",
      "organizations_url": "https://api.github.com/users/jhoneill/orgs",
      "received_events_url": "https://api.github.com/users/jhoneill/received_events",
      "repos_url": "https://api.github.com/users/jhoneill/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jhoneill/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jhoneill/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jhoneill"
    }
  },
  {
    "author_association": "NONE",
    "body": "@jhoneill  Thanks for those examples. I can see where some confusion lies in the way things are processed.\r\n\r\nI put those examples into the attached script, there is a difference in times (Agreed it is machine specific) but PS7 is a lot slower? That said the second method is faster than the first for PS7 and slower for PS5\r\n\r\nAlso, in the two methods we end up with a difference of 1 item in PS7 & PS5\r\n\r\nThe reason for this is that hall.dll is a directory not a file. So, I do need to add the -file parameter anyway but then I get a large difference in numbers: \r\n\r\nResult2 Numbers\r\n52403\r\nResult2 eq dll\r\n52003\r\nResult2 ne dll\r\n400\r\n\r\nI will continue to work on things. and ensure I only get files and not directories.\r\n\r\nIs there any reason why PS7 should be taking longer?\r\n\r\n=======================================\r\nPS 7\r\nS:\\DirTest\\Get-Dll-Test_1.ps1\r\nResult2 Starting\r\n\r\nDays              : 0\r\nHours             : 0\r\nMinutes           : 3\r\nSeconds           : 1\r\nMilliseconds      : 954\r\nTicks             : 1819542415\r\nTotalDays         : 0.00210595186921296\r\nTotalHours        : 0.0505428448611111\r\nTotalMinutes      : 3.03257069166667\r\nTotalSeconds      : 181.9542415\r\nTotalMilliseconds : 181954.2415\r\n\r\nResult2 Numbers\r\n62125\r\nResult2 eq dll\r\n62125\r\nResult2 ne dll\r\n0\r\n\r\nResult3 Starting\r\nDays              : 0\r\nHours             : 0\r\nMinutes           : 2\r\nSeconds           : 1\r\nMilliseconds      : 329\r\nTicks             : 1213299042\r\nTotalDays         : 0.00140428129861111\r\nTotalHours        : 0.0337027511666667\r\nTotalMinutes      : 2.02216507\r\nTotalSeconds      : 121.3299042\r\nTotalMilliseconds : 121329.9042\r\n\r\nResult3 Numbers\r\n62124\r\nResult3 eq dll\r\n62124\r\nResult3 ne dll\r\n0\r\nInputObject   : C:\\Program Files (x86)\\Windows Kits\\10\\Debuggers\\x64\\sym\\hal.dll\r\nSideIndicator : <=\r\n\r\n=======================================\r\nPS 5\r\nPS C:\\> S:\\DirTest\\Get-Dll-Test_1.ps1\r\nResult2 Starting\r\n\r\nDays              : 0\r\nHours             : 0\r\nMinutes           : 1\r\nSeconds           : 7\r\nMilliseconds      : 306\r\nTicks             : 673068861\r\nTotalDays         : 0.000779014885416667\r\nTotalHours        : 0.01869635725\r\nTotalMinutes      : 1.121781435\r\nTotalSeconds      : 67.3068861\r\nTotalMilliseconds : 67306.8861\r\n\r\nResult2 Numbers\r\n62529\r\nResult2 eq dll\r\n62125\r\nResult2 ne dll\r\n404\r\n\r\nResult3 Starting\r\nDays              : 0\r\nHours             : 0\r\nMinutes           : 1\r\nSeconds           : 38\r\nMilliseconds      : 555\r\nTicks             : 985551129\r\nTotalDays         : 0.00114068417708333\r\nTotalHours        : 0.02737642025\r\nTotalMinutes      : 1.642585215\r\nTotalSeconds      : 98.5551129\r\nTotalMilliseconds : 98555.1129\r\n\r\nResult3 Numbers\r\n62124\r\nResult3 eq dll\r\n62124\r\nResult3 ne dll\r\n0\r\n\r\nThe compare in PS5 was taking too long - I gave up waiting. In fact I think it was hanging lots of CPU so I killed the task.\r\n\r\n[Get-Dll-Test_1.zip](https://github.com/PowerShell/PowerShell/files/8933975/Get-Dll-Test_1.zip)\r\n\r\n\r\n",
    "created_at": "2022-06-18T16:52:41Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17537#issuecomment-1159514454",
    "id": 1159514454,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17537",
    "node_id": "IC_kwDOAvT7bc5FHMlW",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1159514454/reactions"
    },
    "updated_at": "2022-06-18T16:52:41Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1159514454",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/60707705?v=4",
      "events_url": "https://api.github.com/users/RG255/events{/privacy}",
      "followers_url": "https://api.github.com/users/RG255/followers",
      "following_url": "https://api.github.com/users/RG255/following{/other_user}",
      "gists_url": "https://api.github.com/users/RG255/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/RG255",
      "id": 60707705,
      "login": "RG255",
      "node_id": "MDQ6VXNlcjYwNzA3NzA1",
      "organizations_url": "https://api.github.com/users/RG255/orgs",
      "received_events_url": "https://api.github.com/users/RG255/received_events",
      "repos_url": "https://api.github.com/users/RG255/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/RG255/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RG255/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/RG255"
    }
  },
  {
    "author_association": "NONE",
    "body": "So, I have found the quickest way so far is shown below but the exercise has been useful thanks for your help.\r\n\r\n(if there is a better way then please advise)\r\n\r\n  function Get-Dll\r\n  {\r\n    param\r\n    (\r\n      [System.IO.FileSystemInfo]\r\n      [Parameter(Mandatory = $True, ValueFromPipeline = $True, HelpMessage = 'Data to filter')]\r\n      $InputObject\r\n    )\r\n    process\r\n    {\r\n      if ($InputObject.extension -eq '.dll' -and ($InputObject.VersionInfo.ProductVersion -or $InputObject.VersionInfo.FileVersion))\r\n      {\r\n        $Result = [Ordered]@{\r\n          Name            = $InputObject.Name\r\n          ProductVersion  = $InputObject.VersionInfo.ProductVersion\r\n          FileVersion     = $InputObject.VersionInfo.FileVersion\r\n          FileDescription = $InputObject.VersionInfo.FileDescription\r\n          FullName        = $InputObject.FullName\r\n        }\r\n        New-Object -TypeName PSObject -Property $Result\r\n      }\r\n    }\r\n  }\r\n$PFPaths = 'C:\\Program Files*\\', 'C:\\Windows\\'\r\n$DLLs=(Get-Item -Path $PFPaths |\r\n    Get-ChildItem -Recurse -ErrorAction SilentlyContinue -File |\r\n    Get-Dll)",
    "created_at": "2022-06-23T14:57:24Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/17537#issuecomment-1164516208",
    "id": 1164516208,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/17537",
    "node_id": "IC_kwDOAvT7bc5FaRtw",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1164516208/reactions"
    },
    "updated_at": "2022-06-23T14:57:24Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1164516208",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/60707705?v=4",
      "events_url": "https://api.github.com/users/RG255/events{/privacy}",
      "followers_url": "https://api.github.com/users/RG255/followers",
      "following_url": "https://api.github.com/users/RG255/following{/other_user}",
      "gists_url": "https://api.github.com/users/RG255/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/RG255",
      "id": 60707705,
      "login": "RG255",
      "node_id": "MDQ6VXNlcjYwNzA3NzA1",
      "organizations_url": "https://api.github.com/users/RG255/orgs",
      "received_events_url": "https://api.github.com/users/RG255/received_events",
      "repos_url": "https://api.github.com/users/RG255/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/RG255/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RG255/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/RG255"
    }
  }
]
