[
  {
    "author_association": "NONE",
    "body": "By replacing the code:\r\n\r\nIf ($PSEdition -Eq 'Core' -And $PSVersionTable.PSVersion.ToString() -Like '7.*') {\r\n    $ReferencedAssemblies = 'System.Management.Automation.dll','System.Drawing.dll','PresentationFramework.dll','PresentationCore.dll','WindowsBase.dll','System.Xaml.dll'\r\n} ElseIf ($PSEdition -Eq 'Desktop' -And $PSVersionTable.PSVersion.ToString() -Like '5.1.*') {\r\n    $ReferencedAssemblies = 'System.Management.Automation.dll','System.Drawing.dll','WPF\\PresentationFramework.dll','WPF\\PresentationCore.dll','WPF\\WindowsBase.dll','System.Xaml.dll'\r\n} Else {\r\n    Throw 'Unsupported PowerShell version.'\r\n}\r\n\r\nwithin the Steps to reproduce section by:\r\n\r\nIf ($PSVersionTable.PSVersion.ToString() -Like '7.0.*') {\r\n    $ReferencedAssemblies = 'System.Management.Automation.dll','System.Drawing.dll','PresentationFramework.dll','PresentationCore.dll','WindowsBase.dll','System.Xaml.dll'\r\n} ElseIf ($PSVersionTable.PSVersion.ToString() -Like '7.1.*') {\r\n    $PwshPath = Split-Path -Parent (Get-Command -Name pwsh.exe).Path\r\n    $ReferencedAssemblies = \"$PwshPath\\System.Management.Automation.dll\",\"$PwshPath\\System.Drawing.dll\",\"$PwshPath\\PresentationFramework.dll\",\"$PwshPath\\PresentationCore.dll\",\"$PwshPath\\WindowsBase.dll\",\"$PwshPath\\System.Xaml.dll\"\r\n} ElseIf ($PSVersionTable.PSVersion.ToString() -Like '5.1.*') {\r\n    $ReferencedAssemblies = 'System.Management.Automation.dll','System.Drawing.dll','WPF\\PresentationFramework.dll','WPF\\PresentationCore.dll','WPF\\WindowsBase.dll','System.Xaml.dll'\r\n} Else {\r\n    Throw 'Unsupported PowerShell version.'\r\n}\r\nAdd-Type -ReferencedAssemblies $ReferencedAssemblies -TypeDefinition @\"\r\n\r\nseems to allow the code to complete successfully and allows dm3ll3n / AnyBox from GitHub to work as expected against PowerShell versions 5.1, 7.03 and 7.1. I haven’t installed PowerShell 7.2 but I would guess similar code to that used for 7.1 may be required.\r\n\r\nWhether or not I should have to fully qualify the paths for the referenced assemblies for PowerShell version 7.1 isn’t clear to me. The documentation for Add-Type indicates that Add-Type looks for assemblies in a ref folder under the folder that contains pwsh.dll. However, this does not contain System.Management.Automation.dll but this is included within the folder that contains pwsh.dll. The documentation also indicates that the default .NET assemblies are no longer included by default from PowerShell 6 but I don’t have to fully qualify the assemblies for version 7.0. So, I’m a bit confused (nothing new there). Anyway, I thought I would post my findings so that changes could be made, if necessary. In the meantime, I’m happy because I’ve got something I can continue testing my scripts against PowerShell 7.1 with.\r\n",
    "created_at": "2020-11-20T15:02:53Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14096#issuecomment-731221468",
    "id": 731221468,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14096",
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTIyMTQ2OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/731221468/reactions"
    },
    "updated_at": "2020-11-20T15:02:53Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/731221468",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/38719687?v=4",
      "events_url": "https://api.github.com/users/IanBAdams/events{/privacy}",
      "followers_url": "https://api.github.com/users/IanBAdams/followers",
      "following_url": "https://api.github.com/users/IanBAdams/following{/other_user}",
      "gists_url": "https://api.github.com/users/IanBAdams/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/IanBAdams",
      "id": 38719687,
      "login": "IanBAdams",
      "node_id": "MDQ6VXNlcjM4NzE5Njg3",
      "organizations_url": "https://api.github.com/users/IanBAdams/orgs",
      "received_events_url": "https://api.github.com/users/IanBAdams/received_events",
      "repos_url": "https://api.github.com/users/IanBAdams/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/IanBAdams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/IanBAdams/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/IanBAdams"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "It seems we have a separate issue to improve how Add-Type cmdlet works/finds reference assemblies.",
    "created_at": "2021-01-21T07:33:32Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14096#issuecomment-764443190",
    "id": 764443190,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14096",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDQ0MzE5MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/764443190/reactions"
    },
    "updated_at": "2021-01-21T07:33:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/764443190",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "@iSazonov Do you have a reference to that issue? I just discovered one of my old PS modules also broke due to this.",
    "created_at": "2021-06-07T12:49:48Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14096#issuecomment-855896607",
    "id": 855896607,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14096",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NTg5NjYwNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/855896607/reactions"
    },
    "updated_at": "2021-06-07T12:49:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/855896607",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1670030?v=4",
      "events_url": "https://api.github.com/users/redoz/events{/privacy}",
      "followers_url": "https://api.github.com/users/redoz/followers",
      "following_url": "https://api.github.com/users/redoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/redoz/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/redoz",
      "id": 1670030,
      "login": "redoz",
      "node_id": "MDQ6VXNlcjE2NzAwMzA=",
      "organizations_url": "https://api.github.com/users/redoz/orgs",
      "received_events_url": "https://api.github.com/users/redoz/received_events",
      "repos_url": "https://api.github.com/users/redoz/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/redoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/redoz/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/redoz"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> I just discovered one of my old PS modules also broke due to this.\r\n\r\nI guess you need to manually create right reference as demonstrated above.",
    "created_at": "2021-06-08T05:12:38Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14096#issuecomment-856446276",
    "id": 856446276,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14096",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjQ0NjI3Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/856446276/reactions"
    },
    "updated_at": "2021-06-08T05:12:38Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/856446276",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
