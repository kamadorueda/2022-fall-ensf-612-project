[
  {
    "author_association": "CONTRIBUTOR",
    "body": "Somewhat related (in that not seeing the caller's variables is problematic with respect to preference variables): #4568\r\n\r\nMy first thought was that calling `$PSCmdlet.SessionState.InvokeCommand.ExpandString()` might work, but it doesn't (I don't know enough to tell you why).\r\n\r\n\r\n",
    "created_at": "2018-10-04T23:10:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-427198006",
    "id": 427198006,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzE5ODAwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427198006/reactions"
    },
    "updated_at": "2018-10-04T23:10:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427198006",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "@mklement0 I saw that issue too, I guess it's related but I think there should be some general way to make the parent context available to a module function. So I thought it best to open a new issue, instead of somewhat hijacking that issue :)\r\nRegarding the `$PSCmdlet.SessionState.InvokeCommand.ExpandString()`, I tried that too, during my research on the matter, among many other things. From what I found the InvokeCommand reference is actually the same in the caller and in the module function. By glancing at the Powershell source it seems that calling a function adds another scope to the ExecutionContext, and that causes the variables to be \"hidden\", so there's no way to get around that without changing the function invocation code in the Powershell source. As a side note, I even tried to get to the parent's scope trough calling `Callstackframe.GetFrameVariables` for the parent stack frame obtained using `Get-PSCallstack` but that also didn't work.\r\n\r\nIn the meantime I also thought a little about the implications a change to the context availability would have on module functions, and I definitely think the module function needs to **request** the parent context in some way, so the module programmer can make sure the function is aware of the security issues that might arise (like function overwrites, aliases or variables with malicious content, etc.).",
    "created_at": "2018-10-05T06:59:21Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-427265566",
    "id": 427265566,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzI2NTU2Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427265566/reactions"
    },
    "updated_at": "2018-10-05T06:59:21Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427265566",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5467899?v=4",
      "events_url": "https://api.github.com/users/Line40/events{/privacy}",
      "followers_url": "https://api.github.com/users/Line40/followers",
      "following_url": "https://api.github.com/users/Line40/following{/other_user}",
      "gists_url": "https://api.github.com/users/Line40/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/Line40",
      "id": 5467899,
      "login": "Line40",
      "node_id": "MDQ6VXNlcjU0Njc4OTk=",
      "organizations_url": "https://api.github.com/users/Line40/orgs",
      "received_events_url": "https://api.github.com/users/Line40/received_events",
      "repos_url": "https://api.github.com/users/Line40/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/Line40/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Line40/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/Line40"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, @Line40; good sleuthing, and I agree on all counts.",
    "created_at": "2018-10-05T14:15:07Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-427380664",
    "id": 427380664,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzM4MDY2NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427380664/reactions"
    },
    "updated_at": "2018-10-05T14:15:07Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427380664",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "```powershell\r\n& {\r\n    $a = 42\r\n    New-Module {\r\n        function f {\r\n            [CmdletBinding()]\r\n            param()\r\n            $PSCmdlet.InvokeCommand.InvokeScript(\r\n                $PSCmdlet.SessionState,\r\n                [ScriptBlock]::Create{\r\n                    $ExecutionContext.SessionState.InvokeCommand.ExpandString('\"$a\"')\r\n                }\r\n            )\r\n        }\r\n    } | Out-Null\r\n    f\r\n}\r\n```",
    "created_at": "2018-10-05T19:05:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-427468659",
    "id": 427468659,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzQ2ODY1OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427468659/reactions"
    },
    "updated_at": "2018-10-05T19:07:38Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427468659",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/17184058?v=4",
      "events_url": "https://api.github.com/users/PetSerAl/events{/privacy}",
      "followers_url": "https://api.github.com/users/PetSerAl/followers",
      "following_url": "https://api.github.com/users/PetSerAl/following{/other_user}",
      "gists_url": "https://api.github.com/users/PetSerAl/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PetSerAl",
      "id": 17184058,
      "login": "PetSerAl",
      "node_id": "MDQ6VXNlcjE3MTg0MDU4",
      "organizations_url": "https://api.github.com/users/PetSerAl/orgs",
      "received_events_url": "https://api.github.com/users/PetSerAl/received_events",
      "repos_url": "https://api.github.com/users/PetSerAl/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PetSerAl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PetSerAl/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PetSerAl"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Great stuff, @PetSerAl, thanks for sharing.\r\n\r\nIf I understand this correctly, the `[scriptblock]::Create()` call could be simplified to simply output a regular expandable string, as its expansion will be delayed anyway:\r\n\r\n```powershell\r\n# Using a string argument, which is what [scriptblock]::Create() requires anyway\r\n[scriptblock]::Create(' \"`\"$a`\"\" ') \r\n```\r\n\r\nor, perhaps more typically, if embedded quoting isn't needed:\r\n\r\n```\r\n[scriptblock]::Create(' \"The answer is $a.\" ') \r\n```\r\n\r\n",
    "created_at": "2018-10-05T19:55:12Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-427481070",
    "id": 427481070,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNzQ4MTA3MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427481070/reactions"
    },
    "updated_at": "2018-10-05T19:55:12Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/427481070",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "Bummer. Just spent 4 hours trying to figure out what I am doing wrong, and then found this. :-( Well, at least it explains it. Thanks for recording the problem.",
    "created_at": "2019-04-10T20:00:49Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7944#issuecomment-481840430",
    "id": 481840430,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7944",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTg0MDQzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/481840430/reactions"
    },
    "updated_at": "2019-04-10T20:00:49Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/481840430",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2113681?v=4",
      "events_url": "https://api.github.com/users/alekdavis/events{/privacy}",
      "followers_url": "https://api.github.com/users/alekdavis/followers",
      "following_url": "https://api.github.com/users/alekdavis/following{/other_user}",
      "gists_url": "https://api.github.com/users/alekdavis/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alekdavis",
      "id": 2113681,
      "login": "alekdavis",
      "node_id": "MDQ6VXNlcjIxMTM2ODE=",
      "organizations_url": "https://api.github.com/users/alekdavis/orgs",
      "received_events_url": "https://api.github.com/users/alekdavis/received_events",
      "repos_url": "https://api.github.com/users/alekdavis/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alekdavis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alekdavis/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alekdavis"
    }
  }
]
