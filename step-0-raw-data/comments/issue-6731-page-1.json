[
  {
    "author_association": "COLLABORATOR",
    "body": "@rjmholt I have no objections to adding this but I'm curious why you want to? Completeness perhaps? We've thought about it before but it never seemed particularly compelling, especially since the loop doesn't introduce a new scope the way it does in C#.  Also note that you _can_ add a type-constraint to the variable by simply initializing it before the loop as in:\r\n```\r\n[int] $i = 0\r\nforeach ($i in 1, \"two\", 3) { \"i is $i\" }\r\n```\r\nThis code will error when it hits \"two\".",
    "created_at": "2018-04-26T00:34:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-384475488",
    "id": 384475488,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDQ3NTQ4OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384475488/reactions"
    },
    "updated_at": "2018-04-26T00:34:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384475488",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6876108?v=4",
      "events_url": "https://api.github.com/users/BrucePay/events{/privacy}",
      "followers_url": "https://api.github.com/users/BrucePay/followers",
      "following_url": "https://api.github.com/users/BrucePay/following{/other_user}",
      "gists_url": "https://api.github.com/users/BrucePay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BrucePay",
      "id": 6876108,
      "login": "BrucePay",
      "node_id": "MDQ6VXNlcjY4NzYxMDg=",
      "organizations_url": "https://api.github.com/users/BrucePay/orgs",
      "received_events_url": "https://api.github.com/users/BrucePay/received_events",
      "repos_url": "https://api.github.com/users/BrucePay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BrucePay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BrucePay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BrucePay"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "My only real motivation is the fact that the error messages the parser spits out when you try this are pretty incoherent. So ideally we fix that so the parser has a better concept of what the user's intent was and goes to the correct error state.\r\n\r\nBut if we're putting the work in there, it seems like we may as well support the actual feature. The `$i` part of `foreach ($i in 1,2,3) {}` constitutes a variable definition, so adding this we can better claim that variable definition can by constrained with a type in PowerShell. It's not obvious what we buy in the case of `[int]`, but in a more complex case, perhaps with a heterogeneous list, the type constraint could aid static analysis and completions, or provide a simple mechanism for coercive assignment. There are other ways to achieve it, but this is maybe pithier.\r\n\r\nTo be clear, I'd like to fix the error messages. The full feature isn't necessarily something I want, but seems worth discussing.",
    "created_at": "2018-04-26T02:22:10Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-384491969",
    "id": 384491969,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDQ5MTk2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384491969/reactions"
    },
    "updated_at": "2018-04-26T02:23:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384491969",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "The error message actually seems clear to me. But I'm special :-) \r\n\r\n> constitutes a variable definition\r\n\r\nWell - we don't actually have variable definitions in PowerShell, except for  class variables. But the variable in a `foreach` loop does constitute an assignment and we allow you to attach attributes to a variable during an assignment so it's reasonable to support this\r\n```\r\nforeach ([int] [validaterange(0, 1000)] $i in 1..100) { $i }\r\n```\r\nBut of course the attributes on a variable are manipulable objects not a fixed definition as in:\r\n```\r\nPS[1] (131) > [int] [validaterange(0,1000)] $x = 123\r\nPS[1] (132) > (gv x).Attributes\r\n\r\nMinRange MaxRange TypeId\r\n-------- -------- ------\r\n       0     1000 System.Management.Automation.ValidateRangeAttribute\r\n                  System.Management.Automation.ArgumentTypeConverterAttribute\r\n\r\n\r\nPS[1] (133) > $vra = (gv x).Attributes[0]\r\nPS[1] (134) > (gv x).Attributes.Remove($vra)\r\nTrue\r\nPS[1] (135) > (gv x).Attributes\r\n\r\nTransformNullOptionalParameters TypeId\r\n------------------------------- ------\r\n                           True System.Management.Automation.ArgumentTypeConverterAttribute\r\n\r\n\r\nPS[1] (136) > $x = 2000\r\nPS[1] (137) >\r\n```\r\n",
    "created_at": "2018-04-26T22:59:24Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-384814184",
    "id": 384814184,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDgxNDE4NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384814184/reactions"
    },
    "updated_at": "2018-04-26T22:59:24Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384814184",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6876108?v=4",
      "events_url": "https://api.github.com/users/BrucePay/events{/privacy}",
      "followers_url": "https://api.github.com/users/BrucePay/followers",
      "following_url": "https://api.github.com/users/BrucePay/following{/other_user}",
      "gists_url": "https://api.github.com/users/BrucePay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BrucePay",
      "id": 6876108,
      "login": "BrucePay",
      "node_id": "MDQ6VXNlcjY4NzYxMDg=",
      "organizations_url": "https://api.github.com/users/BrucePay/orgs",
      "received_events_url": "https://api.github.com/users/BrucePay/received_events",
      "repos_url": "https://api.github.com/users/BrucePay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BrucePay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BrucePay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BrucePay"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Ah that's really cool! Thanks!",
    "created_at": "2018-04-26T23:07:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-384815462",
    "id": 384815462,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDgxNTQ2Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384815462/reactions"
    },
    "updated_at": "2018-04-26T23:07:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/384815462",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "One question I have here is what should happen if a validation attribute on the variable fails? Does the loop terminate or does it keep going and just spit out errors.\r\n\r\nI have a working prototype [here](https://github.com/rjmholt/PowerShell/tree/allow-attributes-foreach-6731), which I've implemented with fairly minimal changes.\r\n\r\nA couple of examples:\r\n```powershell\r\n> foreach ([int]$x in 1..10) { $x }\r\n1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n```\r\n\r\n```powershell\r\n> foreach ([int][char]$x in 'a'..'z') { $x }\r\n97\r\n98\r\n99\r\n100\r\n101\r\n102\r\n103\r\n104\r\n105\r\n106\r\n107\r\n108\r\n109\r\n110\r\n111\r\n112\r\n113\r\n114\r\n115\r\n116\r\n117\r\n118\r\n119\r\n120\r\n121\r\n122\r\n```\r\n\r\nAnd the current semantics terminate the loop when an error occurs in the validation (I think):\r\n```powershell\r\n> foreach ([int]$x in '1','2','three','4') { $x }\r\n1\r\n2\r\nCannot convert value \"three\" to type \"System.Int32\". Error: \"Input string was not in a correct format.\"\r\nAt line:1 char:10\r\n+ foreach ([int]$x in '1','2','three','4') { $x }\r\n+          ~~~~~~~\r\n+ CategoryInfo          : MetadataError: (:) [], ArgumentTransformationMetadataException\r\n+ FullyQualifiedErrorId : RuntimeException\r\n```\r\n\r\n```powershell\r\n> foreach ([validaterange(1,5)][int]$x in 1..10) { $x }\r\n1\r\n2\r\n3\r\n4\r\n5\r\nThe variable cannot be validated because the value 6 is not a valid value for the x variable.\r\nAt line:1 char:10\r\n+ foreach ([validaterange(1,5)][int]$x in 1..10) { $x }\r\n+          ~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n+ CategoryInfo          : MetadataError: (:) [], ValidationMetadataException\r\n+ FullyQualifiedErrorId : ValidateSetFailure\r\n```\r\n\r\nBut wondering how others feel about this. Or does this just prove that attributes on enumeration variables are silly?",
    "created_at": "2018-05-01T17:18:43Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-385729308",
    "id": 385729308,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTcyOTMwOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/385729308/reactions"
    },
    "updated_at": "2018-05-01T17:18:43Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/385729308",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "A validation failure should be an exception (so e.g. it could be caught), so termination of the loop makes sense.",
    "created_at": "2018-05-01T19:34:35Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-385766513",
    "id": 385766513,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NTc2NjUxMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/385766513/reactions"
    },
    "updated_at": "2018-05-01T19:34:35Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/385766513",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2148248?v=4",
      "events_url": "https://api.github.com/users/lzybkr/events{/privacy}",
      "followers_url": "https://api.github.com/users/lzybkr/followers",
      "following_url": "https://api.github.com/users/lzybkr/following{/other_user}",
      "gists_url": "https://api.github.com/users/lzybkr/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lzybkr",
      "id": 2148248,
      "login": "lzybkr",
      "node_id": "MDQ6VXNlcjIxNDgyNDg=",
      "organizations_url": "https://api.github.com/users/lzybkr/orgs",
      "received_events_url": "https://api.github.com/users/lzybkr/received_events",
      "repos_url": "https://api.github.com/users/lzybkr/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lzybkr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lzybkr/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lzybkr"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@rjmholt love the look of this -- it's always been a bit of a weird quirk that foreach-defined variables are kind of type-less.\r\n\r\nPR when? 😄 ",
    "created_at": "2018-10-11T00:58:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-428781726",
    "id": 428781726,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODc4MTcyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/428781726/reactions"
    },
    "updated_at": "2018-10-11T00:58:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/428781726",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I have a branch for this, but I was hitting a very odd error in PowerShell's variable analysis code. At that point other priorities caught up with me. I'll see if I can look into it again at some point.",
    "created_at": "2018-10-11T01:06:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6731#issuecomment-428782988",
    "id": 428782988,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6731",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODc4Mjk4OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 1,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/428782988/reactions"
    },
    "updated_at": "2018-10-11T01:06:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/428782988",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7009879?v=4",
      "events_url": "https://api.github.com/users/rjmholt/events{/privacy}",
      "followers_url": "https://api.github.com/users/rjmholt/followers",
      "following_url": "https://api.github.com/users/rjmholt/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjmholt/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rjmholt",
      "id": 7009879,
      "login": "rjmholt",
      "node_id": "MDQ6VXNlcjcwMDk4Nzk=",
      "organizations_url": "https://api.github.com/users/rjmholt/orgs",
      "received_events_url": "https://api.github.com/users/rjmholt/received_events",
      "repos_url": "https://api.github.com/users/rjmholt/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rjmholt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjmholt/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rjmholt"
    }
  }
]
