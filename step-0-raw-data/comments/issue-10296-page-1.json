[
  {
    "author_association": "NONE",
    "body": "Hello all together,\r\nI install PowerShell Core 6.2.2 today on my Linux box with an ZSH Shell.\r\nWhen I start the Shell I get this error:\r\n\r\nVM-Linux01 :: ~ » pwsh\r\nPowerShell 6.2.2\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\n\r\nhttps://aka.ms/pscore6-docs\r\nType 'help' to get help.\r\n\r\nFailFast:\r\nThe type initializer for 'Microsoft.PowerShell.ApplicationInsightsTelemetry' threw an exception.\r\n\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at System.Environment.FailFast(System.String, System.Exception)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(System.String, System.String[], Int32)\r\n   at Microsoft.PowerShell.ManagedPSEntry.Main(System.String[])\r\n\r\nException details:\r\nSystem.TypeInitializationException: The type initializer for 'Microsoft.PowerShell.ApplicationInsightsTelemetry' threw an exception. ---> System.ArgumentException: Item has already been added. Key in dictionary: 'SHELL'  Key being added: 'SHELL'\r\n   at System.Collections.Hashtable.Insert(Object key, Object nvalue, Boolean add)\r\n   at System.Environment.ToHashtable(IEnumerable`1 pairs)\r\n   at System.Environment.GetEnvironmentVariables()\r\n   at Microsoft.ApplicationInsights.Extensibility.Implementation.Platform.PlatformImplementation..ctor()\r\n   at Microsoft.ApplicationInsights.Extensibility.Implementation.Platform.PlatformSingleton.get_Current()\r\n   at Microsoft.ApplicationInsights.Extensibility.Implementation.TelemetryConfigurationFactory.Initialize(TelemetryConfiguration configuration, TelemetryModules modules)\r\n   at Microsoft.ApplicationInsights.Extensibility.TelemetryConfiguration.get_Active()\r\n   at Microsoft.PowerShell.ApplicationInsightsTelemetry..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.PowerShell.ApplicationInsightsTelemetry.SendPSCoreStartupTelemetry()\r\n   at Microsoft.PowerShell.ConsoleHost.Start(String bannerText, String helpText, String[] args)\r\n   at Microsoft.PowerShell.ConsoleShell.Start(String bannerText, String helpText, String[] args)\r\n   at Microsoft.PowerShell.UnmanagedPSEntry.Start(String consoleFilePath, String[] args, Int32 argc)\r\n[1]    71198 abort      pwsh\r\n\r\nWhen I change the shell to BASH, PowerShell starts. I try to remove the ZSH profile .zshrc and try again, but this does also not work.\r\n\r\nDoes anyone have an idea?\n\n<blockquote><div><strong><a href=\"https://docs.microsoft.com/en-us/powershell/scripting/overview\">PowerShell Scripting</a></strong></div></blockquote>",
    "created_at": "2019-08-03T19:42:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-517949715",
    "id": 517949715,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNzk0OTcxNQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517949715/reactions"
    },
    "updated_at": "2019-08-03T19:42:31Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/517949715",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12720617?v=4",
      "events_url": "https://api.github.com/users/atiedemann/events{/privacy}",
      "followers_url": "https://api.github.com/users/atiedemann/followers",
      "following_url": "https://api.github.com/users/atiedemann/following{/other_user}",
      "gists_url": "https://api.github.com/users/atiedemann/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/atiedemann",
      "id": 12720617,
      "login": "atiedemann",
      "node_id": "MDQ6VXNlcjEyNzIwNjE3",
      "organizations_url": "https://api.github.com/users/atiedemann/orgs",
      "received_events_url": "https://api.github.com/users/atiedemann/received_events",
      "repos_url": "https://api.github.com/users/atiedemann/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/atiedemann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atiedemann/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/atiedemann"
    }
  },
  {
    "author_association": "NONE",
    "body": "As a workaround, have you tried disabling Powershell telemetry? You can disable it by setting the environment variable POWERSHELL_TELEMETRY_OPTOUT to 1.",
    "created_at": "2019-08-04T18:44:24Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518026509",
    "id": 518026509,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODAyNjUwOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518026509/reactions"
    },
    "updated_at": "2019-08-04T18:44:24Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518026509",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/10983684?v=4",
      "events_url": "https://api.github.com/users/satorp/events{/privacy}",
      "followers_url": "https://api.github.com/users/satorp/followers",
      "following_url": "https://api.github.com/users/satorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/satorp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/satorp",
      "id": 10983684,
      "login": "satorp",
      "node_id": "MDQ6VXNlcjEwOTgzNjg0",
      "organizations_url": "https://api.github.com/users/satorp/orgs",
      "received_events_url": "https://api.github.com/users/satorp/received_events",
      "repos_url": "https://api.github.com/users/satorp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/satorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/satorp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/satorp"
    }
  },
  {
    "author_association": "NONE",
    "body": "Yes I do but I get the same error. ",
    "created_at": "2019-08-04T18:56:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518027311",
    "id": 518027311,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODAyNzMxMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518027311/reactions"
    },
    "updated_at": "2019-08-04T18:56:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518027311",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12720617?v=4",
      "events_url": "https://api.github.com/users/atiedemann/events{/privacy}",
      "followers_url": "https://api.github.com/users/atiedemann/followers",
      "following_url": "https://api.github.com/users/atiedemann/following{/other_user}",
      "gists_url": "https://api.github.com/users/atiedemann/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/atiedemann",
      "id": 12720617,
      "login": "atiedemann",
      "node_id": "MDQ6VXNlcjEyNzIwNjE3",
      "organizations_url": "https://api.github.com/users/atiedemann/orgs",
      "received_events_url": "https://api.github.com/users/atiedemann/received_events",
      "repos_url": "https://api.github.com/users/atiedemann/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/atiedemann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atiedemann/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/atiedemann"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "It seems you have some SHELL environment variables.",
    "created_at": "2019-08-05T03:23:19Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518071976",
    "id": 518071976,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODA3MTk3Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518071976/reactions"
    },
    "updated_at": "2019-08-05T03:23:19Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518071976",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "Yes I have some:\r\n\r\nVM-Linux01 :: ~ » printenv | grep SHELL\r\nSHELL=/bin/zsh\r\nSHELL=/bin/zsh\r\nPOWERSHELL_TELEMETRY_OPTOUT=1\r\n\r\nHave someone any idea why push is not starting?\r\nThanks\r\nArne\r\n",
    "created_at": "2019-08-05T06:53:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518109470",
    "id": 518109470,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODEwOTQ3MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518109470/reactions"
    },
    "updated_at": "2019-08-05T06:53:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518109470",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12720617?v=4",
      "events_url": "https://api.github.com/users/atiedemann/events{/privacy}",
      "followers_url": "https://api.github.com/users/atiedemann/followers",
      "following_url": "https://api.github.com/users/atiedemann/following{/other_user}",
      "gists_url": "https://api.github.com/users/atiedemann/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/atiedemann",
      "id": 12720617,
      "login": "atiedemann",
      "node_id": "MDQ6VXNlcjEyNzIwNjE3",
      "organizations_url": "https://api.github.com/users/atiedemann/orgs",
      "received_events_url": "https://api.github.com/users/atiedemann/received_events",
      "repos_url": "https://api.github.com/users/atiedemann/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/atiedemann/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atiedemann/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/atiedemann"
    }
  },
  {
    "author_association": "NONE",
    "body": "Is this another version of the duplicate environment variable bug? That really shouldn’t blow up powershell as hard as it does.",
    "created_at": "2019-08-05T07:19:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518117030",
    "id": 518117030,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODExNzAzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518117030/reactions"
    },
    "updated_at": "2019-08-05T07:19:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518117030",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14316954?v=4",
      "events_url": "https://api.github.com/users/DHowett-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/DHowett-MSFT/followers",
      "following_url": "https://api.github.com/users/DHowett-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/DHowett-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/DHowett-MSFT",
      "id": 14316954,
      "login": "DHowett-MSFT",
      "node_id": "MDQ6VXNlcjE0MzE2OTU0",
      "organizations_url": "https://api.github.com/users/DHowett-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/DHowett-MSFT/received_events",
      "repos_url": "https://api.github.com/users/DHowett-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/DHowett-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DHowett-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/DHowett-MSFT"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "PowerShell doesn't track SHELL. It is a Microsoft.ApplicationInsights bug.",
    "created_at": "2019-08-05T07:29:43Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518119848",
    "id": 518119848,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODExOTg0OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518119848/reactions"
    },
    "updated_at": "2019-08-05T07:29:43Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518119848",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "From the stack trace, the exception seems to be raised by  `System.Environment.GetEnvironmentVariables()`, probably when the telemetry object tries to check for the opt out variable. Is it possible that `System.Environment.GetEnvironmentVariables` in .NET Core does not support duplicate variables in zsh?",
    "created_at": "2019-08-05T09:48:46Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518166110",
    "id": 518166110,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODE2NjExMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518166110/reactions"
    },
    "updated_at": "2019-08-05T09:48:46Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518166110",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/10983684?v=4",
      "events_url": "https://api.github.com/users/satorp/events{/privacy}",
      "followers_url": "https://api.github.com/users/satorp/followers",
      "following_url": "https://api.github.com/users/satorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/satorp/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/satorp",
      "id": 10983684,
      "login": "satorp",
      "node_id": "MDQ6VXNlcjEwOTgzNjg0",
      "organizations_url": "https://api.github.com/users/satorp/orgs",
      "received_events_url": "https://api.github.com/users/satorp/received_events",
      "repos_url": "https://api.github.com/users/satorp/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/satorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/satorp/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/satorp"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "The issue should be moved to CoreClr repo.",
    "created_at": "2019-08-05T11:26:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-518195990",
    "id": 518195990,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODE5NTk5MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518195990/reactions"
    },
    "updated_at": "2019-08-05T11:26:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/518195990",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Close as stale issue.",
    "created_at": "2021-01-15T11:10:55Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10296#issuecomment-760878601",
    "id": 760878601,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10296",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDg3ODYwMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/760878601/reactions"
    },
    "updated_at": "2021-01-15T11:10:55Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/760878601",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
