[
  {
    "author_association": "NONE",
    "body": "@jazzdelightsme \r\nFWIW, this is my solution:\r\n\r\n```\r\n<Project Sdk=\"Microsoft.NET.Sdk\" InitialTargets=\"Init\">\r\n\r\n  <PropertyGroup>\r\n    <OutputType>Exe</OutputType>\r\n    <TargetFrameworks>net6.0;net7.0</TargetFrameworks>\r\n    <RuntimeIdentifier>win7-x64</RuntimeIdentifier>\r\n    <ProduceReferenceAssembly>False</ProduceReferenceAssembly>\r\n    <ImplicitUsings>enable</ImplicitUsings>\r\n  </PropertyGroup>\r\n\r\n  <ItemGroup>\r\n    <PackageReference Include=\"Microsoft.PowerShell.SDK\" Version=\"7.3.0-preview.3\" />\r\n    <PackageReference Update=\"Microsoft.PowerShell.SDK\" Version=\"7.2.2\" Condition=\"'$(TargetFramework)' == 'net6.0'\" />\r\n  </ItemGroup>\r\n\r\n  <Target Name=\"Init\">\r\n    <PropertyGroup>\r\n      <CopyCmd Condition=\"'$(OS)' == 'Windows_NT'\">xcopy /s /y /i</CopyCmd>\r\n      <CopyCmd Condition=\"'$(OS)' == 'Unix'\">cp -R</CopyCmd>\r\n      <DelCmd Condition=\"'$(OS)' == 'Windows_NT'\">rmdir /S /Q</DelCmd>\r\n      <DelCmd Condition=\"'$(OS)' == 'Unix'\">rm -rf</DelCmd>\r\n      <PSModulesOS Condition=\"'$(OS)' == 'Windows_NT'\">win</PSModulesOS>\r\n      <PSModulesOS Condition=\"'$(OS)' == 'Unix'\">unix</PSModulesOS>\r\n      <PSModulesDir>runtimes/$(PSModulesOS)/lib/$(TargetFramework)/Modules</PSModulesDir>\r\n      <PSModulesBuildDir>$(ProjectDir)$(OutputPath)/$(PSModulesDir)</PSModulesBuildDir>\r\n      <PSModulesPublishDir>$(PublishDir)/$(PSModulesDir)</PSModulesPublishDir>\r\n      <BuildDir>$(ProjectDir)$(OutputPath)</BuildDir>\r\n    </PropertyGroup>\r\n  </Target>\r\n\r\n  <Target Name=\"DisplayConfiguration\" AfterTargets=\"BeforeBuild\">\r\n    <Exec Command=\"echo OS               : $(OS)\" />\r\n    <Exec Command=\"echo CopyCmd          : $(CopyCmd)\" />\r\n    <Exec Command=\"echo DelCmd           : $(DelCmd)\" />\r\n    <Exec Command=\"echo OutputPath       : $(OutputPath)\" />\r\n    <Exec Command=\"echo ProjectDir       : $(ProjectDir)\" />\r\n    <Exec Command=\"echo PSModulesOS      : $(PSModulesOS)\" />\r\n    <Exec Command=\"echo Configuration    : $(Configuration)\" />\r\n    <Exec Command=\"echo TargetFramework  : $(TargetFramework)\" />\r\n    <Exec Command=\"echo RuntimeIdentifier: $(RuntimeIdentifier)\" />\r\n  </Target>\r\n\r\n <Target Name=\"CopyModulesBuild\" AfterTargets=\"AfterBuild\">\r\n    <Exec Command=\"echo Build $(TargetFramework): $(PSModulesBuildDir)\" />\r\n    <Exec Command=\"$(CopyCmd) &quot;$(PSModulesBuildDir)&quot; &quot;$(BuildDir)/Modules&quot;\" />\r\n    <Exec Command=\"$(DelCmd) &quot;$(BuildDir)/ref&quot;\" />\r\n    <Exec Command=\"$(DelCmd) &quot;$(BuildDir)/runtimes&quot;\" />\r\n  </Target>\r\n\r\n  <Target Name=\"CopyModulesPublish\" AfterTargets=\"Publish\">\r\n    <Exec Command=\"echo Publish $(TargetFramework): $(PSModulesPublishDir)\" />\r\n    <Exec Command=\"$(CopyCmd) &quot;$(PSModulesPublishDir)&quot; &quot;$(PublishDir)/Modules&quot;\" />\r\n    <Exec Command=\"$(DelCmd) &quot;$(PublishDir)/ref&quot;\" />\r\n    <Exec Command=\"$(DelCmd) &quot;$(PublishDir)/runtimes&quot;\" />\r\n  </Target>\r\n\r\n</Project>\r\n```\r\n",
    "created_at": "2021-11-10T19:25:55Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15274#issuecomment-965668023",
    "id": 965668023,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15274",
    "node_id": "IC_kwDOAvT7bc45juy3",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/965668023/reactions"
    },
    "updated_at": "2022-03-22T11:32:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/965668023",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/365255?v=4",
      "events_url": "https://api.github.com/users/ALIENQuake/events{/privacy}",
      "followers_url": "https://api.github.com/users/ALIENQuake/followers",
      "following_url": "https://api.github.com/users/ALIENQuake/following{/other_user}",
      "gists_url": "https://api.github.com/users/ALIENQuake/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/ALIENQuake",
      "id": 365255,
      "login": "ALIENQuake",
      "node_id": "MDQ6VXNlcjM2NTI1NQ==",
      "organizations_url": "https://api.github.com/users/ALIENQuake/orgs",
      "received_events_url": "https://api.github.com/users/ALIENQuake/received_events",
      "repos_url": "https://api.github.com/users/ALIENQuake/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/ALIENQuake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ALIENQuake/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/ALIENQuake"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "> NOTE: Quote from https://github.com/PowerShell/PowerShell/issues/16525#issuecomment-983108982\r\n\r\nThis is because the modules are not correctly deployed to the publish folder when you specify `dotnet publish -r <RID>`. A few PowerShell built-in modules are shipped with the `Microsoft.PowerShell.SDK` nuget package, and when running `dotnet build` or `dotnet publish`, the modules will be deployed to `bin\\...\\runtimes\\win\\lib\\net5.0`, next to the `System.Management.Automation.dll`, whose location is `$PSHOME` for the powershell hosted by the application.\r\n\r\nHowever, when build with `dotnet publish -r <RID>`, all powershell assemblies are deployed in a flat list under `<RID>\\publish` folder, but the modules are still at `<RID>publish\\runtimes\\win\\lib\\net5.0`. So `$PSHOME` becomes `<RID>\\publish` and the `Modules` folder is missing from there.\r\n\r\nThis is a known issue, and it was done so because\r\n1. There was no way (at least at the time when doing this) for a nuget package to choose where to deploy some content files depending on whether or not `-runtime` is specified.\r\n2. Most applications that need to host PowerShell care more about `dotnet publish` scenario due to cross-platform portability.\r\n\r\nSo, the decision was made to accommodate `dotnet build` and `dotnet publish`, and leave `dotnet publish -r <RID>` broken.\r\n\r\nThe workaround is simple, just have a post-build script that copy the `Modules` folder from `<RID>publish\\runtimes\\win\\lib\\net5.0` to `<RID>publish`.",
    "created_at": "2021-12-01T20:27:19Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15274#issuecomment-984028028",
    "id": 984028028,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15274",
    "node_id": "IC_kwDOAvT7bc46pxN8",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/984028028/reactions"
    },
    "updated_at": "2021-12-01T20:27:19Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/984028028",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  }
]
