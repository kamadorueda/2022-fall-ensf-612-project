[
  {
    "author_association": "COLLABORATOR",
    "body": "@PaulHigin Could you please look the issue?",
    "created_at": "2020-07-08T09:55:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-655418357",
    "id": 655418357,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NTQxODM1Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/655418357/reactions"
    },
    "updated_at": "2020-07-08T09:55:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/655418357",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": " This looks like a build/publishing error where required core module binaries are not available, at runtime.  ForeEach-Object -Parallel code creates runspaces with default initial state that includes all core modules.  But for some reason runtime command discovery cannot find them.\r\n\r\n@daxian-dbw  has worked on the SDK.  Dongbo can you comment on why `Write-Host` cannot be found at runtime?",
    "created_at": "2020-07-09T16:40:36Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656232507",
    "id": 656232507,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjIzMjUwNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656232507/reactions"
    },
    "updated_at": "2020-07-09T16:40:36Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656232507",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": "Sorry I should have put this in the original post but sometimes I get the following error as well which might provide more clues.\r\n\r\n```\r\n2020-07-07 15:13:21: [Error] - An unexpected error has occurred while processing ForEach-Object -Parallel input. This may mean that some of the piped input did not get processed. Error: System.IO.DirectoryNotFoundException: Could not find a part of the path '/tmp/2473a89a-8513-49db-bf23-51d8af91a349/.local/share/powershell/Modules'.\r\n   at System.IO.FileSystem.CreateDirectory(String fullPath)\r\n   at System.IO.Directory.CreateDirectory(String path)\r\n   at System.Management.Automation.Platform.SelectProductNameForDirectory(XDG_Type dirpath)\r\n   at System.Management.Automation.ModuleIntrinsics.GetPersonalModulePath()\r\n   at System.Management.Automation.ModuleIntrinsics.GetModulePath(String currentProcessModulePath, String hklmMachineModulePath, String hkcuUserModulePath)\r\n   at System.Management.Automation.ModuleIntrinsics.SetModulePath()\r\n   at System.Management.Automation.ModuleIntrinsics..ctor(ExecutionContext context)\r\n   at System.Management.Automation.ExecutionContext.InitializeCommon(AutomationEngine engine, PSHost hostInterface)\r\n   at System.Management.Automation.ExecutionContext..ctor(AutomationEngine engine, PSHost hostInterface, InitialSessionState initialSessionState)\r\n   at System.Management.Automation.AutomationEngine..ctor(PSHost hostInterface, InitialSessionState iss)\r\n   at System.Management.Automation.Runspaces.LocalRunspace.DoOpenHelper()\r\n   at System.Management.Automation.Runspaces.LocalRunspace.OpenHelper(Boolean syncCall)\r\n   at System.Management.Automation.Runspaces.RunspaceBase.CoreOpen(Boolean syncCall)\r\n   at System.Management.Automation.Runspaces.RunspaceBase.Open()\r\n   at System.Management.Automation.PSTasks.PSTaskBase.Start()\r\n   at System.Management.Automation.PSTasks.PSTaskPool.Add(PSTaskBase task)\r\n   at Microsoft.PowerShell.Commands.ForEachObjectCommand.<InitParallelParameterSet>b__63_2(Object _).\r\n```",
    "created_at": "2020-07-09T16:45:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656234592",
    "id": 656234592,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjIzNDU5Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656234592/reactions"
    },
    "updated_at": "2020-07-09T16:45:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656234592",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1653751?v=4",
      "events_url": "https://api.github.com/users/normj/events{/privacy}",
      "followers_url": "https://api.github.com/users/normj/followers",
      "following_url": "https://api.github.com/users/normj/following{/other_user}",
      "gists_url": "https://api.github.com/users/normj/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/normj",
      "id": 1653751,
      "login": "normj",
      "node_id": "MDQ6VXNlcjE2NTM3NTE=",
      "organizations_url": "https://api.github.com/users/normj/orgs",
      "received_events_url": "https://api.github.com/users/normj/received_events",
      "repos_url": "https://api.github.com/users/normj/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/normj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/normj/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/normj"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "> One theory I have is with the --runtime linux-x64 switch the assemblies from the publish\\runtimes folder get flatten out at the root of the publish folder. But there is also the Modules in the publish\\runtimes\\unix\\lib\\netcoreapp3.1\\Modules and maybe something about the modules not being direct children of the assemblies anymore is causing the failure.\r\n\r\nThis is exactly the cause. The Runspace created by `ForEach-Object -Parallel` depends on all modules being present in the modules path, which are not.\r\nIt's a known limitation in the the `Microsoft.PowerShell.SDK` package that the deployment of built-in modules doesn't work when building with the specific RID. See https://github.com/PowerShell/PowerShell/pull/11832#issuecomment-584882314.\r\n\r\nThe workaround is to have a post build step, to copy the `Modules` folder to right under the publish folder, where `System.Management.Automation.dll` is located. The `Modules` folders are at `<publish-folder>\\unix\\lib\\netcoreapp3.1\\Modules` and `<publish-folder>\\win\\lib\\netcoreapp3.1\\Modules` for Linux/macOS and Windows respectively.\r\n\r\n--------------------------------------------\r\n\r\nFor the issue regarding `Microsoft.Management.Infrastructure`, it looks like a bug in the nuget packaging of `Microsoft.Management.Infrastructure.Runtime.Win` -- it doesn't have a runtime folder named `win-x64`, and hence `dotnet publish -r win-x64` cannot get the corresponding libraries deployed. @adityapatwardhan Can you please take a look?\r\n\r\n",
    "created_at": "2020-07-09T16:53:11Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656238488",
    "id": 656238488,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjIzODQ4OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656238488/reactions"
    },
    "updated_at": "2020-07-10T16:56:34Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656238488",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "> Error: System.IO.DirectoryNotFoundException\r\n\r\nNo idea why `Directory.CreateDirectory` could fail with this exception. It doesn't require any part of the path to be present ... The code is [here](https://github.com/PowerShell/PowerShell/blob/master/src/System.Management.Automation/CoreCLR/CorePsPlatform.cs#L312). The path in use was `/tmp/2473a89a-8513-49db-bf23-51d8af91a349/.local/share/powershell/Modules` and `/tmp/2473a89a-8513-49db-bf23-51d8af91a349` was already successfully created by [this code](https://github.com/PowerShell/PowerShell/blob/5ad8a5916f37835feb0476396ff7c79e748c2577/src/System.Management.Automation/utils/PsUtils.cs#L145-L165).\r\n\r\n@normj Do you see this every time you use `ForEach-Object -Parallel` in your environment?",
    "created_at": "2020-07-09T17:10:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656246670",
    "id": 656246670,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjI0NjY3MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656246670/reactions"
    },
    "updated_at": "2020-07-09T17:11:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656246670",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Thanks for the detailed bug report! I really appreciate that.\r\n\r\nFor `Microsoft.Management.Infrastructure` we cannot have `win-x64` folder as the dependencies are OS specific. Hence, we have to use OS specific runtimes. \r\n\r\nAlso, can you try with `Microsoft.Management.Infrastructure` version `2.0.0`? That fixed a bunch of issues around runtimes.",
    "created_at": "2020-07-09T17:10:45Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656246836",
    "id": 656246836,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjI0NjgzNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656246836/reactions"
    },
    "updated_at": "2020-07-09T17:10:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656246836",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12820925?v=4",
      "events_url": "https://api.github.com/users/adityapatwardhan/events{/privacy}",
      "followers_url": "https://api.github.com/users/adityapatwardhan/followers",
      "following_url": "https://api.github.com/users/adityapatwardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/adityapatwardhan/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/adityapatwardhan",
      "id": 12820925,
      "login": "adityapatwardhan",
      "node_id": "MDQ6VXNlcjEyODIwOTI1",
      "organizations_url": "https://api.github.com/users/adityapatwardhan/orgs",
      "received_events_url": "https://api.github.com/users/adityapatwardhan/received_events",
      "repos_url": "https://api.github.com/users/adityapatwardhan/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/adityapatwardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adityapatwardhan/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/adityapatwardhan"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@adityapatwardhan FYI, the user was using `Microsoft.PowerShell.SDK` 7.0.2, which reference the 2.0.0 version of `Microsoft.Management.Infrastructure`.",
    "created_at": "2020-07-09T17:13:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656248102",
    "id": 656248102,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjI0ODEwMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656248102/reactions"
    },
    "updated_at": "2020-07-09T17:13:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656248102",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "NONE",
    "body": "Thanks for the information. I'm able to put a work around in our publishing tooling that moves around the Modules folder.",
    "created_at": "2020-07-10T07:45:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-656536023",
    "id": 656536023,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NjUzNjAyMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656536023/reactions"
    },
    "updated_at": "2020-07-10T07:45:27Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/656536023",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/1653751?v=4",
      "events_url": "https://api.github.com/users/normj/events{/privacy}",
      "followers_url": "https://api.github.com/users/normj/followers",
      "following_url": "https://api.github.com/users/normj/following{/other_user}",
      "gists_url": "https://api.github.com/users/normj/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/normj",
      "id": 1653751,
      "login": "normj",
      "node_id": "MDQ6VXNlcjE2NTM3NTE=",
      "organizations_url": "https://api.github.com/users/normj/orgs",
      "received_events_url": "https://api.github.com/users/normj/received_events",
      "repos_url": "https://api.github.com/users/normj/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/normj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/normj/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/normj"
    }
  },
  {
    "author_association": "NONE",
    "body": "This issue has been marked as answered and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
    "created_at": "2020-07-12T00:00:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/13132#issuecomment-657150071",
    "id": 657150071,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/13132",
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzE1MDA3MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/657150071/reactions"
    },
    "updated_at": "2020-07-12T00:00:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/657150071",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  }
]
