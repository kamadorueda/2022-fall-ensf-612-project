[
  {
    "author_association": "NONE",
    "body": "Another surprising aspect is that `[System.Object]::ReferenceEquals()` returns true for two objects for which the result of `-is [psobject]` differs.  For example,\r\n\r\n```PowerShell\r\n$empty = Out-Null\r\n$array = @(0,$empty,2)\r\nfunction f {param($x)}\r\n\r\nf -x $array\r\n\r\n$empty -is [psobject]\r\n$array[1] -is [psobject]\r\n[System.Object]::ReferenceEquals($empty,$array[1])\r\n```\r\n\r\nreturns \r\n\r\n```none\r\nTrue\r\nFalse\r\nTrue\r\n```",
    "created_at": "2018-01-28T17:37:35Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5987#issuecomment-361080532",
    "id": 361080532,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5987",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTA4MDUzMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/361080532/reactions"
    },
    "updated_at": "2018-01-28T17:37:35Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/361080532",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11237922?v=4",
      "events_url": "https://api.github.com/users/alx9r/events{/privacy}",
      "followers_url": "https://api.github.com/users/alx9r/followers",
      "following_url": "https://api.github.com/users/alx9r/following{/other_user}",
      "gists_url": "https://api.github.com/users/alx9r/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/alx9r",
      "id": 11237922,
      "login": "alx9r",
      "node_id": "MDQ6VXNlcjExMjM3OTIy",
      "organizations_url": "https://api.github.com/users/alx9r/orgs",
      "received_events_url": "https://api.github.com/users/alx9r/received_events",
      "repos_url": "https://api.github.com/users/alx9r/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/alx9r/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alx9r/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/alx9r"
    }
  },
  {
    "author_association": "NONE",
    "body": "The example by @alx9r is not really related to this issue.  When I run it in my PS version 3 console, the result of the ReferenceEquals is False, so I cannot reproduce the behaviour.\r\n\r\nIn addition, it turns out that the array constructor completely ignores AutomationNull elements:\r\n\r\n```\r\n$empty = Out-Null\r\n$array = @(0,$empty,2)\r\n'$array.count : ' + $array.count\r\n'$array[1] : ' + $array[1]\r\n```\r\nOutput:\r\n\r\n```\r\n$array.count : 2\r\n$array[1] : 2\r\n```\r\nPerhaps that should be raised as another issue, but I guess that's potentially complex, since it is expected that \r\n@($empty).count is 0\r\n\r\nAnother aside, `[System.Object]::ReferenceEquals($empty,$null)` returns $true.  This is probably because PowerShell silenty converts an AutomationNull argument to a function parameter to a plain $null:\r\n```\r\nfunction IsPsobject($x) {$x -is [psobject]}\r\n\r\n$empty = Out-Null\r\n'[System.Object]::ReferenceEquals($empty,$null) : '+[System.Object]::ReferenceEquals($empty,$null)\r\n'$empty -is [psobject] : ' + ($empty -is [psobject])\r\n'IsPsobject -x $empty : ' + (IsPsobject -x $empty)\r\n```\r\nOutput:\r\n```\r\n[System.Object]::ReferenceEquals($empty,$null) : True\r\n$empty -is [psobject] : True\r\nIsPsobject -x $empty : False\r\n```\r\n\r\nI mention the above not to expand the scope of the original issue raised about arrays being changed, but just to point out confusing behaviour that needs to be understood when discussing the real issue.",
    "created_at": "2018-02-01T19:38:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5987#issuecomment-362378084",
    "id": 362378084,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5987",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjM3ODA4NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/362378084/reactions"
    },
    "updated_at": "2018-02-01T20:19:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/362378084",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/35709353?v=4",
      "events_url": "https://api.github.com/users/TigerBoom/events{/privacy}",
      "followers_url": "https://api.github.com/users/TigerBoom/followers",
      "following_url": "https://api.github.com/users/TigerBoom/following{/other_user}",
      "gists_url": "https://api.github.com/users/TigerBoom/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/TigerBoom",
      "id": 35709353,
      "login": "TigerBoom",
      "node_id": "MDQ6VXNlcjM1NzA5MzUz",
      "organizations_url": "https://api.github.com/users/TigerBoom/orgs",
      "received_events_url": "https://api.github.com/users/TigerBoom/received_events",
      "repos_url": "https://api.github.com/users/TigerBoom/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/TigerBoom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TigerBoom/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/TigerBoom"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Hi guys, perhaps I can provide some context. AutomationNull is an _internal_ special value in PowerShell (System.Management.Automation.**Internal**.AutomationNull) . It's used to uniquely represent an empty sequence i.e. a pipeline that returns no objects. This is not the same as null (a scalar value) or the empty array (an array value with no elements). In a scalar context, AutomationNull is usually converted to the \"real\" value null and in an array context it is converted into an empty array. So in practice, you should rarely if ever see it directly when scripting. AutomationNull was necessary to get the streaming semantics we wanted. Unfortunately it had to be public even though it's in an internal namespace which makes it somewhat confusing.",
    "created_at": "2018-03-09T18:15:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5987#issuecomment-371898799",
    "id": 371898799,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5987",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTg5ODc5OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/371898799/reactions"
    },
    "updated_at": "2018-03-09T18:15:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/371898799",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6876108?v=4",
      "events_url": "https://api.github.com/users/BrucePay/events{/privacy}",
      "followers_url": "https://api.github.com/users/BrucePay/followers",
      "following_url": "https://api.github.com/users/BrucePay/following{/other_user}",
      "gists_url": "https://api.github.com/users/BrucePay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BrucePay",
      "id": 6876108,
      "login": "BrucePay",
      "node_id": "MDQ6VXNlcjY4NzYxMDg=",
      "organizations_url": "https://api.github.com/users/BrucePay/orgs",
      "received_events_url": "https://api.github.com/users/BrucePay/received_events",
      "repos_url": "https://api.github.com/users/BrucePay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BrucePay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BrucePay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BrucePay"
    }
  }
]
