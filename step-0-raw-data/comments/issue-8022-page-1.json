[
  {
    "author_association": "CONTRIBUTOR",
    "body": "The issue is that function `MyComm` is defined in a scope that your module by definition cannot see.\r\n\r\nModules see only _global_ (non-module) function definitions, whereas your function is defined in a _child_ of the global scope by virtue of being defined in a _script_.\r\n\r\nBy dot-sourcing your script from the global scope `MyComm` is defined globally, that's why the problem goes away.",
    "created_at": "2018-10-14T13:01:28Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8022#issuecomment-429624669",
    "id": 429624669,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8022",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTYyNDY2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429624669/reactions"
    },
    "updated_at": "2018-10-14T13:02:37Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429624669",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "Hm, that's how I figured it out also, but I find it a bit inconsistent. Your sentence is good definition of this issue:\r\n> Modules see only global function definitions\r\n\r\nI was presuming `FindMyComm` will run inside a script scope, although defined in global scope. I was not expecting it will jump up during the execution. Microsoft [docs](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_functions?view=powershell-6) say about functions:\r\n> The statements in the list run as if you had typed them at the command prompt.\r\n\r\nI don't know if there are differences between functions defined in module or outside of it, in regards to this definition. So, question is: **In what scope `FindMyComm` runs: global or script scope?**\r\n\r\n---\r\n\r\nWhat about this example:\r\n```PowerShell\r\n# define standalone and module function\r\nfunction MyComm {}\r\nfunction Global:FindMyComm {Get-Command MyComm}\r\n\r\n# check for both functions\r\nGet-Command MyComm\r\nGet-Command FindMyComm\r\n\r\n# run new function\r\nFindMyComm\r\n```\r\n\r\nNow `FindMyComm` is defined in global scope, but it runs inside of the script scope. I would expect importing it via module to be the same as this example. Function `MyComm` is **not** visible in global scope.\r\n![image](https://user-images.githubusercontent.com/15923171/46917846-a0547380-cfcb-11e8-94b7-87b3924fb6d7.png)\r\n",
    "created_at": "2018-10-14T14:34:20Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8022#issuecomment-429631365",
    "id": 429631365,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8022",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTYzMTM2NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429631365/reactions"
    },
    "updated_at": "2018-10-14T14:34:20Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429631365",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/15923171?v=4",
      "events_url": "https://api.github.com/users/iricigor/events{/privacy}",
      "followers_url": "https://api.github.com/users/iricigor/followers",
      "following_url": "https://api.github.com/users/iricigor/following{/other_user}",
      "gists_url": "https://api.github.com/users/iricigor/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iricigor",
      "id": 15923171,
      "login": "iricigor",
      "node_id": "MDQ6VXNlcjE1OTIzMTcx",
      "organizations_url": "https://api.github.com/users/iricigor/orgs",
      "received_events_url": "https://api.github.com/users/iricigor/received_events",
      "repos_url": "https://api.github.com/users/iricigor/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iricigor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iricigor/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iricigor"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "As far as I understand, the short of it is (right, @SeeminglyScience?):\r\n\r\n<sup>Terminology note: I'm using the term _scope domain_ to refer to the distinct variable namespaces inside a session: one default one for all non-module code, and one for each module loaded; they correspond to `SessionStateInternal` instances, as explained in a [blog post](https://seeminglyscience.github.io/powershell/2017/09/30/invocation-operators-states-and-scopes) by @SeeminglyScience. By _default scope domain_ I mean the namespace for all _non-module_ code (whose root is the global scope). My plan is to suggest these terms be used in an overhaul of the `about_Scopes` help topic.</sup>\r\n\r\n**Functions execute in whatever scope happens to be current one _in the scope domain they were defined in_**, which has the following implications:\r\n\r\n* Calling a function defined in a module from outside that module runs in [a child scope of] the _originating module's_ current scope, not in the caller's scope.\r\n\r\n* Calling a function in the same scope domain in which it is defined (i.e., calling a non-module function from non-module code, or calling a module function from inside the same module) runs in [a child scope of] the _caller's_ current scope.\r\n\r\n* This behavior applies even In _chains_ of calls across scope-domain boundaries (see `GlobalFunc` example below).\r\n\r\nNote that _functions_ create a _child scope_ on invocation, whereas compiled _cmdlets_ do not.\r\n\r\n---\r\n\r\nThe following code demonstrates these behaviors:\r\n\r\n```powershell\r\n# Define variables to test with.\r\n$global:foo = 'global foo'\r\n$foo = 'script foo'\r\n\r\n# A function in the global scope.\r\nfunction global:GlobalFunc {\r\n  \"glob func: [$foo]\"\r\n}\r\n\r\n# Define a non-module function that accesses variable $foo in \r\n# the parent and grandparent scopes.\r\nfunction NonModFunc {\r\n  foreach ($scope in 1, 2) {\r\n    try { \"scope $scope`: {0}\" -f (Get-Variable -ValueOnly -EA Stop -Scope $scope foo) } catch { Write-Warning \"No `$foo in scope $scope.\" }\r\n  }\r\n}\r\n\r\n# Save the function body as a string, so we can recreate it in the module below.\r\n# Note: We must create a *global* variable so that the script block passed to\r\n#       New-Module sees it, given that the script block runs in the new module's scope.\r\n$global:__funcDef = $function:NonModFunc\r\n\r\n# Define a function with the same body inside an (in-memory) module.\r\n$null = New-Module -ScriptBlock {\r\n  # Same function body as above, only inside a module and with name 'ModFunc'\r\n  Invoke-Expression ('function ModFunc {{ {0} }}' -f $__funcDef)\r\n  # Define a module function that invokes a global function.\r\n  function CallGlobal {\r\n    global:GlobalFunc\r\n  }\r\n}\r\n\r\n'--- non-module func'\r\nNonModFunc\r\n\r\n'--- module func'\r\nModFunc\r\n\r\n'--- non-module func from child scope'\r\n& { NonModFunc }\r\n\r\n'--- global func via module'\r\nCallGlobal\r\n```\r\n\r\nThe above yields (annotated):\r\n\r\n```powershell\r\n# Calling the non-module function from the script scope runs in a child scope of the script scope.\r\n--- non-module func\r\nscope 1: script foo  # The function's parent scope is the script scope.\r\nscope 2: global foo # The function's grandparent scope is the global scope.\r\n\r\n# Calling the module function from the script scope runs in a child scope of the *module* scope.\r\n--- module func\r\nWARNING: No $foo in scope 1.  # The module's root scope has no $foo.\r\nscope 2: global foo           # The parent of the module's root scope is the global scope.\r\n\r\n# Calling the non-module function from a child scope of the script scope (via a script block,\r\n# & { ... }), runs in a child scope of *that* scope.\r\n--- non-module func from child scope\r\nWARNING: No $foo in scope 1.  # The script block's scope has no $foo.\r\nscope 2: script foo           # The script block's parent scope is the script scope.\r\n\r\n# Calling a module function that in turn calls a global function makes the global function run\r\n# in the non-default (non-module) scope domain's current scope, which is the script scope\r\n# from which CallGlobal was called.\r\n--- global func via module\r\nglob func: [script foo]  # CallGlobal was originally called from the script scope.\r\n```\r\n",
    "created_at": "2018-10-15T18:15:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8022#issuecomment-429958906",
    "id": 429958906,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8022",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyOTk1ODkwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 1,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429958906/reactions"
    },
    "updated_at": "2018-10-15T18:15:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/429958906",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "This issue has been marked as answered and has not had any activity for **1 day**. It has been closed for housekeeping purposes.",
    "created_at": "2019-06-01T00:00:32Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/8022#issuecomment-497893530",
    "id": 497893530,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/8022",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Nzg5MzUzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/497893530/reactions"
    },
    "updated_at": "2019-06-01T00:00:32Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/497893530",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  }
]
