[
  {
    "author_association": "COLLABORATOR",
    "body": "@SteveL-MSFT @daxian-dbw this is... fairly serious, no? Being able to cancel a `finally` block seems _super_ not a good thing. ðŸ˜¦ ",
    "created_at": "2019-08-28T16:44:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10457#issuecomment-525827336",
    "id": 525827336,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10457",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTgyNzMzNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 2,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 2,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525827336/reactions"
    },
    "updated_at": "2019-08-28T16:44:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525827336",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Looks like there's no real system to handle \"delaying\" stops.\r\n\r\nThe example in the notes works mostly by accident.  In `ConsoleHost`, `^c` spins up a thread that handles stops the current pipeline and waits for it to finish.  In that handler, if that thread already exists it just returns early.  So the notes example only works because `ConsoleHost` thinks it's a duplicate stop request.\r\n\r\nA possible way to fix this would be to:\r\n\r\n1. Add a new field to `LocalPipeline` called `_areStopsDisabled`\r\n1. Add another field to `LocalPipeline` called `_wasStopReceivedWhileDisabled` with a better name\r\n1. Change `LocalPipeline.CoreStop` to check if `_areStopsDisabled` and to instead set `_wasStopReceivedWhileDisabled` if `true`\r\n1. Change the expression generated by the compiler for a `finally` block to set `LocalPipeline._areStopsDisabled` before the body, and to throw `PipelineStoppedException` after the body if `_wasStopReceivedWhileDisabled` is `true`\r\n1. Figure out how to do all that while accounting for nested `try`/`finally` blocks",
    "created_at": "2019-08-28T17:02:36Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10457#issuecomment-525833916",
    "id": 525833916,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10457",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTgzMzkxNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 1,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525833916/reactions"
    },
    "updated_at": "2019-08-28T17:02:36Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/525833916",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/24977523?v=4",
      "events_url": "https://api.github.com/users/SeeminglyScience/events{/privacy}",
      "followers_url": "https://api.github.com/users/SeeminglyScience/followers",
      "following_url": "https://api.github.com/users/SeeminglyScience/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeeminglyScience/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SeeminglyScience",
      "id": 24977523,
      "login": "SeeminglyScience",
      "node_id": "MDQ6VXNlcjI0OTc3NTIz",
      "organizations_url": "https://api.github.com/users/SeeminglyScience/orgs",
      "received_events_url": "https://api.github.com/users/SeeminglyScience/received_events",
      "repos_url": "https://api.github.com/users/SeeminglyScience/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SeeminglyScience/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeeminglyScience/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SeeminglyScience"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I guess it is not issue for background scripts like task scheduled.\r\nFor interactive session it could not big issue too - users press Ctrl-C most often when the script freezes and it can freezes in `finally` block too.",
    "created_at": "2019-08-29T04:38:17Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10457#issuecomment-526018681",
    "id": 526018681,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10457",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjAxODY4MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526018681/reactions"
    },
    "updated_at": "2019-08-29T04:38:17Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526018681",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I pretty much agree with @iSazonov - I don't think it's really a big issue. Once you hit ctrl-C, your shell is in an inconsistent state. Because that's how interactive shells work. If you're running a batch script/task or whatever, no one is hitting ctrl-C because - well - it's not interactive. The ctrl-C implementation in PowerShell is a pretty controlled compared to the first implementation (which simply terminated the thread.)\r\n\r\nBut if one was to change anything, there is a single value that represents the fact that the shell is stopping. Just save that value away in the finally clause then restore once finally is done. But wait - what if the user hit's stop again!?! That usually means that they *really* want it to stop. So the finalizer is interrupted. Well - that's what the user wanted. I don't have a problem with that.",
    "created_at": "2019-08-29T05:36:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10457#issuecomment-526030817",
    "id": 526030817,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10457",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjAzMDgxNw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526030817/reactions"
    },
    "updated_at": "2019-08-29T05:36:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526030817",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6876108?v=4",
      "events_url": "https://api.github.com/users/BrucePay/events{/privacy}",
      "followers_url": "https://api.github.com/users/BrucePay/followers",
      "following_url": "https://api.github.com/users/BrucePay/following{/other_user}",
      "gists_url": "https://api.github.com/users/BrucePay/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/BrucePay",
      "id": 6876108,
      "login": "BrucePay",
      "node_id": "MDQ6VXNlcjY4NzYxMDg=",
      "organizations_url": "https://api.github.com/users/BrucePay/orgs",
      "received_events_url": "https://api.github.com/users/BrucePay/received_events",
      "repos_url": "https://api.github.com/users/BrucePay/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/BrucePay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BrucePay/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/BrucePay"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "From a user perspective, that might make sense.\r\n\r\nFrom a module author's perspective, that stance could be really dangerous. Sure, it might be what the user wants, but **usually** the things you put in a `finally` block are pretty important. Cancelling a `finally` block can lead to corrupted data, memory leaks (objects can't be disposed properly), among a host of other problems.\r\n\r\nThis should be fixed.",
    "created_at": "2019-08-29T12:32:33Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/10457#issuecomment-526163844",
    "id": 526163844,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/10457",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNjE2Mzg0NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 5,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 5,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526163844/reactions"
    },
    "updated_at": "2019-08-29T12:32:39Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/526163844",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  }
]
