[
  {
    "author_association": "COLLABORATOR",
    "body": "If this no longer works as expected, it's a .NET change, not a PowerShell one.\r\n\r\n@jborean93 might have some background knowledge around how this can work or perhaps changes to the logic that may be required to make it work? ðŸ¤” ",
    "created_at": "2021-06-29T15:40:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-870708811",
    "id": 870708811,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDcwODgxMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870708811/reactions"
    },
    "updated_at": "2021-06-29T15:40:40Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870708811",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/32407840?v=4",
      "events_url": "https://api.github.com/users/vexx32/events{/privacy}",
      "followers_url": "https://api.github.com/users/vexx32/followers",
      "following_url": "https://api.github.com/users/vexx32/following{/other_user}",
      "gists_url": "https://api.github.com/users/vexx32/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vexx32",
      "id": 32407840,
      "login": "vexx32",
      "node_id": "MDQ6VXNlcjMyNDA3ODQw",
      "organizations_url": "https://api.github.com/users/vexx32/orgs",
      "received_events_url": "https://api.github.com/users/vexx32/received_events",
      "repos_url": "https://api.github.com/users/vexx32/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vexx32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vexx32/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vexx32"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "It is better to ask in .Net Runtime repository.",
    "created_at": "2021-06-29T18:20:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-870814752",
    "id": 870814752,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDgxNDc1Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870814752/reactions"
    },
    "updated_at": "2021-06-29T18:20:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870814752",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "It's definitely a .NET question but a very rudimentary way to do this would be to use the raw socket and wrap that without going into the HTTP request side:\r\n\r\n```powershell\r\n$server = 'httpbin.org'\r\n\r\n$client = $sslStream = $null\r\ntry {\r\n    $client = [System.Net.Sockets.TcpClient]::new($server, 443)\r\n    $sslStream = [System.Net.Security.SslStream]::new($client.GetStream(), $false, {$true}, $null)\r\n    $sslStream.AuthenticateAsClient($server)\r\n\r\n    $cert = $sslStream.RemoteCertificate\r\n}\r\nfinally {\r\n    if ($sslStream) { $sslStream.Close() }\r\n    if ($client) { $client.Close() }\r\n}\r\n```\r\n\r\nThis connects to the server and port specified and disables all validation so you can then get the certificate of the server. Some enhancements to this would be to explicitly connect to the `TcpClient` using the `ConnectAsync` so you can have a timeout on how long it waits until it deems the connection a failure. The `AuthenticateAsClient` has some further overloads you can use to control the TLS policy as well but they are highly dependent on the .NET version that is running so it will be up to you to define them how you wish.",
    "created_at": "2021-06-29T19:32:27Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-870859323",
    "id": 870859323,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDg1OTMyMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870859323/reactions"
    },
    "updated_at": "2021-06-29T19:32:34Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/870859323",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "NONE",
    "body": "**@jborean93** Thank you for that method. I need to play a bit with this way to figure out if it fits into my solution, and of course I'll report to .Net Runtime repository.\r\nAs I'm not that familiar with TcpClient today, could you please extend that sample a bit for me?\r\nIt would be great to have a sample of doing the following with TcpClient as well:\r\n\r\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\r\n\r\nAnd I do not know if having something implemented for the following is needed as well?\r\n\r\n[System.Net.WebRequest]::DefaultWebProxy = [System.Net.WebRequest]::GetSystemWebProxy()\r\n[System.Net.WebRequest]::DefaultWebProxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials \r\n\r\n",
    "created_at": "2021-06-30T09:01:35Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-871223968",
    "id": 871223968,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTIyMzk2OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/871223968/reactions"
    },
    "updated_at": "2021-06-30T09:01:35Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/871223968",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/45030137?v=4",
      "events_url": "https://api.github.com/users/schiroky/events{/privacy}",
      "followers_url": "https://api.github.com/users/schiroky/followers",
      "following_url": "https://api.github.com/users/schiroky/following{/other_user}",
      "gists_url": "https://api.github.com/users/schiroky/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/schiroky",
      "id": 45030137,
      "login": "schiroky",
      "node_id": "MDQ6VXNlcjQ1MDMwMTM3",
      "organizations_url": "https://api.github.com/users/schiroky/orgs",
      "received_events_url": "https://api.github.com/users/schiroky/received_events",
      "repos_url": "https://api.github.com/users/schiroky/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/schiroky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schiroky/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/schiroky"
    }
  },
  {
    "author_association": "NONE",
    "body": "This issue has been marked as external and has not had any activity for **1 day**. It has been be closed for housekeeping purposes.",
    "created_at": "2021-07-01T22:05:22Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-872578684",
    "id": 872578684,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjU3ODY4NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872578684/reactions"
    },
    "updated_at": "2021-07-01T22:05:22Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872578684",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/in/26612?v=4",
      "events_url": "https://api.github.com/users/msftbot%5Bbot%5D/events{/privacy}",
      "followers_url": "https://api.github.com/users/msftbot%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/msftbot%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/msftbot%5Bbot%5D/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/apps/msftbot",
      "id": 48340428,
      "login": "msftbot[bot]",
      "node_id": "MDM6Qm90NDgzNDA0Mjg=",
      "organizations_url": "https://api.github.com/users/msftbot%5Bbot%5D/orgs",
      "received_events_url": "https://api.github.com/users/msftbot%5Bbot%5D/received_events",
      "repos_url": "https://api.github.com/users/msftbot%5Bbot%5D/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/msftbot%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/msftbot%5Bbot%5D/subscriptions",
      "type": "Bot",
      "url": "https://api.github.com/users/msftbot%5Bbot%5D"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\r\n\r\nThe TLS settings are part of the `SslStream`, the `TcpClient` is basically just the raw transport that exchanges the packets and doesn't care about things like authentication and the like. If you want to control what TLS protocols that it can accept there is an overload of [AuthenticateAsClient](https://docs.microsoft.com/en-us/dotnet/api/system.net.security.sslstream.authenticateasclient?view=net-5.0#System_Net_Security_SslStream_AuthenticateAsClient_System_String_System_Security_Cryptography_X509Certificates_X509CertificateCollection_System_Security_Authentication_SslProtocols_System_Boolean_)\r\n\r\n```powershell\r\n$sslStream.AuthenticateAsClient(\r\n    $server,\r\n    $null,  # Certificates to use for X509 certificate authentication - probably don't need this\r\n    'None',  # The SslProtocols that are enabled\r\n    $true  # Whether to check for certificate revocation or not\r\n)\r\n``` \r\n\r\nThe [SslProtocols](https://docs.microsoft.com/en-us/dotnet/api/system.security.authentication.sslprotocols?view=net-5.0) value should be set to `None` if you are on a new enough .NET version, otherwise you can use `Default` or explicitly enable `Tls12` just like you do with `ServicePointManager`.\r\n\r\n> [System.Net.WebRequest]::DefaultWebProxy = [System.Net.WebRequest]::GetSystemWebProxy()\r\n> [System.Net.WebRequest]::DefaultWebProxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials\r\n\r\nUnfortunately the TCP Client this is a level lower than proxies, you need to be able to access the server and port directly. If you need to use proxies then maybe the HTTP request is more ideal but that's technically an extra layer that sits on top of TLS.",
    "created_at": "2021-07-01T23:24:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-872609056",
    "id": 872609056,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjYwOTA1Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872609056/reactions"
    },
    "updated_at": "2021-07-01T23:24:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872609056",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "NONE",
    "body": "Thank you!",
    "created_at": "2021-07-02T12:35:50Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15688#issuecomment-872964986",
    "id": 872964986,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15688",
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3Mjk2NDk4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872964986/reactions"
    },
    "updated_at": "2021-07-02T12:35:50Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/872964986",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/45030137?v=4",
      "events_url": "https://api.github.com/users/schiroky/events{/privacy}",
      "followers_url": "https://api.github.com/users/schiroky/followers",
      "following_url": "https://api.github.com/users/schiroky/following{/other_user}",
      "gists_url": "https://api.github.com/users/schiroky/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/schiroky",
      "id": 45030137,
      "login": "schiroky",
      "node_id": "MDQ6VXNlcjQ1MDMwMTM3",
      "organizations_url": "https://api.github.com/users/schiroky/orgs",
      "received_events_url": "https://api.github.com/users/schiroky/received_events",
      "repos_url": "https://api.github.com/users/schiroky/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/schiroky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schiroky/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/schiroky"
    }
  }
]
