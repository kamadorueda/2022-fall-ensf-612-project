[
  {
    "author_association": "CONTRIBUTOR",
    "body": "I believe I found the issue.  In Sort-Object.cs when a duplicate is found an item is taken from the end of the array and moved to the current position.  This has the side effect of breaking stable sorts because the source array is being re-ordered.  Below is the relevant code.  I believe a fix would just be instead of re-ordering the array just skip to the next record.  It seems that would be quicker and save on the data copying but I don't know enough C# to know if that is proper.\r\n\r\n```c#\r\n                   if (dataIndex != dataToSort.Count - discardedDuplicates)\r\n                    {\r\n                        // When discarding duplicates, replace them with an item at the end of the list and\r\n                        // adjust our counter so that we check the item we just swapped in next\r\n                        dataToSort[dataIndex] = dataToSort[dataToSort.Count - discardedDuplicates];\r\n                        dataIndex--;\r\n                    }\r\n```\r\n\r\nI have created the below targeted test case for the issue.  Currently the test fails since the Record \"B2\" is returned instead of \"B1\".\r\n\r\n```powershell\r\n    It \"Sort-Object with Uniqe Stable should return proper records\"{\r\n        $Record1=[PSCustomObject]@{Key=\"A\";Record=\"A1\"}\r\n        $Record2=[PSCustomObject]@{Key=\"A\";Record=\"A2\"}\r\n        $Record3=[PSCustomObject]@{Key=\"B\";Record=\"B1\"}\r\n        $Record4=[PSCustomObject]@{Key=\"B\";Record=\"B2\"}\r\n        $Records = @($Record1,$Record2,$Record3,$Record4)\r\n        $results = $Records | Sort-Object -Stable -Unique -Property Key\r\n\r\n        $results[0] | Should -Be $Records[0]\r\n        $results[1] | Should -Be $Records[2]\r\n    }\r\n```\r\n\r\n",
    "created_at": "2022-04-17T23:31:16Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16907#issuecomment-1100968148",
    "id": 1100968148,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16907",
    "node_id": "IC_kwDOAvT7bc5Bn3DU",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1100968148/reactions"
    },
    "updated_at": "2022-04-17T23:31:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1100968148",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/78430630?v=4",
      "events_url": "https://api.github.com/users/m1k0net/events{/privacy}",
      "followers_url": "https://api.github.com/users/m1k0net/followers",
      "following_url": "https://api.github.com/users/m1k0net/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1k0net/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/m1k0net",
      "id": 78430630,
      "login": "m1k0net",
      "node_id": "MDQ6VXNlcjc4NDMwNjMw",
      "organizations_url": "https://api.github.com/users/m1k0net/orgs",
      "received_events_url": "https://api.github.com/users/m1k0net/received_events",
      "repos_url": "https://api.github.com/users/m1k0net/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/m1k0net/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1k0net/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/m1k0net"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "This was resolved in PR #17189",
    "created_at": "2022-04-27T23:05:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16907#issuecomment-1111561615",
    "id": 1111561615,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16907",
    "node_id": "IC_kwDOAvT7bc5CQRWP",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1111561615/reactions"
    },
    "updated_at": "2022-04-27T23:05:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1111561615",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/78430630?v=4",
      "events_url": "https://api.github.com/users/m1k0net/events{/privacy}",
      "followers_url": "https://api.github.com/users/m1k0net/followers",
      "following_url": "https://api.github.com/users/m1k0net/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1k0net/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/m1k0net",
      "id": 78430630,
      "login": "m1k0net",
      "node_id": "MDQ6VXNlcjc4NDMwNjMw",
      "organizations_url": "https://api.github.com/users/m1k0net/orgs",
      "received_events_url": "https://api.github.com/users/m1k0net/received_events",
      "repos_url": "https://api.github.com/users/m1k0net/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/m1k0net/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1k0net/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/m1k0net"
    }
  }
]
