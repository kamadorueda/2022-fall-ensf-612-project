[
  {
    "author_association": "CONTRIBUTOR",
    "body": "Can you please provide the output of your `$PSVersionTable`?\r\nAlso, Can you provide the exact steps to reproduce the issue? I suspect this is using the cmdlet outside of its intended purpose, but it's hard to make that call without exact steps to reproduce.\r\n\r\nWhen output is not redirected to a file, `Invoke-RestMethod` coerces unknown content to a string which means that a string encoding gets applied to it. If the server is not supplying the correct encoding (which, usually `application/octet-stream` does not send with an encoding) it's quite possible that bytes would get mixed up in the encoding process. `Invoke-RestMethod` isn't really meant for working with a byte stream.\r\n\r\nI was unable to reproduce an issue using the following:\r\n\r\n```\r\ndotnet new mvc\r\n```\r\nedit `Controllers\\HomeController.cs`\r\nadd the following endpoint:\r\n```csharp\r\n        [HttpGet]\r\n        public FileStreamResult Bytes()\r\n        {\r\n            Byte[] bytes = new Byte[]{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16};\r\n            MemoryStream mstream = new MemoryStream(bytes);\r\n            return new FileStreamResult(mstream, \"application/octet-stream\");            \r\n        }\r\n```\r\nrun it\r\n```\r\ndotnet run\r\n```\r\ndo the following:\r\n```powershell\r\n[System.Text.Encoding]::UTF8.GetBytes((irm 'http://localhost:5000/home/Bytes' ))\r\n\"-----\"\r\n(iwr 'http://localhost:5000/home/Bytes' ).Content\r\n```\r\n\r\nResult:\r\n```none\r\n1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n13\r\n14\r\n15\r\n16\r\n-----\r\n1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n13\r\n14\r\n15\r\n16\r\n```\r\n\r\n",
    "created_at": "2017-11-03T20:16:58Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5334#issuecomment-341814862",
    "id": 341814862,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5334",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTgxNDg2Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341814862/reactions"
    },
    "updated_at": "2017-11-03T20:17:45Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341814862",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "NONE",
    "body": "Thank you for the prompt response. Impressive!\r\n\r\nI forgot to mention that this issue happens when you send bytes that map to decimal point and negative values such as 10.1 and -1. I have recorded the steps above. I don't have a clear repro to share with you since the response is coming from an internal server. I have updated the repro steps above if it helps though.\r\n\r\nI think you're right about the string interpretation messing up the bytes. That would make sense and it's what I had guessed before looking at the code. It helps to know that Invoke-RestMethod is not meant to support binary responses. But what I would suggest is if the encoding is not JSON or XML, to return the Content that is coming back from WebRequest rather than returning as a string. With some more code reading, I could probably submit a PR to fix this, but someone more familiar with the code should be able to do it more quickly :)",
    "created_at": "2017-11-03T22:02:37Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5334#issuecomment-341838301",
    "id": 341838301,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5334",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTgzODMwMQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341838301/reactions"
    },
    "updated_at": "2017-11-03T22:02:37Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341838301",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5313328?v=4",
      "events_url": "https://api.github.com/users/zehranaz/events{/privacy}",
      "followers_url": "https://api.github.com/users/zehranaz/followers",
      "following_url": "https://api.github.com/users/zehranaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/zehranaz/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/zehranaz",
      "id": 5313328,
      "login": "zehranaz",
      "node_id": "MDQ6VXNlcjUzMTMzMjg=",
      "organizations_url": "https://api.github.com/users/zehranaz/orgs",
      "received_events_url": "https://api.github.com/users/zehranaz/received_events",
      "repos_url": "https://api.github.com/users/zehranaz/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/zehranaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zehranaz/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/zehranaz"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": ">  But what I would suggest is if the encoding is not JSON or XML, to return the Content that is coming back from WebRequest rather than returning as a string.\r\n\r\nThat's not what I would expect from the command. `Invoke-RestMethod` is more light weight than `Invoke-WebRequest`, which makes it ideal for web scraping and other activities that do not need the structured complexity of the WebResponseObject. If you want the full object, than just use `Invoke-WebRequest`. I think requesting that behavior is a non-starter. It would be a massive breaking change for very little gain when there is already a cmdlet that does that.\r\n\r\nThere is another request #3829 to provide raw streams to be able to do things like log streams, What you are trying to do would be another use-case for my proposal there to add a new web cmdlet that adds stream handling features. something like `-AsByteStream` or something similar as a switch for that cmdlet.\r\n",
    "created_at": "2017-11-03T22:21:01Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5334#issuecomment-341841462",
    "id": 341841462,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5334",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTg0MTQ2Mg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341841462/reactions"
    },
    "updated_at": "2017-11-03T22:21:01Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341841462",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@zehranaz I see that you have updated your post with the PS version table and it is for Windows PowerShell 5.1. Can you reproduce your issue with with PowerShell Core 6.0.0-beta.9?\r\n\r\nIf you are not using PowerShell Core and wish to file a bug or feature request for Windows PowerShell 5.1, please use the Windows PowerShell [UserVoice](https://windowsserver.uservoice.com/forums/301869-powershell).",
    "created_at": "2017-11-03T23:04:38Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5334#issuecomment-341848302",
    "id": 341848302,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5334",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTg0ODMwMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341848302/reactions"
    },
    "updated_at": "2017-11-03T23:04:38Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/341848302",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Old issue without feedback.",
    "created_at": "2019-09-28T18:04:11Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/5334#issuecomment-536211810",
    "id": 536211810,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/5334",
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNjIxMTgxMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/536211810/reactions"
    },
    "updated_at": "2019-09-28T18:04:11Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/536211810",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
