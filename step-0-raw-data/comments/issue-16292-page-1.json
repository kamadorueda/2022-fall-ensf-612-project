[
  {
    "author_association": "COLLABORATOR",
    "body": ">It kills the interactive session ...\r\n\r\nThis repro description is not very clear but it sounds like the command run in the remote interactive session, `$ powershell.exe -nologo -File MyRemoting.ps1`, is causing the remote session to end.  If this is the case, then this only happens if there is a unrecoverable error in the remote session or the remote session host process crashes.  You can look at the session object on the client for more information:\r\n\r\n```powershell\r\nPS C:\\> $s\r\n\r\n Id Name            Transport ComputerName    ComputerType    State         ConfigurationName     Availability\r\n -- ----            --------- ------------    ------------    -----         -----------------     ------------\r\n  3 Runspace2       SSH       localhost       RemoteMachine   Broken        DefaultShell                  None\r\n\r\nPS C:\\> $s.Runspace.RunspaceStateInfo.Reason\r\n\r\nErrorCode                   : 0\r\nTransportMessage            :\r\nErrorRecord                 : The SSH client session has ended with error message: The SSH transport process has\r\n                              abruptly terminated causing this remote session to break.\r\nWasThrownFromThrowStatement : False\r\n...\r\n```\r\n",
    "created_at": "2021-10-22T16:33:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-949788672",
    "id": 949788672,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc44nKAA",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949788672/reactions"
    },
    "updated_at": "2021-10-22T16:33:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949788672",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@PaulHigin I believe the issue is OP wants `Enter-PSSession` to act like a blocking command when run from the script. That is they want to have a script that opens the PSSession and waits until the user has explicitly exited it before the script continues. As mentioned they can do\r\n\r\n```\r\npowershell.exe -nologo -noexit -File MyRemoting.ps1\r\n```\r\n\r\nBut that will still exit the PSSession and move onto the next comand or wait for further input once it reaches the end.",
    "created_at": "2021-10-22T21:44:34Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-949976415",
    "id": 949976415,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc44n31f",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949976415/reactions"
    },
    "updated_at": "2021-10-22T21:44:34Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949976415",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Oh I see.  That is an incorrect use of `Enter-PSSession`.  It extends the client interactive shell to a remote session, and is intended for interactive use only.  For non-interactive script you should use `Invoke-Command` on a remote session.",
    "created_at": "2021-10-22T22:06:49Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-949985407",
    "id": 949985407,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc44n6B_",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949985407/reactions"
    },
    "updated_at": "2021-10-22T22:06:49Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/949985407",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": "@PaulHigin I have a pretty similar use case, where I want to acquire an interactive session in the middle of a script.\r\nWhat other means exist to achieve that, beside `Enter-PSSession`?\r\n\r\nIn detail I have a utility script that sets up a remote session, and I would like to have the tear-down part after it. Like\r\n\r\n```powershell\r\n# Set up parts\r\n# ...\r\n# Enter the interactive session, command execution is yielded to the user (me)\r\nEnter-PSSession $pss\r\n# Enter-PSSession does not return, until exit/Exit-PSSession is called\r\n# Tear down that I have to do manually currently\r\n# finally exit pwsh\r\nexit\r\n```\r\n\r\nI suggest, that if it is unfeasible to implement a blocking way to call `Enter-PSSession` (with a flag like `-Wait` or `-Block` or `-Interactive`), it could put up a warning that calling the command from a script will not result in what a user could expect.",
    "created_at": "2021-11-01T21:04:04Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-956588414",
    "id": 956588414,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc45BGF-",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/956588414/reactions"
    },
    "updated_at": "2021-11-01T21:04:04Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/956588414",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/15245298?v=4",
      "events_url": "https://api.github.com/users/mrmeszaros/events{/privacy}",
      "followers_url": "https://api.github.com/users/mrmeszaros/followers",
      "following_url": "https://api.github.com/users/mrmeszaros/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrmeszaros/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mrmeszaros",
      "id": 15245298,
      "login": "mrmeszaros",
      "node_id": "MDQ6VXNlcjE1MjQ1Mjk4",
      "organizations_url": "https://api.github.com/users/mrmeszaros/orgs",
      "received_events_url": "https://api.github.com/users/mrmeszaros/received_events",
      "repos_url": "https://api.github.com/users/mrmeszaros/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mrmeszaros/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrmeszaros/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mrmeszaros"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Why do you want to convert a running script into an interactive session?  You can have PowerShell prompt for input, if that is needed.  But currently the only way for a running script to allow interactive access to the session is through the script debugger.\r\n\r\nIf you really need to do this, you can add a `Wait-Debugger` command in your script where you want the script to stop running and break into the script debugger, where you can have interactive access to the session.  But you need to be careful because if there is no terminal the script will wait indefinitely for a debugger attach.",
    "created_at": "2021-11-01T22:41:53Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-956785251",
    "id": 956785251,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc45B2Jj",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/956785251/reactions"
    },
    "updated_at": "2021-11-01T22:50:13Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/956785251",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  },
  {
    "author_association": "NONE",
    "body": "I have a pretty special use case.\r\nI want to connect to windows machines from a linux machine in a single step. There are many machines, so I have populated my `/etc/hosts` file for shell autocompletion purposes.\r\n\r\n```fish\r\n#!/usr/bin/env fish\r\nfunction pwsh-remote --argument host --description 'Open Powershell to remote...'\r\n  pwsh -NoExit -Command \"\r\n  \\$creds = Get-Credential -UserName the-doctor\r\n  \\$pss = New-PSSession -ComputerName $host -Authentication Negotiate -Credential \\$creds\r\n  Enter-PSSession \\$pss\r\n  # This should run after exiting the remote and exit the main pwsh\r\n  exit\r\n  \"\r\nend\r\ncomplete -c pwsh-remote -x -d \"Remote\" -a \"(__fish_complete_user_at_hosts)\"\r\n```\r\n\r\nI have tried using `Register-EngineEvent` with `-SourceIdentifier PowerShell.Exiting` (and `-Forward` on the remote) hoping to catch the event of exiting the remote PSSession but with no avail.\r\n(Sadly [my stackoverflow question](https://stackoverflow.com/questions/69782883/how-to-forward-powershell-exiting-event-when-remoting-on-linux) did not provide a satisfying answer yet.)\r\n\r\nBasically, I would like to have callbacks on exiting the remote session.\r\nNow I know this is an issue tracker and no Q/A forum so should it bother You, please nudge me towards the right forum/person?",
    "created_at": "2021-11-03T15:10:18Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-959385215",
    "id": 959385215,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc45Lw5_",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/959385215/reactions"
    },
    "updated_at": "2021-11-03T15:12:01Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/959385215",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/15245298?v=4",
      "events_url": "https://api.github.com/users/mrmeszaros/events{/privacy}",
      "followers_url": "https://api.github.com/users/mrmeszaros/followers",
      "following_url": "https://api.github.com/users/mrmeszaros/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrmeszaros/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mrmeszaros",
      "id": 15245298,
      "login": "mrmeszaros",
      "node_id": "MDQ6VXNlcjE1MjQ1Mjk4",
      "organizations_url": "https://api.github.com/users/mrmeszaros/orgs",
      "received_events_url": "https://api.github.com/users/mrmeszaros/received_events",
      "repos_url": "https://api.github.com/users/mrmeszaros/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mrmeszaros/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrmeszaros/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mrmeszaros"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@mrmeszaros Please open new question in our Discussions.",
    "created_at": "2021-11-03T18:30:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-959809482",
    "id": 959809482,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc45NYfK",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/959809482/reactions"
    },
    "updated_at": "2021-11-03T18:30:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/959809482",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "hi mrm:\r\n[kasini3000](https://gitee.com/chuanjiao10/kasini3000)    \r\nwin,linux devops automation batch script framework.(It is similar to ansible) \r\nOpen source, free, cross-platform \r\n\r\nEnglish manual: https://gitee.com/chuanjiao10/kasini3000/blob/master/docs/kasini3000_manual.xlsx\r\nscript dependencies 【c:\\ProgramData\\kasini3000\\nodelist.csv】\r\n\r\n1 Multi-process batch execution. k-commit.ps1\r\n2 Multi-threaded batch execution. k-commit-rs.ps1 #need powershell module poshrsjob\r\nsetup:\r\ncopy files from\r\nc:\\ProgramData\\kasini3000\\lib\\kasini3000\\ProgramFiles_WindowsPowerShell_Modules\r\nto\r\n$psmodulepath\r\n\r\n----\r\nc:\\ProgramData\\kasini3000\\k_run_ip_port_l2w_user_pwd.ps1\r\nor \r\n/etc/kasini3000/k_run_ip_port_l2w_user_pwd.ps1 #linux \r\nthis script not dependencies 【c:\\ProgramData\\kasini3000\\nodelist.csv】,but need parameter username ,password.\r\n\r\n**From linux master to win node, no support is provided.**\n\n<blockquote><img src=\"https://gitee.com/static/images/logo_themecolor.png\" width=\"48\" align=\"right\"><div>Gitee</div><div><strong><a href=\"http://gitee.com/chuanjiao10/kasini3000/blob/master/docs/kasini3000_manual.xlsx\">docs/kasini3000_manual.xlsx · chuanjiao10/kasini3000 - Gitee.com</a></strong></div><div>类似于Puppet，Ansible，pipeline。号称比ansible好10倍，具有批量远程推送脚本，执行脚本，远程传递代码块，定时执行的，devops运维工具。</div></blockquote>",
    "created_at": "2021-12-02T05:49:19Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16292#issuecomment-984314092",
    "id": 984314092,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16292",
    "node_id": "IC_kwDOAvT7bc46q3Ds",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/984314092/reactions"
    },
    "updated_at": "2021-12-02T05:49:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/984314092",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/65390418?v=4",
      "events_url": "https://api.github.com/users/kasini3000/events{/privacy}",
      "followers_url": "https://api.github.com/users/kasini3000/followers",
      "following_url": "https://api.github.com/users/kasini3000/following{/other_user}",
      "gists_url": "https://api.github.com/users/kasini3000/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/kasini3000",
      "id": 65390418,
      "login": "kasini3000",
      "node_id": "MDQ6VXNlcjY1MzkwNDE4",
      "organizations_url": "https://api.github.com/users/kasini3000/orgs",
      "received_events_url": "https://api.github.com/users/kasini3000/received_events",
      "repos_url": "https://api.github.com/users/kasini3000/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/kasini3000/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kasini3000/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/kasini3000"
    }
  }
]
