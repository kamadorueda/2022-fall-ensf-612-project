[
  {
    "author_association": "NONE",
    "body": "from linux ,use omi ,to win, i have similar question.  https://github.com/PowerShell/PowerShell/discussions/16623\r\nmark，the problem may not be resolved soon",
    "created_at": "2022-01-22T06:14:25Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16787#issuecomment-1019072839",
    "id": 1019072839,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16787",
    "node_id": "IC_kwDOAvT7bc48vdFH",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1019072839/reactions"
    },
    "updated_at": "2022-01-22T06:14:25Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1019072839",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/65390418?v=4",
      "events_url": "https://api.github.com/users/kasini3000/events{/privacy}",
      "followers_url": "https://api.github.com/users/kasini3000/followers",
      "following_url": "https://api.github.com/users/kasini3000/following{/other_user}",
      "gists_url": "https://api.github.com/users/kasini3000/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/kasini3000",
      "id": 65390418,
      "login": "kasini3000",
      "node_id": "MDQ6VXNlcjY1MzkwNDE4",
      "organizations_url": "https://api.github.com/users/kasini3000/orgs",
      "received_events_url": "https://api.github.com/users/kasini3000/received_events",
      "repos_url": "https://api.github.com/users/kasini3000/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/kasini3000/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kasini3000/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/kasini3000"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "This error comes from psl-omi-provider at https://github.com/PowerShell/psl-omi-provider/blob/59ab42f3bc769b1aa31c1181e3a97ea3e1b1c96e/src/BufferManipulation.c#L35-L39. It would indicate there's a problem calling [iconv_open](https://man7.org/linux/man-pages/man3/iconv_open.3.html) and the error code it's returning is `22` meaning invalid argument. Looking further back this function is called with `UTF-16LE` and `UTF-8`. It seems like `iconv_open` does not support either of these character sets or maybe the combination of both for your setup.\r\n\r\nYou can replicate this same call in pwsh with\r\n\r\n```powershell\r\nAdd-Type -Namespace Native -Name Methods -MemberDefinition @'\r\n[DllImport(\"libc\", SetLastError = true)]\r\nprivate static extern IntPtr iconv_open(string tocode, string fromcode);\r\n\r\npublic static IntPtr IconvOpen(string to, string from)\r\n{\r\n    IntPtr res = iconv_open(to, from);\r\n    if (res == new IntPtr(-1))\r\n    {\r\n        var ex = new System.ComponentModel.Win32Exception();\r\n        \r\n        throw new Exception(String.Format(\"iconv_open error {0} - {1}\", ex.NativeErrorCode, ex.Message));\r\n    }\r\n    \r\n    return res;\r\n}\r\n'@\r\n\r\n[Native.Methods]::IconvOpen(\"UTF-16LE\", \"UTF-8\")\r\n[Native.Methods]::IconvOpen(\"UTF-8\", \"UTF-16LE2\")\r\n```\r\n\r\nIf either of those 2 calls to `iconv_open` fail it will display the errorno and message, in your case it will most likely be `22 - Invalid argument`. I cannot replicate this at all even on a blank `centos:8` container (both return valid pointers) so not sure what's actually happening on your host. One thing to check is the contents of `/usr/lib64/gconv` to see what it contains. I can see `UNICODE.so`, `UTF-16.so` in that folder. Unfortunately at this point I don't fully understand the behaviour of iconv but the problem for this particular issue lies there and that's where you should investigate further.\r\n\r\nJust as a side note, the fact that this function is being reached is usually an indication that the underlying MI library failed for some reason and it is trying to convert the error code from UTF-16-LE encoded bytes to UTF-8 for consumption. There are numerous issues with MI on Linux and the provided one from pwsh is mostly a best effort attempt but not really that great. You could try my fork https://github.com/jborean93/omi through the [PSWSMan](https://www.powershellgallery.com/packages/PSWSMan/2.3.0) module. This is not supported by MS in any way and is mostly my attempt to [solve the various problems](https://github.com/jborean93/omi#changes-from-upstream-omi) MI has on Linux in relation to PowerShell remoting. It also doesn't really change `psl-omi-provider` very much so if the same error is occurring with my fork you will most like still see this error.\n\n<blockquote><img src=\"https://opengraph.githubassets.com/9c2227a9bafacb92749a8ed279b31a2ca2e8e5cde57c8b3c078fa25c72e5517c/PowerShell/psl-omi-provider\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/PowerShell/psl-omi-provider\">psl-omi-provider/BufferManipulation.c at 59ab42f3bc769b1aa31c1181e3a97ea3e1b1c96e · PowerShell/psl-omi-provider</a></strong></div><div>PSRP Linux support library. Contribute to PowerShell/psl-omi-provider development by creating an account on GitHub.</div></blockquote>\n<blockquote><img src=\"https://opengraph.githubassets.com/17d1db716a0bcb6c993b53bdb256341fed6b28c06e0b8fc7bbcefabef0ddf024/jborean93/omi\" width=\"48\" align=\"right\"><div><img src=\"https://github.githubassets.com/favicons/favicon.svg\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/jborean93/omi\">GitHub - jborean93/omi: Open Management Infrastructure</a></strong></div><div>Open Management Infrastructure. Contribute to jborean93/omi development by creating an account on GitHub.</div></blockquote>",
    "created_at": "2022-01-22T23:12:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16787#issuecomment-1019374595",
    "id": 1019374595,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16787",
    "node_id": "IC_kwDOAvT7bc48wmwD",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1019374595/reactions"
    },
    "updated_at": "2022-01-22T23:12:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1019374595",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@WG-Remoting\r\nNew-PSSession is no longer supported on non-Windows platforms, because OMI is no longer supported (#15310).  We hope that the community will pick up support for this using the new Custom Remote Connections support (#16923).",
    "created_at": "2022-04-07T17:27:59Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/16787#issuecomment-1092008776",
    "id": 1092008776,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/16787",
    "node_id": "IC_kwDOAvT7bc5BFrtI",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1092008776/reactions"
    },
    "updated_at": "2022-04-07T17:27:59Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1092008776",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/14019529?v=4",
      "events_url": "https://api.github.com/users/PaulHigin/events{/privacy}",
      "followers_url": "https://api.github.com/users/PaulHigin/followers",
      "following_url": "https://api.github.com/users/PaulHigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulHigin/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/PaulHigin",
      "id": 14019529,
      "login": "PaulHigin",
      "node_id": "MDQ6VXNlcjE0MDE5NTI5",
      "organizations_url": "https://api.github.com/users/PaulHigin/orgs",
      "received_events_url": "https://api.github.com/users/PaulHigin/received_events",
      "repos_url": "https://api.github.com/users/PaulHigin/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/PaulHigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulHigin/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/PaulHigin"
    }
  }
]
