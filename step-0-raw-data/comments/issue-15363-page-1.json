[
  {
    "author_association": "NONE",
    "body": "The Windows PowerShell make the same output,  as raw xml.  \r\nMaybe that's how it should be?  \r\nWhat would you expect, for example, from `tasklist.exe /fo:csv`?",
    "created_at": "2021-05-07T22:10:35Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834815303",
    "id": 834815303,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDgxNTMwMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834815303/reactions"
    },
    "updated_at": "2021-05-07T22:10:35Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834815303",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/78153320?v=4",
      "events_url": "https://api.github.com/users/237dmitry/events{/privacy}",
      "followers_url": "https://api.github.com/users/237dmitry/followers",
      "following_url": "https://api.github.com/users/237dmitry/following{/other_user}",
      "gists_url": "https://api.github.com/users/237dmitry/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/237dmitry",
      "id": 78153320,
      "login": "237dmitry",
      "node_id": "MDQ6VXNlcjc4MTUzMzIw",
      "organizations_url": "https://api.github.com/users/237dmitry/orgs",
      "received_events_url": "https://api.github.com/users/237dmitry/received_events",
      "repos_url": "https://api.github.com/users/237dmitry/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/237dmitry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/237dmitry/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/237dmitry"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@237dmitry:\r\n\r\nYes, the bug affects Windows PowerShell too.\r\n\r\nExternal programs _other than the PowerShell CLI_ - such as `tasklist.exe` -  cannot and are not expected to emit output in  _CLIXML_ format,  which is PowerShell's _serialization_ format.\r\n\r\nBy contrast, the PowerShell CLI's `-OutputFormat xml` parameter explicitly requests this CLIXML format, and PowerShell _generally_ recognizes it as such and _automatically deserializes_ such output into objects - except when printing directly to the console, which is the bug at hand.\r\n",
    "created_at": "2021-05-07T22:17:11Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834818986",
    "id": 834818986,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDgxODk4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834818986/reactions"
    },
    "updated_at": "2021-05-07T22:17:11Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834818986",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "NONE",
    "body": "I think the deserialization of objects only applies to redirects to a file. So it turns out that if you call this command from within powershell/pwsh you will not be able to redirect it to a file as CLIXML (Export-CliXml is for this), unlike other shells (cmd, bash, etc.).   \r\nBut, yes, the output to the console (pwsh) in this form is useless, unless it will be copied with the mouse or keyboard.",
    "created_at": "2021-05-07T23:25:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834857898",
    "id": 834857898,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDg1Nzg5OA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834857898/reactions"
    },
    "updated_at": "2021-05-07T23:25:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834857898",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/78153320?v=4",
      "events_url": "https://api.github.com/users/237dmitry/events{/privacy}",
      "followers_url": "https://api.github.com/users/237dmitry/followers",
      "following_url": "https://api.github.com/users/237dmitry/following{/other_user}",
      "gists_url": "https://api.github.com/users/237dmitry/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/237dmitry",
      "id": 78153320,
      "login": "237dmitry",
      "node_id": "MDQ6VXNlcjc4MTUzMzIw",
      "organizations_url": "https://api.github.com/users/237dmitry/orgs",
      "received_events_url": "https://api.github.com/users/237dmitry/received_events",
      "repos_url": "https://api.github.com/users/237dmitry/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/237dmitry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/237dmitry/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/237dmitry"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "> I think the deserialization of objects only applies to redirects to a file. \r\n\r\nNo, it doesn't just apply to redirection to a _file_, it applies to _any other form of additional processing_ other than printing directly to the console - that's why the to-console output behavior should be considered a bug.\r\n\r\nJust try the following:\r\n\r\n```powershell\r\nPS> $output = pwsh -OutputFormat xml -noprofile -c 'Get-Item $PROFILE'; $output.pstypenames[0]; $output\r\nDeserialized.System.IO.FileInfo\r\n\r\n    Directory: /Users/mklement/.config/powershell\r\n\r\nUnixMode   User             Group                 LastWriteTime           Size Name\r\n--------   ----             -----                 -------------           ---- ----\r\n-rw-r--r-- mklement         staff               3/25/2021 16:21           1281 Microsoft.PowerShell_profile.ps1\r\n```\r\n\r\nAs you can see what variable `$output` captured was a _deserialized_ `System.IO.FileInfo` instance (`Deserialized.System.IO.FileInfo`), and outputting it resulted in the usual output formatting.\r\n",
    "created_at": "2021-05-07T23:31:56Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834861354",
    "id": 834861354,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDg2MTM1NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834861354/reactions"
    },
    "updated_at": "2021-05-07T23:31:56Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834861354",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@237dmitry issue is that if you don't capture any output when calling a native command then the output goes directly to the console without it being touched at all by PowerShell.\r\n\r\n```powershell\r\n# not captured - direct to console\r\nmy.exe arguments\r\n\r\n# captured in some way - powershell converts to a string object\r\n$var = my.exe arguments\r\nmy.exe argumens | Out-String\r\nmy.exe arguments > C:\\path\\file.txt\r\n```\r\n\r\nIf PowerShell isn't capturing the output then the CLIXML is written directly to the console.",
    "created_at": "2021-05-07T23:34:00Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834862466",
    "id": 834862466,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDg2MjQ2Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834862466/reactions"
    },
    "updated_at": "2021-05-07T23:34:00Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834862466",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/8462645?v=4",
      "events_url": "https://api.github.com/users/jborean93/events{/privacy}",
      "followers_url": "https://api.github.com/users/jborean93/followers",
      "following_url": "https://api.github.com/users/jborean93/following{/other_user}",
      "gists_url": "https://api.github.com/users/jborean93/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/jborean93",
      "id": 8462645,
      "login": "jborean93",
      "node_id": "MDQ6VXNlcjg0NjI2NDU=",
      "organizations_url": "https://api.github.com/users/jborean93/orgs",
      "received_events_url": "https://api.github.com/users/jborean93/received_events",
      "repos_url": "https://api.github.com/users/jborean93/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/jborean93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jborean93/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/jborean93"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the clarification, @jborean93. \r\n\r\nIt seems that the problem boils down to this:\r\n\r\nWith a _script-block_-based invocation that _implies_ CLIXML output, PowerShell already knows that direct-to-host output of the raw CLIXML _isn't_ appropriate, and that the raw output needs to be deserialized first and then sent to the formatting system:\r\n\r\n```powershell\r\nPS> pwsh -noprofile -c { Get-Item $PROFILE }\r\n\r\n    Directory: /Users/jdoe/.config/powershell\r\n\r\nUnixMode   User             Group                 LastWriteTime           Size Name\r\n--------   ----             -----                 -------------           ---- ----\r\n-rw-r--r-- jdoe             staff               3/19/2021 09:20            909 Microsoft.PowerShell_profile.ps1\r\n```\r\n\r\nIf a script block _isn't_ involved and CLIXML output is explicitly requested via `-OutputFormat xml`, PowerShell does _not_ apply the necessary logic:\r\n\r\n```powershell\r\nPS> pwsh -OutputFormat xml -noprofile -c 'Get-Item $PROFILE'\r\n# CLIXML output\r\n```\r\n\r\nAlso note that _redundantly_ adding `-OutputFormat xml` _to the script-block_ invocation scenario also results in broken output:\r\n\r\n```powershell\r\nPS>  pwsh -OutputFormat xml -noprofile -c { Get-Item $PROFILE }\r\n# CLIXML output\r\n```\r\n\r\n\r\n\r\n",
    "created_at": "2021-05-07T23:46:31Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15363#issuecomment-834870108",
    "id": 834870108,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15363",
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDg3MDEwOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834870108/reactions"
    },
    "updated_at": "2021-05-07T23:46:31Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/834870108",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  }
]
