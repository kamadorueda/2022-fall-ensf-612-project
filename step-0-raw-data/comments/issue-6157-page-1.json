[
  {
    "author_association": "CONTRIBUTOR",
    "body": "This has come up a few times. `HttpClient` treats 300 level responses as an unsuccessful response. The web cmdlets interpret that as a failure and produces a terminating error. It's not that `MaximumRedirection 0` is ignored, it's that it is producing an error and your `$res` is stale with the previous succesful `$res = irw ...` call. Toe verify, please run `$res = $null` before your `$res = irw ...` call\r\n\r\n```powershell\r\n$res = $null\r\n$res = Invoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0\r\n$null -eq $res\r\n```\r\n\r\nShould be `True`.\r\n\r\n\r\nYou can get the location like this:\r\n\r\n```powershell\r\nInvoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0 -ErrorVariable Err\r\n$err[0].InnerException.Response.Headers.Location\r\n```\r\n\r\nor\r\n\r\n```powershell\r\nTry {\r\n    Invoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0\r\n} catch {\r\n    $_.Exception.Response.Headers.Location\r\n}\r\n```\r\n\r\nIn previous discussions, I leaned on this actually being a correction of bad behavior, If I tell the command I want it to not redirect by supplying `-MaximumRedirection 0`, then I expect it to error if it tries to redirect, The behavior in 5.1 is odd to me...  it displays an error but still populates the variable with a result. To me, this is a terminating error and the behavior in 6.0.0 is correct.",
    "created_at": "2018-02-14T22:06:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6157#issuecomment-365760673",
    "id": 365760673,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6157",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTc2MDY3Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365760673/reactions"
    },
    "updated_at": "2018-02-14T22:06:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365760673",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "It's nice to have a workaround but really, this is a bit of spew don't you think?\r\n```posh\r\nInvoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0 -ErrorVariable Err\r\n$err[0].InnerException.Response.Headers.Location\r\n```\r\nBy specifying `-MaximumRedirection 0` in this scenario, I'm indicating that I **want** the 301 redirect response (headers and content).  That's not that uncommon of a thing to do especially when you're trying to resolve the target of bit.ly style URL.  FWIW I much prefer the PowerShell 5.1 behavior in this case.  At the very least, there should be a way to accomplish this in PS Core without having to root around in exception info.  That just not intuitive at all.  Could we special case the `-MaximumRedirection 0` scenario - catch the HttpClient exception and if a 3xx status, not report as an error?  Or maybe we should have another parameter??  What I'm after is something like `curl -v <url>` provides.  Our verbose output is, well, lacking.  Maybe we should have a `-Trace` switch that writes out at least request/response header info?",
    "created_at": "2018-02-14T23:03:09Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6157#issuecomment-365774369",
    "id": 365774369,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6157",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTc3NDM2OQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365774369/reactions"
    },
    "updated_at": "2018-02-14T23:03:09Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365774369",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5177512?v=4",
      "events_url": "https://api.github.com/users/rkeithhill/events{/privacy}",
      "followers_url": "https://api.github.com/users/rkeithhill/followers",
      "following_url": "https://api.github.com/users/rkeithhill/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkeithhill/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rkeithhill",
      "id": 5177512,
      "login": "rkeithhill",
      "node_id": "MDQ6VXNlcjUxNzc1MTI=",
      "organizations_url": "https://api.github.com/users/rkeithhill/orgs",
      "received_events_url": "https://api.github.com/users/rkeithhill/received_events",
      "repos_url": "https://api.github.com/users/rkeithhill/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rkeithhill/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkeithhill/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rkeithhill"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Yea, This is a difference of opinion. I have times where I don't want to redirect.. and in those times I'm specifying `-MaximumRedirection 0`. In 5.1 this behavior was bad...\r\n\r\n```powershell\r\nTry { \r\n    Invoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0\r\n} catch {\r\n    'Caught'\r\n}\r\n```\r\n\r\ndoesn't catch, spits out both the response and an error.\r\n\r\n```powershell\r\nTry { \r\n    Invoke-WebRequest -uri 'https://t.co/4OAcNMg9kv' -MaximumRedirection 0 -ErrorAction Stop\r\n} catch {\r\n    'Caught'\r\n}\r\n```\r\n\r\nJust spits out the response... what?\r\n\r\nIn 6.0.0 it at least makes sense now. it's a terminating error so it catches. \r\n\r\n> At the very least, there should be a way to accomplish this in PS Core without having to root around in exception info.\r\n\r\nI'd have to dig around for the other issue on this, but on option would be to add an option to treat all responses as successful. There are times when you want to test a 404 page, for example, and doing that currently is a serious pain. Especially when that 404 is a JSON object. That, or allow specifying a collection of response codes to be considered successful... something like `-SuccessStatusCodes 200, 301` that way a 404 would still be a terminating error, but 200 and 301 would be successful and return the response object.\r\n\r\nI don't think removing the terminating error nature as it exists in core is the right direction. `-MaximumRedirection 0` and a single redirect should be an error and nothing more by default, IMO.\r\n\r\n>  What I'm after is something like curl -v <url>\r\n\r\nIt's been suggested. Some of that output is possible, some if it is not (for example, we cannot get the SSL information). The general consensus is that the verbose output needs work. Implementing some of that is trivial.. and some of it is not. There are several ways in which we make the HTTP calls and in some of those scenarios, we don't even have access to the intermediary headers (for example, hop 2 of 3). To implement it we would have to step back from the default behavior of HttpClient and not allow it to redirect at all and handle all the redirects manually ourselves (which introduces some overhead). This all also gets complicated by some of the other features. Automatic retries, for example. \r\n\r\nI don't have a good solution to all of this. I agree the verbosity needs work, but improving it will likely introduce bugs as we will need to reinvent the wheel and mimic much of the default behavior if HttpClient. This is already causes issues when we introduced the removal of authorization headers on redirect. ",
    "created_at": "2018-02-15T01:04:52Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6157#issuecomment-365796222",
    "id": 365796222,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6157",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTc5NjIyMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365796222/reactions"
    },
    "updated_at": "2018-02-15T01:04:52Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365796222",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "`-SuccessStatusCodes 200, 301` or something to that effect sounds reasonable to me.  RE improved verbose output - I'll try to be patient.  :-)",
    "created_at": "2018-02-15T01:13:34Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6157#issuecomment-365797613",
    "id": 365797613,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6157",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTc5NzYxMw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365797613/reactions"
    },
    "updated_at": "2018-02-15T01:14:22Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/365797613",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/5177512?v=4",
      "events_url": "https://api.github.com/users/rkeithhill/events{/privacy}",
      "followers_url": "https://api.github.com/users/rkeithhill/followers",
      "following_url": "https://api.github.com/users/rkeithhill/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkeithhill/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rkeithhill",
      "id": 5177512,
      "login": "rkeithhill",
      "node_id": "MDQ6VXNlcjUxNzc1MTI=",
      "organizations_url": "https://api.github.com/users/rkeithhill/orgs",
      "received_events_url": "https://api.github.com/users/rkeithhill/received_events",
      "repos_url": "https://api.github.com/users/rkeithhill/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rkeithhill/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkeithhill/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rkeithhill"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Closing as is duplicate of #4534 ",
    "created_at": "2018-04-17T14:03:44Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/6157#issuecomment-382004326",
    "id": 382004326,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/6157",
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MjAwNDMyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/382004326/reactions"
    },
    "updated_at": "2018-04-17T14:03:44Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/382004326",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  }
]
