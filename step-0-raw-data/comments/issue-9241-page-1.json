[
  {
    "author_association": "MEMBER",
    "body": "cc @markekraus ",
    "created_at": "2019-03-28T01:50:21Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477412465",
    "id": 477412465,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzQxMjQ2NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477412465/reactions"
    },
    "updated_at": "2019-03-28T01:50:21Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477412465",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "As I suspected, we are dealing with API endpoints which are not RFC compliant:\r\n\r\nhttps://tools.ietf.org/html/rfc7578#section-4.1\r\n\r\n> it is often necessary to enclose the \"boundary\" parameter values in quotes in the Content-Type header field.\r\n\r\nAPIs _should_ implement support for quoted boundary parameter values. I would suggest this is actually a bug in the API and neither .NET Core or PowerShell. \r\n\r\nThat being said, this is not the first time this has been reported to me personally. Additionally, we already have modified behavior from .NET Core in filenames #6780.\r\n\r\nhttps://stackoverflow.com/questions/30926645/httpcontent-boundary-double-quotes Provides a possible workaround\r\n\r\nUnfortunately, changing this may result in breaking changes for other endpoints. *sigh.",
    "created_at": "2019-03-28T04:27:40Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477443128",
    "id": 477443128,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzQ0MzEyOA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477443128/reactions"
    },
    "updated_at": "2019-03-28T04:27:40Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477443128",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "NONE",
    "body": "I had a feeling this might be the case. Gotta love poor API implementations. Thanks for the potential workaround though (and all the previous improvements to the web cmdlets). For my particular use-case, I can probably make that work.\r\n\r\nIn the general case, I can definitely see how it's a damned if you do, damned if you don't situation.",
    "created_at": "2019-03-28T04:48:10Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477446626",
    "id": 477446626,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzQ0NjYyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477446626/reactions"
    },
    "updated_at": "2019-03-28T04:48:10Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477446626",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2327255?v=4",
      "events_url": "https://api.github.com/users/rmbolger/events{/privacy}",
      "followers_url": "https://api.github.com/users/rmbolger/followers",
      "following_url": "https://api.github.com/users/rmbolger/following{/other_user}",
      "gists_url": "https://api.github.com/users/rmbolger/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rmbolger",
      "id": 2327255,
      "login": "rmbolger",
      "node_id": "MDQ6VXNlcjIzMjcyNTU=",
      "organizations_url": "https://api.github.com/users/rmbolger/orgs",
      "received_events_url": "https://api.github.com/users/rmbolger/received_events",
      "repos_url": "https://api.github.com/users/rmbolger/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rmbolger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rmbolger/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rmbolger"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@markekraus would it be acceptable to retry without the quotes if you get a 400 error?",
    "created_at": "2019-03-28T06:04:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477461097",
    "id": 477461097,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzQ2MTA5Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477461097/reactions"
    },
    "updated_at": "2019-03-28T06:04:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477461097",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "NONE",
    "body": "It's definitely more work than just using `-Form`, but here's a function to generate a `MultiPartFormDataContent` object with the workaround that seems to be working for me:\r\n\r\n```powershell\r\nfunction New-MultipartFileContent {\r\n    [OutputType('System.Net.Http.MultipartFormDataContent')]\r\n    [CmdletBinding()]\r\n    param(\r\n        [Parameter(Mandatory)]\r\n        [System.IO.FileInfo]$File,\r\n        [string]$HeaderName='file'\r\n    )\r\n\r\n    # build the header and make sure to include quotes around Name\r\n    # and FileName like https://github.com/PowerShell/PowerShell/pull/6782)\r\n    $fileHeader = [System.Net.Http.Headers.ContentDispositionHeaderValue]::new('form-data')\r\n    $fileHeader.Name = \"`\"$HeaderName`\"\"\r\n    $fileHeader.FileName = \"`\"$($File.Name)`\"\"\r\n\r\n    # build the content\r\n    $fs = [System.IO.FileStream]::new($File.FullName, [System.IO.FileMode]::Open)\r\n    $fileContent = [System.Net.Http.StreamContent]::new($fs)\r\n    $fileContent.Headers.ContentDisposition = $fileHeader\r\n    $fileContent.Headers.ContentType = [System.Net.Http.Headers.MediaTypeHeaderValue]::Parse('application/octet-stream')\r\n\r\n    # add it to a new MultipartFormDataContent object\r\n    $mp = [System.Net.Http.MultipartFormDataContent]::new()\r\n    $mp.Add($fileContent)\r\n\r\n    # get rid of the quotes around the boundary value\r\n    # https://github.com/PowerShell/PowerShell/issues/9241\r\n    $b = $mp.Headers.ContentType.Parameters | Where-Object { $_.Name -eq 'boundary' }\r\n    $b.Value = $b.Value.Trim('\"')\r\n\r\n    # return an array wrapped copy of the object to avoid PowerShell unrolling \r\n    return @(,$mp)\r\n}\r\n```\r\n\r\nUsing this function's return value with the `-Body` parameter gets successfully processed by the PAN API now. Though it has the potential to leave the file handles open if you don't actually send the output to `Invoke-RestMethod`. For smaller files, you can use `ReadAllBytes` and `ByteArrayContent` rather than `StreamContent` to avoid leaving file handles open.",
    "created_at": "2019-03-28T06:35:13Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477467675",
    "id": 477467675,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzQ2NzY3NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477467675/reactions"
    },
    "updated_at": "2019-04-02T15:35:49Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477467675",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2327255?v=4",
      "events_url": "https://api.github.com/users/rmbolger/events{/privacy}",
      "followers_url": "https://api.github.com/users/rmbolger/followers",
      "following_url": "https://api.github.com/users/rmbolger/following{/other_user}",
      "gists_url": "https://api.github.com/users/rmbolger/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rmbolger",
      "id": 2327255,
      "login": "rmbolger",
      "node_id": "MDQ6VXNlcjIzMjcyNTU=",
      "organizations_url": "https://api.github.com/users/rmbolger/orgs",
      "received_events_url": "https://api.github.com/users/rmbolger/received_events",
      "repos_url": "https://api.github.com/users/rmbolger/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rmbolger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rmbolger/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rmbolger"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@SteveL-MSFT maybe retrying is ok. I'm a bit cautious of retries with Multipart forms. If they contain several large files, we could be duplicating the payload for an issue that may not be related to a quoted boundary parameter.",
    "created_at": "2019-03-28T14:10:28Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477611230",
    "id": 477611230,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzYxMTIzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477611230/reactions"
    },
    "updated_at": "2019-03-28T14:10:28Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477611230",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@markekraus my reading of that sentence in the RFC \"...often necessary...\" doesn't mean mandatory.  I wonder if curl always leaves off the quotes in which case it might be best to align with their default.  ",
    "created_at": "2019-03-28T16:09:08Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477663016",
    "id": 477663016,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzY2MzAxNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477663016/reactions"
    },
    "updated_at": "2019-03-28T16:09:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477663016",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "Right. Supplying it is not mandatory. But since it is a possible request, that means an API _should_ implement it. One that doesn't is non-compliant. But the opposite may be true to. I'm just pointing out that if we change the behavior we may end up causing APIs that mistakenly require it (which are also non-compliant) to suddenly break for users. Just laying out the risks of the change. No clue how likely that risk is.",
    "created_at": "2019-03-28T16:46:15Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477678341",
    "id": 477678341,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzY3ODM0MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477678341/reactions"
    },
    "updated_at": "2019-03-28T16:46:15Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477678341",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6509955?v=4",
      "events_url": "https://api.github.com/users/markekraus/events{/privacy}",
      "followers_url": "https://api.github.com/users/markekraus/followers",
      "following_url": "https://api.github.com/users/markekraus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markekraus/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/markekraus",
      "id": 6509955,
      "login": "markekraus",
      "node_id": "MDQ6VXNlcjY1MDk5NTU=",
      "organizations_url": "https://api.github.com/users/markekraus/orgs",
      "received_events_url": "https://api.github.com/users/markekraus/received_events",
      "repos_url": "https://api.github.com/users/markekraus/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/markekraus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markekraus/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/markekraus"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "My general position is that without any data, following curl's lead is more likely to be right than wrong.  ",
    "created_at": "2019-03-29T01:21:38Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/9241#issuecomment-477829026",
    "id": 477829026,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/9241",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzgyOTAyNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 3,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 3,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477829026/reactions"
    },
    "updated_at": "2019-03-29T01:21:38Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/477829026",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  }
]
