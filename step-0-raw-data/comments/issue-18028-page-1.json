[
  {
    "author_association": "MEMBER",
    "body": "`Add-Type` relies on reference assemblies to build the resulting assembly.  PS7 ships the reference assemblies in `$PSHome/ref`.  If you're hosting PS7, then you need to either make these ref assemblies available for `Add-Type` or use the `Add-Type -ReferencedAssemblies` parameter to specify them.",
    "created_at": "2022-09-12T18:11:57Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1244115748",
    "id": 1244115748,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KJ7Mk",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244115748/reactions"
    },
    "updated_at": "2022-09-12T18:11:57Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244115748",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "NONE",
    "body": "@SteveL-MSFT `dotnet publish` makes these assemblies available as the directory `ref` in the publish destination. The issue I am describing is that PS Core does not look for this \"natural\" location. According to clear error messages with expected paths, PS Core looks for the folder `ref` in different locations and does not check the \"natural\" `dotnet publish` location (which should be easy to calculate by relative paths).\r\n\r\nThus, to work around this issue I have to manually relocate this `ref` folder to the location from PS Core errors messages. This does not look quite right.\r\n",
    "created_at": "2022-09-12T19:37:51Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1244256115",
    "id": 1244256115,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KKddz",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244256115/reactions"
    },
    "updated_at": "2022-09-12T19:40:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244256115",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@nightroman ok, now i see what you are saying.  See https://github.com/PowerShell/PowerShell/blob/736cf3ecbf441af05baec72ac31bad9619a2b3e2/src/Microsoft.PowerShell.Commands.Utility/commands/utility/AddType.cs#L622-L633",
    "created_at": "2022-09-12T20:37:36Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1244414036",
    "id": 1244414036,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KLEBU",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244414036/reactions"
    },
    "updated_at": "2022-09-12T20:37:36Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244414036",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "NONE",
    "body": "Well, I'd say it's a bug, i.e. your wrong assumption about location of the `ref` produced by `dotnet publish`\r\nPer your code and in my case it is this (`typeof(PSObject).Assembly`):\r\n```\r\nC:\\Bin\\Far\\x64\\FarNet\\Modules\\PowerShellFar\\runtimes\\win\\lib\\net6.0\\System.Management.Automation.dll\r\n```\r\nbut the actual location of `ref` produced by `dotnet publish` is\r\n```\r\nC:\\Bin\\Far\\x64\\FarNet\\Modules\\PowerShellFar\r\n```",
    "created_at": "2022-09-12T22:39:31Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1244634215",
    "id": 1244634215,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KL5xn",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244634215/reactions"
    },
    "updated_at": "2022-09-12T22:41:03Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244634215",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "NONE",
    "body": "Is `System.Management.Automation.dll` always published to `runtimes\\<os>\\lib\\net<version>`?\r\nIf yes then the correct way to find `ref` is to step 4 folders up from its location.\r\n\r\nNB And the issue is a bug, after all.",
    "created_at": "2022-09-13T05:08:17Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1244904489",
    "id": 1244904489,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KM7wp",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244904489/reactions"
    },
    "updated_at": "2022-09-13T05:22:12Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1244904489",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "NONE",
    "body": "@SteveL-MSFT @iSazonov \r\nAny comments on new discoveries? Should this be labeled as a bug, not a question? Or should I open a separate bug issue for the wrong `ref` location assumptions?",
    "created_at": "2022-09-15T03:18:12Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1247530047",
    "id": 1247530047,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KW8w_",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247530047/reactions"
    },
    "updated_at": "2022-09-15T03:18:12Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247530047",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "The PowerShell code exactly says that `ref` folder must be in SMA.dll folder for host scenarios. _It is best we can do._\r\n\r\n`dotnet publish` is based on _standard_ MSBuild scripts from .Net SDK and can not address all specific scenarios. You have to customize build process in your prop/target/csproj files as needed and copy `ref` folder in place the SMA.dll expects.",
    "created_at": "2022-09-15T04:59:55Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1247583445",
    "id": 1247583445,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KXJzV",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247583445/reactions"
    },
    "updated_at": "2022-09-15T04:59:55Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247583445",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "@iSazonov So by the PowerShell Core design, it fails instead of checking one more location for `ref` as described (4 folders up from SMA.dll) in addition to two already checked. Is this correct?\r\n\r\n",
    "created_at": "2022-09-15T07:49:23Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1247714196",
    "id": 1247714196,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KXpuU",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247714196/reactions"
    },
    "updated_at": "2022-09-15T07:49:23Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247714196",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "NONE",
    "body": "If this is by design then the required custom build step should be described in\r\nhttps://docs.microsoft.com/en-us/powershell/scripting/dev-cross-plat/choosing-the-right-nuget-package?view=powershell-7.2\r\n\r\nCurrently it omits the very important piece of information and only says:\r\n\r\n> Publishing an application targeting Microsoft.Powershell.SDK will include all these assemblies, and any dependencies PowerShell requires. It will also include other assets that PowerShell required in its build, such as the module manifests for Microsoft.PowerShell.* modules and the ref directory required by [Add-Type](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type).\r\n\r\nIt admits that `ref` is needed and provided but does not tell to copy `ref` to SMA.dll location.\r\n\r\n<blockquote><img src=\"https://docs.microsoft.com/media/logos/logo-powershell-social.png\" width=\"48\" align=\"right\"><div><strong><a href=\"https://docs.microsoft.com/en-us/powershell/scripting/dev-cross-plat/choosing-the-right-nuget-package\">Choosing the right PowerShell NuGet package for your .NET project - PowerShell</a></strong></div><div>Alongside the executable packages published with each PowerShell release, the PowerShell team also maintains several packages available on NuGet. These packages allow targeting PowerShell as an API platform in .NET.</div></blockquote>",
    "created_at": "2022-09-15T08:03:10Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1247730513",
    "id": 1247730513,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KXttR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247730513/reactions"
    },
    "updated_at": "2022-09-15T08:04:19Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247730513",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "NONE",
    "body": "Also, the design is not quite right (if not just wrong) in the scenario when `Assembly.GetEntryAssembly()` is not null. In this case you require `ref` to be copied to the application executable directory. You assume that this is possible. This is not always the case (you may not own that application or have no right to access its folder).\r\n\r\nAlso, this is not just post-build step required but rather installation/deployment step because a plugin hosting PSCore might be added to already installed application not during the build process.\r\n",
    "created_at": "2022-09-15T08:13:14Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1247743321",
    "id": 1247743321,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KXw1Z",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247743321/reactions"
    },
    "updated_at": "2022-09-15T08:14:40Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1247743321",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> In this case you require `ref` to be copied to the application executable directory\r\n\r\nNot in the application. In _SMA.dll_ folder.",
    "created_at": "2022-09-15T12:44:10Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248051507",
    "id": 1248051507,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KY8Ez",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248051507/reactions"
    },
    "updated_at": "2022-09-15T12:44:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248051507",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "> > In this case you require `ref` to be copied to the application executable directory\r\n> \r\n> Not in the application. In _SMA.dll_ folder.\r\n\r\n```\r\nPathType.GetDirectoryName( \r\n         (Assembly.GetEntryAssembly() ?? typeof(PSObject).Assembly).Location), \r\n     \"ref\"); \r\n```\r\n\r\nOn the contrary, in the application folder, if `Assembly.GetEntryAssembly()` is not null. Not in _SMA.dll_ folder.\r\nAnd this application folder may be not available for copying `ref`. This makes some valid scenarios impossible.\r\n",
    "created_at": "2022-09-15T13:03:26Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248073060",
    "id": 1248073060,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KZBVk",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248073060/reactions"
    },
    "updated_at": "2022-09-15T13:03:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248073060",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "> On the contrary, in the application folder, if `Assembly.GetEntryAssembly()` is not null.\r\n\r\n> My real use case is more complex. The application is not even .NET, **native**.\r\nOne of plugins hosts .NET Core and loads another plugin which hosts PowerShell\r\nCore.\r\n\r\nIs your application _native_? Or I misread your scenario?\r\n",
    "created_at": "2022-09-15T16:42:48Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248353440",
    "id": 1248353440,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KaFyg",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248353440/reactions"
    },
    "updated_at": "2022-09-15T16:42:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248353440",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "My sample attached application is .NET. My other application is native. I have all kind of use cases in practice.",
    "created_at": "2022-09-15T17:04:13Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248374763",
    "id": 1248374763,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KaK_r",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248374763/reactions"
    },
    "updated_at": "2022-09-15T17:04:13Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248374763",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "NONE",
    "body": "TBH the discussion is getting too long. If the issue remains labeled as question I close it. I got the some answers and the shape of things.\r\n\r\nI think the PS Core design is not quite right. PS Core is not born yesterday. It's really the time to support plugin scenarios. If not fully then at least partially and with some help for users who really need plugins hosting PS Core.\r\n",
    "created_at": "2022-09-15T17:12:14Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248383502",
    "id": 1248383502,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KaNIO",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248383502/reactions"
    },
    "updated_at": "2022-09-15T17:12:14Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248383502",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "I don't see a problem for a native host. If there is a host managed application, it is supposed to be the one that publishes the ref folder. If the SMA is a separate plugin, it is impossible to distinguish between the managed application itself and the plugin.\r\nPerhaps we could check the existence of the folder in those two places.\r\n\r\n@daxian-dbw Could you please comment?",
    "created_at": "2022-09-15T19:02:02Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1248489873",
    "id": 1248489873,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5KanGR",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248489873/reactions"
    },
    "updated_at": "2022-09-15T19:02:02Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1248489873",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  },
  {
    "author_association": "NONE",
    "body": "NB Semi-related note, this documentation introduces \"another way\" which has nothing to do with use cases when users really have to know where to put the `ref` folder. These use cases do not have `pwsh.dll`.\r\n\r\n> Beginning in PowerShell 7, Add-Type does not compile a type if a type with the same name already exists. Also, Add-Type looks for assemblies in a ref folder under the folder that contains pwsh.dll.\r\n\r\nhttps://docs.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Utility/Add-Type?view=powershell-7\r\n\r\nThis documentation presumably describes the `pwsh` installation. Interestingly, exactly in this case users do not have to know such a technical detail like the location of `ref`. It comes with `pwsh` out of the box.\n\n<blockquote><img src=\"https://docs.microsoft.com/media/logos/logo-powershell-social.png\" width=\"48\" align=\"right\"><div><strong><a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type\">Add-Type (Microsoft.PowerShell.Utility) - PowerShell</a></strong></div><div>The Add-Type cmdlet lets you define a Microsoft .NET Core class in your PowerShell session. You can then instantiate objects, by using the New-Object cmdlet, and use the objects just as you would use any .NET Core object. If you add an Add-Type command to your PowerShell profile, the class is available in all PowerShell sessions. You can specify the type by specifying an existing assembly or source code files, or you can specify the source code inline or saved in a variable. You can even specify only a method and Add-Type defines and generates the class. On Windows, you can use this feature to make Platform Invoke (P/Invoke) calls to unmanaged functions in PowerShell. If you specify source code, Add-Type compiles the specified source code and generates an in-memory assembly that contains the new .NET Core types. You can use the parameters of Add-Type to specify an alternate language and compiler, C# is the default, compiler options, assembly dependencies, the class namespace, the names of the type, and the resulting assembly. Beginning in PowerShell 7, Add-Type does not compile a type if a type with the same name already exists. Also, Add-Type looks for assemblies in a ref folder under the folder that contains pwsh.dll. </div></blockquote>",
    "created_at": "2022-09-16T11:58:02Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/18028#issuecomment-1249275637",
    "id": 1249275637,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/18028",
    "node_id": "IC_kwDOAvT7bc5Kdm71",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1249275637/reactions"
    },
    "updated_at": "2022-09-16T11:58:04Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/1249275637",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/927533?v=4",
      "events_url": "https://api.github.com/users/nightroman/events{/privacy}",
      "followers_url": "https://api.github.com/users/nightroman/followers",
      "following_url": "https://api.github.com/users/nightroman/following{/other_user}",
      "gists_url": "https://api.github.com/users/nightroman/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/nightroman",
      "id": 927533,
      "login": "nightroman",
      "node_id": "MDQ6VXNlcjkyNzUzMw==",
      "organizations_url": "https://api.github.com/users/nightroman/orgs",
      "received_events_url": "https://api.github.com/users/nightroman/received_events",
      "repos_url": "https://api.github.com/users/nightroman/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/nightroman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nightroman/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/nightroman"
    }
  }
]
