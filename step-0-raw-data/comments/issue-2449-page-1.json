[
  {
    "author_association": "NONE",
    "body": "To add to what Steve's reported here, 'using' directives need to be placed at the top of a script, but this doesn't seem to stop you from placing them at the top of a secondary script and then invoking that script from the middle of your first one.\n\n**`Main.ps1`**\n`Write-Host \"This is the first line\"`\n`& LoaderScript.ps1`\n`[SomeClass]::new()`\n\n**`LoaderScript.ps1`**\n`using \".\\SomeModule.psm1\"`\n\n**`SomeModule.psm1`**\n`Class SomeClass {`\n  `[string]$SomeProperty`\n`}`\n\nI get what they're going for with 'using' - it does some much-needed things for IntelliSense when you get into class management, but wimbor's point remains that there is still a demand to load them dynamically.\nI, too, expected there to be some form of `Export-ModuleMember -Class`\n",
    "created_at": "2016-10-19T15:27:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-254848051",
    "id": 254848051,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NDg0ODA1MQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/254848051/reactions"
    },
    "updated_at": "2016-10-19T15:28:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/254848051",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/7060281?v=4",
      "events_url": "https://api.github.com/users/rumbawls/events{/privacy}",
      "followers_url": "https://api.github.com/users/rumbawls/followers",
      "following_url": "https://api.github.com/users/rumbawls/following{/other_user}",
      "gists_url": "https://api.github.com/users/rumbawls/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/rumbawls",
      "id": 7060281,
      "login": "rumbawls",
      "node_id": "MDQ6VXNlcjcwNjAyODE=",
      "organizations_url": "https://api.github.com/users/rumbawls/orgs",
      "received_events_url": "https://api.github.com/users/rumbawls/received_events",
      "repos_url": "https://api.github.com/users/rumbawls/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/rumbawls/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rumbawls/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/rumbawls"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "Thank you, great discussion!\n\n### Why there is a need in `using module`?\n\nUsing module looks like a duplicated facility with `Import-Module`.\nLet's take a look.\n- PowerShell is a dynamic language.\n- Classes provide some **parse-time** checks. I.e. if you have a class that has a return value `[string]` but doesn't return anything from anywhere,  you will get an error on the module load (actually, during the module parsing, which happens, when you are trying to load it). It gives developers ability to find problems earlier.\n- Mixing parse time checks into dynamic language is not a picnic.\n- `using module` separated from `Import-Module` because is in this parse-time vs runtime difference. `Import-Module` could take a variable value and load it in runtime, but `using module` can take only constant expressions. Also, because `using` statement is allowed only at the beginning of the file, it greatly simplifies things: now you don't need to try to figure out (dynamic) scopes and visibility rules and can just use whole files as scopes.\n- If you want to use one class in the context of another class, i.e.\n\n``` powershell\n# A.psm1\nclass A{}\n\n# B.psm1\nImport-Module ./A.psm1\nclass B {\n    [A]getA() { return [A]::new() }\n}\n```\n\nThe type definition of `[A]` should be available at parse time to `[B]`, so this code could not work reliable. That's why we need `using module` and that's why it's always at the top of the script: to simplify scoping rules for class names visibility.\n\n### Export-ModuleMember\n\nThe classes **are** exported out of the module. To see them as available types use `using module`. Should we also make it available as types for `Import-Module`? Yes, I think that's a good idea.\nNote that it may still be confusing and inconsistent because after this change you would be able to write code:\n\n``` powershell\n# A.psm1\nclass A{\n   $foo = 'bar'\n}\n\n# B.psm1\nImport-Module ./A.psm1\nclass B {\n    [A]getA() { return [A]::new() } # error, this is compile-time dispatching\n}\n\n[A]::foo # no error, this is runtime dispatching\n```\n\nThese are the fundamental incompatibility between two approaches, but I think we can collaboratively improve the experience.\n",
    "created_at": "2016-10-22T04:28:34Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-255506786",
    "id": 255506786,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTUwNjc4Ng==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255506786/reactions"
    },
    "updated_at": "2016-10-22T04:28:34Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255506786",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/816680?v=4",
      "events_url": "https://api.github.com/users/vors/events{/privacy}",
      "followers_url": "https://api.github.com/users/vors/followers",
      "following_url": "https://api.github.com/users/vors/following{/other_user}",
      "gists_url": "https://api.github.com/users/vors/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vors",
      "id": 816680,
      "login": "vors",
      "node_id": "MDQ6VXNlcjgxNjY4MA==",
      "organizations_url": "https://api.github.com/users/vors/orgs",
      "received_events_url": "https://api.github.com/users/vors/received_events",
      "repos_url": "https://api.github.com/users/vors/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vors/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vors"
    }
  },
  {
    "author_association": "NONE",
    "body": "One question about _using module_.\nI have a simple module that declare a 'Computer' class.\n\n``` Powershell\n@'\nclass Computer {\n    [string] $Name\n    [string] $OS\n}\n'@ >C:\\Temp\\Computer\\1.0\\Computer.psm1\n```\n\nI can write this into a script :\n\n``` Powershell\n@'\nusing module C:\\Temp\\Computer\\1.0\\Computer.psm1\n[Computer]::new()\n'@ > c:\\temp\\using.ps1\n```\n\nBut not this :\n\n``` Powershell\n@'\n  using module C:\\Temp\\Computer\\1.0\\Computer.psm1\n  [Computer]::new()\n\n  $Object=Start-job { \n     using module C:\\Temp\\Computer\\1.0\\Computer.psm1\n     [Computer]::New()\n  } | \n   Wait-Job|\n   Receive-job -AutoRemoveJob -Wait\n'@ > c:\\temp\\using.ps1\n```\n\nI get an exception :\n\n``` Powershell\n  At C:\\temp\\using.ps1:5 char:4\n  +    using module C:\\Temp\\Computer\\1.0\\Computer.psm1\n  +    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  A 'using' statement must appear before any other statements in a script.\n      + CategoryInfo          : ParserError: (:) [], ParseException\n      + FullyQualifiedErrorId : UsingMustBeAtStartOfScript\n```\n\nThis code is not possible, I get the same exception :\n\n``` Powershell\n@'\n  $Object=Start-job { \n     using module C:\\Temp\\Computer\\1.0\\Computer.psm1\n     [Computer]::New()\n  } | \n   Wait-Job|\n   Receive-job -AutoRemoveJob -Wait\n'@ > c:\\temp\\Test.ps1\n\n.\\test.ps1\n```\n\nIt is by design ?\n\nThis code is possible :\n\n``` Powershell\n@'\n  $Object=Start-job { \n     Invoke-Expression  \"using module C:\\Temp\\Computer\\1.0\\Computer.psm1\"\n     [Computer]::New()\n  } | \n   Wait-Job|\n   Receive-job -AutoRemoveJob -Wait\n   $object\n'@ > c:\\temp\\Test2.ps1\n\n.\\test2.ps1\n```\n\nThe use of _Invoke-Expression_ can it be a workaround ?\n\nPSversion  5.0.10586.117, Seven x64\n",
    "created_at": "2016-10-23T09:52:59Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-255579206",
    "id": 255579206,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTU3OTIwNg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255579206/reactions"
    },
    "updated_at": "2016-10-23T09:52:59Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255579206",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/4894452?v=4",
      "events_url": "https://api.github.com/users/LaurentDardenne/events{/privacy}",
      "followers_url": "https://api.github.com/users/LaurentDardenne/followers",
      "following_url": "https://api.github.com/users/LaurentDardenne/following{/other_user}",
      "gists_url": "https://api.github.com/users/LaurentDardenne/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/LaurentDardenne",
      "id": 4894452,
      "login": "LaurentDardenne",
      "node_id": "MDQ6VXNlcjQ4OTQ0NTI=",
      "organizations_url": "https://api.github.com/users/LaurentDardenne/orgs",
      "received_events_url": "https://api.github.com/users/LaurentDardenne/received_events",
      "repos_url": "https://api.github.com/users/LaurentDardenne/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/LaurentDardenne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LaurentDardenne/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/LaurentDardenne"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "@LaurentDardenne that's an excellent example, thank you for sharing it. UX indeed feels a little bit broken.\nOne way to see it is  \"how to defer parse time check to runtime\". I would not recommend use a temp file or invoke-expression. A little bit cleaner workaround would be creating scriptblock for Start-Job argument dynamically from string. Use [scriptblock]::create().\n\nOne design problem with allowing using module to be at beginning of any arbitrary scriptblock is that it would be significant complicate lookups and resolution.\n",
    "created_at": "2016-10-23T19:44:53Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-255609630",
    "id": 255609630,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NTYwOTYzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255609630/reactions"
    },
    "updated_at": "2016-10-23T19:45:41Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/255609630",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/816680?v=4",
      "events_url": "https://api.github.com/users/vors/events{/privacy}",
      "followers_url": "https://api.github.com/users/vors/followers",
      "following_url": "https://api.github.com/users/vors/following{/other_user}",
      "gists_url": "https://api.github.com/users/vors/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/vors",
      "id": 816680,
      "login": "vors",
      "node_id": "MDQ6VXNlcjgxNjY4MA==",
      "organizations_url": "https://api.github.com/users/vors/orgs",
      "received_events_url": "https://api.github.com/users/vors/received_events",
      "repos_url": "https://api.github.com/users/vors/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/vors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vors/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/vors"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "You could use `Start-Job -FilePath` instead of `Invoke-Expression`.\n",
    "created_at": "2016-10-25T13:38:57Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-256036950",
    "id": 256036950,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjAzNjk1MA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/256036950/reactions"
    },
    "updated_at": "2016-10-25T13:39:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/256036950",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/2148248?v=4",
      "events_url": "https://api.github.com/users/lzybkr/events{/privacy}",
      "followers_url": "https://api.github.com/users/lzybkr/followers",
      "following_url": "https://api.github.com/users/lzybkr/following{/other_user}",
      "gists_url": "https://api.github.com/users/lzybkr/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/lzybkr",
      "id": 2148248,
      "login": "lzybkr",
      "node_id": "MDQ6VXNlcjIxNDgyNDg=",
      "organizations_url": "https://api.github.com/users/lzybkr/orgs",
      "received_events_url": "https://api.github.com/users/lzybkr/received_events",
      "repos_url": "https://api.github.com/users/lzybkr/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/lzybkr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lzybkr/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/lzybkr"
    }
  },
  {
    "author_association": "COLLABORATOR",
    "body": "`using module` confuse us because it is _directive_ at parse time but looks like runtime term.\nIt would be reasoned to use **#using module**\n",
    "created_at": "2016-10-25T14:29:49Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/2449#issuecomment-256051194",
    "id": 256051194,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/2449",
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1NjA1MTE5NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/256051194/reactions"
    },
    "updated_at": "2016-10-25T14:29:49Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/256051194",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/22290914?v=4",
      "events_url": "https://api.github.com/users/iSazonov/events{/privacy}",
      "followers_url": "https://api.github.com/users/iSazonov/followers",
      "following_url": "https://api.github.com/users/iSazonov/following{/other_user}",
      "gists_url": "https://api.github.com/users/iSazonov/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/iSazonov",
      "id": 22290914,
      "login": "iSazonov",
      "node_id": "MDQ6VXNlcjIyMjkwOTE0",
      "organizations_url": "https://api.github.com/users/iSazonov/orgs",
      "received_events_url": "https://api.github.com/users/iSazonov/received_events",
      "repos_url": "https://api.github.com/users/iSazonov/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/iSazonov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iSazonov/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/iSazonov"
    }
  }
]
