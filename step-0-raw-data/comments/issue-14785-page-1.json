[
  {
    "author_association": "CONTRIBUTOR",
    "body": "To be clear up front: You likely won't see improvements in _Windows PowerShell_  - please note that this repo is only for PowerShell Core 6 and PowerShell 7+ issues.\r\n\r\nIn a pinch, you can pipe to `Out-String -Stream` before piping to the 2nd `Select-String` call, but note that this will retain the formatting artifacts, notably the `>` before the matching line and a space before the context lines.\r\n\r\n---\r\n\r\nThere are two related issues:\r\n\r\n* `Select-Object -Context ... | Select-Object ...` causes the context information in the first command's output objects to be quietly ignored by the second command.\r\n\r\n* Additionally, `Select-Object -Context ... | Select-Object -Context ...`, i.e. using `-Context` with _both_ commands causes the `-Context` parameter to also be ignored by the 2nd command, accompanied by warning `The option \"Context\" is not valid when searching results that are piped from Select-String output.`\r\n\r\nI can't speak to the original design intent, but the behavior seems unhelpful.\r\n\r\nThe code at https://github.com/PowerShell/PowerShell/blob/ac560d8d320f3ba72e525825be2c64d9c5abdf2c/src/Microsoft.PowerShell.Commands.Utility/commands/utility/MatchString.cs#L1740-L1757\r\n\r\n* suggests that only looking at the `.Line` property of  incoming `Microsoft.PowerShell.Commands.MatchInfo`  instance - instead of also considering `.PreContext` and `.PostContext` -  is intentional.\r\n\r\n* additionally restricting the use of `-Context` in the _receiving_ command seems curious, however: perhaps this was a _logic error_, where the actual intent was solely to warn about the _incoming_ context information getting ignored?\r\n\r\n---\r\n\r\nA similar issue arose in combination with the `-Raw` switch (not available in Windows PowerShell), which outputs just the matching _lines_ rather than `Microsoft.PowerShell.Commands.MatchInfo` objects:\r\n\r\nHere too the intuitive expectation is that combining `-Raw` with `-Context` should also output the context lines, which isn't the case either, unfortunately, as reported in #14350.\r\n\r\n\r\n\r\n\r\n\r\n",
    "created_at": "2021-02-12T20:35:18Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-778440557",
    "id": 778440557,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODQ0MDU1Nw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/778440557/reactions"
    },
    "updated_at": "2021-02-15T19:17:26Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/778440557",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "P.S., @microlaser, can you please give your issue a meaningful title, for better discoverability?",
    "created_at": "2021-02-12T20:36:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-778440939",
    "id": 778440939,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODQ0MDkzOQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/778440939/reactions"
    },
    "updated_at": "2021-02-12T20:36:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/778440939",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "I realized I misinterpreted the current behavior and design intent, so here's the hopefully correct summary, based on https://github.com/PowerShell/PowerShell/blob/ac560d8d320f3ba72e525825be2c64d9c5abdf2c/src/Microsoft.PowerShell.Commands.Utility/commands/utility/MatchString.cs#L1740-L1757 and experimenting with commands:\r\n\r\n* By (debatable) design, when `Select-String` receives input from _another_ `Select-String` call, it acts as a filter on the `Microsoft.PowerShell.Commands.MatchInfo` _objects_ received as input rather than on the _text content_ they represent:\r\n\r\n  * The filtering is solely based on the `.Line` property value of the input objects, not also on the lines contained in the `.Context` property, if present.\r\n\r\n  * Due to this match-info-_object_-filtering approach, the receiving `Select-String` call doesn't support a `-Context` argument itself  so it is ignored, but a warning is issued.\r\n    * While context resulting from a `-Context` argument passed to the _sending_ `Select-String` _is_ passed through - if the `.Line` property value matches the filter - there is a _display bug_, in that the context lines passed through do not show up in the formatted output anymore; e.g.:\r\n\r\n         * `1..5 | Select-String 3 -Context 1 | Select-String 3` outputs just `> 3`, not `  2\\n> 3\\n  4`, as the original command would; the problem is connected to the `.Context.DisplayPreContext` and `.Context.DisplayPostContext` values not getting preserved on filtering.\r\n\r\n---\r\n\r\nThe upshot is:\r\n\r\n* The current behavior when chaining `Select-String` calls is unhelpful, in two respects:\r\n\r\n  * It doesn't consider context lines when filtering in the receiving `Select-String` command.\r\n  * The receiving `Select-String` command doesn't support `-Context` (your original complaint).\r\n\r\n---\r\n\r\nWhat _would_ be helpful if receiving `Select-String` calls solely operated on the _strings_ represented by the input objects, notably _including_ the context lines, but _without duplicates_ from overlapping contexts - as you currently already see in the _formatted_ output from non-chained calls (formatting markup aside).\r\n\r\nA similar issue arose in combination with the `-Raw` switch (not available in Windows PowerShell; its purpose is to output just the matching _lines_ (text) rather than `Microsoft.PowerShell.Commands.MatchInfo` objects):\r\n\r\nHere too the intuitive expectation is that combining `-Raw` with `-Context` should also output the context lines without duplicates, which isn't the case either, unfortunately, as reported in #14350.\r\n\r\n---\r\n\r\nTo me, these changes would undoubtedly be helpful, but at least in the non-`-Raw` case they do amount to a _breaking change_, so the question is whether it is an _acceptable_ breaking change, namely one that falls into [bucket 3: Unlikely Grey Area](https://github.com/PowerShell/PowerShell/blob/master/docs/dev-process/breaking-change-contract.md#bucket-3-unlikely-grey-area).\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "created_at": "2021-02-15T19:17:14Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-779407514",
    "id": 779407514,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTQwNzUxNA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/779407514/reactions"
    },
    "updated_at": "2021-02-19T12:56:16Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/779407514",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "@mklement0 Can you please move your comment to a new issue with a meaning title and repro steps? I will close this one given that the PR title and description are not helpful.",
    "created_at": "2021-02-19T01:11:53Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-781744202",
    "id": 781744202,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTc0NDIwMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/781744202/reactions"
    },
    "updated_at": "2021-02-19T01:12:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/781744202",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@daxian-dbw, please see #14850",
    "created_at": "2021-02-19T02:24:42Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-781769202",
    "id": 781769202,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTc2OTIwMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/781769202/reactions"
    },
    "updated_at": "2021-02-19T02:24:42Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/781769202",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@daxian-dbw, given that the current behavior is (mostly) by design (but somewhat unhelpful), the new issues is of type \"Issue-Enhancement\", not a bug report. I have added sample commands that demonstrate the unhelpful behavior, however (in the context of the current behavior there is also a small bug, but fixing that will be moot, if the behavior is more fundamentally revised).\r\n",
    "created_at": "2021-02-19T13:00:12Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-782059254",
    "id": 782059254,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjA1OTI1NA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/782059254/reactions"
    },
    "updated_at": "2021-02-20T02:03:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/782059254",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/588825?v=4",
      "events_url": "https://api.github.com/users/mklement0/events{/privacy}",
      "followers_url": "https://api.github.com/users/mklement0/followers",
      "following_url": "https://api.github.com/users/mklement0/following{/other_user}",
      "gists_url": "https://api.github.com/users/mklement0/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/mklement0",
      "id": 588825,
      "login": "mklement0",
      "node_id": "MDQ6VXNlcjU4ODgyNQ==",
      "organizations_url": "https://api.github.com/users/mklement0/orgs",
      "received_events_url": "https://api.github.com/users/mklement0/received_events",
      "repos_url": "https://api.github.com/users/mklement0/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/mklement0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mklement0/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/mklement0"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Thank you @mklement0!",
    "created_at": "2021-02-22T19:14:48Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/14785#issuecomment-783607930",
    "id": 783607930,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/14785",
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzYwNzkzMA==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 1,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 1,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/783607930/reactions"
    },
    "updated_at": "2021-02-22T19:14:48Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/783607930",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/127450?v=4",
      "events_url": "https://api.github.com/users/daxian-dbw/events{/privacy}",
      "followers_url": "https://api.github.com/users/daxian-dbw/followers",
      "following_url": "https://api.github.com/users/daxian-dbw/following{/other_user}",
      "gists_url": "https://api.github.com/users/daxian-dbw/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/daxian-dbw",
      "id": 127450,
      "login": "daxian-dbw",
      "node_id": "MDQ6VXNlcjEyNzQ1MA==",
      "organizations_url": "https://api.github.com/users/daxian-dbw/orgs",
      "received_events_url": "https://api.github.com/users/daxian-dbw/received_events",
      "repos_url": "https://api.github.com/users/daxian-dbw/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/daxian-dbw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daxian-dbw/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/daxian-dbw"
    }
  }
]
