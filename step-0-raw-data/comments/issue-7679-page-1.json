[
  {
    "author_association": "CONTRIBUTOR",
    "body": "The problem occurs when the PSModulePath from the native environment contains a reference to a SxS installation. \r\n\r\nModuleIntrinsics.GetModulePath calls RemoveSxSPsHomeModulePath to remove it; which succeeds but the subsequent logic is has a few problems.  In the repro case, systemModulePathToUse is populated with the PSHOME\\Modules because hklmMachineModulePath is null and it is placed at the end of the PSModulePath.  Using the pshome\\modules path as the fallback is problem since later logic assumes they are different.\r\n\r\nFor the repro case, I was using 6-preview as the default shell for OpenSSH and using RC-1 as the subsystem.  OpenSSH adds the path of the default shell  to the PSModulePath environment variable which is picked up by the subsystem process.\r\n",
    "created_at": "2018-09-06T01:28:37Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7679#issuecomment-418933693",
    "id": 418933693,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7679",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODkzMzY5Mw==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/418933693/reactions"
    },
    "updated_at": "2018-09-06T17:12:08Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/418933693",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12105071?v=4",
      "events_url": "https://api.github.com/users/dantraMSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/dantraMSFT/followers",
      "following_url": "https://api.github.com/users/dantraMSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/dantraMSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dantraMSFT",
      "id": 12105071,
      "login": "dantraMSFT",
      "node_id": "MDQ6VXNlcjEyMTA1MDcx",
      "organizations_url": "https://api.github.com/users/dantraMSFT/orgs",
      "received_events_url": "https://api.github.com/users/dantraMSFT/received_events",
      "repos_url": "https://api.github.com/users/dantraMSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dantraMSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dantraMSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dantraMSFT"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "The problem occurs when the environment's path already contains the Windows PowerShell module path (%windir%\\system32\\WindowsPowerShell\\v1.0\\Modules).  \r\n\r\nThe current logic conditionally appends it if it is not present but doesn't consider it when adding $PSHOME\\Modules.  The result is $PSHOME\\Modules is added after Windows PowerShell causing built in modules to be loaded from Windows PowerShell; many of which fail.\r\n\r\nThe problem only occurs when SxS versions of PowerShell containing the PSCompatibleEdition changes are installed and one launches the other or if the Windows PowerShell module path is present in the environment's PSModulePath.\r\n\r\nA possible fix is to detect the existence of WP's module path and insert $PSHOME\\Modules before it.",
    "created_at": "2018-09-06T17:15:03Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7679#issuecomment-419172532",
    "id": 419172532,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7679",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTE3MjUzMg==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419172532/reactions"
    },
    "updated_at": "2018-09-06T17:31:07Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419172532",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12105071?v=4",
      "events_url": "https://api.github.com/users/dantraMSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/dantraMSFT/followers",
      "following_url": "https://api.github.com/users/dantraMSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/dantraMSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dantraMSFT",
      "id": 12105071,
      "login": "dantraMSFT",
      "node_id": "MDQ6VXNlcjEyMTA1MDcx",
      "organizations_url": "https://api.github.com/users/dantraMSFT/orgs",
      "received_events_url": "https://api.github.com/users/dantraMSFT/received_events",
      "repos_url": "https://api.github.com/users/dantraMSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dantraMSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dantraMSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dantraMSFT"
    }
  },
  {
    "author_association": "MEMBER",
    "body": "Talked to @dantraMSFT, this seems more of an advanced use case than a common case for most users.  If the fix comes in and is low risk, we can consider for 6.1 GA, but it's not a blocker for GA.",
    "created_at": "2018-09-07T00:14:30Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7679#issuecomment-419280775",
    "id": 419280775,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7679",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTI4MDc3NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419280775/reactions"
    },
    "updated_at": "2018-09-07T00:14:30Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419280775",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/11859881?v=4",
      "events_url": "https://api.github.com/users/SteveL-MSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/SteveL-MSFT/followers",
      "following_url": "https://api.github.com/users/SteveL-MSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/SteveL-MSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/SteveL-MSFT",
      "id": 11859881,
      "login": "SteveL-MSFT",
      "node_id": "MDQ6VXNlcjExODU5ODgx",
      "organizations_url": "https://api.github.com/users/SteveL-MSFT/orgs",
      "received_events_url": "https://api.github.com/users/SteveL-MSFT/received_events",
      "repos_url": "https://api.github.com/users/SteveL-MSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/SteveL-MSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SteveL-MSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/SteveL-MSFT"
    }
  },
  {
    "author_association": "CONTRIBUTOR",
    "body": "@SteveL-MSFT: The proposed fix and test are here: https://github.com/PowerShell/PowerShell/pull/7727",
    "created_at": "2018-09-07T00:35:39Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/7679#issuecomment-419283955",
    "id": 419283955,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/7679",
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTI4Mzk1NQ==",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419283955/reactions"
    },
    "updated_at": "2018-09-07T00:35:39Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/419283955",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/12105071?v=4",
      "events_url": "https://api.github.com/users/dantraMSFT/events{/privacy}",
      "followers_url": "https://api.github.com/users/dantraMSFT/followers",
      "following_url": "https://api.github.com/users/dantraMSFT/following{/other_user}",
      "gists_url": "https://api.github.com/users/dantraMSFT/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/dantraMSFT",
      "id": 12105071,
      "login": "dantraMSFT",
      "node_id": "MDQ6VXNlcjEyMTA1MDcx",
      "organizations_url": "https://api.github.com/users/dantraMSFT/orgs",
      "received_events_url": "https://api.github.com/users/dantraMSFT/received_events",
      "repos_url": "https://api.github.com/users/dantraMSFT/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/dantraMSFT/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dantraMSFT/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/dantraMSFT"
    }
  }
]
