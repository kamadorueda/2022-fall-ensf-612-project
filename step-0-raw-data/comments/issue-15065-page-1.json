[
  {
    "author_association": "COLLABORATOR",
    "body": "> pwsh is loading the first Module it finds, not the latest version of the module in all PSModulepath locations.\r\n\r\nThis is **expected** behaviour & one that I don't seen it changing as it is based on the way that PowerShell discovers and organises it's module cache. This is built based on the ordering of PSModulePath which means that PowerShell will not simply load the latest version available and will as you've noticed will load in path order, which I admit may seem counter intuitive. The design as this is right now ensures that an admin push of a newer version of a module to any of the All Users locations `C:\\Program Files\\PowerShell\\Modules`, `c:\\program files\\powershell\\7\\Modules`, `C:\\Program Files\\WindowsPowerShell\\Modules` does not impact anything that may be requiring a version the user may have installed in their userpath location.\r\n\r\nPowerShell already gives lots of ways to ensure correct loading of the right version of the module from whatever location it is installed in by allowing passing of a PSModuleInfo object like in my below function or explicitly telling Import-Module to load either a `RequiredVersion` or a `MinimumVersion` or a full path to a `psm1` or `psd1`\r\n\r\nI however get round this with this little function though perhaps a future enhancement to `Import-Module` could be to add a `Latest` switch that essentially does this \r\n\r\n```powershell\r\nfunction Import-LatestModule  {\r\n    [CmdletBinding()]\r\n    [Alias('iplmo')]\r\n    param (\r\n     # Parameter help description\r\n     [Parameter(Mandatory=$true, Position=0)]\r\n     [String]\r\n     $Module   \r\n    )\r\n    Get-Module $module -ListAvailable | Sort-Object Version -Descending -Top 1 | Import-Module\r\n}\r\n```",
    "created_at": "2021-08-12T09:19:29Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15065#issuecomment-897481808",
    "id": 897481808,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15065",
    "node_id": "IC_kwDOAvT7bc41fnxQ",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/897481808/reactions"
    },
    "updated_at": "2021-08-12T09:19:29Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/897481808",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/6355225?v=4",
      "events_url": "https://api.github.com/users/kilasuit/events{/privacy}",
      "followers_url": "https://api.github.com/users/kilasuit/followers",
      "following_url": "https://api.github.com/users/kilasuit/following{/other_user}",
      "gists_url": "https://api.github.com/users/kilasuit/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/kilasuit",
      "id": 6355225,
      "login": "kilasuit",
      "node_id": "MDQ6VXNlcjYzNTUyMjU=",
      "organizations_url": "https://api.github.com/users/kilasuit/orgs",
      "received_events_url": "https://api.github.com/users/kilasuit/received_events",
      "repos_url": "https://api.github.com/users/kilasuit/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/kilasuit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kilasuit/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/kilasuit"
    }
  },
  {
    "author_association": "NONE",
    "body": "It seems you are correct, however I was sure this wasn't the original behavior with Windows PowerShell ? ... however testing below is seems that it is the current behavior, which I am surprised.\r\n\r\n```powershell\r\n$env:PSModulePath -split \";\"\r\nD:\\OneDrive\\Documents\\WindowsPowerShell\\Modules\r\nC:\\Program Files\\WindowsPowerShell\\Modules\r\n```\r\n\r\n\r\n```powershell\r\nfind-module profiler -AllVersions\r\n\r\nVersion              Name                                Repository           Description\r\n-------              ----                                ----------           -----------\r\n3.1.1                Profiler                            PSGallery            Script, ScriptBlock and module performanâ€¦\r\n3.0.2                Profiler                            PSGallery\r\n\r\ninstall-module profiler -Scope AllUsers\r\ninstall-module profiler -Scope CurrentUser -RequiredVersion 3.0.2\r\n\r\ngmo profiler -listavailable\r\n\r\n    Directory: D:\\OneDrive\\Documents\\WindowsPowerShell\\Modules\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nScript     3.0.2                 Profiler                            Desk      {Invoke-Script, Trace-Script, Get-LatestTrace, Show-ScriptExecution}\r\n\r\n    Directory: C:\\Program Files\\WindowsPowerShell\\Modules\r\n\r\nModuleType Version    PreRelease Name                                PSEdition ExportedCommands\r\n---------- -------    ---------- ----                                --------- ----------------\r\nScript     3.1.1                 Profiler                            Desk      {Invoke-Script, Trace-Script, Get-LatestTrace, Show-ScriptExecution}\r\n```\r\n\r\nWindows Powershell + PowerShell both loading the first one it finds... I am sure it didn't always do this however?!?!\r\n\r\n```powershell\r\nTrace-Script -ScriptBlock {gps}\r\n...\r\n\r\ngmo profiler\r\n\r\nModuleType Version    PreRelease Name                                ExportedCommands\r\n---------- -------    ---------- ----                                ----------------\r\nScript     3.0.2                 Profiler\r\n```\r\n\r\n",
    "created_at": "2021-08-13T00:16:19Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15065#issuecomment-898057573",
    "id": 898057573,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15065",
    "node_id": "IC_kwDOAvT7bc41h0Vl",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/898057573/reactions"
    },
    "updated_at": "2021-08-13T00:16:19Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/898057573",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/3605266?v=4",
      "events_url": "https://api.github.com/users/brwilkinson/events{/privacy}",
      "followers_url": "https://api.github.com/users/brwilkinson/followers",
      "following_url": "https://api.github.com/users/brwilkinson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brwilkinson/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/brwilkinson",
      "id": 3605266,
      "login": "brwilkinson",
      "node_id": "MDQ6VXNlcjM2MDUyNjY=",
      "organizations_url": "https://api.github.com/users/brwilkinson/orgs",
      "received_events_url": "https://api.github.com/users/brwilkinson/received_events",
      "repos_url": "https://api.github.com/users/brwilkinson/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/brwilkinson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brwilkinson/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/brwilkinson"
    }
  },
  {
    "author_association": "NONE",
    "body": "Will close, since I didn't realize this was the same behavior as WMF 5.1.\n",
    "created_at": "2021-08-13T02:58:05Z",
    "html_url": "https://github.com/PowerShell/PowerShell/issues/15065#issuecomment-898145787",
    "id": 898145787,
    "issue_url": "https://api.github.com/repos/PowerShell/PowerShell/issues/15065",
    "node_id": "IC_kwDOAvT7bc41iJ37",
    "performed_via_github_app": null,
    "reactions": {
      "+1": 0,
      "-1": 0,
      "confused": 0,
      "eyes": 0,
      "heart": 0,
      "hooray": 0,
      "laugh": 0,
      "rocket": 0,
      "total_count": 0,
      "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/898145787/reactions"
    },
    "updated_at": "2021-08-13T02:58:05Z",
    "url": "https://api.github.com/repos/PowerShell/PowerShell/issues/comments/898145787",
    "user": {
      "avatar_url": "https://avatars.githubusercontent.com/u/3605266?v=4",
      "events_url": "https://api.github.com/users/brwilkinson/events{/privacy}",
      "followers_url": "https://api.github.com/users/brwilkinson/followers",
      "following_url": "https://api.github.com/users/brwilkinson/following{/other_user}",
      "gists_url": "https://api.github.com/users/brwilkinson/gists{/gist_id}",
      "gravatar_id": "",
      "html_url": "https://github.com/brwilkinson",
      "id": 3605266,
      "login": "brwilkinson",
      "node_id": "MDQ6VXNlcjM2MDUyNjY=",
      "organizations_url": "https://api.github.com/users/brwilkinson/orgs",
      "received_events_url": "https://api.github.com/users/brwilkinson/received_events",
      "repos_url": "https://api.github.com/users/brwilkinson/repos",
      "site_admin": false,
      "starred_url": "https://api.github.com/users/brwilkinson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brwilkinson/subscriptions",
      "type": "User",
      "url": "https://api.github.com/users/brwilkinson"
    }
  }
]
